"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[122],{33122:(e,r,s)=>{s.r(r),s.d(r,{default:()=>Q});var a=s(89379),i=s(65043),t=s(77210),n=s(83003),l=s(49806),o=s(94799),c=s(53969),d=s(64020),u=s(22555),m=s(17873),h=s(42579),p=s(55895),f=s(14333),A=s(12843),g=s(53089),x=s(24343),j=s(12097),v=s(94527),y=s(33699),w=s(91449),P=s(33023),b=s(81911),C=s(78776),_=s(10256),S=s(79067),W=s(67203),E=s(47471),I=s(85877),T=s(80172),R=s(5362),k=s(61773),q=s(18470),L=s(3665),D=s(22632),z=s(13417),B=s(78816),M=s(41894),U=s(57488),O=s(82656),F=s(70360),K=s(54434),N=s(61549),J=s(56266),G=s(72170),H=s(70579);const Q=()=>{var e,r;const s=(0,n.wA)(),{user:Q}=(0,n.d4)(e=>e.auth),[V,X]=(0,i.useState)({username:"",email:"",pseudo:""});(0,i.useEffect)(()=>{J.A.init()},[]);(0,G.m)();(0,i.useEffect)(()=>{Q&&X({username:Q.username||"",email:Q.email||"",pseudo:Q.pseudo||""})},[Q]);const[Y,Z]=(0,i.useState)({currentPassword:"",newPassword:"",confirmPassword:""}),[$,ee]=(0,i.useState)(!1),[re,se]=(0,i.useState)(!1),[ae,ie]=(0,i.useState)(!1),[te,ne]=(0,i.useState)({}),[le,oe]=(0,i.useState)(!1),[ce,de]=(0,i.useState)(!1),[ue,me]=(0,i.useState)(!1),[he,pe]=(0,i.useState)(!1),[fe,Ae]=(0,i.useState)(null),[ge,xe]=(0,i.useState)(null),[je,ve]=(0,i.useState)(!1),[ye,we]=(0,i.useState)({username:"",pseudo:"",email:"",genre:"",tranche_age:"",profession:"",ville_residence:"",origine:"",situation_matrimoniale:"",niveau_education:"",telephone:"",adresse:"",image:"",departement_id:"",eglise_locale_id:""}),{churches:Pe,departments:be,loading:Ce}=(0,K.K)(),[_e,Se]=(0,i.useState)(0);(0,i.useEffect)(()=>{var e;Q&&we({username:Q.username||"",pseudo:Q.pseudo||"",email:Q.email||"",genre:Q.genre||"",tranche_age:Q.tranche_age||"",profession:Q.profession||"",ville_residence:Q.ville_residence||"",origine:Q.origine||"",situation_matrimoniale:Q.situation_matrimoniale||"",niveau_education:Q.niveau_education||"",telephone:Q.telephone||"",adresse:Q.adresse||"",image:Q.image||"",departement_id:Q.departement_id||"",eglise_locale_id:Q.eglise_locale_id||(null===(e=Q.eglise_locale)||void 0===e?void 0:e.id)||""})},[Q]);const We=e=>{X((0,a.A)((0,a.A)({},V),{},{[e.target.name]:e.target.value}))},Ee=e=>{Z((0,a.A)((0,a.A)({},Y),{},{[e.target.name]:e.target.value})),te[e.target.name]&&ne((0,a.A)((0,a.A)({},te),{},{[e.target.name]:""}))},Ie=e=>{we((0,a.A)((0,a.A)({},ye),{},{[e.target.name]:e.target.value}))},Te=()=>{const e=document.getElementById("profile-image-input");e?e.click():(console.error("Input file non trouv\xe9"),U.oR.error("Erreur: Impossible d'acc\xe9der au s\xe9lecteur de fichiers"))},Re=()=>{pe(!1),Ae(null),xe(null)},ke=()=>{de(!1)};return(0,H.jsxs)(l.A,{maxWidth:"md",children:[(0,H.jsxs)(o.A,{elevation:3,sx:{p:4,mt:4,mb:4},children:[(0,H.jsxs)(c.A,{display:"flex",flexDirection:"column",alignItems:"center",mb:4,children:[(0,H.jsxs)(c.A,{sx:{position:"relative",mb:2},children:[(0,H.jsx)(d.A,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},badgeContent:(0,H.jsx)(u.A,{size:"small",color:"primary","aria-label":J.A.t("profile.image.changePhoto"),onClick:Te,sx:{width:32,height:32,"&:hover":{transform:"scale(1.1)",transition:"transform 0.2s"}},children:(0,H.jsx)(q.A,{sx:{fontSize:16}})}),children:(0,H.jsx)(m.A,{src:null!==Q&&void 0!==Q&&Q.image?"".concat("http://localhost:5001","/").concat(Q.image):void 0,sx:{width:100,height:100,bgcolor:"primary.main",cursor:"pointer","&:hover":{opacity:.8,transition:"opacity 0.2s"}},onClick:Te,onError:e=>{},children:null===Q||void 0===Q||null===(e=Q.username)||void 0===e||null===(r=e.charAt(0))||void 0===r?void 0:r.toUpperCase()})}),(null===Q||void 0===Q?void 0:Q.image)&&(0,H.jsx)(h.A,{size:"small",color:"error",onClick:async()=>{try{const r=await M.apiService.users.removeProfileImage();var e;if(r.data&&r.data.success)s((0,z.eg)({image:""})),U.oR.success(J.A.t("profile.image.removeSuccess"));else U.oR.error((null===(e=r.data)||void 0===e?void 0:e.message)||J.A.t("profile.image.removeError"))}catch(r){U.oR.error(J.A.t("profile.image.removeError"))}},sx:{position:"absolute",top:-8,left:-8,bgcolor:"white",border:"2px solid",borderColor:"error.main","&:hover":{bgcolor:"error.light",color:"white"}},children:(0,H.jsx)(R.A,{sx:{fontSize:16}})})]}),(0,H.jsx)("input",{id:"profile-image-input",type:"file",accept:"image/*",onChange:e=>{const r=e.target.files[0];if(r){if(!r.type.startsWith("image/"))return void U.oR.error(J.A.t("profile.image.invalidFileType"));if(r.size>5242880)return void U.oR.error(J.A.t("profile.image.fileTooLarge"));Ae(r);const e=new FileReader;e.onload=e=>{xe(e.target.result)},e.readAsDataURL(r),pe(!0)}e.target.value=""},style:{display:"none"}}),(0,H.jsx)(p.A,{variant:"h5",gutterBottom:!0,children:J.A.t("profile.title")})]}),(0,H.jsx)(c.A,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:(0,H.jsxs)(f.A,{value:_e,onChange:(e,r)=>Se(r),"aria-label":J.A.t("profile.tabs.informations"),centered:!0,children:[(0,H.jsx)(A.A,{label:J.A.t("profile.tabs.informations")}),(0,H.jsx)(A.A,{label:J.A.t("profile.tabs.preferences")}),(0,H.jsx)(A.A,{label:J.A.t("profile.tabs.security")})]})}),0===_e&&(0,H.jsxs)(c.A,{children:[Q?(0,H.jsx)("form",{onSubmit:async e=>{e.preventDefault();try{await s((0,z.eg)(V)).unwrap(),U.oR.success(J.A.t("success.profileUpdated"))}catch(r){U.oR.error(r.message||J.A.t("errors.api.updateProfile"))}},children:(0,H.jsxs)(g.A,{container:!0,spacing:3,children:[(0,H.jsx)(g.A,{xs:12,children:(0,H.jsx)(x.A,{fullWidth:!0,label:J.A.t("profile.basicInfo.username"),name:"username",value:V.username,onChange:We})}),(0,H.jsx)(g.A,{xs:12,children:(0,H.jsx)(x.A,{fullWidth:!0,label:J.A.t("profile.basicInfo.pseudo"),name:"pseudo",value:V.pseudo,onChange:We})}),(0,H.jsx)(g.A,{xs:12,children:(0,H.jsx)(x.A,{fullWidth:!0,label:J.A.t("profile.basicInfo.email"),name:"email",type:"email",value:V.email,onChange:We})}),(0,H.jsx)(g.A,{xs:12,children:(0,H.jsx)(j.A,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,size:"large",children:J.A.t("profile.basicInfo.updateButton")})})]})}):(0,H.jsx)(c.A,{display:"flex",justifyContent:"center",p:4,children:(0,H.jsx)(p.A,{variant:"body1",color:"text.secondary",children:J.A.t("profile.loading")})}),(0,H.jsx)(v.A,{sx:{my:3}}),(0,H.jsx)(c.A,{display:"flex",justifyContent:"center",children:(0,H.jsx)(j.A,{variant:"outlined",color:"secondary",size:"large",startIcon:(0,H.jsx)(k.A,{}),onClick:()=>{var e;Q&&we({username:Q.username||"",pseudo:Q.pseudo||"",email:Q.email||"",genre:Q.genre||"",tranche_age:Q.tranche_age||"",profession:Q.profession||"",ville_residence:Q.ville_residence||"",origine:Q.origine||"",situation_matrimoniale:Q.situation_matrimoniale||"",niveau_education:Q.niveau_education||"",telephone:Q.telephone||"",adresse:Q.adresse||"",departement_id:Q.departement_id||"",eglise_locale_id:Q.eglise_locale_id||(null===(e=Q.eglise_locale)||void 0===e?void 0:e.id)||""});de(!0)},sx:{minWidth:250},children:J.A.t("profile.basicInfo.editCompleteButton")})})]}),1===_e&&(0,H.jsx)(N.A,{}),2===_e&&(0,H.jsxs)(c.A,{children:[(0,H.jsx)(p.A,{variant:"h6",gutterBottom:!0,sx:{mb:3,color:"primary.main"},children:J.A.t("profile.security.title")}),(0,H.jsx)("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return Y.currentPassword||(e.currentPassword=J.A.t("errors.validation.currentPasswordRequired")),Y.newPassword?Y.newPassword.length<6&&(e.newPassword=J.A.t("errors.validation.passwordMinLength")):e.newPassword=J.A.t("errors.validation.newPasswordRequired"),Y.confirmPassword?Y.newPassword!==Y.confirmPassword&&(e.confirmPassword=J.A.t("errors.validation.passwordMismatch")):e.confirmPassword=J.A.t("errors.validation.confirmPasswordRequired"),Y.currentPassword===Y.newPassword&&(e.newPassword=J.A.t("errors.validation.passwordMustBeDifferent")),ne(e),0===Object.keys(e).length})()){oe(!0);try{await B.y.updatePassword({currentPassword:Y.currentPassword,newPassword:Y.newPassword}),U.oR.success(J.A.t("success.passwordChanged")),Z({currentPassword:"",newPassword:"",confirmPassword:""}),ne({})}catch(r){U.oR.error(r.message||J.A.t("errors.api.changePassword"))}finally{oe(!1)}}},children:(0,H.jsxs)(g.A,{container:!0,spacing:3,children:[(0,H.jsx)(g.A,{xs:12,children:(0,H.jsx)(x.A,{fullWidth:!0,label:J.A.t("profile.security.currentPassword"),name:"currentPassword",type:$?"text":"password",value:Y.currentPassword,onChange:Ee,error:!!te.currentPassword,helperText:te.currentPassword,InputProps:{endAdornment:(0,H.jsx)(y.A,{position:"end",children:(0,H.jsx)(h.A,{onClick:()=>ee(!$),edge:"end",children:$?(0,H.jsx)(D.A,{}):(0,H.jsx)(L.A,{})})})}})}),(0,H.jsx)(g.A,{xs:12,md:6,children:(0,H.jsx)(x.A,{fullWidth:!0,label:J.A.t("profile.security.newPassword"),name:"newPassword",type:re?"text":"password",value:Y.newPassword,onChange:Ee,error:!!te.newPassword,helperText:te.newPassword,InputProps:{endAdornment:(0,H.jsx)(y.A,{position:"end",children:(0,H.jsx)(h.A,{onClick:()=>se(!re),edge:"end",children:re?(0,H.jsx)(D.A,{}):(0,H.jsx)(L.A,{})})})}})}),(0,H.jsx)(g.A,{xs:12,md:6,children:(0,H.jsx)(x.A,{fullWidth:!0,label:J.A.t("profile.security.confirmPassword"),name:"confirmPassword",type:ae?"text":"password",value:Y.confirmPassword,onChange:Ee,error:!!te.confirmPassword,helperText:te.confirmPassword,InputProps:{endAdornment:(0,H.jsx)(y.A,{position:"end",children:(0,H.jsx)(h.A,{onClick:()=>ie(!ae),edge:"end",children:ae?(0,H.jsx)(D.A,{}):(0,H.jsx)(L.A,{})})})}})}),(0,H.jsx)(g.A,{xs:12,children:(0,H.jsx)(w.A,{severity:"info",sx:{mb:2},children:J.A.t("profile.security.passwordInfo")})}),(0,H.jsx)(g.A,{xs:12,children:(0,H.jsx)(j.A,{type:"submit",variant:"contained",color:"secondary",fullWidth:!0,size:"large",disabled:le,children:le?J.A.t("common.actions.processing"):J.A.t("profile.security.changePasswordButton")})})]})})]})]}),(0,H.jsxs)(P.A,{open:ce,onClose:ke,maxWidth:"md",fullWidth:!0,children:[(0,H.jsx)(b.A,{children:J.A.t("profile.completeProfile.title")}),(0,H.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),me(!0);try{await M.apiService.users.updateProfile(ye),U.oR.success(J.A.t("success.profileCompleteUpdated")),s((0,z.eg)({username:ye.username,pseudo:ye.pseudo,email:ye.email})),X({username:ye.username,email:ye.email,pseudo:ye.pseudo}),ke()}catch(r){const e=(0,t.hS)(r,"la mise \xe0 jour du profil complet");U.oR.error(e.message)}finally{me(!1)}},children:[(0,H.jsxs)(C.A,{children:[ye.username?(0,H.jsxs)(g.A,{container:!0,spacing:2,children:[(0,H.jsx)(g.A,{xs:12,md:6,children:(0,H.jsx)(x.A,{fullWidth:!0,label:J.A.t("profile.completeProfile.username"),name:"username",value:ye.username,onChange:Ie,required:!0})}),(0,H.jsx)(g.A,{xs:12,md:6,children:(0,H.jsx)(x.A,{fullWidth:!0,label:J.A.t("profile.completeProfile.pseudo"),name:"pseudo",value:ye.pseudo,onChange:Ie,required:!0})}),(0,H.jsx)(g.A,{xs:12,md:6,children:(0,H.jsx)(x.A,{fullWidth:!0,label:J.A.t("profile.completeProfile.email"),name:"email",type:"email",value:ye.email,onChange:Ie})}),(0,H.jsx)(g.A,{xs:12,md:6,children:(0,H.jsx)(x.A,{fullWidth:!0,label:J.A.t("profile.completeProfile.telephone"),name:"telephone",value:ye.telephone,onChange:Ie})}),(0,H.jsx)(g.A,{xs:12,md:6,children:(0,H.jsxs)(_.A,{fullWidth:!0,required:!0,children:[(0,H.jsx)(S.A,{children:J.A.t("profile.completeProfile.genre")}),(0,H.jsx)(W.A,{name:"genre",value:ye.genre,onChange:Ie,label:J.A.t("profile.completeProfile.genre"),children:O.xG.map(e=>(0,H.jsx)(E.A,{value:e.value,children:e.label},e.value))})]})}),(0,H.jsx)(g.A,{xs:12,md:6,children:(0,H.jsxs)(_.A,{fullWidth:!0,required:!0,children:[(0,H.jsx)(S.A,{children:J.A.t("profile.completeProfile.trancheAge")}),(0,H.jsx)(W.A,{name:"tranche_age",value:ye.tranche_age,onChange:Ie,label:J.A.t("profile.completeProfile.trancheAge"),children:O.T.map(e=>(0,H.jsx)(E.A,{value:e.value,children:e.label},e.value))})]})}),(0,H.jsx)(g.A,{xs:12,md:6,children:(0,H.jsx)(x.A,{fullWidth:!0,label:J.A.t("profile.completeProfile.profession"),name:"profession",value:ye.profession,onChange:Ie,required:!0})}),(0,H.jsx)(g.A,{xs:12,md:6,children:(0,H.jsx)(x.A,{fullWidth:!0,label:J.A.t("profile.completeProfile.villeResidence"),name:"ville_residence",value:ye.ville_residence,onChange:Ie,required:!0})}),(0,H.jsx)(g.A,{xs:12,md:6,children:(0,H.jsxs)(_.A,{fullWidth:!0,required:!0,children:[(0,H.jsx)(S.A,{children:J.A.t("profile.completeProfile.origine")}),(0,H.jsx)(W.A,{name:"origine",value:ye.origine,onChange:Ie,label:J.A.t("profile.completeProfile.origine"),children:F.F.map(e=>(0,H.jsx)(E.A,{value:e.value,children:e.label},e.value))})]})}),(0,H.jsx)(g.A,{xs:12,md:6,children:(0,H.jsxs)(_.A,{fullWidth:!0,required:!0,children:[(0,H.jsx)(S.A,{children:J.A.t("profile.completeProfile.situationMatrimoniale")}),(0,H.jsx)(W.A,{name:"situation_matrimoniale",value:ye.situation_matrimoniale,onChange:Ie,label:J.A.t("profile.completeProfile.situationMatrimoniale"),children:O.LA.map(e=>(0,H.jsx)(E.A,{value:e.value,children:e.label},e.value))})]})}),(0,H.jsx)(g.A,{xs:12,md:6,children:(0,H.jsxs)(_.A,{fullWidth:!0,required:!0,children:[(0,H.jsx)(S.A,{children:J.A.t("profile.completeProfile.niveauEducation")}),(0,H.jsx)(W.A,{name:"niveau_education",value:ye.niveau_education,onChange:Ie,label:J.A.t("profile.completeProfile.niveauEducation"),children:O.RD.map(e=>(0,H.jsx)(E.A,{value:e.value,children:e.label},e.value))})]})}),(0,H.jsx)(g.A,{xs:12,md:6,children:(0,H.jsxs)(_.A,{fullWidth:!0,sx:{minWidth:180},children:[(0,H.jsx)(S.A,{children:J.A.t("profile.completeProfile.departement")}),(0,H.jsxs)(W.A,{name:"departement_id",value:ye.departement_id||"",onChange:Ie,label:J.A.t("profile.completeProfile.departement"),disabled:Ce,children:[(0,H.jsx)(E.A,{value:"",children:(0,H.jsx)("em",{children:J.A.t("profile.completeProfile.noDepartement")})}),Array.isArray(be)&&be.map(e=>(0,H.jsx)(E.A,{value:e.id,children:e.nom},e.id))]})]})}),(0,H.jsx)(g.A,{xs:12,md:6,children:(0,H.jsx)(x.A,{fullWidth:!0,label:J.A.t("profile.completeProfile.adresse"),name:"adresse",value:ye.adresse,onChange:Ie,multiline:!0,rows:3})})]}):(0,H.jsx)(c.A,{display:"flex",justifyContent:"center",p:4,children:(0,H.jsx)(p.A,{variant:"body1",color:"text.secondary",children:J.A.t("profile.completeProfile.loading")})}),(0,H.jsxs)(w.A,{severity:"info",sx:{mt:2},children:[(0,H.jsx)("strong",{children:"Note :"})," ",J.A.t("profile.completeProfile.note")]})]}),(0,H.jsxs)(I.A,{children:[(0,H.jsx)(j.A,{onClick:ke,color:"primary",children:J.A.t("common.actions.cancel")}),(0,H.jsx)(j.A,{type:"submit",variant:"contained",color:"primary",disabled:ue,children:ue?J.A.t("common.actions.processing"):J.A.t("common.actions.save")})]})]})]}),(0,H.jsxs)(P.A,{open:he,onClose:Re,maxWidth:"sm",fullWidth:!0,children:[(0,H.jsx)(b.A,{children:J.A.t("profile.image.previewTitle")}),(0,H.jsx)(C.A,{children:(0,H.jsxs)(c.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[ge&&(0,H.jsx)(m.A,{src:ge,sx:{width:150,height:150,border:"3px solid",borderColor:"primary.main"}}),(0,H.jsx)(p.A,{variant:"body2",color:"text.secondary",textAlign:"center",children:null===fe||void 0===fe?void 0:fe.name}),(0,H.jsx)(p.A,{variant:"caption",color:"text.secondary",textAlign:"center",children:J.A.t("profile.image.confirmUpload")})]})}),(0,H.jsxs)(I.A,{children:[(0,H.jsx)(j.A,{onClick:Re,color:"primary",children:J.A.t("common.actions.cancel")}),(0,H.jsx)(j.A,{onClick:async()=>{if(fe){ve(!0);try{const r=new FormData;r.append("image",fe);const a=await M.apiService.users.uploadProfileImage(r);var e;if(a.data&&a.data.success)s((0,z.eg)({image:a.data.data.image})),U.oR.success(J.A.t("profile.image.uploadSuccess")),pe(!1),Ae(null),xe(null);else U.oR.error((null===(e=a.data)||void 0===e?void 0:e.message)||J.A.t("profile.image.uploadError"))}catch(r){U.oR.error(J.A.t("profile.image.uploadError"))}finally{ve(!1)}}},variant:"contained",color:"primary",disabled:je,startIcon:je?(0,H.jsx)(T.A,{size:16}):null,children:je?J.A.t("common.actions.uploading"):J.A.t("common.actions.upload")})]})]})]})}},39408:(e,r,s)=>{s.d(r,{A:()=>i});var a=s(89379);const i=new class{constructor(){this.storageKey="user_preferences",this.defaultPreferences={language:"fr",theme:"light",autoTheme:!0},this.loadPreferences()}loadPreferences(){try{const e=localStorage.getItem(this.storageKey);this.preferences=e?(0,a.A)((0,a.A)({},this.defaultPreferences),JSON.parse(e)):(0,a.A)({},this.defaultPreferences)}catch(e){this.preferences=(0,a.A)({},this.defaultPreferences)}}savePreferences(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.preferences))}catch(e){}}getPreference(e){return this.preferences[e]}setPreference(e,r){this.preferences[e]=r,this.savePreferences(),this.applyPreferences()}getAllPreferences(){return(0,a.A)({},this.preferences)}applyPreferences(){this.applyTheme(),this.applyLanguage()}applyTheme(){const{theme:e,autoTheme:r}=this.preferences;if(r){const e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";document.documentElement.setAttribute("data-theme",e)}else document.documentElement.setAttribute("data-theme",e)}applyLanguage(){const{language:e}=this.preferences;document.documentElement.setAttribute("lang",e),window.dispatchEvent(new CustomEvent("languageChanged",{detail:{language:e}}))}listenToSystemTheme(){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{this.preferences.autoTheme&&this.applyTheme()})}init(){this.applyPreferences(),this.listenToSystemTheme()}}},61549:(e,r,s)=>{s.d(r,{A:()=>W});var a=s(89379),i=s(65043),t=s(94799),n=s(53969),l=s(55895),o=s(53089),c=s(10256),d=s(79067),u=s(67203),m=s(47471),h=s(1725),p=s(85030),f=s(94527),A=s(12097),g=s(91449),x=s(16936),j=s(15939),v=s(4573),y=s(85490),w=s(57488),P=s(39408),b=s(78816);const C=new class{async getPreferences(){try{return(await b.A.get("/preferences")).data}catch(e){throw console.error("Erreur lors de la r\xe9cup\xe9ration des pr\xe9f\xe9rences:",e),e}}async updatePreferences(e){try{return(await b.A.put("/preferences",e)).data}catch(r){throw console.error("Erreur lors de la mise \xe0 jour des pr\xe9f\xe9rences:",r),r}}async updateEmailPreferences(e){try{return(await b.A.put("/preferences/email",{email_notifications:e})).data}catch(r){throw console.error("Erreur lors de la mise \xe0 jour des pr\xe9f\xe9rences email:",r),r}}};var _=s(56266),S=s(70579);const W=()=>{const[e,r]=(0,i.useState)({language:"fr",theme:"light",autoTheme:!0,email_notifications:!0}),[s,b]=(0,i.useState)({language:"fr",theme:"light",autoTheme:!0,email_notifications:!0}),[W,E]=(0,i.useState)(!1),[I,T]=(0,i.useState)(!1),[R,k]=(0,i.useState)(0);(0,i.useEffect)(()=>{(async()=>{try{var e,s,a,i;const t=_.A.getCurrentLanguage(),n=P.A.getPreference("autoTheme")||!0,l=await C.getPreferences(),o={language:(null===l||void 0===l||null===(e=l.data)||void 0===e?void 0:e.language)||t,theme:(null===l||void 0===l||null===(s=l.data)||void 0===s?void 0:s.theme)||"light",autoTheme:n,email_notifications:null===(a=null===l||void 0===l||null===(i=l.data)||void 0===i?void 0:i.email_notifications)||void 0===a||a};r(o),b(o)}catch(t){console.error("Erreur lors du chargement des pr\xe9f\xe9rences:",t);const e={language:_.A.getCurrentLanguage(),theme:"light",autoTheme:P.A.getPreference("autoTheme")||!0,email_notifications:!0};r(e),b(e)}})()},[e.theme]),(0,i.useEffect)(()=>{const r=s.language!==e.language,a=s.theme!==e.theme,i=s.autoTheme!==e.autoTheme,t=s.email_notifications!==e.email_notifications;T(r||a||i||t)},[e,s]),(0,i.useEffect)(()=>{if(R>0){const e=_.A.getCurrentLanguage();r(r=>(0,a.A)((0,a.A)({},r),{},{language:e,theme:r.theme}))}},[R]);const q=(e,s)=>{r(r=>(0,a.A)((0,a.A)({},r),{},{[e]:s})),T(!0)};return(0,S.jsxs)(t.A,{sx:{p:3,mb:3},children:[(0,S.jsxs)(n.A,{display:"flex",alignItems:"center",mb:3,children:[(0,S.jsx)(x.A,{sx:{mr:2,color:"primary.main"}}),(0,S.jsx)(l.A,{variant:"h6",component:"h3",children:_.A.t("profile.preferences.title")})]}),(0,S.jsxs)(o.A,{container:!0,spacing:3,children:[(0,S.jsx)(o.A,{item:!0,xs:12,md:6,children:(0,S.jsxs)(n.A,{children:[(0,S.jsxs)(n.A,{display:"flex",alignItems:"center",mb:2,children:[(0,S.jsx)(j.A,{sx:{mr:1,color:"primary.main"}}),(0,S.jsx)(l.A,{variant:"subtitle1",fontWeight:"bold",children:_.A.t("profile.preferences.language.title")})]}),(0,S.jsxs)(c.A,{fullWidth:!0,children:[(0,S.jsx)(d.A,{children:_.A.t("profile.preferences.language.title")}),(0,S.jsx)(u.A,{value:e.language,onChange:e=>q("language",e.target.value),label:_.A.t("profile.preferences.language.title"),children:_.A.getAvailableLanguages().map(e=>(0,S.jsx)(m.A,{value:e.code,children:(0,S.jsxs)(n.A,{display:"flex",alignItems:"center",children:[(0,S.jsx)("span",{style:{marginRight:"8px"},children:e.flag}),(0,S.jsx)("span",{children:e.nativeName||e.code.toUpperCase()})]})},e.code))})]})]})}),(0,S.jsx)(o.A,{item:!0,xs:12,md:6,children:(0,S.jsxs)(n.A,{children:[(0,S.jsxs)(n.A,{display:"flex",alignItems:"center",mb:2,children:[(0,S.jsx)(v.A,{sx:{mr:1,color:"primary.main"}}),(0,S.jsx)(l.A,{variant:"subtitle1",fontWeight:"bold",children:_.A.t("profile.preferences.email.title")})]}),(0,S.jsx)(h.A,{control:(0,S.jsx)(p.A,{checked:e.email_notifications,onChange:e=>q("email_notifications",e.target.checked),color:"primary"}),label:(0,S.jsxs)(n.A,{children:[(0,S.jsx)(l.A,{variant:"body2",children:_.A.t("profile.preferences.email.notifications")}),(0,S.jsx)(l.A,{variant:"caption",color:"text.secondary",children:_.A.t("profile.preferences.email.description")})]})})]})}),(0,S.jsx)(o.A,{item:!0,xs:12,md:6,children:(0,S.jsxs)(n.A,{children:[(0,S.jsxs)(n.A,{display:"flex",alignItems:"center",mb:2,children:[(0,S.jsx)(y.A,{sx:{mr:1,color:"primary.main"}}),(0,S.jsx)(l.A,{variant:"subtitle1",fontWeight:"bold",children:_.A.t("profile.preferences.theme.title")})]}),(0,S.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{fontStyle:"italic"},children:_.A.t("profile.preferences.theme.disabled")})]})})]}),(0,S.jsx)(f.A,{sx:{my:3}}),(0,S.jsxs)(n.A,{display:"flex",gap:2,justifyContent:"flex-end",children:[(0,S.jsx)(A.A,{variant:"outlined",onClick:()=>{r({language:"fr",theme:"light",autoTheme:!0}),_.A.setLanguage("fr"),T(!1),b(e)},disabled:W,children:_.A.t("common.actions.reset")}),(0,S.jsx)(A.A,{variant:"contained",onClick:async()=>{E(!0);try{_.A.setLanguage(e.language),P.A.setPreference("autoTheme",e.autoTheme);try{const r=await C.updatePreferences({email_notifications:e.email_notifications,language:e.language,theme:e.theme});r&&r.success?console.log("\u2705 Pr\xe9f\xe9rences sauvegard\xe9es avec succ\xe8s via l'API"):console.warn("\u26a0\ufe0f R\xe9ponse API inattendue:",r)}catch(r){console.error("\u274c Erreur API lors de la sauvegarde des pr\xe9f\xe9rences:",r),w.oR.error("Erreur lors de la sauvegarde sur le serveur, mais les changements locaux sont appliqu\xe9s")}k(e=>e+1),window.dispatchEvent(new CustomEvent("languageOrThemeChanged",{detail:{language:e.language,theme:e.theme,timestamp:Date.now()}})),w.oR.success(_.A.t("success.preferencesSaved")),T(!1),b(e)}catch(s){w.oR.error(_.A.t("errors.general")),console.error("Erreur de sauvegarde:",s)}finally{E(!1)}},disabled:W||!I,startIcon:null,children:W?_.A.t("common.actions.saving"):_.A.t("profile.actions.savePreferences")})]}),I&&(0,S.jsx)(g.A,{severity:"info",sx:{mt:2},children:_.A.t("profile.preferences.unsavedChanges")})]})}}}]);
//# sourceMappingURL=122.58fe7b21.chunk.js.map