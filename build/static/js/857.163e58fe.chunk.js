"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[857],{32238:(e,t,r)=>{r.r(t),r.d(t,{default:()=>$});var o=r(89379),l=r(65043),s=r(56266),a=r(77210),i=r(15521),n=r(42227),d=r(94799),c=r(53969),u=r(55895),h=r(24343),m=r(47471),_=r(28259),v=r(87443),p=r(10756),x=r(86172),A=r(81341),g=r(34375),f=r(42579),j=r(33023),b=r(81911),C=r(78776),y=r(10256),S=r(79067),B=r(67203),w=r(85877),W=r(12097),k=r(70916),L=r(91449),q=r(13059),I=r(5362),E=r(61773),D=r(87338),N=r(80899),P=r(63516),T=r(82656),M=r(45492),R=r(83140),U=r(72301),O=r(24634),Y=r(37251),z=r(41894),F=r(45350),V=r(98914),G=r(22094),H=r(70579);const Z=N.Ik({culte:N.Yj().required("Le type de culte est requis"),orateur:N.Yj().required("L'orateur est requis"),date:N.p6().required("La date est requise"),total_adultes:N.ai().min(0,"Le nombre doit \xeatre positif").required("Le nombre d'adultes est requis"),total_enfants:N.ai().min(0,"Le nombre doit \xeatre positif").required("Le nombre d'enfants est requis"),total_chantres:N.ai().min(0,"Le nombre doit \xeatre positif").required("Le nombre de chantres est requis"),total_protocoles:N.ai().min(0,"Le nombre doit \xeatre positif").required("Le nombre de protocoles est requis"),total_multimedia:N.ai().min(0,"Le nombre doit \xeatre positif").required("Le nombre de multimedia est requis"),total_respo_ecodim:N.Yj().required("Le responsable ECODIM est requis"),total_animateurs_ecodim:N.ai().min(0,"Le nombre doit \xeatre positif").required("Le nombre d'animateurs ECODIM est requis"),total_enfants_ecodim:N.ai().min(0,"Le nombre doit \xeatre positif").required("Le nombre d'enfants ECODIM est requis"),collecteur_culte:N.Yj().required("Le collecteur est requis"),superviseur:N.Yj().required("Le superviseur est requis")}),$=()=>{const{canUpdateServices:e,canDeleteServices:t}=(0,F.S)(),{selectedChurch:r}=(0,V.w)(),[N,$]=((0,D.Zp)(),(0,l.useState)(0)),[J,K]=(0,l.useState)(10),[Q,X]=(0,l.useState)(!1),[ee,te]=(0,l.useState)(null),[re,oe]=(0,l.useState)([]),[le,se]=(0,l.useState)([]),[ae,ie]=(0,l.useState)(!1),[ne,de]=(0,l.useState)(null),[ce,ue]=(0,l.useState)({type:"",date:"",collecteur:"",superviseur:""}),{services:he,loading:me,error:_e,fetchServices:ve,updateService:pe,deleteService:xe}=(0,O.A$)(),{notification:Ae,showSuccess:ge,showError:fe,hideNotification:je}=(0,Y.h)(),be=()=>{ie(!1),de(null)};(0,l.useEffect)(()=>{ve(),(async()=>{try{var e,t;const[r,o]=await Promise.all([z.apiService.users.getAll({role:"COLLECTEUR_CULTE"}),z.apiService.users.getAll({role:"SUPERVISEUR"})]),l=(null===(e=r.data)||void 0===e?void 0:e.data)||r.data||[],a=(null===(t=o.data)||void 0===t?void 0:t.data)||o.data||[];oe(l.map(e=>({id:e.id||e._id,username:e.username||e.pseudo||s.A.t("common_text.unknownName"),pseudo:e.pseudo||e.username||s.A.t("common_text.unknownName")}))),se(a.map(e=>({id:e.id||e._id,username:e.username||e.pseudo||s.A.t("common_text.unknownName"),pseudo:e.pseudo||e.username||s.A.t("common_text.unknownName")})))}catch(r){(0,a.hS)(r,s.A.t("errors.api.loadUsers")),fe(s.A.t("errors.api.loadUsers"))}})()},[ve]);const Ce=(0,l.useMemo)(()=>{if(null===r||void 0===r||!r.id||!he||0===he.length)return[];return he.filter(e=>{var t;const o=((null===(t=e.eglise)||void 0===t?void 0:t.id)||e.eglise_id)===r.id;return o})},[he,r]);(0,l.useEffect)(()=>{Ce.length},[Ce]);const ye=()=>{X(!1),te(null),Se.setValues({culte:"",orateur:"",date:(new Date).toISOString().split("T")[0],total_adultes:0,total_enfants:0,total_chantres:0,total_protocoles:0,total_multimedia:0,total_respo_ecodim:0,total_animateurs_ecodim:0,total_enfants_ecodim:0,collecteur_culte:"",superviseur:""}),Se.setTouched({}),Se.setErrors({})},Se=(0,P.Wx)({initialValues:{culte:"",orateur:"",date:new Date,total_adultes:"",total_enfants:"",total_chantres:"",total_protocoles:"",total_multimedia:"",total_respo_ecodim:"",total_animateurs_ecodim:"",total_enfants_ecodim:"",collecteur_culte:"",superviseur:""},validationSchema:Z,onSubmit:async e=>{try{const t=(null===ee||void 0===ee?void 0:ee.id)||(null===ee||void 0===ee?void 0:ee._id);if(!t)return void fe(s.A.t("errors.validation.serviceIdNotFound"));const r={culte:e.culte,orateur:e.orateur,date:e.date,total_adultes:parseInt(e.total_adultes)||0,total_enfants:parseInt(e.total_enfants)||0,total_chantres:parseInt(e.total_chantres)||0,total_protocoles:parseInt(e.total_protocoles)||0,total_multimedia:parseInt(e.total_multimedia)||0,total_respo_ecodim:parseInt(e.total_respo_ecodim)||0,total_animateurs_ecodim:parseInt(e.total_animateurs_ecodim)||0,total_enfants_ecodim:parseInt(e.total_enfants_ecodim)||0,collecteur_culte_id:e.collecteur_culte||null,superviseur_id:e.superviseur||null};await pe(t,r);const l=Ce.map(e=>(e.id||e._id)===t?(0,o.A)((0,o.A)({},e),r):e);ve(l),ye(),ge(s.A.t("success.serviceUpdated"))}catch(_e){fe(s.A.t("errors.api.updateService"))}}}),Be=e=>{ue((0,o.A)((0,o.A)({},ce),{},{[e.target.name]:e.target.value}))},we=Ce.filter(e=>{var t,r;if(ce.type&&"Tous"!==ce.type&&e.culte!==ce.type)return!1;if(ce.date){const t=new Date(ce.date),r=new Date(e.date);if(t.getFullYear()!==r.getFullYear()||t.getMonth()!==r.getMonth()||t.getDate()!==r.getDate())return!1}return!(ce.collecteur&&(null===(t=e.collecteur_culte)||void 0===t||!t.username.toLowerCase().includes(ce.collecteur.toLowerCase())))&&!(ce.superviseur&&(null===(r=e.superviseur)||void 0===r||!r.username.toLowerCase().includes(ce.superviseur.toLowerCase())))});return me?(0,H.jsx)(U.A,{titre:s.A.t("loading.loadingServices")}):_e?(0,H.jsx)(M.A,{message:_e}):null!==r&&void 0!==r&&r.id?(0,H.jsx)(G.A,{allowedRoles:["SUPER_ADMIN","ADMIN","MANAGER","SUPERVISEUR"],children:(0,H.jsxs)(d.A,{"data-aos":"fade-up",elevation:3,sx:{p:4},children:[(0,H.jsxs)(c.A,{mb:4,children:[(0,H.jsx)(u.A,{variant:"h6",gutterBottom:!0,children:s.A.t("common.actions.filter")}),(0,H.jsxs)(c.A,{display:"flex",gap:2,flexWrap:"wrap",children:[(0,H.jsx)(h.A,{select:!0,name:"type",label:s.A.t("services.list.typeCulte"),value:ce.type,onChange:Be,sx:{minWidth:200,backgroundColor:"#fdfdfd"},children:T.ze.map(e=>(0,H.jsx)(m.A,{value:e.value,children:e.label},e.value))}),(0,H.jsx)(h.A,{type:"date",name:"date",label:s.A.t("common.time.days"),value:ce.date,onChange:Be,InputLabelProps:{shrink:!0},sx:{minWidth:200,backgroundColor:"#fdfdfd"}}),(0,H.jsx)(h.A,{name:"collecteur",label:s.A.t("services.list.collecteur"),value:ce.collecteur,onChange:Be,sx:{minWidth:200,backgroundColor:"#fdfdfd"}}),(0,H.jsx)(h.A,{name:"superviseur",label:s.A.t("services.list.superviseur"),value:ce.superviseur,onChange:Be,sx:{minWidth:200,backgroundColor:"#fdfdfd"}})]})]}),(0,H.jsx)(_.A,{component:d.A,sx:{backgroundColor:"primary.light",maxHeight:"80vh",overflow:"auto"},children:(0,H.jsxs)(v.A,{sx:{backgroundColor:"#fff"},children:[(0,H.jsx)(p.A,{sx:{backgroundColor:"#dcdcdc"},children:(0,H.jsxs)(x.A,{children:[(0,H.jsx)(A.A,{sx:{fontWeight:"bold"},children:s.A.t("services.list.typeCulte")}),(0,H.jsx)(A.A,{sx:{fontWeight:"bold"},children:s.A.t("services.list.orateur")}),(0,H.jsx)(A.A,{sx:{fontWeight:"bold"},children:s.A.t("common.time.days")}),(0,H.jsx)(A.A,{align:"right",sx:{fontWeight:"bold"},children:s.A.t("services.list.adultes")}),(0,H.jsx)(A.A,{align:"right",sx:{fontWeight:"bold"},children:s.A.t("services.list.enfants")}),(0,H.jsx)(A.A,{align:"right",sx:{fontWeight:"bold"},children:s.A.t("services.list.chantres")}),(0,H.jsx)(A.A,{align:"right",sx:{fontWeight:"bold"},children:s.A.t("services.list.protocoles")}),(0,H.jsx)(A.A,{align:"right",sx:{fontWeight:"bold"},children:s.A.t("services.list.multimedia")}),(0,H.jsx)(A.A,{align:"right",sx:{fontWeight:"bold"},children:s.A.t("services.list.respEcodim")}),(0,H.jsx)(A.A,{align:"right",sx:{fontWeight:"bold"},children:s.A.t("services.list.animEcodim")}),(0,H.jsx)(A.A,{align:"right",sx:{fontWeight:"bold"},children:s.A.t("services.list.enfEcodim")}),(0,H.jsx)(A.A,{sx:{fontWeight:"bold"},children:s.A.t("services.list.collecteur")}),(0,H.jsx)(A.A,{sx:{fontWeight:"bold"},children:s.A.t("services.list.superviseur")}),(0,H.jsx)(A.A,{align:"center",sx:{fontWeight:"bold",minWidth:120},children:s.A.t("common.actions.title")})]})}),(0,H.jsxs)(g.A,{sx:{backgroundColor:"white"},children:[we.slice(N*J,N*J+J).map(r=>{const o=r.id||r._id;return(0,H.jsxs)(x.A,{hover:!0,sx:{transition:"background-color 0.2s","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.03)"}},children:[(0,H.jsx)(A.A,{children:r.culte}),(0,H.jsx)(A.A,{children:r.orateur}),(0,H.jsx)(A.A,{children:(0,i.GP)(new Date(r.date),"dd MMMM yyyy",{locale:n.A})}),(0,H.jsx)(A.A,{align:"right",children:r.total_adultes||0}),(0,H.jsx)(A.A,{align:"right",children:r.total_enfants||0}),(0,H.jsx)(A.A,{align:"right",children:r.total_chantres||0}),(0,H.jsx)(A.A,{align:"right",children:r.total_protocoles||0}),(0,H.jsx)(A.A,{align:"right",children:r.total_multimedia||0}),(0,H.jsx)(A.A,{align:"right",children:r.total_respo_ecodim||0}),(0,H.jsx)(A.A,{align:"right",children:r.total_animateurs_ecodim||0}),(0,H.jsx)(A.A,{align:"right",children:r.total_enfants_ecodim||0}),(0,H.jsx)(A.A,{children:r.collecteur_culte?r.collecteur_culte.username:""}),(0,H.jsx)(A.A,{children:r.superviseur?r.superviseur.username:""}),(0,H.jsxs)(A.A,{align:"center",children:[(0,H.jsx)(f.A,{color:"primary",onClick:()=>(e=>{var t,r,o,l;te(e),X(!0),Se.setValues({culte:e.culte||"",orateur:e.orateur||"",date:e.date||new s.A.t("common.time.days")().toISOString().split("T")[0],total_adultes:e.total_adultes||0,total_enfants:e.total_enfants||0,total_chantres:e.total_chantres||0,total_protocoles:e.total_protocoles||0,total_multimedia:e.total_multimedia||0,total_respo_ecodim:e.total_respo_ecodim||0,total_animateurs_ecodim:e.total_animateurs_ecodim||0,total_enfants_ecodim:e.total_enfants_ecodim||0,collecteur_culte:(null===(t=e.collecteur_culte)||void 0===t?void 0:t.id)||(null===(r=e.collecteur_culte)||void 0===r?void 0:r._id)||"",superviseur:(null===(o=e.superviseur)||void 0===o?void 0:o.id)||(null===(l=e.superviseur)||void 0===l?void 0:l._id)||""})})(r),disabled:!e,title:e?"":s.A.t("errors.adminOnlyRead"),children:(0,H.jsx)(E.A,{})}),(0,H.jsx)(f.A,{color:"error",onClick:()=>(e=>{de(e),ie(!0)})(r),disabled:!t,title:t?"":s.A.t("errors.adminOnlyRead"),children:(0,H.jsx)(I.A,{})})]})]},o)}),0===we.length&&(0,H.jsx)(x.A,{children:(0,H.jsx)(A.A,{colSpan:14,align:"center",children:s.A.t("services.list.noServices")})})]})]})}),(0,H.jsxs)(j.A,{open:Q,onClose:ye,maxWidth:"md",fullWidth:!0,children:[(0,H.jsx)(b.A,{children:s.A.t("services.list.editService")}),(0,H.jsxs)("form",{onSubmit:Se.handleSubmit,children:[(0,H.jsx)(C.A,{children:(0,H.jsxs)(c.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,H.jsx)(h.A,{fullWidth:!0,name:"culte",label:s.A.t("services.list.typeCulte"),value:Se.values.culte,onChange:Se.handleChange,onBlur:Se.handleBlur,error:Se.touched.culte&&Boolean(Se.errors.culte),helperText:Se.touched.culte&&Se.errors.culte}),(0,H.jsx)(h.A,{fullWidth:!0,name:"orateur",label:s.A.t("services.list.orateur"),value:Se.values.orateur,onChange:Se.handleChange,onBlur:Se.handleBlur,error:Se.touched.orateur&&Boolean(Se.errors.orateur),helperText:Se.touched.orateur&&Se.errors.orateur}),(0,H.jsx)(h.A,{fullWidth:!0,type:"date",name:"date",value:Se.values.date,onChange:Se.handleChange,onBlur:Se.handleBlur,error:Se.touched.date&&Boolean(Se.errors.date),helperText:Se.touched.date&&Se.errors.date,InputLabelProps:{shrink:!0}}),(0,H.jsx)(h.A,{fullWidth:!0,name:"total_adultes",label:"Nombre d'".concat(s.A.t("services.list.adultes")),type:"number",value:Se.values.total_adultes,onChange:Se.handleChange,onBlur:Se.handleBlur,error:Se.touched.total_adultes&&Boolean(Se.errors.total_adultes),helperText:Se.touched.total_adultes&&Se.errors.total_adultes}),(0,H.jsx)(h.A,{fullWidth:!0,name:"total_enfants",label:"Nombre d'".concat(s.A.t("services.list.enfants")),type:"number",value:Se.values.total_enfants,onChange:Se.handleChange,onBlur:Se.handleBlur,error:Se.touched.total_enfants&&Boolean(Se.errors.total_enfants),helperText:Se.touched.total_enfants&&Se.errors.total_enfants}),(0,H.jsx)(h.A,{fullWidth:!0,name:"total_chantres",label:"Nombre de ".concat(s.A.t("services.list.chantres")),type:"number",value:Se.values.total_chantres,onChange:Se.handleChange,onBlur:Se.handleBlur,error:Se.touched.total_chantres&&Boolean(Se.errors.total_chantres),helperText:Se.touched.total_chantres&&Se.errors.total_chantres}),(0,H.jsx)(h.A,{fullWidth:!0,name:"total_protocoles",label:"Nombre de ".concat(s.A.t("services.list.protocoles")),type:"number",value:Se.values.total_protocoles,onChange:Se.handleChange,onBlur:Se.handleBlur,error:Se.touched.total_protocoles&&Boolean(Se.errors.total_protocoles),helperText:Se.touched.total_protocoles&&Se.errors.total_protocoles}),(0,H.jsx)(h.A,{fullWidth:!0,name:"total_multimedia",label:"Nombre ".concat(s.A.t("services.list.multimedia")),type:"number",value:Se.values.total_multimedia,onChange:Se.handleChange,onBlur:Se.handleBlur,error:Se.touched.total_multimedia&&Boolean(Se.errors.total_multimedia),helperText:Se.touched.total_multimedia&&Se.errors.total_multimedia}),(0,H.jsx)(h.A,{fullWidth:!0,name:"total_respo_ecodim",label:"Responsable ".concat(s.A.t("services.list.respEcodim")),value:Se.values.total_respo_ecodim,onChange:Se.handleChange,onBlur:Se.handleBlur,error:Se.touched.total_respo_ecodim&&Boolean(Se.errors.total_respo_ecodim),helperText:Se.touched.total_respo_ecodim&&Se.errors.total_respo_ecodim}),(0,H.jsx)(h.A,{fullWidth:!0,name:"total_animateurs_ecodim",label:"Nombre d'".concat(s.A.t("services.list.animEcodim")),type:"number",value:Se.values.total_animateurs_ecodim,onChange:Se.handleChange,onBlur:Se.handleBlur,error:Se.touched.total_animateurs_ecodim&&Boolean(Se.errors.total_animateurs_ecodim),helperText:Se.touched.total_animateurs_ecodim&&Se.errors.total_animateurs_ecodim}),(0,H.jsx)(h.A,{fullWidth:!0,name:"total_enfants_ecodim",label:"Nombre d'".concat(s.A.t("services.list.enfants")," ").concat(s.A.t("services.list.enfEcodim")),type:"number",value:Se.values.total_enfants_ecodim,onChange:Se.handleChange,onBlur:Se.handleBlur,error:Se.touched.total_enfants_ecodim&&Boolean(Se.errors.total_enfants_ecodim),helperText:Se.touched.total_enfants_ecodim&&Se.errors.total_enfants_ecodim}),(0,H.jsxs)(y.A,{fullWidth:!0,children:[(0,H.jsx)(S.A,{children:s.A.t("services.list.collecteur")}),(0,H.jsxs)(B.A,{name:"collecteur_culte",value:Se.values.collecteur_culte||"",onChange:Se.handleChange,onBlur:Se.handleBlur,error:Se.touched.collecteur_culte&&Boolean(Se.errors.collecteur_culte),children:[(0,H.jsx)(m.A,{value:"",children:"i18nService.t('services.list.selectCollecteur')"}),re.map(e=>(0,H.jsx)(m.A,{value:e._id||e.id,children:e.username||e.pseudo},e._id||e.id))]}),Se.touched.collecteur_culte&&Se.errors.collecteur_culte&&(0,H.jsx)("div",{style:{color:"red",fontSize:"0.75rem"},children:Se.errors.collecteur_culte})]}),(0,H.jsxs)(y.A,{fullWidth:!0,children:[(0,H.jsx)(S.A,{children:s.A.t("services.list.superviseur")}),(0,H.jsxs)(B.A,{name:"superviseur",value:Se.values.superviseur||"",onChange:Se.handleChange,onBlur:Se.handleBlur,error:Se.touched.superviseur&&Boolean(Se.errors.superviseur),children:[(0,H.jsx)(m.A,{value:"",children:s.A.t("services.list.selectSuperviseur")}),le.map(e=>(0,H.jsx)(m.A,{value:e._id||e.id,children:e.username||e.pseudo},e._id||e.id))]}),Se.touched.superviseur&&Se.errors.superviseur&&(0,H.jsx)("div",{style:{color:"red",fontSize:"0.75rem"},children:Se.errors.superviseur})]})]})}),(0,H.jsxs)(w.A,{children:[(0,H.jsx)(W.A,{onClick:ye,color:"primary",children:s.A.t("common.actions.cancel")}),(0,H.jsx)(W.A,{type:"submit",variant:"contained",color:"primary",children:s.A.t("common.actions.save")})]})]})]}),(0,H.jsx)(R.A,{open:ae,title:s.A.t("services.list.deleteService"),content:ne?"\xcates-vous s\xfbr de vouloir supprimer le service du ".concat((0,i.GP)(new Date(ne.date),"dd/MM/yyyy",{locale:n.A})," ?"):"\xcates-vous s\xfbr de vouloir supprimer ce service ?",onClose:be,onConfirm:async()=>{if(!ne)return;const e=(null===ne||void 0===ne?void 0:ne.id)||(null===ne||void 0===ne?void 0:ne._id);if(e)try{await xe(e);const t=Ce.filter(t=>(t.id||t._id)!==e);ve(t),ge(s.A.t("success.serviceDeleted"))}catch(_e){fe(s.A.t("errors.api.deleteService"))}finally{be()}else fe(s.A.t("errors.validation.serviceIdNotFound"))}}),(0,H.jsx)(k.A,{open:Ae.open,autoHideDuration:2e3,onClose:je,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,H.jsx)(L.A,{onClose:je,severity:Ae.severity,sx:{width:"100%"},children:Ae.message})}),(0,H.jsx)(q.A,{component:"div",count:we.length,page:N,onPageChange:(e,t)=>{$(t)},rowsPerPage:J,onRowsPerPageChange:e=>{K(parseInt(e.target.value,10)),$(0)},labelRowsPerPage:s.A.t("common.pagination.rowsPerPage")})]})}):(0,H.jsx)(d.A,{"data-aos":"fade-up",elevation:3,sx:{p:4},children:(0,H.jsxs)(c.A,{sx:{textAlign:"center",py:4},children:[(0,H.jsx)(u.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:s.A.t("home.noChurchSelected")}),(0,H.jsx)(u.A,{variant:"body1",color:"text.secondary",children:s.A.t("home.selectChurchForServices")})]})})}},45492:(e,t,r)=>{r.d(t,{A:()=>n});var o=r(53969),l=r(94799),s=r(55895),a=r(56266),i=r(70579);const n=e=>{let{error:t,onRetry:r}=e;return(0,i.jsx)(o.A,{sx:{minHeight:"60vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",bgcolor:"background.default"},children:(0,i.jsxs)(l.A,{elevation:3,sx:{p:4,bgcolor:"#fff3f3",border:"1px solid #f44336",borderRadius:3,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,i.jsxs)("svg",{width:"56",height:"56",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{marginBottom:16},children:[(0,i.jsx)("circle",{cx:"12",cy:"12",r:"12",fill:"#f44336",fillOpacity:"0.1"}),(0,i.jsx)("path",{d:"M12 7v5",stroke:"#f44336",strokeWidth:"2",strokeLinecap:"round"}),(0,i.jsx)("circle",{cx:"12",cy:"16",r:"1",fill:"#f44336"})]}),(0,i.jsx)(s.A,{variant:"h5",sx:{color:"error.main",fontWeight:"bold",mb:1},children:a.A.t("loading.error")}),(0,i.jsx)(s.A,{variant:"subtitle1",sx:{color:"error.main",mb:2},children:t}),(0,i.jsx)("button",{style:{padding:"8px 24px",background:"#f44336",color:"#fff",border:"none",borderRadius:4,fontWeight:"bold",cursor:"pointer",fontSize:16},onClick:r||(()=>window.location.reload()),children:a.A.t("common.actions.retry")})]})})}}}]);
//# sourceMappingURL=857.163e58fe.chunk.js.map