"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[41],{21281:(e,t,a)=>{a.d(t,{B:()=>r,l:()=>n});const n=e=>e?e.startsWith("QUALIFICATION_")?e.replace("QUALIFICATION_",""):e:"",r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Non d\xe9finie";if(!e)return t;return n(e)||t}},37531:(e,t,a)=>{a.d(t,{A:()=>c});var n=a(89379),r=(a(65043),a(53969)),s=a(91449),o=a(41968),i=a(55895),l=a(56266),d=a(70579);const c=e=>{let{error:t,title:a=l.A.t("common.actions.error"),variant:c="error",showTitle:u=!0,showIcon:h=!0,sx:m={},onClose:p,action:x}=e;if(!t)return null;const A=e=>{switch(e){case"VALIDATION":case"NETWORK":return"warning";case"AUTHENTICATION":case"AUTHORIZATION":return"info";default:return"error"}},g=t.type&&t.message?{type:t.type,message:t.message,severity:A(t.type)}:t.userMessage?{type:"UNKNOWN",message:t.userMessage,severity:"error"}:t.message&&"string"===typeof t.message?{type:"UNKNOWN",message:t.message,severity:"error"}:{type:"UNKNOWN",message:l.A.t("common.unexpectedError"),severity:"error"};return(0,d.jsx)(r.A,{sx:(0,n.A)({mb:2},m),children:(0,d.jsxs)(s.A,{severity:g.severity,variant:c,onClose:p,action:x,sx:{"& .MuiAlert-message":{width:"100%"}},children:[u&&(0,d.jsx)(o.A,{sx:{fontWeight:"bold"},children:a}),(0,d.jsx)(i.A,{variant:"body2",component:"div",children:g.message}),!1]})})}},56198:(e,t,a)=>{a.d(t,{A:()=>r});var n=a(78816);const r=new class{async create(e){try{return(await n.A.post("/assistance",e)).data}catch(t){throw t}}async getStats(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{const t=new URLSearchParams;Object.keys(e).forEach(a=>{e[a]&&t.append(a,e[a])});return(await n.A.get("/assistance/stats?".concat(t.toString()))).data}catch(t){throw t}}async getById(e){try{return(await n.A.get("/assistance/".concat(e))).data}catch(t){throw t}}async update(e,t){try{return(await n.A.put("/assistance/".concat(e),t)).data}catch(a){throw a}}async delete(e){try{return(await n.A.delete("/assistance/".concat(e))).data}catch(t){throw t}}}},65506:(e,t,a)=>{a.d(t,{A:()=>r});var n=a(78816);const r=new class{async create(e){try{return(await n.A.post("/previsionnels",e)).data}catch(t){throw t}}async getByNetwork(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const a=new URLSearchParams;t.page&&a.append("page",t.page),t.limit&&a.append("limit",t.limit),t.type_culte&&a.append("type_culte",t.type_culte),t.date_from&&a.append("date_from",t.date_from),t.date_to&&a.append("date_to",t.date_to);return(await n.A.get("/previsionnels/network/".concat(e,"?").concat(a.toString()))).data}catch(a){throw a}}async getById(e){try{return(await n.A.get("/previsionnels/".concat(e))).data}catch(t){throw t}}async update(e,t){try{return(await n.A.put("/previsionnels/".concat(e),t)).data}catch(a){throw a}}async delete(e){try{return(await n.A.delete("/previsionnels/".concat(e))).data}catch(t){throw t}}async getStats(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{const t=new URLSearchParams;e.church_id&&t.append("church_id",e.church_id),e.network_id&&t.append("network_id",e.network_id),e.type_culte&&t.append("type_culte",e.type_culte),e.date_from&&t.append("date_from",e.date_from),e.date_to&&t.append("date_to",e.date_to);const a="/previsionnels/stats?".concat(t.toString());return(await n.A.get(a)).data}catch(t){throw t}}}},82402:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ja});var n=a(65043),r=a(83003),s=a(53969),o=a(55895),i=a(26887),l=a(23182),d=a(42579),c=a(10256),u=a(67203),h=a(47471),m=a(83759),p=a(64020),x=a(58128),A=a(31274),g=a(76998),f=a(89379),b=a(56266),v=a(77210),j=a(80172),y=a(53089),w=a(94799),C=a(50108),S=a(60163),_=a(4240),k=a(17869),R=a(86150),I=a(75748),D=a(87734),E=a(52185),W=a(6026),N=a(21327),M=a(90168),L=a(82291),F=a(38643),O=a(69302);const T={pageLoads:0,apiCalls:0,cacheHits:0,cacheMisses:0,renderTimes:[],memoryUsage:[]},B=new Map,z=new Map,P=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const[r,s]=(0,n.useState)(null),[o,i]=(0,n.useState)(!1),[l,d]=(0,n.useState)(null),c=(e=>{const t=(0,n.useRef)(performance.now()),a=(0,n.useRef)(0);(0,n.useEffect)(()=>{const a=performance.now()-t.current;T.renderTimes.push({component:e,time:a,timestamp:Date.now()}),T.renderTimes.length>100&&T.renderTimes.shift(),T.pageLoads++});const r=(0,n.useCallback)((t,n,r)=>{a.current++,T.apiCalls++,"true"==={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"http://localhost:5001"}.REACT_APP_PERFORMANCE_TRACKING&&fetch("/api/performance/metrics",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({component:e,endpoint:t,duration:n,success:r,timestamp:Date.now()})}).catch(()=>{})},[e]);(0,n.useEffect)(()=>{if("memory"in performance){const t=performance.memory;T.memoryUsage.push({component:e,used:t.usedJSHeapSize,total:t.totalJSHeapSize,limit:t.jsHeapSizeLimit,timestamp:Date.now()}),T.memoryUsage.length>50&&T.memoryUsage.shift()}},[e]);const s=(0,n.useCallback)(()=>{const t=T.renderTimes.length>0?T.renderTimes.reduce((e,t)=>e+t.time,0)/T.renderTimes.length:0,a=T.memoryUsage.length>0?T.memoryUsage.reduce((e,t)=>e+t.used,0)/T.memoryUsage.length:0;return{component:e,pageLoads:T.pageLoads,apiCalls:T.apiCalls,cacheHits:T.cacheHits,cacheMisses:T.cacheMisses,avgRenderTime:t.toFixed(2),avgMemoryUsage:(a/1024/1024).toFixed(2)+" MB",timestamp:Date.now()}},[e]);return{trackApiCall:r,trackCacheHit:(0,n.useCallback)(()=>{T.cacheHits++},[]),trackCacheMiss:(0,n.useCallback)(()=>{T.cacheMisses++},[]),getPerformanceStats:s,apiCallCount:a.current}})("useGlobalCache-".concat(e)),u=(0,n.useCallback)(()=>{const t=z.get(e);return!!t&&Date.now()-t<12e4},[e]),h=(0,n.useCallback)(()=>{const t=B.get(e);return t?c.trackCacheHit():c.trackCacheMiss(),t},[e,c]),m=(0,n.useCallback)(t=>{B.set(e,t),z.set(e,Date.now())},[e]),p=(0,n.useCallback)(async function(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&u()){const e=h();if(e)return s(e),e}i(!0),d(null);const a=performance.now();try{const n=await t(),r=performance.now()-a;return c.trackApiCall(e,r,!0),m(n),s(n),n}catch(n){const t=performance.now()-a;throw c.trackApiCall(e,t,!1),d(n),n}finally{i(!1)}},[t,u,h,m,e,c]);(0,n.useEffect)(()=>{p()},a);return{data:r,loading:o,error:l,refresh:(0,n.useCallback)(()=>p(!0),[p]),clearCache:(0,n.useCallback)(()=>{B.delete(e),z.delete(e)},[e])}};var q=a(41894),U=a(70579);const G=["#e6194b","#3cb44b","#ffe119","#4363d8","#f58231","#911eb4","#46f0f0","#f032e6","#bcf60c","#fabebe","#008080","#e6beff","#9a6324","#fffac8","#800000","#aaffc3","#808000","#ffd8b1","#000075","#808080","#ffffff","#000000","#a28ef5","#ffb6b9","#00c49f","#0088fe","#ffc658","#ff8042","#7b68ee","#f0e130"],H=e=>{let{selectedChurch:t,refreshKey:a}=e;(0,n.useEffect)(()=>{b.A.init()},[]);const{data:r,loading:i,error:l,refresh:c}=P("globalStats-".concat((null===t||void 0===t?void 0:t.id)||"none"),async()=>{if(!t)return{};const e={churchId:t.id};try{var a;const t=await q.apiService.stats.getOverview(e);return(null===(a=t.data)||void 0===a?void 0:a.data)||t.data||{}}catch(n){throw n}},[a]),{data:u,loading:h,error:m,refresh:p}=P("networkStats-".concat((null===t||void 0===t?void 0:t.id)||"none"),async()=>{var e;if(!t)return[];const a={churchId:t.id},n=await q.apiService.networks.getStats(a),r=(null===(e=n.data)||void 0===e?void 0:e.data)||n.data||[];if(!Array.isArray(r))return[];return r.map(e=>({name:e.nom,value:e.memberCount||0}))},[a]),{data:x,loading:A,error:g,refresh:f}=P("networkEvolution-".concat((null===t||void 0===t?void 0:t.id)||"none"),async()=>{var e;if(!t)return[];const a={churchId:t.id},n=await q.apiService.stats.getNetworksEvolution(a),r=(null===(e=n.data)||void 0===e?void 0:e.data)||n.data||[];return Array.isArray(r)?r:[]},[a]),{data:v,loading:T,error:B,refresh:z}=P("serviceAttendance-".concat((null===t||void 0===t?void 0:t.id)||"none"),async()=>{var e;if(!t)return[];const a={churchId:t.id},n=await q.apiService.services.getAll(a),r=(null===(e=n.data)||void 0===e?void 0:e.data)||n.data||[];return Array.isArray(r)?r:[]},[a]),{data:H,loading:K,error:V,refresh:X}=P("networkYearCompare-".concat((null===t||void 0===t?void 0:t.id)||"none"),async()=>{var e;if(!t)return[];const a=(new Date).getFullYear(),n={years:"".concat(a-1,",").concat(a),churchId:t.id},r=await q.apiService.stats.getNetworksComparison(n),s=(null===(e=r.data)||void 0===e?void 0:e.data)||r.data||[];return Array.isArray(s)?s:[]},[a]);if((0,n.useEffect)(()=>{if(t){const e=setTimeout(()=>c(),100),t=setTimeout(()=>p(),300),a=setTimeout(()=>f(),500),n=setTimeout(()=>z(),700),r=setTimeout(()=>X(),900);return()=>{clearTimeout(e),clearTimeout(t),clearTimeout(a),clearTimeout(n),clearTimeout(r)}}},[t]),!t)return(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",my:4},children:(0,U.jsx)(o.A,{variant:"h6",color:"text.secondary",children:b.A.t("stats.selectChurch")})});(new Date).getFullYear();const Z=i||h||A||T||K,Y=l||m||g||B||V;return(0,U.jsxs)(s.A,{sx:{width:"100%",overflow:"hidden",overflowX:"auto"},children:[(0,U.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",mb:6,alignItems:"center"},children:[(0,U.jsx)(o.A,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:b.A.t("stats.overview")}),(0,U.jsx)(d.A,{onClick:c,disabled:Z,"aria-label":b.A.t("common.actions.refresh"),children:(0,U.jsx)(O.A,{})})]}),Z?(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",my:4},children:(0,U.jsx)(j.A,{})}):Y?(e=>{var t,a;if(!e)return null;let n=b.A.t("common.errorOccurred");return"string"===typeof e?n=e:null!==e&&void 0!==e&&e.message?n=e.message:null!==e&&void 0!==e&&null!==(t=e.response)&&void 0!==t&&null!==(a=t.data)&&void 0!==a&&a.message&&(n=e.response.data.message),n.includes("Request failed with status code 500")?n=b.A.t("errors.server500"):n.includes("Request failed with status code 429")&&(n=b.A.t("errors.tooManyRequests")),(0,U.jsx)(o.A,{color:"error",sx:{mt:2,textAlign:"center"},children:n})})(Y):(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(y.A,{"data-aos":"fade-up",container:!0,spacing:2,sx:{mb:3},children:[{value:(null===r||void 0===r?void 0:r.total_all)||0,label:b.A.t("stats.members")},{value:(null===r||void 0===r?void 0:r.total_reseaux)||0,label:b.A.t("stats.networks")},{value:(null===r||void 0===r?void 0:r.total_gr)||0,label:b.A.t("stats.groups")},{value:(null===r||void 0===r?void 0:r.total_resp_reseaux)||0,label:b.A.t("stats.networkLeaders")},{value:(null===r||void 0===r?void 0:r.total_resp_gr)||0,label:b.A.t("stats.groupLeaders")},{value:(null===r||void 0===r?void 0:r.total_leaders)||0,label:b.A.t("stats.leaders")},{value:(null===r||void 0===r?void 0:r.total_leaders_all)||0,label:b.A.t("stats.allLeaders")},{value:(null===r||void 0===r?void 0:r.total_reguliers)||0,label:b.A.t("stats.regulars")},{value:(null===r||void 0===r?void 0:r.total_integration)||0,label:b.A.t("stats.integration")},{value:(null===r||void 0===r?void 0:r.total_irreguliers)||0,label:b.A.t("stats.irregulars")},{value:(null===r||void 0===r?void 0:r.total_gouvernance)||0,label:b.A.t("stats.governance")},{value:(null===r||void 0===r?void 0:r.total_ecodim)||0,label:b.A.t("stats.ecodim")},{value:(null===r||void 0===r?void 0:r.total_resp_ecodim)||0,label:b.A.t("stats.ecodimLeaders")},{value:(null===r||void 0===r?void 0:r.total_personnes_isolees)||0,label:b.A.t("stats.isolatedPersons")}].map((e,t)=>(0,U.jsx)(y.A,{xs:6,sm:4,md:3,lg:2,children:(0,U.jsxs)(w.A,{sx:{p:2,textAlign:"center",minHeight:80},children:[(0,U.jsx)(o.A,{color:"text.secondary",children:e.label}),(0,U.jsx)(o.A,{variant:"h5",children:e.value})]})},t))}),(0,U.jsxs)(y.A,{"data-aos":"fade-up",container:!0,spacing:1,sx:{display:"block"},children:[(0,U.jsx)(y.A,{xs:12,md:6,children:(0,U.jsxs)(w.A,{sx:{p:3,width:"100%",backgroundColor:"#f9f9f9",overflowX:"auto",display:"flex",flexDirection:"column",justifyContent:"center"},children:[(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:b.A.t("stats.membersByNetwork")}),u&&0!==u.length?(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(s.A,{children:(0,U.jsx)(s.A,{sx:{flex:1,minHeight:0,alignItems:"center",justifyContent:"center"},children:(0,U.jsx)(C.u,{width:"100%",height:600,children:(0,U.jsxs)(S.r,{children:[(0,U.jsx)(_.F,{data:u,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:250,label:e=>{var t,a;let{cx:n,cy:r,midAngle:s,innerRadius:o,outerRadius:i,percent:l,index:d}=e;const c=Math.PI/180,h=o+1.15*(i-o),m=n+h*Math.cos(-s*c),p=r+h*Math.sin(-s*c),x=(null===u||void 0===u||null===(t=u[d])||void 0===t?void 0:t.value)||0,A=(u||[]).reduce((e,t)=>e+(t.value||0),0),g=A>0?(x/A*100).toFixed(1):0;return(0,U.jsx)("text",{x:m,y:p,fill:G[d%G.length],textAnchor:m>n?"start":"end",dominantBaseline:"central",fontSize:16,fontWeight:600,children:"".concat(null===(a=u[d])||void 0===a?void 0:a.name,": ").concat(x," (").concat(g,"%)")})},children:(u||[]).map((e,t)=>(0,U.jsx)(k.f,{fill:G[t%G.length]},"cell-".concat(t)))}),(0,U.jsx)(R.m,{})]})})})}),(0,U.jsx)(s.A,{sx:{bgcolor:"#f9f9f9",borderRadius:2,border:"1px solid #e0e0e0",p:4},children:(()=>{const e=new Date,t=e.toLocaleString("fr-FR",{month:"long"}),a=e.getFullYear(),n=e.getDate(),r=(u||[]).reduce((e,t)=>e+(t.value||0),0),i=[...u||[]].sort((e,t)=>(t.value||0)-(e.value||0)),l=i[0],d=i[1],c=new Date(e.getFullYear(),e.getMonth(),1),h=(u||[]).filter(e=>{if(!e.createdAt)return!1;return new Date(e.createdAt)>=c});return(0,U.jsxs)(o.A,{sx:{fontSize:18,color:"#444",fontStyle:"italic",textAlign:"center"},children:[b.A.t("stats.interpretation.datePrefix"),(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:"".concat(n," ").concat(t," ").concat(a)}),b.A.t("stats.interpretation.totalMembers"),(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:r}),(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:b.A.t("stats.interpretation.persons")}),l&&(0,U.jsxs)(U.Fragment,{children:[b.A.t("stats.interpretation.largestNetwork"),(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:" \xab ".concat(l.name," \xbb")}),b.A.t("stats.interpretation.with"),(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:l.value}),(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:b.A.t("stats.interpretation.members")}),d&&(0,U.jsxs)(U.Fragment,{children:[b.A.t("stats.interpretation.followedBy"),(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:" \xab ".concat(d.name," \xbb")}),b.A.t("stats.interpretation.parentheses"),(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:d.value}),(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:b.A.t("stats.interpretation.members")}),b.A.t("stats.interpretation.closeParentheses")]}),h&&h.length>0&&(0,U.jsxs)(U.Fragment,{children:[b.A.t("stats.interpretation.inMonth"),(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:"".concat(t," ").concat(a)}),b.A.t("stats.interpretation.networks"),(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:(h||[]).map(e=>"\xab ".concat(e.name," \xbb")).join(", ")}),b.A.t("stats.interpretation.wereCreated")]})]})]})})()})]}):(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:400},children:(0,U.jsx)(o.A,{variant:"h6",color:"text.secondary",children:h?b.A.t("common.actions.loading"):b.A.t("stats.noDataForChurch")})})]})}),(0,U.jsx)(y.A,{"data-aos":"fade-up",xs:12,md:8,sx:{minWidth:400,mt:3},children:(0,U.jsxs)(w.A,{sx:{p:3,height:520,minWidth:0,overflowX:"auto",display:"flex",flexDirection:"column",justifyContent:"center",backgroundColor:"#f9f9f9"},children:[(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:b.A.t("stats.monthlyEvolution")}),(0,U.jsx)(s.A,{sx:{flex:1,minHeight:0,display:"flex",alignItems:"center",justifyContent:"center"},children:Array.isArray(x)&&x.length>0&&Object.keys(x[0]).length>1?(0,U.jsx)(C.u,{width:"100%",height:440,children:(0,U.jsxs)(I.b,{data:x,margin:{top:20,right:20,left:0,bottom:0},children:[(0,U.jsx)(D.d,{strokeDasharray:"3 3"}),(0,U.jsx)(E.W,{dataKey:"month"}),(0,U.jsx)(W.h,{allowDecimals:!1}),(0,U.jsx)(R.m,{}),(0,U.jsx)(N.s,{}),Object.keys(x[0]).filter(e=>"month"!==e).map((e,t)=>(0,U.jsx)(M.N,{type:"monotone",dataKey:e,stroke:G[t%G.length],strokeWidth:2,dot:!1},e))]})}):(0,U.jsx)(o.A,{sx:{color:"#888",fontSize:20,textAlign:"center",width:"100%"},children:b.A.t("stats.noMonthlyData")})})]})}),(0,U.jsx)(y.A,{"data-aos":"fade-up",xs:12,md:8,sx:{minWidth:400,mt:3},children:(0,U.jsxs)(w.A,{sx:{p:3,minHeight:320,backgroundColor:"#f9f9f9"},children:[(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:b.A.t("stats.networkComparison")}),(0,U.jsx)(C.u,{width:"100%",height:400,children:(0,U.jsxs)(L.E,{data:(()=>{if(!x||0===x.length)return[];const e=x.slice(-3);return(Object.keys(e[0]||{}).filter(e=>"month"!==e)||[]).map(t=>{const a={network:t};return(e||[]).forEach((e,n)=>{const r=new Date(e.month+"-01").toLocaleString("fr-FR",{month:"short",year:"2-digit"});a[r]=e[t]||0}),a})})(),children:[(0,U.jsx)(R.m,{}),(0,U.jsx)(D.d,{strokeDasharray:"3 3"}),(0,U.jsx)(E.W,{dataKey:"network"}),(0,U.jsx)(W.h,{allowDecimals:!1}),(0,U.jsx)(N.s,{}),(()=>{if(!x||0===x.length)return null;return(x.slice(-3)||[]).map((e,t)=>{const a=new Date(e.month+"-01").toLocaleString("fr-FR",{month:"short",year:"2-digit"}),n=["#8884d8","#82ca9d","#ffc658"];return(0,U.jsx)(F.y,{dataKey:a,fill:n[t%n.length],name:a.charAt(0).toUpperCase()+a.slice(1),activeBar:!1},a)})})()]})})]})}),(0,U.jsx)(y.A,{"data-aos":"fade-up",xs:12,md:12,sx:{minWidth:400,mt:3},children:(0,U.jsxs)(w.A,{sx:{p:3,height:520,minWidth:0,overflowX:"auto",display:"flex",flexDirection:"column",justifyContent:"center",backgroundColor:"#f9f9f9"},children:[(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:b.A.t("stats.serviceAttendance")}),(0,U.jsx)(s.A,{sx:{flex:1,minHeight:0,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,U.jsx)(C.u,{width:"100%",height:440,children:(0,U.jsxs)(I.b,{data:(()=>{const e=(v||[]).map(e=>new Date(e.date).toISOString().slice(0,10));return([...new Set(e)].sort().slice(-8)||[]).map(e=>{const t={date:new Date(e).toLocaleDateString("fr-FR")};return[b.A.t("stats.service1"),b.A.t("stats.service2"),b.A.t("stats.service3")].forEach((a,n)=>{const r=(v||[]).find(t=>new Date(t.date).toISOString().slice(0,10)===e&&t.culte===a);t["culte".concat(n+1)]=r?(r.total_adultes||0)+(r.total_enfants||0)+(r.total_chantres||0)+(r.total_protocoles||0)+(r.total_multimedia||0)+(r.total_respo_ecodim||0)+(r.total_animateurs_ecodim||0)+(r.total_enfants_ecodim||0):0}),t})})(),margin:{top:20,right:20,left:0,bottom:0},children:[(0,U.jsx)(D.d,{strokeDasharray:"3 3"}),(0,U.jsx)(E.W,{dataKey:"date"}),(0,U.jsx)(W.h,{allowDecimals:!1,interval:0,tickCount:10}),(0,U.jsx)(R.m,{}),(0,U.jsx)(N.s,{}),(0,U.jsx)(M.N,{type:"monotone",dataKey:"culte1",stroke:"#1976d2",name:b.A.t("stats.service1"),strokeWidth:2,dot:!0}),(0,U.jsx)(M.N,{type:"monotone",dataKey:"culte2",stroke:"#FFBB28",name:b.A.t("stats.service2"),strokeWidth:2,dot:!0}),(0,U.jsx)(M.N,{type:"monotone",dataKey:"culte3",stroke:"#43a047",name:b.A.t("stats.service3"),strokeWidth:2,dot:!0})]})})})]})})]})]})]})},K=["#0088FE","#00C49F","#FFBB28","#FF8042","#B455C6","#FF6666","#82ca9d","#8884d8","#ffc658","#a4de6c","#d0ed57"],V=e=>e&&0!==e.length?e.map(e=>{if(!e.evolution||e.evolution.length<2)return{name:e.nom,croissance:b.A.t("statsReseaux.new")};const t=e.evolution[e.evolution.length-1],a=e.evolution[e.evolution.length-2];if(0===a.memberCount)return{name:e.nom,croissance:b.A.t("statsReseaux.new")};const n=(t.memberCount-a.memberCount)/a.memberCount*100;return{name:e.nom,croissance:Math.round(n)}}):[],X=e=>{let{selectedChurch:t,refreshKey:a}=e;(0,n.useEffect)(()=>{b.A.init()},[]);const{data:r,loading:i,error:l,refresh:c}=P("networkStats-".concat((null===t||void 0===t?void 0:t.id)||"none"),async()=>{var e;if(!t)return[];const a={churchId:t.id},n=await q.apiService.networks.getStats(a),r=(null===(e=n.data)||void 0===e?void 0:e.data)||n.data||[];if(!Array.isArray(r))return[];return r.filter(e=>e&&e.nom&&(e.memberCount||0)>0).map(e=>({name:e.nom||"R\xe9seau sans nom",value:e.memberCount||0}))},[a]),{data:u,loading:h,error:m,refresh:p}=P("networkEvolution-".concat((null===t||void 0===t?void 0:t.id)||"none"),async()=>{var e;if(!t)return[];const a={churchId:t.id},n=await q.apiService.stats.getNetworksEvolution(a),r=(null===(e=n.data)||void 0===e?void 0:e.data)||n.data||[];return Array.isArray(r)?r:[]},[a]),{data:x,loading:A,error:g,refresh:f}=P("networkYearCompare-".concat((null===t||void 0===t?void 0:t.id)||"none"),async()=>{var e;if(!t)return[];const a=(new Date).getFullYear(),n={years:"".concat(a-1,",").concat(a),churchId:t.id},r=await q.apiService.stats.getNetworksComparison(n),s=(null===(e=r.data)||void 0===e?void 0:e.data)||r.data||[];return Array.isArray(s)?s:[]},[a]),{data:v,loading:T,error:B,refresh:z}=P("networkQualificationStats-".concat((null===t||void 0===t?void 0:t.id)||"none"),async()=>{if(!t)return[];try{var e;const a={churchId:t.id},n=await q.apiService.networks.getQualificationStats(a),r=(null===(e=n.data)||void 0===e?void 0:e.data)||n.data||[];if(!Array.isArray(r))return[];return r.filter(e=>e&&e.networkName&&e.totalMembers>0).map(e=>{const t={name:e.networkName};return e.qualifications&&"object"===typeof e.qualifications&&Object.entries(e.qualifications).forEach(e=>{let[a,n]=e;a&&void 0!==n&&null!==n&&n>0&&a!==b.A.t("statsReseaux.notSpecified")&&(t[a]=n)}),t}).filter(e=>Object.keys(e).some(e=>"name"!==e))}catch(a){return[]}});if((0,n.useEffect)(()=>{if(t){const e=setTimeout(()=>{c(),p(),f(),z()},100);return()=>clearTimeout(e)}},[t]),!t)return(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",my:4},children:(0,U.jsx)(o.A,{variant:"h6",color:"text.secondary",children:"Veuillez s\xe9lectionner une \xe9glise pour voir les statistiques"})});const G=i||h||A||T,H=e=>{var t,a;return e?"string"===typeof e?e:null!==e&&void 0!==e&&e.message?e.message:null!==e&&void 0!==e&&null!==(t=e.response)&&void 0!==t&&null!==(a=t.data)&&void 0!==a&&a.message?e.response.data.message:b.A.t("common.errorOccurred"):null},X=H(l)||H(m)||H(g)||H(B);return(0,U.jsxs)(s.A,{children:[(0,U.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",mb:3,alignItems:"center"},children:[(0,U.jsx)(o.A,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:b.A.t("statsReseaux.title")}),(0,U.jsx)(d.A,{onClick:c,disabled:G,"aria-label":b.A.t("common.actions.refresh"),children:(0,U.jsx)(O.A,{})})]}),G?(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",my:4},children:(0,U.jsx)(j.A,{})}):X?(e=>{var t,a;if(!e)return null;let n=b.A.t("common.errorOccurred");return"string"===typeof e?n=e:null!==e&&void 0!==e&&e.message?n=e.message:null!==e&&void 0!==e&&null!==(t=e.response)&&void 0!==t&&null!==(a=t.data)&&void 0!==a&&a.message&&(n=e.response.data.message),(0,U.jsx)(o.A,{color:"error",sx:{mt:2,textAlign:"center"},children:n})})(X):(0,U.jsxs)(y.A,{children:[(0,U.jsx)(y.A,{"data-aos":"fade-up",item:!0,xs:12,sx:{mt:0},children:(0,U.jsxs)(w.A,{sx:{p:3,backgroundColor:"#f9f9f9",overflowX:"auto"},children:[(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:b.A.t("statsReseaux.membersByNetwork")}),r&&0!==r.length?(0,U.jsx)(C.u,{width:"100%",height:600,children:(0,U.jsxs)(S.r,{children:[(0,U.jsx)(_.F,{data:r,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:250,label:e=>{let{name:t,value:a}=e;if(!t||void 0===a||null===a)return"";const n=(r||[]).reduce((e,t)=>e+(t.value||0),0),s=n?(a/n*100).toFixed(1):0;return"".concat(t,": ").concat(a," (").concat(s,"%)")},children:(r||[]).map((e,t)=>(0,U.jsx)(k.f,{fill:K[t%K.length]},"cell-".concat(t)))}),(0,U.jsx)(R.m,{})]})}):(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:400},children:(0,U.jsx)(o.A,{variant:"h6",color:"text.secondary",children:i?b.A.t("common.loading"):b.A.t("statsReseaux.noDataForChurch")})}),(0,U.jsx)(s.A,{sx:{bgcolor:"#f9f9f9",borderRadius:2,border:"1px solid #e0e0e0",p:4},children:(()=>{const e=new Date,t=e.toLocaleString("fr-FR",{month:"long"}),a=e.getFullYear(),n=e.getDate(),i=(r||[]).reduce((e,t)=>e+(t.value||0),0),l=[...r||[]].filter(e=>e&&void 0!==e.value&&null!==e.value).sort((e,t)=>(t.value||0)-(e.value||0)),d=l[0],c=l[1],u=new Date(e.getFullYear(),e.getMonth(),1),h=(r||[]).filter(e=>{if(!e.createdAt)return!1;return new Date(e.createdAt)>=u});return(0,U.jsxs)(o.A,{sx:{fontSize:18,color:"#444",fontStyle:"italic",textAlign:"center"},children:[b.A.t("statsReseaux.interpretation.datePrefix"),(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:"".concat(n," ").concat(t," ").concat(a)}),b.A.t("statsReseaux.interpretation.totalMembers"),(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:i}),(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:" personnes."}),d&&d.name&&d.value&&(0,U.jsxs)(U.Fragment,{children:[" Le plus grand r\xe9seau est ",(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:" \xab ".concat(d.name," \xbb")})," avec ",(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:d.value}),(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:" membres"}),c&&c.name&&c.value&&(0,U.jsxs)(U.Fragment,{children:[", suivi du r\xe9seau ",(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:" \xab ".concat(c.name," \xbb")})," (",(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:c.value}),(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:" membres"}),")"]}),"."]}),h.length>0&&h.every(e=>e&&e.name)&&(0,U.jsxs)(U.Fragment,{children:[" ",1===h.length?(0,U.jsxs)(U.Fragment,{children:[b.A.t("statsReseaux.inMonth"),(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:"".concat(t," ").concat(a)}),", le r\xe9seau ",(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:" \xab ".concat(h[0].name," \xbb")})," a vu le jour."]}):(0,U.jsxs)(U.Fragment,{children:[b.A.t("statsReseaux.inMonth"),(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:"".concat(t," ").concat(a)}),", les r\xe9seaux ",(0,U.jsx)(s.A,{component:"span",fontWeight:"bold",color:"primary.main",children:(h||[]).filter(e=>e&&e.name).map(e=>"\xab ".concat(e.name," \xbb")).join(", ")})," ont vu le jour."]})]})]})})()})]})}),(0,U.jsx)(y.A,{"data-aos":"fade-up",item:!0,xs:12,sx:{mt:4},children:(0,U.jsxs)(w.A,{sx:{p:3,height:520,minWidth:0,overflowX:"auto",display:"flex",flexDirection:"column",justifyContent:"center",backgroundColor:"#f9f9f9"},children:[(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:b.A.t("statsReseaux.monthlyEvolution")}),(0,U.jsx)(s.A,{sx:{flex:1,minHeight:0,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,U.jsx)(C.u,{width:"100%",height:440,children:(0,U.jsxs)(I.b,{data:u,margin:{top:20,right:20,left:0,bottom:0},children:[(0,U.jsx)(D.d,{strokeDasharray:"3 3"}),(0,U.jsx)(E.W,{dataKey:"month"}),(0,U.jsx)(W.h,{allowDecimals:!1}),(0,U.jsx)(R.m,{}),(0,U.jsx)(N.s,{}),(u||[]).length>0&&Object.keys((u||[])[0]||{}).filter(e=>"month"!==e).map((e,t)=>(0,U.jsx)(M.N,{type:"monotone",dataKey:e,stroke:K[t%K.length],strokeWidth:2,dot:!1},e))]})})})]})}),(0,U.jsx)(y.A,{"data-aos":"fade-up",item:!0,xs:12,sx:{mt:4},children:(0,U.jsxs)(w.A,{sx:{p:3,minHeight:320,backgroundColor:"#f9f9f9",overflowX:"auto"},children:[(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:b.A.t("statsReseaux.networkComparison")}),(0,U.jsx)(C.u,{width:"100%",height:400,children:(0,U.jsxs)(L.E,{data:(()=>{if(!u||0===u.length)return[];const e=u.slice(-3);return(Object.keys(e[0]||{}).filter(e=>"month"!==e)||[]).map(t=>{const a={network:t};return(e||[]).forEach((e,n)=>{const r=new Date(e.month+"-01").toLocaleString("fr-FR",{month:"short",year:"2-digit"});a[r]=e[t]||0}),a})})(),margin:{top:20,right:20,left:0,bottom:0},children:[(0,U.jsx)(R.m,{}),(0,U.jsx)(D.d,{strokeDasharray:"3 3"}),(0,U.jsx)(E.W,{dataKey:"network"}),(0,U.jsx)(W.h,{allowDecimals:!1}),(0,U.jsx)(N.s,{}),(()=>{if(!u||0===u.length)return null;return(u.slice(-3)||[]).map((e,t)=>{const a=new Date(e.month+"-01").toLocaleString("fr-FR",{month:"short",year:"2-digit"}),n=["#8884d8","#82ca9d","#ffc658"];return(0,U.jsx)(F.y,{dataKey:a,fill:n[t%n.length],name:a.charAt(0).toUpperCase()+a.slice(1),activeBar:!1},a)})})()]})})]})}),v&&v.length>0&&(0,U.jsx)(y.A,{"data-aos":"fade-up",item:!0,xs:12,sx:{mt:4},children:(0,U.jsxs)(w.A,{sx:{p:3,minHeight:320,backgroundColor:"#f9f9f9",overflowX:"auto"},children:[(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:b.A.t("statsReseaux.internalComposition")}),(0,U.jsx)(C.u,{width:"100%",height:400,children:(0,U.jsxs)(L.E,{data:v,margin:{top:20,right:20,left:0,bottom:0},children:[(0,U.jsx)(D.d,{strokeDasharray:"3 3"}),(0,U.jsx)(E.W,{dataKey:"name"}),(0,U.jsx)(W.h,{allowDecimals:!1}),(0,U.jsx)(R.m,{}),(0,U.jsx)(N.s,{}),(Array.from(new Set((v||[]).flatMap(e=>Object.keys(e||{}).filter(e=>"name"!==e))))||[]).map((e,t)=>(0,U.jsx)(F.y,{dataKey:e,stackId:"a",fill:K[t%K.length],name:e},e))]})})]})}),u&&u.length>1&&(0,U.jsx)(y.A,{"data-aos":"fade-up",item:!0,xs:12,sx:{mt:4},children:(0,U.jsxs)(w.A,{sx:{p:3,minHeight:320,backgroundColor:"#f9f9f9",overflowX:"auto"},children:[(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:b.A.t("statsReseaux.growthRate")}),(0,U.jsx)(C.u,{width:"100%",height:400,children:(0,U.jsxs)(L.E,{data:V(u),margin:{top:20,right:20,left:0,bottom:0},children:[(0,U.jsx)(D.d,{strokeDasharray:"3 3"}),(0,U.jsx)(E.W,{dataKey:"name"}),(0,U.jsx)(W.h,{allowDecimals:!1,tickFormatter:e=>e+"%"}),(0,U.jsx)(R.m,{formatter:e=>null!==e?e+"%":"N/A"}),(0,U.jsx)(N.s,{}),(0,U.jsx)(F.y,{dataKey:"croissance",fill:"#82ca9d",name:b.A.t("statsReseaux.growth")})]})}),(()=>{const e=V(u);if(!e.length)return null;const t=(e||[]).filter(e=>"number"===typeof e.croissance&&e.croissance>0),a=(e||[]).filter(e=>"number"===typeof e.croissance&&e.croissance<0),n=(e||[]).filter(e=>0===e.croissance),r=(e||[]).filter(e=>e.croissance===b.A.t("statsReseaux.new")),i=t.filter(e=>e.name||e.nom),l=a.filter(e=>e.name||e.nom),d=n.filter(e=>e.name||e.nom),c=r.filter(e=>e.name||e.nom);return 0===i.length&&0===l.length&&0===d.length&&0===c.length?null:(0,U.jsx)(s.A,{sx:{bgcolor:"#f9f9f9",borderRadius:2,border:"1px solid #e0e0e0",p:4,mt:3},children:(0,U.jsxs)(o.A,{sx:{fontSize:18,color:"#444",fontStyle:"italic",textAlign:"center"},children:[i.length>0&&(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)(s.A,{component:"span",fontWeight:"bold",color:"success.main",children:["R\xe9seaux en croissance : ",i.map(e=>"\xab ".concat(e.name||e.nom," \xbb (+").concat(e.croissance,"%)")).join(", ")]}),".",(0,U.jsx)("br",{})]}),l.length>0&&(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)(s.A,{component:"span",fontWeight:"bold",color:"error.main",children:["R\xe9seaux en baisse : ",l.map(e=>"\xab ".concat(e.name||e.nom," \xbb (").concat(e.croissance,"%)")).join(", ")]}),".",(0,U.jsx)("br",{})]}),d.length>0&&(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)(s.A,{component:"span",fontWeight:"bold",color:"warning.main",children:["R\xe9seaux stables : ",d.map(e=>"\xab ".concat(e.name||e.nom," \xbb")).join(", ")]}),".",(0,U.jsx)("br",{})]}),c.length>0&&(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)(s.A,{component:"span",fontWeight:"bold",color:"info.main",children:["Nouveaux r\xe9seaux : ",c.map(e=>"\xab ".concat(e.name||e.nom," \xbb")).join(", ")]}),".",(0,U.jsx)("br",{})]})]})})})()]})})]})]})};var Z=a(82656);const Y=["#8884d8","#82ca9d","#ffc658"],Q=e=>{let{selectedChurch:t}=e;const{data:a,loading:r,error:i,refresh:l}=P("services-".concat(t||"none"),async()=>{var e;if(!t)return[];const a=new Date,n=new Date(a.getFullYear(),a.getMonth()-2,1),r=new Date(a.getFullYear(),a.getMonth()+1,0),s={start:n.toISOString().slice(0,10),end:r.toISOString().slice(0,10),churchId:t.id},o=await q.apiService.services.getAll(s);return(null===(e=o.data)||void 0===e?void 0:e.data)||o.data||[]},{ttl:3e5,staleWhileRevalidate:!0});(0,n.useEffect)(()=>{if(t){const e=setTimeout(()=>{l()},100);return()=>clearTimeout(e)}},[t]);const c=n.useMemo(()=>{if(!a||0===a.length)return[];const e=a.map(e=>new Date(e.date).toISOString().slice(0,10));return[...new Set(e)].sort().slice(-8).map(e=>{const t={date:new Date(e).toLocaleDateString("fr-FR")};return["Culte 1","Culte 2","Culte 3"].forEach((n,r)=>{const s=a.find(t=>new Date(t.date).toISOString().slice(0,10)===e&&t.culte===n);t["culte".concat(r+1)]=s?(s.total_adultes||0)+(s.total_enfants||0)+(s.total_chantres||0)+(s.total_protocoles||0)+(s.total_multimedia||0)+(s.total_respo_ecodim||0)+(s.total_animateurs_ecodim||0)+(s.total_enfants_ecodim||0):0}),t})},[a]),u=["total_chantres","total_protocoles","total_multimedia","total_respo_ecodim","total_animateurs_ecodim"],h=n.useCallback(e=>{if(!a||0===a.length)return[];const t=a.map(e=>new Date(e.date).toISOString().slice(0,10));return[...new Set(t)].sort().slice(-8).map(t=>{const n={date:new Date(t).toLocaleDateString("fr-FR")},r=a.find(a=>new Date(a.date).toISOString().slice(0,10)===t&&a.culte===e),s=r?(r.total_adultes||0)+(r.total_enfants||0)+(r.total_chantres||0)+(r.total_protocoles||0)+(r.total_multimedia||0)+(r.total_respo_ecodim||0)+(r.total_animateurs_ecodim||0)+(r.total_enfants_ecodim||0):0,o=s-(r?u.reduce((e,t)=>e+(r[t]||0),0):0);return n.audienceSansServiteurs=o,n.audienceAvecServiteurs=s,n})},[a,u]),m=n.useMemo(()=>h("Culte 1"),[h]),p=n.useMemo(()=>h("Culte 2"),[h]),x=n.useMemo(()=>h("Culte 3"),[h]);return t?(0,U.jsxs)(s.A,{children:[(0,U.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",mb:3,alignItems:"center"},children:[(0,U.jsx)(o.A,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:"Statistiques Cultes"}),(0,U.jsx)(d.A,{onClick:l,disabled:r,"aria-label":b.A.t("common.actions.refresh"),children:(0,U.jsx)(O.A,{})})]}),r?(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",my:4},children:(0,U.jsx)(j.A,{})}):i?(0,U.jsx)(o.A,{color:"error",children:(e=>{var t,a;return"string"===typeof e?e:null!==e&&void 0!==e&&e.message?e.message:null!==e&&void 0!==e&&null!==(t=e.response)&&void 0!==t&&null!==(a=t.data)&&void 0!==a&&a.message?e.response.data.message:"Une erreur est survenue lors du chargement des donn\xe9es"})(i)}):(0,U.jsxs)(w.A,{"data-aos":"fade-up",sx:{p:3,height:520,minWidth:0,overflowX:"auto",display:"flex",flexDirection:"column",justifyContent:"center",backgroundColor:"#f9f9f9"},children:[(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:"Fr\xe9quentation des cultes par culte (8 derniers dimanches)"}),(0,U.jsx)(s.A,{sx:{flex:1,minHeight:0,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,U.jsx)(C.u,{width:"100%",height:440,children:(0,U.jsxs)(I.b,{data:c,margin:{top:20,right:20,left:0,bottom:0},children:[(0,U.jsx)(D.d,{strokeDasharray:"3 3"}),(0,U.jsx)(E.W,{dataKey:"date"}),(0,U.jsx)(W.h,{allowDecimals:!1}),(0,U.jsx)(R.m,{}),(0,U.jsx)(N.s,{}),(0,U.jsx)(M.N,{type:"monotone",dataKey:"culte1",stroke:Y[0],strokeWidth:2,dot:!0,name:"Culte 1"}),(0,U.jsx)(M.N,{type:"monotone",dataKey:"culte2",stroke:Y[1],strokeWidth:2,dot:!0,name:"Culte 2"}),(0,U.jsx)(M.N,{type:"monotone",dataKey:"culte3",stroke:Y[2],strokeWidth:2,dot:!0,name:"Culte 3"})]})})})]}),(0,U.jsxs)(w.A,{sx:{p:3,mt:4,backgroundColor:"#f9f9f9"},children:[(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:"Audience - Culte 1"}),(0,U.jsx)(C.u,{width:"100%",height:300,children:(0,U.jsxs)(I.b,{data:m,children:[(0,U.jsx)(E.W,{dataKey:"date"}),(0,U.jsx)(W.h,{allowDecimals:!1}),(0,U.jsx)(R.m,{}),(0,U.jsx)(N.s,{}),(0,U.jsx)(M.N,{type:"monotone",dataKey:"audienceSansServiteurs",stroke:"#1976d2",strokeWidth:2,dot:!0,name:"Audience, \xe0 l'exception des serviteurs"}),(0,U.jsx)(M.N,{type:"monotone",dataKey:"audienceAvecServiteurs",stroke:"#43a047",strokeWidth:2,dot:!0,name:"Audience, avec les serviteurs"})]})})]}),(0,U.jsxs)(w.A,{sx:{p:3,mt:4,backgroundColor:"#f9f9f9"},children:[(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:"Audience - Culte 2"}),(0,U.jsx)(C.u,{width:"100%",height:300,children:(0,U.jsxs)(I.b,{data:p,children:[(0,U.jsx)(E.W,{dataKey:"date"}),(0,U.jsx)(W.h,{allowDecimals:!1}),(0,U.jsx)(R.m,{}),(0,U.jsx)(N.s,{}),(0,U.jsx)(M.N,{type:"monotone",dataKey:"audienceSansServiteurs",stroke:"#1976d2",strokeWidth:2,dot:!0,name:"Audience, \xe0 l'exception des serviteurs"}),(0,U.jsx)(M.N,{type:"monotone",dataKey:"audienceAvecServiteurs",stroke:"#43a047",strokeWidth:2,dot:!0,name:"Audience, avec les serviteurs"})]})})]}),(0,U.jsxs)(w.A,{sx:{p:3,mt:4,backgroundColor:"#f9f9f9"},children:[(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:"Audience - Culte 3"}),(0,U.jsx)(C.u,{width:"100%",height:300,children:(0,U.jsxs)(I.b,{data:x,children:[(0,U.jsx)(E.W,{dataKey:"date"}),(0,U.jsx)(W.h,{allowDecimals:!1}),(0,U.jsx)(R.m,{}),(0,U.jsx)(N.s,{}),(0,U.jsx)(M.N,{type:"monotone",dataKey:"audienceSansServiteurs",stroke:"#1976d2",strokeWidth:2,dot:!0,name:"Audience, \xe0 l'exception des serviteurs"}),(0,U.jsx)(M.N,{type:"monotone",dataKey:"audienceAvecServiteurs",stroke:"#43a047",strokeWidth:2,dot:!0,name:"Audience, avec les serviteurs"})]})})]})]}):(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",my:4},children:(0,U.jsx)(o.A,{variant:"h6",color:"text.secondary",children:"Veuillez s\xe9lectionner une \xe9glise pour voir les statistiques"})})};var J=a(79067),$=a(24343),ee=a(91449),te=a(91244),ae=a(16128),ne=a(65506);const re=e=>{let{selectedChurch:t,user:a}=e;const[r,i]=(0,n.useState)({church_id:(null===t||void 0===t?void 0:t.id)||"",network_id:"",type_culte:"",date_from:(()=>{const e=new Date,t=e.getFullYear(),a=new Date(t,0,1),n=Math.floor((e-a)/864e5);let r=Math.ceil((n+a.getDay()+1)/7);if(0===r){const a=new Date(t-1,0,1),n=Math.floor((e-a)/864e5);r=Math.ceil((n+a.getDay()+1)/7)}if(r-=1,r<=0){return r=52,"".concat(t-1,"-W").concat(r.toString().padStart(2,"0"))}return"".concat(t,"-W").concat(r.toString().padStart(2,"0"))})()}),[l,d]=(0,n.useState)(!1),[p,x]=(0,n.useState)(null),[A,g]=(0,n.useState)(null),[v,S]=(0,n.useState)([]);(0,n.useEffect)(()=>{null!==t&&void 0!==t&&t.id?(async()=>{try{var e;const a=await q.A.networks.getAll({churchId:null===t||void 0===t?void 0:t.id}),n=(null===(e=a.data)||void 0===e?void 0:e.data)||a.data||[];if(Array.isArray(n)){if(S(n),n.length>0){const e=n[0],t=Z.ze.find(e=>"Tous"!==e.value);i(a=>(0,f.A)((0,f.A)({},a),{},{network_id:e.id,type_culte:t?t.value:""}))}}else S([])}catch(p){S([])}})():S([])},[t]),(0,n.useEffect)(()=>{null!==t&&void 0!==t&&t.id&&r.network_id&&r.type_culte&&r.date_from&&_()},[null===t||void 0===t?void 0:t.id,r.network_id,r.type_culte,r.date_from,v.length]);const _=async()=>{d(!0),x(null);try{const e=(0,f.A)({},r);if(r.date_from&&r.date_from.includes("-W"))try{const[t,a]=r.date_from.split("-W"),n=parseInt(a),s=(new Date(t,0,1),new Date(t,0,1));for(;4!==s.getDay();)s.setDate(s.getDate()+1);const o=new Date(s);o.setDate(s.getDate()+7*(n-1)-3);const i=new Date(o);if(i.setDate(o.getDate()+6),isNaN(o.getTime())||isNaN(i.getTime()))throw new Error("Dates invalides g\xe9n\xe9r\xe9es");e.date_from=o.toISOString().split("T")[0],e.date_to=i.toISOString().split("T")[0]}catch(p){delete e.date_from}const t=await ne.A.getStats(e);if(t.success){const e=t.data,a={total_previsionnel:e.total_previsionnel||0,total_effectif_reel:e.total_effectif||0,chartData:e.chart_data||[],details:e.details||[]};g(a)}else x(t.message||"Erreur lors du chargement des statistiques"),g(null)}catch(p){var e,t;x((null===(e=p.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Erreur lors du chargement des statistiques"),g(null)}finally{d(!1)}},k=(e,t)=>{i(a=>(0,f.A)((0,f.A)({},a),{},{[e]:t}))},I=(null===A||void 0===A?void 0:A.chartData)||[],M=(null===A||void 0===A?void 0:A.total_previsionnel)||0,O=(null===A||void 0===A?void 0:A.total_effectif_reel)||0,T=M-O;return(0,U.jsxs)(s.A,{sx:{p:3},children:[(0,U.jsx)(o.A,{variant:"h4",gutterBottom:!0,children:b.A.t("previsionnel.dashboard.title")}),(0,U.jsx)(o.A,{variant:"body1",color:"text.secondary",sx:{mb:3},children:b.A.t("previsionnel.dashboard.subtitle")}),(0,U.jsxs)(w.A,{sx:{p:3,mb:3},children:[(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,children:b.A.t("previsionnel.dashboard.filters.title")}),(0,U.jsxs)(y.A,{container:!0,spacing:3,alignItems:"flex-start",children:[(0,U.jsx)(y.A,{item:!0,xs:12,sm:6,md:4,children:(0,U.jsxs)(c.A,{fullWidth:!0,children:[(0,U.jsx)(J.A,{children:b.A.t("previsionnel.dashboard.filters.network")}),(0,U.jsx)(u.A,{sx:{minWidth:"100px"},value:r.network_id,onChange:e=>k("network_id",e.target.value),label:b.A.t("previsionnel.dashboard.filters.network"),children:v.map(e=>(0,U.jsx)(h.A,{value:e.id,children:e.nom},e.id))})]})}),(0,U.jsx)(y.A,{item:!0,xs:12,sm:6,md:4,children:(0,U.jsxs)(c.A,{fullWidth:!0,children:[(0,U.jsx)(J.A,{children:b.A.t("previsionnel.dashboard.filters.type")}),(0,U.jsxs)(u.A,{sx:{minWidth:"100px"},value:r.type_culte,onChange:e=>k("type_culte",e.target.value),label:b.A.t("previsionnel.dashboard.filters.type"),children:[(0,U.jsx)(h.A,{value:"",children:"Tous"}),Z.ze.filter(e=>"Tous"!==e.value).map(e=>(0,U.jsx)(h.A,{value:e.value,children:e.label},e.value))]})]})}),(0,U.jsx)(y.A,{item:!0,xs:12,sm:6,md:4,children:(0,U.jsx)($.A,{fullWidth:!0,type:"week",label:"Semaine",sx:{minWidth:"100px"},value:r.date_from||"",onChange:e=>k("date_from",e.target.value),InputLabelProps:{shrink:!0},helperText:r.date_from?(e=>{if(!e)return"";try{const[t,a]=e.split("-W"),n=parseInt(a),r=(new Date(t,0,1),new Date(t,0,1));for(;4!==r.getDay();)r.setDate(r.getDate()+1);const s=new Date(r);s.setDate(r.getDate()+7*(n-1)-3);const o=new Date(s);o.setDate(s.getDate()+6);const i={weekday:"long",day:"numeric",month:"long",year:"numeric"};return"Semaine ".concat(n," (").concat(o.toLocaleDateString("fr-FR",i),")")}catch(p){return e}})(r.date_from):"Format: Semaine/Mois/Ann\xe9e"})})]})]}),p&&(0,U.jsx)(ee.A,{severity:"error",sx:{mb:3},children:p}),A&&(0,U.jsxs)(y.A,{container:!0,spacing:3,sx:{mb:3},children:[(0,U.jsx)(y.A,{item:!0,xs:12,md:4,children:(0,U.jsx)(te.A,{children:(0,U.jsxs)(ae.A,{children:[(0,U.jsx)(o.A,{color:"textSecondary",gutterBottom:!0,children:"Total Pr\xe9visionnel"}),(0,U.jsx)(o.A,{variant:"h4",children:M})]})})}),(0,U.jsx)(y.A,{item:!0,xs:12,md:4,children:(0,U.jsx)(te.A,{children:(0,U.jsxs)(ae.A,{children:[(0,U.jsx)(o.A,{color:"textSecondary",gutterBottom:!0,children:"Effectif R\xe9seau"}),(0,U.jsx)(o.A,{variant:"h4",children:O})]})})}),(0,U.jsx)(y.A,{item:!0,xs:12,md:4,children:(0,U.jsx)(te.A,{children:(0,U.jsxs)(ae.A,{children:[(0,U.jsx)(o.A,{color:"textSecondary",gutterBottom:!0,children:"Diff\xe9rence"}),(0,U.jsxs)(o.A,{variant:"h4",color:T>=0?"success.main":"error.main",children:[T>=0?"+":"",T]})]})})})]}),I.length>0?(0,U.jsxs)(w.A,{sx:{p:3,mb:3},children:[(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,children:b.A.t("previsionnel.dashboard.chart.title")}),(0,U.jsx)(C.u,{width:"100%",height:400,children:(0,U.jsxs)(L.E,{data:I,children:[(0,U.jsx)(D.d,{strokeDasharray:"3 3"}),(0,U.jsx)(E.W,{dataKey:"date"}),(0,U.jsx)(W.h,{}),(0,U.jsx)(R.m,{}),(0,U.jsx)(N.s,{}),(0,U.jsx)(F.y,{dataKey:"effectif_reel",fill:"#8884d8",name:b.A.t("previsionnel.dashboard.chart.effectifReel")}),(0,U.jsx)(F.y,{dataKey:"previsionnel",fill:"#82ca9d",name:b.A.t("previsionnel.dashboard.chart.previsionnel")})]})})]}):!l&&!p&&(0,U.jsx)(w.A,{sx:{p:3,mb:3,textAlign:"center"},children:(0,U.jsx)(o.A,{variant:"h6",color:"text.secondary",children:b.A.t("previsionnel.dashboard.chart.noData")})}),(null===A||void 0===A?void 0:A.details)&&A.details.length>0&&(0,U.jsxs)(w.A,{sx:{p:3},children:[(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,children:b.A.t("previsionnel.dashboard.table.title")}),(0,U.jsx)(s.A,{sx:{overflowX:"auto"},children:(0,U.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,U.jsx)("thead",{children:(0,U.jsxs)("tr",{style:{backgroundColor:"#f5f5f5"},children:[(0,U.jsx)("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #ddd"},children:b.A.t("previsionnel.dashboard.table.network")}),(0,U.jsx)("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #ddd"},children:b.A.t("previsionnel.dashboard.table.type")}),(0,U.jsx)("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #ddd"},children:b.A.t("previsionnel.dashboard.table.date")}),(0,U.jsx)("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #ddd"},children:b.A.t("previsionnel.dashboard.table.effectifReel")}),(0,U.jsx)("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #ddd"},children:b.A.t("previsionnel.dashboard.table.previsionnel")}),(0,U.jsx)("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #ddd"},children:b.A.t("previsionnel.dashboard.table.difference")})]})}),(0,U.jsx)("tbody",{children:A.details.map((e,t)=>(0,U.jsxs)("tr",{style:{borderBottom:"1px solid #eee"},children:[(0,U.jsx)("td",{style:{padding:"12px"},children:e.network_name}),(0,U.jsx)("td",{style:{padding:"12px"},children:e.type_culte}),(0,U.jsx)("td",{style:{padding:"12px"},children:new Date(e.date).toLocaleDateString("fr-FR")}),(0,U.jsx)("td",{style:{padding:"12px"},children:e.effectif_reel}),(0,U.jsx)("td",{style:{padding:"12px"},children:e.previsionnel}),(0,U.jsx)("td",{style:{padding:"12px"},children:(0,U.jsx)(m.A,{label:e.difference>=0?"+".concat(e.difference):e.difference,color:e.difference>=0?"success":"error",size:"small"})})]},t))})]})})]}),l&&(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,U.jsx)(j.A,{})})]})};var se=a(56198);const oe=e=>{let{selectedChurch:t,user:a}=e;const[r,i]=(0,n.useState)({church_id:(null===t||void 0===t?void 0:t.id)||"",network_id:"",type_culte:"",date_from:(()=>{const e=new Date,t=e.getFullYear(),a=new Date(t,0,1),n=Math.floor((e-a)/864e5);let r=Math.ceil((n+a.getDay()+1)/7);if(0===r){const a=new Date(t-1,0,1),n=Math.floor((e-a)/864e5);r=Math.ceil((n+a.getDay()+1)/7)}return"".concat(t,"-W").concat(r.toString().padStart(2,"0"))})()}),[l,d]=(0,n.useState)(!1),[p,x]=(0,n.useState)(null),[A,g]=(0,n.useState)(null),[v,S]=(0,n.useState)([]);(0,n.useEffect)(()=>{null!==t&&void 0!==t&&t.id?(async()=>{try{var e;const a=await q.A.networks.getAll({churchId:null===t||void 0===t?void 0:t.id}),n=(null===(e=a.data)||void 0===e?void 0:e.data)||a.data||[];if(Array.isArray(n)){if(S(n),n.length>0){const e=n[0],t=Z.ze.find(e=>"Tous"!==e.value);i(a=>(0,f.A)((0,f.A)({},a),{},{network_id:e.id,type_culte:t?t.value:""}))}}else S([])}catch(p){S([])}})():S([])},[t]),(0,n.useEffect)(()=>{null!==t&&void 0!==t&&t.id&&r.network_id&&r.type_culte&&r.date_from&&_()},[null===t||void 0===t?void 0:t.id,r.network_id,r.type_culte,r.date_from,v.length]);const _=async()=>{d(!0),x(null);try{const e=(0,f.A)({},r);if(r.date_from&&r.date_from.includes("-W"))try{const[t,a]=r.date_from.split("-W");let n=parseInt(a);if(n-=1,n<=0){parseInt(t);n=52}const s=n<=0?parseInt(t)-1:parseInt(t),o=n<=0?52:n,i=(new Date(s,0,1),new Date(s,0,1));for(;4!==i.getDay();)i.setDate(i.getDate()+1);const l=new Date(i);l.setDate(i.getDate()+7*(o-1)-3);const d=new Date(l);if(d.setDate(l.getDate()+6),isNaN(l.getTime())||isNaN(d.getTime()))throw new Error("Dates invalides g\xe9n\xe9r\xe9es");e.date_from=l.toISOString().split("T")[0],e.date_to=d.toISOString().split("T")[0]}catch(p){delete e.date_from}const t=await se.A.getStats(e);if(t.success){const e=t.data,a={total_presents:e.total_presents||0,total_effectif_reel:e.effectif_reel||0,chartData:e.chart_data||[],details:e.details||[]};g(a)}else x(t.message||"Erreur lors du chargement des statistiques"),g(null)}catch(p){var e,t;x((null===(e=p.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Erreur lors du chargement des statistiques"),g(null)}finally{d(!1)}},k=(e,t)=>{i(a=>(0,f.A)((0,f.A)({},a),{},{[e]:t}))},I=(null===A||void 0===A?void 0:A.chartData)||[],M=(null===A||void 0===A?void 0:A.total_presents)||0,O=(null===A||void 0===A?void 0:A.total_effectif_reel)||0,T=M-O;return(0,U.jsxs)(s.A,{sx:{p:3},children:[(0,U.jsx)(o.A,{variant:"h4",gutterBottom:!0,children:b.A.t("assistance.dashboard.title")}),(0,U.jsx)(o.A,{variant:"body1",color:"text.secondary",sx:{mb:3},children:b.A.t("assistance.dashboard.subtitle")}),(0,U.jsxs)(w.A,{sx:{p:3,mb:3},children:[(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,children:b.A.t("assistance.dashboard.filters.title")}),(0,U.jsxs)(y.A,{container:!0,spacing:3,alignItems:"flex-start",children:[(0,U.jsx)(y.A,{item:!0,xs:12,sm:6,md:4,children:(0,U.jsxs)(c.A,{fullWidth:!0,children:[(0,U.jsx)(J.A,{children:b.A.t("assistance.dashboard.filters.network")}),(0,U.jsx)(u.A,{sx:{minWidth:"100px"},value:r.network_id,onChange:e=>k("network_id",e.target.value),label:b.A.t("assistance.dashboard.filters.network"),children:v.map(e=>(0,U.jsx)(h.A,{value:e.id,children:e.nom},e.id))})]})}),(0,U.jsx)(y.A,{item:!0,xs:12,sm:6,md:4,children:(0,U.jsxs)(c.A,{fullWidth:!0,children:[(0,U.jsx)(J.A,{children:b.A.t("assistance.dashboard.filters.type")}),(0,U.jsxs)(u.A,{sx:{minWidth:"100px"},value:r.type_culte,onChange:e=>k("type_culte",e.target.value),label:b.A.t("assistance.dashboard.filters.type"),children:[(0,U.jsx)(h.A,{value:"",children:"Tous"}),Z.ze.filter(e=>"Tous"!==e.value).map(e=>(0,U.jsx)(h.A,{value:e.value,children:e.label},e.value))]})]})}),(0,U.jsx)(y.A,{item:!0,xs:12,sm:6,md:4,children:(0,U.jsx)($.A,{fullWidth:!0,type:"week",label:b.A.t("common.actions.week"),sx:{minWidth:"100px"},value:r.date_from||"",onChange:e=>k("date_from",e.target.value),InputLabelProps:{shrink:!0},helperText:r.date_from?(e=>{if(!e)return"";try{const[t,a]=e.split("-W"),n=parseInt(a);let r=n-1,s=parseInt(t);r<=0&&(s=parseInt(t)-1,r=52);new Date(s,0,1);const o=new Date(s,0,1);for(;4!==o.getDay();)o.setDate(o.getDate()+1);const i=new Date(o);i.setDate(o.getDate()+7*(r-1)-3);const l=new Date(i);l.setDate(i.getDate()+6);const d={weekday:"long",day:"numeric",month:"long",year:"numeric"};return"Semaine ".concat(n," \u2192 Donn\xe9es semaine ").concat(r," (").concat(l.toLocaleDateString("fr-FR",d),")")}catch(p){return e}})(r.date_from):"Format: Semaine/Mois/Ann\xe9e"})})]})]}),p&&(0,U.jsx)(ee.A,{severity:"error",sx:{mb:3},children:p}),A&&(0,U.jsxs)(y.A,{container:!0,spacing:3,sx:{mb:3},children:[(0,U.jsx)(y.A,{item:!0,xs:12,md:4,children:(0,U.jsx)(te.A,{children:(0,U.jsxs)(ae.A,{children:[(0,U.jsx)(o.A,{color:"textSecondary",gutterBottom:!0,children:"Total Pr\xe9sents"}),(0,U.jsx)(o.A,{variant:"h4",children:M})]})})}),(0,U.jsx)(y.A,{item:!0,xs:12,md:4,children:(0,U.jsx)(te.A,{children:(0,U.jsxs)(ae.A,{children:[(0,U.jsx)(o.A,{color:"textSecondary",gutterBottom:!0,children:"Effectif R\xe9seau"}),(0,U.jsx)(o.A,{variant:"h4",children:O})]})})}),(0,U.jsx)(y.A,{item:!0,xs:12,md:4,children:(0,U.jsx)(te.A,{children:(0,U.jsxs)(ae.A,{children:[(0,U.jsx)(o.A,{color:"textSecondary",gutterBottom:!0,children:"Diff\xe9rence"}),(0,U.jsxs)(o.A,{variant:"h4",color:T>=0?"success.main":"error.main",children:[T>=0?"+":"",T]})]})})})]}),I.length>0?(0,U.jsxs)(w.A,{sx:{p:3,mb:3},children:[(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,children:b.A.t("assistance.dashboard.chart.title")}),(0,U.jsx)(C.u,{width:"100%",height:400,children:(0,U.jsxs)(L.E,{data:I,children:[(0,U.jsx)(D.d,{strokeDasharray:"3 3"}),(0,U.jsx)(E.W,{dataKey:"date"}),(0,U.jsx)(W.h,{}),(0,U.jsx)(R.m,{}),(0,U.jsx)(N.s,{}),(0,U.jsx)(F.y,{dataKey:"effectif_reel",fill:"#8884d8",name:b.A.t("assistance.dashboard.chart.effectifReel")}),(0,U.jsx)(F.y,{dataKey:"assistance",fill:"#ffc658",name:b.A.t("assistance.dashboard.chart.assistance")})]})})]}):!l&&!p&&(0,U.jsx)(w.A,{sx:{p:3,mb:3,textAlign:"center"},children:(0,U.jsx)(o.A,{variant:"h6",color:"text.secondary",children:b.A.t("assistance.dashboard.chart.noData")})}),(null===A||void 0===A?void 0:A.details)&&A.details.length>0&&(0,U.jsxs)(w.A,{sx:{p:3},children:[(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,children:b.A.t("assistance.dashboard.table.title")}),(0,U.jsx)(s.A,{sx:{overflowX:"auto"},children:(0,U.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,U.jsx)("thead",{children:(0,U.jsxs)("tr",{style:{backgroundColor:"#f5f5f5"},children:[(0,U.jsx)("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #ddd"},children:b.A.t("assistance.dashboard.table.network")}),(0,U.jsx)("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #ddd"},children:b.A.t("assistance.dashboard.table.type")}),(0,U.jsx)("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #ddd"},children:b.A.t("assistance.dashboard.table.date")}),(0,U.jsx)("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #ddd"},children:b.A.t("assistance.dashboard.table.effectifReel")}),(0,U.jsx)("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #ddd"},children:b.A.t("assistance.dashboard.table.assistance")}),(0,U.jsx)("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #ddd"},children:b.A.t("assistance.dashboard.table.difference")})]})}),(0,U.jsx)("tbody",{children:A.details.map((e,t)=>(0,U.jsxs)("tr",{style:{borderBottom:"1px solid #eee"},children:[(0,U.jsx)("td",{style:{padding:"12px"},children:e.network_name}),(0,U.jsx)("td",{style:{padding:"12px"},children:e.type_culte}),(0,U.jsx)("td",{style:{padding:"12px"},children:new Date(e.date).toLocaleDateString("fr-FR")}),(0,U.jsx)("td",{style:{padding:"12px"},children:e.effectif_reel}),(0,U.jsx)("td",{style:{padding:"12px"},children:e.assistance}),(0,U.jsx)("td",{style:{padding:"12px"},children:(0,U.jsx)(m.A,{label:e.assistance-e.effectif_reel>=0?"+".concat(e.assistance-e.effectif_reel):e.assistance-e.effectif_reel,color:e.assistance-e.effectif_reel>=0?"success":"error",size:"small"})})]},t))})]})})]}),l&&(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",p:3},children:(0,U.jsx)(j.A,{})})]})};var ie=a(17873),le=a(57756),de=a(369),ce=a(51181),ue=a(88324);const he=e=>{var t,a;let{node:n,expandedNodes:r,onToggle:i,level:l=0}=e;const d=n.children&&n.children.length>0,c=r.has(n.id),u=e=>{switch(e){case 0:return"primary";case 1:return"secondary";case 2:return"success";case 3:return"info";case 4:return"warning";case 5:return"error";default:return"default"}};return(0,U.jsxs)(s.A,{sx:{position:"relative"},children:[(0,U.jsxs)(s.A,{onClick:()=>d&&i(n.id),sx:{cursor:d?"pointer":"default",display:"flex",flexDirection:"column",alignItems:"center",p:2,border:"2px solid",borderColor:"".concat(u(n.niveau),".main"),borderRadius:2,bgcolor:"".concat(u(n.niveau),".50"),minWidth:0===n.niveau?200:1===n.niveau?160:130,transition:"all 0.3s ease",mb:d&&c?2:0,"&:hover":d?{transform:"translateY(-2px)",boxShadow:"0 4px 20px rgba(0,0,0,0.15)",borderColor:"".concat(u(n.niveau),".dark")}:{}},children:[d&&(0,U.jsx)(s.A,{sx:{position:"absolute",top:-8,right:-8,bgcolor:"white",border:"2px solid",borderColor:"".concat(u(n.niveau),".main"),borderRadius:"50%",width:28,height:28,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"bold",color:"".concat(u(n.niveau),".main"),boxShadow:"0 2px 8px rgba(0,0,0,0.2)",zIndex:10},children:c?"\u2212":"+"}),d&&(0,U.jsx)(s.A,{sx:{position:"absolute",bottom:-8,left:"50%",transform:"translateX(-50%)",width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"8px solid ".concat(u(n.niveau),".main"),filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.2))"}}),(0,U.jsx)(ie.A,{src:n.user.image?"".concat("http://localhost:5001","/").concat(n.user.image):void 0,sx:{width:0===n.niveau?80:1===n.niveau?60:50,height:0===n.niveau?80:1===n.niveau?60:50,mb:1,border:"2px solid",borderColor:"".concat(u(n.niveau),".main")},onError:e=>{},children:null===(t=n.user.username)||void 0===t||null===(a=t.charAt(0))||void 0===a?void 0:a.toUpperCase()}),(0,U.jsx)(o.A,{variant:0===n.niveau?"subtitle1":"body2",sx:{fontWeight:"bold",textAlign:"center",mb:.5,color:"text.primary"},children:n.user.username}),(0,U.jsx)(o.A,{variant:"caption",sx:{color:"".concat(u(n.niveau),".main"),fontWeight:"600",textAlign:"center"},children:(e=>{switch(e){case 0:return"Responsable d'\xe9glise";case 1:return"Responsable de r\xe9seau";case 2:return"12";case 3:return"144";case 4:return"1728";case 5:return"20738";case 6:return"248832";default:return"Niveau ".concat(e)}})(n.niveau)}),(0,U.jsx)(m.A,{label:"Niveau ".concat(n.niveau),color:u(n.niveau),variant:"filled",size:"small",sx:{mt:1,fontSize:"0.7rem"}}),d&&(0,U.jsxs)(o.A,{variant:"caption",sx:{mt:.5,color:"text.secondary",fontSize:"0.65rem"},children:[n.children.length," leader",n.children.length>1?"s":""]})]}),d&&c&&(0,U.jsxs)(s.A,{sx:{mt:3,position:"relative"},children:[(0,U.jsx)(s.A,{sx:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",width:4,height:30,bgcolor:"".concat(u(n.niveau),".main"),borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.2)"}}),n.children.length>1&&(0,U.jsx)(s.A,{sx:{position:"absolute",top:-15,left:"50%",transform:"translateX(-50%)",width:"calc(100% - 120px)",height:4,bgcolor:"".concat(u(n.niveau),".main"),borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.2)",zIndex:5}}),n.children.map((e,t)=>(0,U.jsx)(s.A,{sx:{position:"absolute",top:-15,left:"50%",transform:"translateX(-50%)",width:4,height:15,bgcolor:"".concat(u(n.niveau),".main"),borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.2)",zIndex:5}},"line-".concat(e.id))),(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",gap:4,flexWrap:"nowrap",position:"relative",pt:1,minWidth:"max-content",width:"100%","&::-webkit-scrollbar":{height:"8px"},"&::-webkit-scrollbar-track":{backgroundColor:"#f1f1f1",borderRadius:"4px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#c1c1c1",borderRadius:"4px","&:hover":{backgroundColor:"#a8a8a8"}}},children:n.children.map((e,t)=>(0,U.jsxs)(s.A,{sx:{position:"relative",flexShrink:0},children:[" ",(0,U.jsx)(s.A,{sx:{position:"absolute",top:-15,left:"50%",transform:"translateX(-50%)",width:10,height:10,bgcolor:"".concat(u(n.niveau),".main"),borderRadius:"50%",border:"3px solid white",boxShadow:"0 2px 8px rgba(0,0,0,0.3)",zIndex:10}}),(0,U.jsx)(he,{node:e,expandedNodes:r,onToggle:i,level:l+1})]},e.id))})]})]})},me=e=>{let{selectedChurch:t}=e;const[a,r]=(0,n.useState)(null),[i,l]=(0,n.useState)(!1),[c,u]=(0,n.useState)(null),[h,m]=(0,n.useState)(new Set),[p,x]=(0,n.useState)(1),[A,g]=(0,n.useState)({x:0,y:0}),[f,v]=(0,n.useState)(!1),[y,C]=(0,n.useState)({x:0,y:0}),[S,_]=(0,n.useState)({x:0,y:0}),k=(0,n.useRef)(null),R=async()=>{if(null!==t&&void 0!==t&&t.id){l(!0),u(null);try{const e=await ue.A.getChaineImpact(t.id);if(e.success&&e.tree){if(r(e),e.tree.length>0){const t=e.tree.find(e=>0===e.niveau)||e.tree[0];m(new Set([t.id]))}}else r(null)}catch(e){u("Erreur lors du chargement de la cha\xeene d'impact")}finally{l(!1)}}},I=e=>{const t=new Set(h);t.has(e)?t.delete(e):t.add(e),m(t)},D=e=>{e.preventDefault(),v(!1)};return(0,n.useEffect)(()=>{R()},[null===t||void 0===t?void 0:t.id]),null!==t&&void 0!==t&&t.id?(0,U.jsxs)(s.A,{sx:{p:3},children:[(0,U.jsxs)(s.A,{sx:{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,U.jsxs)(o.A,{variant:"h4",component:"h1",gutterBottom:!0,children:["Cha\xeene d'Impact - ",t.nom]}),(0,U.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,U.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",mr:2,p:1,bgcolor:"grey.100",borderRadius:1},children:[(0,U.jsx)(o.A,{variant:"caption",sx:{mr:1,color:"text.secondary"},children:"Navigation carte"}),(0,U.jsx)(d.A,{size:"small",onClick:()=>{x(e=>Math.max(.1,e/1.2))},"aria-label":"Zoom arri\xe8re",children:(0,U.jsx)(le.A,{})}),(0,U.jsxs)(o.A,{variant:"caption",sx:{mx:1,minWidth:"40px",textAlign:"center"},children:[Math.round(100*p),"%"]}),(0,U.jsx)(d.A,{size:"small",onClick:()=>{x(e=>Math.min(3,1.2*e))},"aria-label":"Zoom avant",children:(0,U.jsx)(de.A,{})}),(0,U.jsx)(d.A,{size:"small",onClick:()=>{x(1),g({x:0,y:0})},"aria-label":"Vue d'ensemble",sx:{ml:1},children:(0,U.jsx)(ce.A,{})})]}),(0,U.jsx)(d.A,{onClick:async()=>{if(null!==t&&void 0!==t&&t.id){u(null);try{await ue.A.updateChaineImpact(t.id),await R()}catch(e){u("Erreur lors de la mise \xe0 jour de la cha\xeene d'impact")}}},disabled:i,"aria-label":b.A.t("common.actions.refresh"),sx:{mr:1},children:(0,U.jsx)(O.A,{})})]})]}),a&&(0,U.jsx)(s.A,{sx:{mb:3},children:(0,U.jsxs)(o.A,{variant:"body2",color:"text.secondary",children:["Total de ",a.total_nodes," n\u0153ud",a.total_nodes>1?"s":""," dans la hi\xe9rarchie"]})}),c&&(0,U.jsx)(ee.A,{severity:"error",sx:{mb:3},onClose:()=>u(null),children:c}),i?(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",p:4},children:(0,U.jsx)(j.A,{})}):a&&a.tree&&0!==a.tree.length?(0,U.jsxs)(w.A,{"data-testid":"chaine-impact-container",ref:k,sx:{p:0,overflow:"hidden",position:"relative",height:"600px",cursor:f?"grabbing":"grab",userSelect:"none",touchAction:"none"},onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),0===e.button&&(v(!0),C({x:e.clientX,y:e.clientY}),_(A))},onMouseMove:e=>{if(e.preventDefault(),f){const t=e.clientX-y.x,a=e.clientY-y.y;g({x:S.x+t,y:S.y+a})}},onMouseUp:D,onMouseLeave:D,onWheel:e=>{e.preventDefault(),e.stopPropagation();const t=e.deltaY>0?.9:1.1,a=Math.max(.1,Math.min(3,p*t));x(a)},children:[(0,U.jsx)(s.A,{sx:{position:"absolute",top:10,left:10,zIndex:10,bgcolor:"rgba(255,255,255,0.9)",p:1,borderRadius:1,fontSize:"0.75rem",color:"text.secondary"},children:"Glisser pour d\xe9placer \u2022 Molette pour zoomer"}),(0,U.jsx)(s.A,{sx:{width:"100%",height:"100%",overflow:"hidden",position:"relative"},children:(0,U.jsx)(s.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%) translate(".concat(A.x,"px, ").concat(A.y,"px) scale(").concat(p,")"),transformOrigin:"center center",transition:f?"none":"transform 0.1s ease-out",display:"flex",flexDirection:"column",alignItems:"center",minWidth:"max-content",py:2},children:a.tree.map(e=>(0,U.jsx)(he,{node:e,expandedNodes:h,onToggle:I,level:0},e.id))})})]}):(0,U.jsxs)(s.A,{sx:{textAlign:"center",p:4},children:[(0,U.jsx)(o.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Aucune cha\xeene d'impact trouv\xe9e"}),(0,U.jsx)(o.A,{variant:"body2",color:"text.secondary",children:b.A.t("chaineImpact.updateChainMessage")})]})]}):(0,U.jsx)(s.A,{sx:{p:3,textAlign:"center"},children:(0,U.jsx)(o.A,{variant:"h6",color:"text.secondary",children:"Veuillez s\xe9lectionner une \xe9glise pour voir sa cha\xeene d'impact"})})};var pe=a(12097),xe=a(28259),Ae=a(87443),ge=a(10756),fe=a(86172),be=a(81341),ve=a(34375),je=a(19e3),ye=a(33023),we=a(81911),Ce=a(78776),Se=a(85877),_e=a(70916),ke=a(64),Re=a(25272),Ie=a(61773),De=a(5362),Ee=a(22950),We=a(83140),Ne=a(63745),Me=a(69594),Le=a(72301),Fe=a(37531),Oe=a(24634),Te=a(37251),Be=a(45350),ze=a(21281);const Pe=e=>{let{selectedChurch:t,user:a}=e;const{networks:r,loading:i,error:l,fetchNetworks:m,createNetwork:p,updateNetwork:x,deleteNetwork:A}=(0,Oe.fI)(t?{churchId:t.id}:{}),g=(0,n.useCallback)(async()=>{null!==t&&void 0!==t&&t.id&&await m({churchId:t.id})},[m,null===t||void 0===t?void 0:t.id]);(0,n.useEffect)(()=>{null!==t&&void 0!==t&&t.id&&g()},[null===t||void 0===t?void 0:t.id,g]);const{notification:j,showSuccess:C,showError:S,hideNotification:_}=(0,Te.h)(),{canCreateNetworks:k,canUpdateNetworks:R,canDeleteNetworks:I}=(0,Be.S)(),[D,E]=(0,n.useState)(null),[W,N]=(0,n.useState)(null),[M,L]=(0,n.useState)({}),[F,T]=(0,n.useState)({}),[B,z]=(0,n.useState)({}),[P,G]=(0,n.useState)(!1),[H,K]=(0,n.useState)(!1),[V,X]=(0,n.useState)(null),[Z,Y]=(0,n.useState)({nom:"",responsable1:"",responsable2:null}),[Q,te]=(0,n.useState)(null),[ae,ne]=(0,n.useState)(""),[re,se]=(0,n.useState)([]),[oe,ie]=(0,n.useState)(null),[le,de]=(0,n.useState)([]),[ce,ue]=(0,n.useState)(""),he=(0,n.useCallback)(async()=>{try{var e;const r=await q.apiService.users.getAvailable({churchId:null===t||void 0===t?void 0:t.id}),s=(null===(e=r.data)||void 0===e?void 0:e.data)||r.data||[];if(Q&&Z.responsable1)try{var a;const e=await q.apiService.users.getById(Z.responsable1),t=(null===(a=e.data)||void 0===a?void 0:a.data)||e.data;if(t){const e=s.some(e=>(e.id||e._id)===(t.id||t._id));e||s.push(t)}}catch(n){}se(s)}catch(n){const e=(0,v.hS)(n,"le chargement des membres disponibles");ie(e.message)}},[null===t||void 0===t?void 0:t.id,Q,Z.responsable1]),me=(0,n.useCallback)(async()=>{try{var e;const t=await q.apiService.churches.getAll();de((null===(e=t.data)||void 0===e?void 0:e.data)||t.data||[])}catch(t){de([])}},[]);if((0,n.useEffect)(()=>{m(),he(),me()},[t,m,he,me]),!t)return(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",my:4},children:(0,U.jsx)(o.A,{variant:"h6",color:"text.secondary",children:b.A.t("dashboard.networks.selectChurchMessage")})});const Pe=()=>{K(!1),X(null)};return(0,U.jsxs)(s.A,{sx:{width:"100%",overflow:"hidden",overflowX:"auto"},children:[(0,U.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[(0,U.jsx)(o.A,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:b.A.t("dashboard.networks.management")}),(0,U.jsxs)(s.A,{sx:{display:"flex",gap:2},children:[(0,U.jsx)(d.A,{onClick:g,disabled:i,"aria-label":b.A.t("common.actions.refresh"),children:(0,U.jsx)(O.A,{})}),(0,U.jsx)(pe.A,{variant:"contained",startIcon:(0,U.jsx)(Ee.A,{}),onClick:()=>{G(!0),ue("")},disabled:!k||!(null!==t&&void 0!==t&&t.id),children:b.A.t("dashboard.networks.newNetwork")})]})]}),(0,U.jsx)($.A,{"data-aos":"fade-up",fullWidth:!0,variant:"outlined",placeholder:b.A.t("dashboard.networks.searchPlaceholder"),value:ae,onChange:e=>ne(e.target.value),InputProps:{startAdornment:(0,U.jsx)(Ne.A,{sx:{mr:1,color:"text.secondary"}})},sx:{mb:3}}),i?(0,U.jsx)(Le.A,{titre:b.A.t("dashboard.networks.loading")}):l?(0,U.jsx)(Fe.A,{error:l,title:b.A.t("dashboard.networks.loadingError")}):(0,U.jsx)(xe.A,{"data-aos":"fade-up",component:w.A,children:(0,U.jsxs)(Ae.A,{children:[(0,U.jsx)(ge.A,{children:(0,U.jsxs)(fe.A,{children:[(0,U.jsx)(be.A,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Nom"}),(0,U.jsx)(be.A,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Responsable(s)"}),(0,U.jsx)(be.A,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"\xc9glise"}),(0,U.jsx)(be.A,{align:"right",sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:b.A.t("dashboard.networks.table.actions")})]})}),(0,U.jsxs)(ve.A,{children:[Array.isArray(r)?r.filter(e=>e.nom.toLowerCase().includes(ae.toLowerCase())).map(e=>{var t;return(0,U.jsxs)(n.Fragment,{children:[(0,U.jsxs)(fe.A,{hover:!0,onClick:()=>(async e=>{if(E(D===e?null:e),N(null),!M[e])try{const t=await q.apiService.networks.getById(e);L(a=>{var n;return(0,f.A)((0,f.A)({},a),{},{[e]:(null===(n=t.data)||void 0===n?void 0:n.data)||t.data})})}catch(t){}if(!F[e])try{const t=await q.apiService.networks.getGroups(e);T(a=>{var n;return(0,f.A)((0,f.A)({},a),{},{[e]:(null===(n=t.data)||void 0===n?void 0:n.data)||t.data})})}catch(t){}})(e.id||e._id),style:{cursor:"pointer"},children:[(0,U.jsxs)(be.A,{children:[(0,U.jsx)(d.A,{size:"small",children:D===(e.id||e._id)?(0,U.jsx)(ke.A,{}):(0,U.jsx)(Re.A,{})}),e.nom]}),(0,U.jsx)(be.A,{children:(()=>{const t=e=>(null===e||void 0===e?void 0:e.username)||(null===e||void 0===e?void 0:e.pseudo)||(null===e||void 0===e?void 0:e.email)||"-",a="object"===typeof e.responsable1?t(e.responsable1):t(re.find(t=>(t.id||t._id)===e.responsable1)),n="object"===typeof e.responsable2?t(e.responsable2):t(re.find(t=>(t.id||t._id)===e.responsable2));return a&&n&&"-"!==n?"".concat(a," & ").concat(n):a&&"-"!==a?a:n&&"-"!==n?n:"-"})()}),(0,U.jsx)(be.A,{children:e.church&&(null===(t=le.find(t=>{var a,n;return(t.id||t._id)===((null===(a=e.church)||void 0===a?void 0:a.id)||(null===(n=e.church)||void 0===n?void 0:n._id)||e.church)}))||void 0===t?void 0:t.nom)||"-"}),(0,U.jsxs)(be.A,{align:"right",children:[(0,U.jsx)(d.A,{onClick:t=>{t.stopPropagation(),(e=>{var t,a,n,r;Y({nom:e.nom,responsable1:(null===(t=e.responsable1)||void 0===t?void 0:t.id)||(null===(a=e.responsable1)||void 0===a?void 0:a._id)||e.responsable1||"",responsable2:(null===(n=e.responsable2)||void 0===n?void 0:n.id)||(null===(r=e.responsable2)||void 0===r?void 0:r._id)||e.responsable2||null}),te(e.id||e._id),G(!0),setTimeout(()=>{he()},100)})(e)},color:"primary",size:"small",disabled:!R,children:(0,U.jsx)(Ie.A,{})}),(0,U.jsx)(d.A,{onClick:t=>{t.stopPropagation(),(e=>{X(e),K(!0)})(e)},color:"error",size:"small",disabled:!I,children:(0,U.jsx)(De.A,{})}),(0,U.jsx)(d.A,{onClick:t=>{t.stopPropagation(),window.open("/networks/".concat(e.id||e._id),"_blank")},color:"info",size:"small",title:b.A.t("common.actions.view"),children:(0,U.jsx)(Me.A,{})})]})]}),(0,U.jsx)(fe.A,{children:(0,U.jsx)(be.A,{style:{paddingBottom:0,paddingTop:0},colSpan:3,children:(0,U.jsx)(je.A,{in:D===(e.id||e._id),timeout:"auto",unmountOnExit:!0,children:(0,U.jsx)(s.A,{margin:1,children:(0,U.jsx)(Ae.A,{size:"small",children:(0,U.jsx)(ve.A,{children:Array.isArray(F[e.id||e._id])&&F[e.id||e._id].map(e=>{var t,a,r,i,l;return(0,U.jsxs)(n.Fragment,{children:[(0,U.jsx)(fe.A,{hover:!0,onClick:t=>{t.stopPropagation(),(async e=>{if(N(W===e?null:e),!B[e])try{var a;const t=await q.apiService.groups.getById(e),n=(null===(a=t.data)||void 0===a?void 0:a.data)||t.data;z(t=>(0,f.A)((0,f.A)({},t),{},{[e]:n}))}catch(t){(0,v.hS)(t,"le chargement du groupe")}})(e.id||e._id)},style:{cursor:"pointer"},children:(0,U.jsx)(be.A,{children:(0,U.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,U.jsx)(Me.A,{color:"primary"}),W===(e.id||e._id)?(0,U.jsx)(ke.A,{}):(0,U.jsx)(Re.A,{}),(0,U.jsx)(o.A,{variant:"body2",sx:{fontWeight:500},children:null!==(t=e.responsable2)&&void 0!==t&&t.username?"GR ".concat(null===(a=e.responsable1)||void 0===a?void 0:a.username," & ").concat(null===(r=e.responsable2)||void 0===r?void 0:r.username):"GR ".concat(null===(i=e.responsable1)||void 0===i?void 0:i.username)})]})})}),(0,U.jsx)(fe.A,{children:(0,U.jsx)(be.A,{style:{paddingBottom:0,paddingTop:0},colSpan:3,children:(0,U.jsx)(je.A,{in:W===(e.id||e._id),timeout:"auto",unmountOnExit:!0,children:(0,U.jsx)(s.A,{margin:1,children:(0,U.jsx)("ol",{style:{paddingLeft:"2rem"},children:((null===(l=B[e.id||e._id])||void 0===l?void 0:l.members)||[]).map(e=>{const t=e.user||e,a=e.id||e._id||t.id||t._id,n=t.username||t.pseudo||"Nom inconnu",r=(0,ze.B)(t.qualification,"Non d\xe9finie");return(0,U.jsxs)("li",{style:{background:"#f5f5f5",borderRadius:"8px",padding:"8px 12px",marginBottom:"8px",color:"#333",display:"flex",alignItems:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.04)",transition:"background 0.2s",cursor:"pointer"},onMouseOver:e=>e.currentTarget.style.background="#e3f2fd",onMouseOut:e=>e.currentTarget.style.background="#f5f5f5",children:[(0,U.jsx)("span",{style:{marginRight:"10px",color:"#1976d2"},children:"\ud83d\udc64"}),(0,U.jsx)("span",{style:{fontWeight:500},children:n}),(0,U.jsxs)("span",{style:{marginLeft:"8px",fontStyle:"italic",color:"#4b5563"},children:["(",r,")"]})]},a)})})})})})})]},e.id||e._id)})})})})})})})]},e.id||e._id)}):null,Array.isArray(r)&&0===r.filter(e=>e.nom.toLowerCase().includes(ae.toLowerCase())).length&&(0,U.jsx)(fe.A,{children:(0,U.jsx)(be.A,{colSpan:3,align:"center",children:0===r.length?b.A.t("dashboard.networks.noNetworks"):b.A.t("dashboard.networks.noSearchResults")})})]})]})}),(0,U.jsxs)(ye.A,{open:P,onClose:()=>G(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{width:"100%",maxWidth:"450px",margin:"20px"}},children:[(0,U.jsx)(we.A,{children:Q?b.A.t("dashboard.networks.dialog.editTitle"):b.A.t("dashboard.networks.dialog.createTitle")}),ce&&(0,U.jsx)(s.A,{sx:{px:3,pb:2},children:(0,U.jsx)(ee.A,{severity:"error",onClose:()=>ue(""),children:ce})}),(0,U.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),Z.nom&&Z.responsable1)try{const e=(0,f.A)((0,f.A)({nom:Z.nom,responsable1:Z.responsable1},Z.responsable2&&{responsable2:Z.responsable2}),{},{church:t.id});Q?(await x(Q,e),C("R\xe9seau modifi\xe9 avec succ\xe8s")):(await p(e),C("R\xe9seau cr\xe9\xe9 avec succ\xe8s")),G(!1),Y({nom:"",responsable1:"",responsable2:null}),te(null),ue(""),setTimeout(()=>{g()},100)}catch(r){var a,n;const e=(null===(a=r.response)||void 0===a||null===(n=a.data)||void 0===n?void 0:n.message)||r.message||"Erreur lors de l'op\xe9ration";ue(e),S(e)}else ue("Le nom et le responsable principal sont requis")},children:[(0,U.jsx)(Ce.A,{sx:{display:"flex",justifyContent:"center"},children:(0,U.jsx)(s.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:(0,U.jsxs)(y.A,{container:!0,spacing:2,sx:{display:"flex"},children:[(0,U.jsx)(y.A,{item:!0,xs:12,sx:{display:"flex",justifyContent:"center"},children:(0,U.jsx)($.A,{sx:{width:400},label:b.A.t("dashboard.networks.form.networkName"),value:Z.nom,onChange:e=>Y((0,f.A)((0,f.A)({},Z),{},{nom:e.target.value})),margin:"normal",required:!0})}),(0,U.jsx)(y.A,{item:!0,xs:12,sx:{display:"flex",justifyContent:"center"},children:(0,U.jsxs)(c.A,{sx:{width:400},margin:"normal",children:[(0,U.jsx)(J.A,{id:"responsable1-label",children:b.A.t("networks.details.responsable1")}),(0,U.jsxs)(u.A,{labelId:"responsable1-label",value:Z.responsable1,label:b.A.t("networks.details.responsable1"),onChange:e=>Y((0,f.A)((0,f.A)({},Z),{},{responsable1:e.target.value})),required:!0,children:[(0,U.jsx)(h.A,{value:"",children:(0,U.jsx)("em",{children:"Aucun"})}),re.map(e=>(0,U.jsx)(h.A,{value:e.id||e._id,children:e.username||e.pseudo||e.email},e.id||e._id))]}),(0,U.jsx)(o.A,{variant:"caption",color:"text.secondary",sx:{mt:1,textAlign:"center"},children:b.A.t("networks.details.responsable1Helper")})]})}),(0,U.jsx)(y.A,{item:!0,xs:12,sx:{display:"flex",justifyContent:"center"},children:(0,U.jsxs)(c.A,{sx:{width:400},margin:"normal",children:[(0,U.jsx)(J.A,{id:"responsable2-label",sx:{color:"#757575"},children:b.A.t("networks.details.responsable2")}),(0,U.jsxs)(u.A,{labelId:"responsable2-label",value:Z.responsable2||"",label:b.A.t("networks.details.responsable2"),onChange:e=>Y((0,f.A)((0,f.A)({},Z),{},{responsable2:e.target.value})),disabled:!0,sx:{backgroundColor:"#e0e0e0","& .MuiOutlinedInput-notchedOutline":{borderColor:"#bdbdbd"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#bdbdbd"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#bdbdbd"},"& .MuiSelect-icon":{color:"#9e9e9e"}},children:[(0,U.jsx)(h.A,{value:"",children:(0,U.jsx)("em",{children:"Aucun"})}),re.map(e=>(0,U.jsx)(h.A,{value:e.id||e._id,children:e.username||e.pseudo||e.email},e.id||e._id))]}),(0,U.jsx)(o.A,{variant:"caption",color:"text.secondary",sx:{mt:1,textAlign:"center"},children:b.A.t("networks.details.responsable2Helper")})]})})]})})}),(0,U.jsxs)(Se.A,{children:[(0,U.jsx)(pe.A,{onClick:()=>G(!1),children:b.A.t("dashboard.members.roleDialog.cancel")}),(0,U.jsx)(pe.A,{type:"submit",variant:"contained",color:"primary",disabled:!k,children:Q?b.A.t("dashboard.networks.dialog.editTitle"):b.A.t("dashboard.networks.dialog.createTitle")})]})]})]}),(0,U.jsx)(We.A,{open:H,title:b.A.t("dashboard.networks.deleteDialog.title"),content:V?b.A.t("dashboard.networks.deleteDialog.content",{networkName:V.nom}):b.A.t("dashboard.networks.deleteDialog.contentGeneric"),onClose:Pe,onConfirm:async()=>{if(V)try{await A(V.id||V._id),C("R\xe9seau supprim\xe9 avec succ\xe8s"),setTimeout(()=>{g()},100)}catch(a){var e,t;S((null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||"Erreur lors de la suppression")}finally{Pe()}}}),(0,U.jsx)(_e.A,{open:j.open,autoHideDuration:4e3,onClose:_,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,U.jsx)(ee.A,{onClose:_,severity:j.severity,sx:{width:"100%"},children:j.message})})]})},qe=e=>{let{selectedChurch:t,user:a,refreshKey:r}=e;const[i,l]=(0,n.useState)([]),[d,c]=(0,n.useState)(!0),[u,h]=(0,n.useState)(null),m=(0,n.useCallback)(async()=>{c(!0),h(null);try{var e;const a=t?{churchId:t.id}:{},n=await q.apiService.stats.getNetworks(a),r=(null===(e=n.data)||void 0===e?void 0:e.data)||n.data||[];Array.isArray(r)?l(r):l([])}catch(a){const e=(0,v.hS)(a,"networksrecap - erreur:");h(e.message),l([])}finally{c(!1)}},[t]);return(0,n.useEffect)(()=>{t&&m()},[t,m]),t?(0,U.jsxs)(s.A,{sx:{width:"100%",overflow:"hidden",overflowX:"auto"},children:[(0,U.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[(0,U.jsx)(o.A,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:b.A.t("dashboard.networks.recap.title")}),(0,U.jsx)(pe.A,{variant:"outlined",startIcon:(0,U.jsx)(O.A,{}),onClick:m,disabled:d,children:d?b.A.t("common.actions.loading"):b.A.t("dashboard.networks.recap.refresh")})]}),d?(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",my:3},children:(0,U.jsx)(j.A,{})}):u?(0,U.jsx)(o.A,{color:"error",children:u}):0===i.length?(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",my:4},children:(0,U.jsx)(o.A,{variant:"h6",color:"text.secondary",children:b.A.t("dashboard.networks.noNetworks")})}):(0,U.jsx)(xe.A,{"data-aos":"fade-up",component:w.A,sx:{mt:2,boxShadow:3,borderRadius:2},children:(0,U.jsxs)(Ae.A,{sx:{minWidth:650},stickyHeader:!0,children:[(0,U.jsx)(ge.A,{children:(0,U.jsxs)(fe.A,{sx:{backgroundColor:"#f5f5f5"},children:[(0,U.jsx)(be.A,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:b.A.t("dashboard.networks.recap.table.networkName")}),(0,U.jsx)(be.A,{align:"right",sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:b.A.t("dashboard.networks.recap.table.totalMembers")}),(0,U.jsx)(be.A,{align:"right",sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:b.A.t("dashboard.networks.recap.table.nb12")}),(0,U.jsx)(be.A,{align:"right",sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:b.A.t("dashboard.networks.recap.table.nb144")}),(0,U.jsx)(be.A,{align:"right",sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:b.A.t("dashboard.networks.recap.table.groupCount")}),(0,U.jsx)(be.A,{align:"right",sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:b.A.t("dashboard.networks.recap.table.groupResponsablesCount")})]})}),(0,U.jsxs)(ve.A,{children:[i.map((e,t)=>{var a,n;return(0,U.jsxs)(fe.A,{sx:{backgroundColor:t%2===0?"#fafafa":"#fff","&:hover":{backgroundColor:"#e3f2fd"},borderBottom:"1px solid #e0e0e0"},children:[(0,U.jsx)(be.A,{sx:{py:1,px:2},children:e.nom}),(0,U.jsx)(be.A,{align:"right",sx:{py:1,px:2},children:e.memberCount||0}),(0,U.jsx)(be.A,{align:"right",sx:{py:1,px:2},children:(null===(a=e.qualifications)||void 0===a?void 0:a.filter(e=>"12"===(0,ze.l)(e)).length)||0}),(0,U.jsx)(be.A,{align:"right",sx:{py:1,px:2},children:(null===(n=e.qualifications)||void 0===n?void 0:n.filter(e=>"144"===(0,ze.l)(e)).length)||0}),(0,U.jsx)(be.A,{align:"right",sx:{py:1,px:2},children:e.groupCount||0}),(0,U.jsx)(be.A,{align:"right",sx:{py:1,px:2},children:e.groupResponsablesCount||0})]},e.id||e.nom)}),i.length>0&&(()=>{const e=i.reduce((e,t)=>{var a,n;return e.memberCount+=t.memberCount||0,e.nb12+=(null===(a=t.qualifications)||void 0===a?void 0:a.filter(e=>"12"===(0,ze.l)(e)).length)||0,e.nb144+=(null===(n=t.qualifications)||void 0===n?void 0:n.filter(e=>"144"===(0,ze.l)(e)).length)||0,e.groupCount+=t.groupCount||0,e.groupResponsablesCount+=t.groupResponsablesCount||0,e},{memberCount:0,nb12:0,nb144:0,groupCount:0,groupResponsablesCount:0});return(0,U.jsxs)(fe.A,{sx:{backgroundColor:"#e3f2fd",fontWeight:"bold"},children:[(0,U.jsx)(be.A,{sx:{py:1,px:2,fontWeight:"bold"},children:b.A.t("dashboard.networks.recap.table.totals")}),(0,U.jsx)(be.A,{align:"right",sx:{py:1,px:2,fontWeight:"bold"},children:e.memberCount}),(0,U.jsx)(be.A,{align:"right",sx:{py:1,px:2,fontWeight:"bold"},children:e.nb12}),(0,U.jsx)(be.A,{align:"right",sx:{py:1,px:2,fontWeight:"bold"},children:e.nb144}),(0,U.jsx)(be.A,{align:"right",sx:{py:1,px:2,fontWeight:"bold"},children:e.groupCount}),(0,U.jsx)(be.A,{align:"right",sx:{py:1,px:2,fontWeight:"bold"},children:e.groupResponsablesCount})]})})()]})]})})]}):(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",my:4},children:(0,U.jsx)(o.A,{variant:"h6",color:"text.secondary",children:b.A.t("dashboard.networks.selectChurchMessage")})})};var Ue=a(72170),Ge=a(22094);const He=()=>{const[e,t]=(0,n.useState)(!1),[a,r]=(0,n.useState)([]),[i,l]=(0,n.useState)(!1),[c,u]=(0,n.useState)(null),[h,m]=(0,n.useState)(null),[p,x]=(0,n.useState)(!1),[A,g]=(0,n.useState)(null);(0,n.useEffect)(()=>{b.A.init()},[]);(0,Ue.m)();const{notification:f,showSuccess:y,showError:C,hideNotification:S}=(0,Te.h)(),{canCreateCarousel:_,canDeleteCarousel:k}=(0,Be.S)(),R=async()=>{l(!0);try{var e;const t=await q.apiService.carousel.getAll();r((null===(e=t.data)||void 0===e?void 0:e.data)||t.data||[]),u(null)}catch(t){u(e.message),r([]);const e=(0,v.hS)(t,"l'op\xe9ration")}finally{l(!1)}};(0,n.useEffect)(()=>{R()},[]);return(0,U.jsx)(Ge.A,{allowedRoles:["SUPER_ADMIN"],children:(0,U.jsxs)(s.A,{children:[(0,U.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[(0,U.jsx)(o.A,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:b.A.t("dashboard.carousel.title")}),(0,U.jsx)(pe.A,{variant:"contained",startIcon:(0,U.jsx)(Ee.A,{}),onClick:()=>t(!0),disabled:!_,children:b.A.t("dashboard.carousel.newImage")})]}),i?(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",my:3},children:(0,U.jsx)(j.A,{})}):c?(0,U.jsx)(Fe.A,{error:c,title:b.A.t("dashboard.carousel.loadingError")}):(0,U.jsx)(xe.A,{"data-aos":"fade-up",component:w.A,children:(0,U.jsxs)(Ae.A,{children:[(0,U.jsx)(ge.A,{children:(0,U.jsxs)(fe.A,{children:[(0,U.jsx)(be.A,{children:b.A.t("dashboard.carousel.table.image")}),(0,U.jsx)(be.A,{children:b.A.t("dashboard.carousel.table.path")}),(0,U.jsx)(be.A,{align:"right",children:b.A.t("dashboard.carousel.table.actions")})]})}),(0,U.jsxs)(ve.A,{children:[Array.isArray(a)&&a.map(e=>(0,U.jsxs)(fe.A,{children:[(0,U.jsx)(be.A,{children:(0,U.jsx)("img",{src:"".concat("http://localhost:5001").concat(e.image_url),alt:"Carousel",style:{height:"50px",width:"auto"}})}),(0,U.jsx)(be.A,{children:e.image_url}),(0,U.jsx)(be.A,{align:"right",children:(0,U.jsx)(d.A,{onClick:()=>(e=>{g(e),x(!0)})(e),color:"error",size:"small",disabled:!k,title:k?"":b.A.t("dashboard.carousel.readOnlyAdmin"),children:(0,U.jsx)(De.A,{})})})]},e.id||e._id)),Array.isArray(a)&&0===a.length&&(0,U.jsx)(fe.A,{children:(0,U.jsx)(be.A,{colSpan:3,align:"center",children:b.A.t("dashboard.carousel.noImages")})})]})]})}),(0,U.jsxs)(ye.A,{open:e,onClose:()=>t(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{width:"100%",maxWidth:"500px",margin:"20px"}},children:[(0,U.jsx)(we.A,{children:b.A.t("dashboard.carousel.dialog.title")}),(0,U.jsxs)("form",{onSubmit:async e=>{if(e&&e.preventDefault(),h)try{const e=new FormData;e.append("image",h),await q.apiService.carousel.upload(e),y(b.A.t("dashboard.carousel.uploadSuccess")),t(!1),m(null),await R()}catch(a){C(a.message||b.A.t("dashboard.carousel.uploadError"))}else C(b.A.t("dashboard.carousel.noFileSelected")||"Veuillez s\xe9lectionner une image")},noValidate:!0,children:[(0,U.jsx)(Ce.A,{sx:{display:"flex",justifyContent:"center"},children:(0,U.jsxs)(s.A,{sx:{width:"100%",maxWidth:"450px"},children:[(0,U.jsxs)(pe.A,{variant:"outlined",component:"label",fullWidth:!0,sx:{mt:2,mb:1},children:[b.A.t("dashboard.carousel.dialog.selectImage"),(0,U.jsx)("input",{type:"file",name:"carouselImage",hidden:!0,accept:"image/*",onChange:e=>{console.log("handleFileSelect appel\xe9",e),console.log("Fichiers s\xe9lectionn\xe9s:",e.target.files);const t=e.target.files[0];t?(console.log("Fichier s\xe9lectionn\xe9:",t.name,t.type,t.size),m(t)):console.log("Aucun fichier s\xe9lectionn\xe9"),e.target.value=""}})]}),h&&(0,U.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:2},children:[(0,U.jsx)(o.A,{variant:"body2",sx:{mb:1},color:"text.secondary",children:h.name}),(0,U.jsx)(s.A,{sx:{border:"1px solid #eee",borderRadius:2,p:1,bgcolor:"#fafafa"},children:(0,U.jsx)("img",{src:URL.createObjectURL(h),alt:"Pr\xe9visualisation",style:{maxHeight:120,maxWidth:200,objectFit:"contain"}})})]})]})}),(0,U.jsxs)(Se.A,{children:[(0,U.jsx)(pe.A,{onClick:()=>t(!1),children:b.A.t("common.actions.cancel")}),(0,U.jsx)(pe.A,{type:"submit",variant:"contained",color:"primary",disabled:!h,children:b.A.t("dashboard.carousel.dialog.create")})]})]})]}),(0,U.jsx)(We.A,{open:p,title:b.A.t("dashboard.carousel.deleteDialog.title"),content:A?b.A.t("dashboard.carousel.deleteDialog.content",{imageUrl:A.image_url}):b.A.t("dashboard.carousel.deleteDialog.contentGeneric"),onClose:()=>{x(!1),g(null)},onConfirm:async()=>{if(A)try{await q.apiService.carousel.delete(A.id||A._id),y(b.A.t("dashboard.carousel.deleteSuccess")),await R()}catch(e){C(e.message||b.A.t("dashboard.carousel.deleteError"))}finally{x(!1),g(null)}}}),(0,U.jsx)(_e.A,{open:f.open,autoHideDuration:4e3,onClose:S,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,U.jsx)(ee.A,{onClose:S,severity:f.severity,sx:{width:"100%"},children:f.message})})]})})};var Ke=a(26529),Ve=a(37515),Xe=a(31191),Ze=a(70360),Ye=a(30342),Qe=a(17996),Je=a(57488);const $e=e=>{if(!e)return"";if(e.startsWith("http"))return e;const t=e.startsWith("/")?e:"/".concat(e),a="".concat("http://localhost:5001").concat(t);return a.includes("?")?"".concat(a,"&cb=").concat(Date.now()):"".concat(a,"?cb=").concat(Date.now())};var et=a(20762);const tt=e=>{var t,a,r;let{selectedChurch:i}=e;const[l,m]=(0,n.useState)([]),[p,x]=(0,n.useState)(null),[A,g]=(0,n.useState)([]),[j,C]=(0,n.useState)([]),[S,_]=(0,n.useState)(!1),[k,R]=(0,n.useState)(null),[I,D]=(0,n.useState)(null),{user:E}=(0,Ye.A)(),W=(0,Be.S)(),{users:N,loading:M,error:L,fetchUsers:F,createUser:O,updateUser:T,deleteUser:B}=(0,Oe.kp)(i?{churchId:i.id}:{}),{notification:z,showSuccess:P,showError:G,hideNotification:H}=(0,Te.h)(),{canCreateUsers:K,canUpdateUsers:V,canDeleteUsers:X,canAssignAdminRole:Y,canAssignManagerRole:Q,canAssignSuperAdminRole:te,canModifyChurchField:ae}=(0,Be.S)(),[ne,re]=(0,n.useState)({open:!1,member:null,roles:[]}),[se,oe]=(0,n.useState)({open:!1,member:null,newPassword:""}),[ie,le]=(0,n.useState)({open:!1,member:null}),[de,ce]=(0,n.useState)(null),[ue,he]=(0,n.useState)([]),[me,je]=(0,n.useState)(!1),[ke,Re]=(0,n.useState)(!1),[Me,Pe]=(0,n.useState)(null),[qe,Ue]=(0,n.useState)({username:"",pseudo:"",role:b.A.t("dashboard.members.form.defaults.role"),genre:b.A.t("dashboard.members.form.defaults.gender"),tranche_age:b.A.t("dashboard.members.form.defaults.ageRange"),profession:b.A.t("dashboard.members.form.defaults.profession"),ville_residence:b.A.t("dashboard.members.form.defaults.city"),origine:b.A.t("dashboard.members.form.defaults.origin"),situation_matrimoniale:b.A.t("dashboard.members.form.defaults.maritalStatus"),niveau_education:b.A.t("dashboard.members.form.defaults.education"),eglise_locale_id:ae?"":W.isManager&&((null===E||void 0===E||null===(t=E.eglise_locale)||void 0===t?void 0:t.id)||(null===E||void 0===E?void 0:E.eglise_locale))||"",sert_departement:b.A.t("dashboard.members.form.no"),departement_id:"",departement_ids:[],qualification:b.A.t("dashboard.members.form.defaults.qualification"),email:"",telephone:"",adresse:"",image:""}),[Ge,He]=(0,n.useState)(null),[tt,at]=(0,n.useState)(null),nt=(0,n.useCallback)(()=>{var e;Ue({username:"",pseudo:"",role:b.A.t("dashboard.members.form.defaults.role"),genre:b.A.t("dashboard.members.form.defaults.gender"),tranche_age:b.A.t("dashboard.members.form.defaults.ageRange"),profession:b.A.t("dashboard.members.form.defaults.profession"),ville_residence:b.A.t("dashboard.members.form.defaults.city"),origine:"",situation_matrimoniale:b.A.t("dashboard.members.form.defaults.maritalStatus"),niveau_education:b.A.t("dashboard.members.form.defaults.education"),eglise_locale_id:ae?"":W.isManager&&((null===E||void 0===E||null===(e=E.eglise_locale)||void 0===e?void 0:e.id)||(null===E||void 0===E?void 0:E.eglise_locale))||"",sert_departement:b.A.t("dashboard.members.form.no"),departement_id:"",departement_ids:[],qualification:b.A.t("dashboard.members.form.defaults.qualification"),email:"",telephone:"",adresse:"",image:""}),He(null),at(null)},[E,ae]),rt=(0,n.useCallback)(async()=>{try{var e;const t=await q.apiService.churches.getAll();g((null===(e=t.data)||void 0===e?void 0:e.data)||t.data||[]),D(null)}catch(t){const e=(0,v.hS)(t,b.A.t("dashboard.members.errors.loadingChurches"));g([]),D(e.message)}},[]),st=(0,n.useCallback)(async()=>{_(!0);try{var e;const t=await q.apiService.departments.getAll();C((null===(e=t.data)||void 0===e?void 0:e.data)||t.data||[]),R(null)}catch(t){const e=(0,v.hS)(t,b.A.t("dashboard.members.errors.loadingDepartments"));R(e.message),C([])}finally{_(!1)}},[]),ot=(0,n.useCallback)(async()=>{try{var e;if(null===i||void 0===i||!i.id)return;const t=await q.apiService.users.getIsoles({churchId:i.id});he((null===(e=t.data)||void 0===e?void 0:e.data)||t.data||[])}catch(t){(0,v.hS)(t,b.A.t("dashboard.members.errors.loadingIsolatedMembers"))}},[null===i||void 0===i?void 0:i.id]),it=(0,n.useCallback)(async()=>{try{var e;const t=await q.apiService.groups.getAll(),a=(null===(e=t.data)||void 0===e?void 0:e.data)||t.data||[];m(a),x(null)}catch(t){const e=(0,v.hS)(t,b.A.t("dashboard.members.errors.loadingGroups"));x(e.message),m([])}},[]);(0,n.useEffect)(()=>{F(),rt(),it(),ot(),st()},[F,rt,it,ot,st,null===i||void 0===i?void 0:i.id]);const[lt,dt]=(0,n.useState)(""),ct=[{label:b.A.t("dashboard.members.filters.all"),value:""},{label:b.A.t("dashboard.members.filters.networkResponsible"),value:"Responsable r\xe9seau"},{label:b.A.t("dashboard.members.filters.groupResponsibles"),value:"Responsables de GR"},{label:b.A.t("dashboard.members.filters.leader"),value:"Leader"},{label:b.A.t("dashboard.members.filters.allLeaders"),value:"Leaders (tous)"},{label:b.A.t("dashboard.members.filters.regular"),value:"R\xe9gulier"},{label:b.A.t("dashboard.members.filters.integration"),value:"En int\xe9gration"},{label:b.A.t("dashboard.members.filters.irregular"),value:"Irr\xe9gulier"},{label:b.A.t("dashboard.members.filters.governance"),value:"Gouvernance"},{label:b.A.t("dashboard.members.filters.ecodim"),value:"Ecodim"},{label:b.A.t("dashboard.members.filters.ecodimResponsible"),value:"Responsable ecodim"},{label:b.A.t("dashboard.members.filters.qualification12"),value:"12"},{label:b.A.t("dashboard.members.filters.qualification144"),value:"144"},{label:b.A.t("dashboard.members.filters.qualification1728"),value:"1728"},{label:b.A.t("dashboard.members.filters.isolatedPeople"),value:"Personnes isol\xe9es"}],[ut,ht]=(0,n.useState)("");if(!i)return(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",my:4},children:(0,U.jsx)(o.A,{variant:"h6",color:"text.secondary",children:b.A.t("dashboard.members.selectChurchMessage")})});const mt=()=>{let e;return e=W.isManager?Z._y.filter(e=>!["ADMIN","SUPER_ADMIN","MANAGER"].includes(e.value)):Z._y,(e=>{const t={SUPER_ADMIN:6,ADMIN:5,MANAGER:4,SUPERVISEUR:3,COLLECTEUR_CULTE:2,COLLECTEUR_RESEAUX:2,MEMBRE:1};return e.sort((e,a)=>{const n=t[e.value]||0;return(t[a.value]||0)-n})})(e)},pt=()=>oe({open:!1,member:null,newPassword:""}),xt=e=>{if(!ut)return e;if(ut===b.A.t("dashboard.members.filters.allLeaders")){return e.filter(e=>{const t=e.qualification||"";return"LEADER"===t||"RESPONSABLE_RESEAU"===t||"QUALIFICATION_12"===t||"12"===t||"QUALIFICATION_144"===t||"144"===t||"QUALIFICATION_1728"===t||"1728"===t})}if(ut===b.A.t("dashboard.members.filters.ecodimResponsible")){return e.filter(e=>{const t=e.qualification||"";return t.toLowerCase().includes("ecodim")&&t.toLowerCase().includes("responsable")})}if(ut===b.A.t("dashboard.members.filters.isolatedPeople"))return ue;if(ut===b.A.t("dashboard.members.filters.governance")){return e.filter(e=>"GOUVERNANCE"===(e.qualification||""))}if(ut===b.A.t("dashboard.members.filters.groupResponsibles")){const t=new Set;l.forEach(e=>{if(e.responsable1){const a=e.responsable1.id||e.responsable1._id;a&&t.add(a)}if(e.responsable2){const a=e.responsable2.id||e.responsable2._id;a&&t.add(a)}});return e.filter(e=>t.has(e.id||e._id))}return e.filter(e=>{const t=e.qualification||"",a=ut.toLowerCase();return a===b.A.t("dashboard.members.filters.leader").toLowerCase()&&("LEADER"===t||"Leader"===t)||(a===b.A.t("dashboard.members.filters.networkResponsible").toLowerCase()&&("RESPONSABLE_RESEAU"===t||"Responsable r\xe9seau"===t)||(a===b.A.t("dashboard.members.filters.regular").toLowerCase()&&("REGULIER"===t||"R\xe9gulier"===t)||(a===b.A.t("dashboard.members.filters.integration").toLowerCase()&&("EN_INTEGRATION"===t||"En int\xe9gration"===t)||(a===b.A.t("dashboard.members.filters.irregular").toLowerCase()&&("IRREGULIER"===t||"Irr\xe9gulier"===t)||(a===b.A.t("dashboard.members.filters.governance").toLowerCase()&&"GOUVERNANCE"===t||(!(a!==b.A.t("dashboard.members.filters.ecodim").toLowerCase()||!t.toLowerCase().includes("ecodim"))||(a===b.A.t("dashboard.members.filters.qualification12").toLowerCase()&&"12"===(0,ze.l)(t)||(a===b.A.t("dashboard.members.filters.qualification144").toLowerCase()&&"144"===(0,ze.l)(t)||a===b.A.t("dashboard.members.filters.qualification1728").toLowerCase()&&"1728"===(0,ze.l)(t)))))))))})};return(0,U.jsxs)(s.A,{sx:{width:"100%",overflow:"hidden",overflowX:"auto"},children:[(0,U.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[(0,U.jsx)(o.A,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:b.A.t("dashboard.members.management")}),(0,U.jsxs)(c.A,{sx:{minWidth:250,mx:3},children:[(0,U.jsx)(J.A,{children:b.A.t("dashboard.members.filters.title")}),(0,U.jsx)(u.A,{value:ut,label:b.A.t("dashboard.members.filters.title"),onChange:e=>ht(e.target.value),children:ct.map(e=>(0,U.jsx)(h.A,{value:e.value,children:e.label},e.value))})]}),(0,U.jsx)(pe.A,{variant:"contained",startIcon:(0,U.jsx)(Ee.A,{}),onClick:()=>je(!0),disabled:!K,children:b.A.t("dashboard.members.newMember")})]}),(0,U.jsx)($.A,{"data-aos":"fade-up",fullWidth:!0,variant:"outlined",placeholder:b.A.t("dashboard.members.searchPlaceholder"),value:lt,onChange:e=>dt(e.target.value),InputProps:{startAdornment:(0,U.jsx)(Ne.A,{sx:{mr:1,color:"text.secondary"}})},sx:{mb:3}}),M?(0,U.jsx)(Le.A,{titre:b.A.t("dashboard.members.loading.members")}):L&&"success"!==L?(0,U.jsx)(Fe.A,{error:L,title:b.A.t("dashboard.members.loading.error")}):(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(o.A,{"data-aos":"fade-up",sx:{mb:1,fontWeight:"bold"},children:b.A.t("dashboard.members.foundCount",{count:Array.isArray(N)?xt(N).filter(e=>{var t,a;return(null===(t=e.username)||void 0===t?void 0:t.toLowerCase().includes(lt.toLowerCase()))||(null===(a=e.email)||void 0===a?void 0:a.toLowerCase().includes(lt.toLowerCase()))}).length:0})}),(0,U.jsx)(xe.A,{"data-aos":"fade-up",component:w.A,children:(0,U.jsxs)(Ae.A,{children:[(0,U.jsx)(ge.A,{children:(0,U.jsxs)(fe.A,{children:[(0,U.jsx)(be.A,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:b.A.t("dashboard.members.table.name")}),(0,U.jsx)(be.A,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:b.A.t("dashboard.members.table.email")}),(0,U.jsx)(be.A,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:b.A.t("dashboard.members.table.phone")}),(0,U.jsx)(be.A,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:b.A.t("dashboard.members.table.qualification")}),(0,U.jsx)(be.A,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:b.A.t("dashboard.members.table.role")}),(0,U.jsx)(be.A,{align:"right",sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:b.A.t("dashboard.members.table.actions")})]})}),(0,U.jsx)(ve.A,{children:Array.isArray(N)&&xt(N).filter(e=>{var t,a;return(null===(t=e.username)||void 0===t?void 0:t.toLowerCase().includes(lt.toLowerCase()))||(null===(a=e.email)||void 0===a?void 0:a.toLowerCase().includes(lt.toLowerCase()))}).map(e=>(0,U.jsxs)(fe.A,{children:[(0,U.jsx)(be.A,{children:e.username}),(0,U.jsx)(be.A,{children:e.email}),(0,U.jsx)(be.A,{children:e.telephone||"-"}),(0,U.jsx)(be.A,{children:(0,U.jsx)(o.A,{component:"span",variant:"caption",sx:{fontWeight:"bold",fontSize:"0.75rem"},children:(0,ze.B)(e.qualification,"-")})}),(0,U.jsx)(be.A,{children:(0,Qe.uC)(e.role)}),(0,U.jsxs)(be.A,{align:"right",children:[(0,U.jsx)(Ke.A,{title:b.A.t("dashboard.members.actions.assignRole"),children:(0,U.jsx)(d.A,{size:"small",color:"secondary",onClick:()=>(async e=>{try{const t=(await et.A.getUserRoles(e.id||e._id)).data.assigned_roles||[];re({open:!0,member:e,roles:t})}catch(L){console.error("Erreur lors du chargement des r\xf4les:",L),re({open:!0,member:e,roles:e.role?[e.role]:[]})}})(e),disabled:!V,title:V?"":Q?b.A.t("dashboard.members.permissions.managerFullRights"):b.A.t("dashboard.members.permissions.adminReadOnly"),children:(0,U.jsx)(Xe.A,{})})}),(0,U.jsx)(Ke.A,{title:b.A.t("dashboard.members.actions.resetPassword"),children:(0,U.jsx)(d.A,{size:"small",color:"warning",onClick:()=>(async e=>{try{var t;const a=(null===(t=(await q.apiService.users.resetPassword(e.id||e._id)).data)||void 0===t?void 0:t.tempPassword)||"N/A";oe({open:!0,member:e,newPassword:a}),P(b.A.t("dashboard.members.success.passwordReset"))}catch(a){const e=a.userMessage||a.message||b.A.t("dashboard.members.errors.passwordReset");G(e),oe({open:!1,member:null,newPassword:""})}})(e),disabled:!V,title:V?"":Q?b.A.t("dashboard.members.permissions.managerFullRights"):b.A.t("dashboard.members.permissions.adminReadOnly"),children:(0,U.jsx)(Ve.A,{})})}),(0,U.jsx)(Ke.A,{title:b.A.t("dashboard.members.actions.edit"),children:(0,U.jsx)(d.A,{size:"small",color:"info",onClick:()=>(e=>{Re(!0),Pe(e);const t=(e.user_departments||[]).map(e=>{var t,a;return(null===(t=e.department)||void 0===t?void 0:t.id)||(null===(a=e.department)||void 0===a?void 0:a._id)||e.department_id}).filter(Boolean);var a,n,r,s,o,i,l;W.isManager?Ue((0,f.A)((0,f.A)({},e),{},{eglise_locale_id:(null===E||void 0===E||null===(a=E.eglise_locale)||void 0===a?void 0:a.id)||(null===E||void 0===E?void 0:E.eglise_locale)||"",role:b.A.t("dashboard.members.form.defaults.role"),departement_id:(null===(n=e.departement)||void 0===n?void 0:n.id)||(null===(r=e.departement)||void 0===r?void 0:r._id)||e.departement||"",departement_ids:t})):Ue((0,f.A)((0,f.A)({},e),{},{eglise_locale_id:(null===(s=e.eglise_locale)||void 0===s?void 0:s.id)||(null===(o=e.eglise_locale)||void 0===o?void 0:o._id)||e.eglise_locale||"",departement_id:(null===(i=e.departement)||void 0===i?void 0:i.id)||(null===(l=e.departement)||void 0===l?void 0:l._id)||e.departement||"",departement_ids:t})),je(!0)})(e),disabled:!V,title:V?"":Q?b.A.t("dashboard.members.permissions.managerFullRights"):b.A.t("dashboard.members.permissions.adminReadOnly"),children:(0,U.jsx)(Ie.A,{})})}),(0,U.jsx)(Ke.A,{title:b.A.t("dashboard.members.actions.delete"),children:(0,U.jsx)(d.A,{size:"small",color:"error",onClick:()=>(e=>{le({open:!0,member:e})})(e),disabled:!X,title:X?"":Q?b.A.t("dashboard.members.permissions.managerFullRights"):b.A.t("dashboard.members.permissions.adminReadOnly"),children:(0,U.jsx)(De.A,{})})})]})]},e.id||e._id))})]})})]}),(0,U.jsxs)(ye.A,{open:ne.open,onClose:()=>re({open:!1,member:null,roles:[]}),maxWidth:"sm",fullWidth:!0,children:[(0,U.jsxs)(we.A,{children:[b.A.t("dashboard.members.roleDialog.title")," - ",null===(a=ne.member)||void 0===a?void 0:a.username]}),(0,U.jsxs)(Ce.A,{children:[(0,U.jsxs)(c.A,{fullWidth:!0,sx:{mt:2},children:[(0,U.jsx)(J.A,{id:"role-select-label",children:"S\xe9lectionner les r\xf4les"}),(0,U.jsx)(u.A,{labelId:"role-select-label",multiple:!0,value:ne.roles,label:"S\xe9lectionner les r\xf4les",onChange:e=>{const t=e.target.value;re(e=>(0,f.A)((0,f.A)({},e),{},{roles:"string"===typeof t?t.split(","):t}))},renderValue:e=>(0,U.jsx)(s.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(e=>{var t;return(0,U.jsx)(s.A,{sx:{backgroundColor:"primary.main",color:"white",padding:"2px 8px",borderRadius:"12px",fontSize:"0.75rem"},children:(null===(t=mt().find(t=>t.value===e))||void 0===t?void 0:t.label)||e},e)})}),children:mt().map(e=>(0,U.jsx)(h.A,{value:e.value,children:e.label},e.value))})]}),(0,U.jsx)(o.A,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"Vous pouvez s\xe9lectionner plusieurs r\xf4les. Le r\xf4le le plus \xe9lev\xe9 sera d\xe9fini comme r\xf4le principal."})]}),(0,U.jsxs)(Se.A,{children:[(0,U.jsx)(pe.A,{onClick:()=>re({open:!1,member:null,roles:[]}),children:"Annuler"}),(0,U.jsx)(pe.A,{onClick:async()=>{try{const e=["ADMIN","SUPER_ADMIN","MANAGER"],t=ne.roles.some(t=>e.includes(t));if(W.isManager&&t)return void G(b.A.t("dashboard.members.errors.cannotAssignRole"));await et.A.assignMultipleRoles(ne.member.id||ne.member._id,ne.roles),P(b.A.t("dashboard.members.success.roleUpdated")),re({open:!1,member:null,roles:[]}),await F()}catch(a){var e,t;const n=(null===(e=a.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||a.message||b.A.t("dashboard.members.errors.roleAssignment");G(n)}},variant:"contained",children:"Assigner les r\xf4les"})]})]}),(0,U.jsxs)(ye.A,{open:se.open,onClose:pt,children:[(0,U.jsxs)(we.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,U.jsx)(Ve.A,{color:"primary",sx:{mr:1}}),b.A.t("dashboard.members.resetPasswordDialog.title")]}),(0,U.jsxs)(Ce.A,{sx:{minWidth:340},children:[(0,U.jsx)(o.A,{sx:{mb:1},children:b.A.t("dashboard.members.resetPasswordDialog.newPasswordFor",{username:null===(r=se.member)||void 0===r?void 0:r.username})}),(0,U.jsxs)(s.A,{sx:{mt:2,p:2,bgcolor:"background.paper",borderRadius:2,boxShadow:2,display:"flex",alignItems:"center",justifyContent:"space-between",gap:2,border:"1px solid #e0e0e0"},children:[(0,U.jsx)(o.A,{variant:"h6",sx:{wordBreak:"break-all",letterSpacing:1,fontWeight:700,color:"primary.main",flex:1},children:se.newPassword}),(0,U.jsx)(Ke.A,{title:b.A.t("dashboard.members.resetPasswordDialog.copyPassword"),children:(0,U.jsx)(d.A,{color:"primary",onClick:()=>{navigator.clipboard.writeText(se.newPassword)},sx:{ml:1},children:(0,U.jsx)(Ve.A,{})})})]}),(0,U.jsx)(o.A,{variant:"caption",color:"text.secondary",sx:{mt:2,display:"block"},children:b.A.t("dashboard.members.resetPasswordDialog.passwordInfo")})]}),(0,U.jsx)(Se.A,{children:(0,U.jsx)(pe.A,{onClick:pt,variant:"contained",color:"primary",sx:{fontWeight:600},children:b.A.t("dashboard.members.resetPasswordDialog.close")})})]}),(0,U.jsxs)(ye.A,{open:me,onClose:()=>{var e;(je(!1),Re(!1),Pe(null),Q)?Ue({username:"",pseudo:"",role:"MEMBRE",genre:"",tranche_age:"",profession:"",ville_residence:"",origine:"",situation_matrimoniale:"",niveau_education:"",eglise_locale_id:(null===E||void 0===E||null===(e=E.eglise_locale)||void 0===e?void 0:e.id)||(null===E||void 0===E?void 0:E.eglise_locale)||"",sert_departement:"Non",departement_id:"",departement_ids:[],qualification:"EN_INTEGRATION",email:"",telephone:"",adresse:"",image:""}):Ue({username:"",pseudo:"",role:"MEMBRE",genre:"",tranche_age:"",profession:"",ville_residence:"",origine:"",situation_matrimoniale:"",niveau_education:"",eglise_locale_id:"",sert_departement:"Non",departement_id:"",departement_ids:[],qualification:"EN_INTEGRATION",email:"",telephone:"",adresse:"",image:""});He(null),at(null)},maxWidth:"md",fullWidth:!0,PaperProps:{sx:{width:"100%",maxWidth:"800px",margin:"20px"}},children:[(0,U.jsx)(we.A,{children:ke?b.A.t("dashboard.members.dialog.editTitle"):b.A.t("dashboard.members.dialog.createTitle")}),(0,U.jsxs)("form",{onSubmit:async e=>{e.preventDefault();const t=["username","pseudo","genre","tranche_age","profession","ville_residence","origine","situation_matrimoniale","niveau_education"].filter(e=>!qe[e]||""===qe[e].trim());if(t.length>0)return void G(b.A.t("dashboard.members.errors.requiredFields",{fields:t.join(", ")}));let a=qe.image||"";if(Ge)try{var n,r,s;const e=new FormData;e.append("image",Ge);const t=await q.apiService.users.uploadProfileImage(e);if(a=(null===(n=t.data)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.image)||(null===(s=t.data)||void 0===s?void 0:s.image),!a)throw new Error("URL de l'image non re\xe7ue")}catch(L){return void Je.oR.error("Erreur lors de l'upload de l'image")}const o={username:qe.username,pseudo:qe.pseudo,role:qe.role,genre:qe.genre,tranche_age:qe.tranche_age,profession:qe.profession,ville_residence:qe.ville_residence,origine:qe.origine,situation_matrimoniale:qe.situation_matrimoniale,niveau_education:qe.niveau_education,qualification:qe.qualification,email:qe.email,telephone:qe.telephone,adresse:qe.adresse,image:a,eglise_locale_id:""===qe.eglise_locale_id?null:qe.eglise_locale_id,departement_id:""===qe.departement_id?null:qe.departement_id,departement_ids:qe.departement_ids||[]};var i;W.isManager&&(o.eglise_locale_id=(null===E||void 0===E||null===(i=E.eglise_locale)||void 0===i?void 0:i.id)||(null===E||void 0===E?void 0:E.eglise_locale),o.role=b.A.t("dashboard.members.form.defaults.role"));try{if(ke&&Me){const e=Me.id||Me._id;await T(e,o),P(b.A.t("dashboard.members.success.updated"))}else await O(o),P(b.A.t("dashboard.members.success.created"));je(!1),Re(!1),Pe(null),nt(),await F()}catch(l){const e=l.userMessage||l.message||b.A.t("dashboard.members.errors.save");G(e)}},children:[(0,U.jsx)(Ce.A,{sx:{display:"flex",justifyContent:"center"},children:(0,U.jsx)(s.A,{sx:{display:"flex",flexDirection:"column",gap:2,alignItems:"center",width:"100%",maxWidth:"750px"},children:(0,U.jsxs)(y.A,{container:!0,spacing:2,sx:{margin:0,alignItems:"center"},children:[(0,U.jsx)(y.A,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:(0,U.jsx)($.A,{sx:{width:350},label:b.A.t("dashboard.members.form.username"),value:qe.username,onChange:e=>Ue((0,f.A)((0,f.A)({},qe),{},{username:e.target.value})),margin:"normal",required:!0})}),(0,U.jsx)(y.A,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:(0,U.jsx)($.A,{sx:{width:350},label:b.A.t("dashboard.members.form.pseudo"),value:qe.pseudo,onChange:e=>Ue((0,f.A)((0,f.A)({},qe),{},{pseudo:e.target.value})),margin:"normal",required:!0})}),(0,U.jsx)(y.A,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:(0,U.jsxs)(c.A,{sx:{width:350},margin:"normal",required:!0,children:[(0,U.jsx)(J.A,{children:b.A.t("dashboard.members.form.genre")}),(0,U.jsx)(u.A,{sx:{minWidth:350},value:qe.genre,onChange:e=>Ue((0,f.A)((0,f.A)({},qe),{},{genre:e.target.value})),children:Z.xG.map(e=>(0,U.jsx)(h.A,{value:e.value,children:e.label},e.value))})]})}),(0,U.jsx)(y.A,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:(0,U.jsxs)(c.A,{sx:{width:350},margin:"normal",required:!0,children:[(0,U.jsx)(J.A,{children:b.A.t("dashboard.members.form.ageRange")}),(0,U.jsx)(u.A,{sx:{minWidth:350},value:qe.tranche_age,onChange:e=>Ue((0,f.A)((0,f.A)({},qe),{},{tranche_age:e.target.value})),children:Z.T.map(e=>(0,U.jsx)(h.A,{value:e.value,children:e.label},e.value))})]})}),(0,U.jsx)(y.A,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:(0,U.jsx)($.A,{sx:{width:350},label:b.A.t("dashboard.members.form.profession"),value:qe.profession,onChange:e=>Ue((0,f.A)((0,f.A)({},qe),{},{profession:e.target.value})),margin:"normal",required:!0})}),(0,U.jsx)(y.A,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:(0,U.jsx)($.A,{sx:{width:350},label:b.A.t("dashboard.members.form.residenceCity"),value:qe.ville_residence,onChange:e=>Ue((0,f.A)((0,f.A)({},qe),{},{ville_residence:e.target.value})),margin:"normal",required:!0})}),(0,U.jsx)(y.A,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:(0,U.jsxs)(c.A,{sx:{width:350},margin:"normal",required:!0,children:[(0,U.jsx)(J.A,{children:b.A.t("dashboard.members.form.origin")}),(0,U.jsx)(u.A,{sx:{minWidth:350},value:qe.origine,onChange:e=>Ue((0,f.A)((0,f.A)({},qe),{},{origine:e.target.value})),children:Ze.F.map(e=>(0,U.jsx)(h.A,{value:e.value,children:e.label},e.value))})]})}),(0,U.jsx)(y.A,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:(0,U.jsxs)(c.A,{sx:{width:350},margin:"normal",required:!0,children:[(0,U.jsx)(J.A,{children:b.A.t("dashboard.members.form.maritalStatus")}),(0,U.jsx)(u.A,{sx:{minWidth:350},value:qe.situation_matrimoniale,onChange:e=>Ue((0,f.A)((0,f.A)({},qe),{},{situation_matrimoniale:e.target.value})),children:Z.LA.map(e=>(0,U.jsx)(h.A,{value:e.value,children:e.label},e.value))})]})}),(0,U.jsx)(y.A,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:(0,U.jsxs)(c.A,{sx:{width:350},margin:"normal",required:!0,children:[(0,U.jsx)(J.A,{children:b.A.t("dashboard.members.form.educationLevel")}),(0,U.jsx)(u.A,{sx:{minWidth:350},value:qe.niveau_education,onChange:e=>Ue((0,f.A)((0,f.A)({},qe),{},{niveau_education:e.target.value})),children:Z.RD.map(e=>(0,U.jsx)(h.A,{value:e.value,children:e.label},e.value))})]})}),ae&&(0,U.jsx)(y.A,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:(0,U.jsxs)(c.A,{sx:{width:350},margin:"normal",required:!0,children:[(0,U.jsx)(J.A,{children:b.A.t("dashboard.members.form.localChurch")}),(0,U.jsx)(u.A,{sx:{minWidth:350},value:qe.eglise_locale_id,onChange:e=>Ue((0,f.A)((0,f.A)({},qe),{},{eglise_locale_id:e.target.value})),children:A.map(e=>(0,U.jsx)(h.A,{value:e.id||e._id,children:e.nom},e.id||e._id))})]})}),!Q&&(0,U.jsx)(y.A,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:(0,U.jsxs)(c.A,{sx:{width:350},margin:"normal",required:!0,children:[(0,U.jsx)(J.A,{children:"R\xf4le"}),(0,U.jsx)(u.A,{sx:{minWidth:350},value:qe.role,onChange:e=>Ue((0,f.A)((0,f.A)({},qe),{},{role:e.target.value})),children:Z._y.map(e=>(0,U.jsx)(h.A,{value:e.value,children:e.label},e.value))})]})}),!ke&&(0,U.jsx)(y.A,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:(0,U.jsxs)(c.A,{sx:{width:350},margin:"normal",required:!0,children:[(0,U.jsx)(J.A,{children:b.A.t("dashboard.members.form.servesDepartment")}),(0,U.jsxs)(u.A,{sx:{minWidth:350},value:qe.sert_departement,onChange:e=>Ue((0,f.A)((0,f.A)({},qe),{},{sert_departement:e.target.value,departement_id:"Non"===e.target.value?"":qe.departement_id})),children:[(0,U.jsx)(h.A,{value:b.A.t("dashboard.members.form.yes"),children:b.A.t("dashboard.members.form.yes")}),(0,U.jsx)(h.A,{value:b.A.t("dashboard.members.form.no"),children:b.A.t("dashboard.members.form.no")})]})]})}),(ke||"Oui"===qe.sert_departement)&&(0,U.jsx)(y.A,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:(0,U.jsxs)(c.A,{sx:{width:350},margin:"normal",children:[(0,U.jsx)(J.A,{children:b.A.t("dashboard.members.form.departments")}),(0,U.jsxs)(u.A,{multiple:!0,sx:{minWidth:350},value:qe.departement_ids||[],onChange:e=>Ue((0,f.A)((0,f.A)({},qe),{},{departement_ids:e.target.value})),renderValue:e=>{if(0===e.length)return b.A.t("dashboard.members.form.noDepartment");if(1===e.length){const t=j.find(t=>(t.id||t._id)===e[0]);return t?t.nom:e[0]}return"".concat(e.length," d\xe9partements s\xe9lectionn\xe9s")},children:[k&&(0,U.jsx)(ee.A,{severity:"error",children:k}),0===j.length&&!k&&(0,U.jsx)(ee.A,{severity:"info",children:b.A.t("dashboard.members.form.noDepartmentsFound")}),Array.isArray(j)&&j.map(e=>(0,U.jsx)(h.A,{value:e.id||e._id,children:e.nom},e.id||e._id))]})]})}),(0,U.jsx)(y.A,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:(0,U.jsxs)(c.A,{sx:{width:350},margin:"normal",required:!0,children:[(0,U.jsx)(J.A,{children:b.A.t("dashboard.members.form.qualification")}),(0,U.jsx)(u.A,{sx:{minWidth:350},value:qe.qualification,onChange:e=>Ue((0,f.A)((0,f.A)({},qe),{},{qualification:e.target.value})),children:Z.Ls.map(e=>(0,U.jsx)(h.A,{value:e.value,children:e.label},e.value))})]})}),(0,U.jsx)(y.A,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:(0,U.jsx)($.A,{sx:{width:350},type:"email",label:b.A.t("dashboard.members.form.email"),value:qe.email,onChange:e=>Ue((0,f.A)((0,f.A)({},qe),{},{email:e.target.value})),margin:"normal",required:!0})}),(0,U.jsx)(y.A,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:(0,U.jsx)($.A,{sx:{width:350},label:b.A.t("dashboard.members.form.phone"),value:qe.telephone,onChange:e=>Ue((0,f.A)((0,f.A)({},qe),{},{telephone:e.target.value})),margin:"normal",required:!0})}),(0,U.jsx)(y.A,{item:!0,xs:12,sx:{display:"flex",justifyContent:"center"},children:(0,U.jsx)($.A,{sx:{width:350},label:b.A.t("dashboard.members.form.address"),value:qe.adresse,onChange:e=>Ue((0,f.A)((0,f.A)({},qe),{},{adresse:e.target.value})),margin:"normal",required:!0,multiline:!0,rows:3})}),(0,U.jsx)(y.A,{item:!0,xs:12,sx:{display:"flex",justifyContent:"center"},children:(0,U.jsxs)(s.A,{sx:{width:350,mt:2},children:[(0,U.jsx)(o.A,{variant:"body2",sx:{mb:1,fontWeight:"bold"},children:b.A.t("dashboard.members.form.profileImage")}),(qe.image||tt)&&(0,U.jsxs)(s.A,{sx:{mb:2,textAlign:"center"},children:[(0,U.jsx)("img",{src:tt||$e(qe.image),alt:"Aper\xe7u",style:{width:100,height:100,objectFit:"cover",borderRadius:"50%",border:"2px solid #e0e0e0"},onError:e=>{}}),(0,U.jsx)(o.A,{variant:"caption",display:"block",sx:{mt:1},children:tt?"Nouvelle image":"Image actuelle"})]}),(0,U.jsx)("input",{accept:"image/*",style:{display:"none"},id:"image-upload",type:"file",onChange:e=>{const t=e.target.files[0];if(t){if(!t.type.startsWith("image/"))return void Je.oR.error("Veuillez s\xe9lectionner un fichier image valide");if(t.size>5242880)return void Je.oR.error("L'image ne doit pas d\xe9passer 5MB");He(t);const e=new FileReader;e.onload=e=>{at(e.target.result)},e.readAsDataURL(t)}e.target.value=""}}),(0,U.jsx)("label",{htmlFor:"image-upload",children:(0,U.jsx)(pe.A,{variant:"outlined",component:"span",startIcon:(0,U.jsx)(Ee.A,{}),fullWidth:!0,sx:{mb:1},children:qe.image?"Changer l'image":"Ajouter une image"})}),qe.image&&(0,U.jsx)(pe.A,{variant:"text",color:"error",onClick:()=>{Ue((0,f.A)((0,f.A)({},qe),{},{image:""})),He(null),at(null)},fullWidth:!0,size:"small",children:"Supprimer l'image"})]})})]})})}),(0,U.jsxs)(Se.A,{children:[(0,U.jsx)(pe.A,{onClick:()=>je(!1),children:b.A.t("dashboard.members.roleDialog.cancel")}),(0,U.jsx)(pe.A,{type:"submit",variant:"contained",color:"primary",children:ke?b.A.t("dashboard.members.dialog.update"):b.A.t("dashboard.members.dialog.create")})]})]})]}),(0,U.jsx)(We.A,{open:ie.open,title:b.A.t("dashboard.members.deleteDialog.title"),content:"".concat(de?b.A.t("dashboard.members.deleteDialog.content",{memberName:de.username}):b.A.t("dashboard.members.deleteDialog.contentGeneric")),onClose:()=>le({open:!1,member:null}),onConfirm:async()=>{try{await B(ie.member.id||ie.member._id),P(b.A.t("dashboard.members.success.memberDeleted")),le({open:!1,member:null}),await F()}catch(e){const t=e.userMessage||e.message||b.A.t("dashboard.members.errors.deletion");G(t)}}}),(0,U.jsx)(_e.A,{open:z.open,autoHideDuration:4e3,onClose:H,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,U.jsx)(ee.A,{onClose:H,severity:z.severity,sx:{width:"100%"},children:z.message})})]})},at=e=>{let{selectedChurch:t}=e;const[a,r]=(0,n.useState)([]),[i,l]=(0,n.useState)(!0),[d,c]=(0,n.useState)(null),u=(0,n.useCallback)(async()=>{l(!0),c(null);try{var e;const a=t?{churchId:t.id}:{},n=await q.apiService.users.getRetired(a);r((null===(e=n.data)||void 0===e?void 0:e.data)||n.data||[])}catch(s){var a,n;c((null===(a=s.response)||void 0===a||null===(n=a.data)||void 0===n?void 0:n.message)||s.message)}finally{l(!1)}},[t]);return(0,n.useEffect)(()=>{t&&u()},[t,u]),t?(0,U.jsxs)(s.A,{children:[(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:(0,U.jsx)(o.A,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:"Membres Retir\xe9s"})}),i?(0,U.jsx)(s.A,{sx:{textAlign:"center",mt:4},children:(0,U.jsx)(j.A,{})}):d?(0,U.jsx)(ee.A,{severity:"error",children:d}):0===a.length?(0,U.jsx)(o.A,{children:"Aucun membre retir\xe9 trouv\xe9."}):(0,U.jsx)(xe.A,{"data-aos":"fade-up",component:w.A,sx:{mt:2,boxShadow:3,borderRadius:2},children:(0,U.jsxs)(Ae.A,{stickyHeader:!0,children:[(0,U.jsx)(ge.A,{children:(0,U.jsxs)(fe.A,{sx:{backgroundColor:"#f5f5f5"},children:[(0,U.jsx)(be.A,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Nom"}),(0,U.jsx)(be.A,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Pseudo"}),(0,U.jsx)(be.A,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Qualification"}),(0,U.jsx)(be.A,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Groupe quitt\xe9"}),(0,U.jsx)(be.A,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"R\xe9seau"}),(0,U.jsx)(be.A,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Date de sortie"})]})}),(0,U.jsx)(ve.A,{children:a.map((e,t)=>{var a,n;return(0,U.jsxs)(fe.A,{sx:{backgroundColor:t%2===0?"#fafafa":"#fff","&:hover":{backgroundColor:"#e3f2fd"}},children:[(0,U.jsx)(be.A,{children:e.user.username}),(0,U.jsx)(be.A,{children:e.user.pseudo}),(0,U.jsx)(be.A,{children:(0,ze.B)(e.user.qualification,"-")}),(0,U.jsx)(be.A,{children:(null===(a=e.group)||void 0===a?void 0:a.nom)||"-"}),(0,U.jsx)(be.A,{children:(null===(n=e.network)||void 0===n?void 0:n.nom)||"-"}),(0,U.jsx)(be.A,{children:e.leftAt?new Date(e.leftAt).toLocaleDateString():"-"})]},e.user._id)})})]})})]}):(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",my:4},children:(0,U.jsx)(o.A,{variant:"h6",color:"text.secondary",children:"Veuillez s\xe9lectionner une \xe9glise pour voir les membres retrait\xe9s"})})};var nt=a(17060);const rt=[{name:"Paris",population:2161e3},{name:"Marseille",population:861635},{name:"Lyon",population:513275},{name:"Toulouse",population:479553},{name:"Nice",population:342522},{name:"Nantes",population:309346},{name:"Strasbourg",population:280966},{name:"Montpellier",population:285121},{name:"Bordeaux",population:254436},{name:"Lille",population:232787},{name:"Rennes",population:217728},{name:"Reims",population:180752},{name:"Saint-\xc9tienne",population:172565},{name:"Toulon",population:171953},{name:"Le Havre",population:170147},{name:"Grenoble",population:158454},{name:"Dijon",population:156854},{name:"Angers",population:154508},{name:"Saint-Denis",population:153810},{name:"Villeurbanne",population:150659},{name:"Le Mans",population:143252},{name:"Aix-en-Provence",population:143097},{name:"Brest",population:139456},{name:"N\xeemes",population:146709},{name:"Limoges",population:132175},{name:"Clermont-Ferrand",population:143886},{name:"Tours",population:136463},{name:"Villejuif",population:131824},{name:"Amiens",population:133625},{name:"Metz",population:118489},{name:"Besan\xe7on",population:117912},{name:"Perpignan",population:119656},{name:"Orl\xe9ans",population:114782},{name:"Mulhouse",population:108942},{name:"Caen",population:105354},{name:"Boulogne-Billancourt",population:119808},{name:"Rouen",population:110169},{name:"Nancy",population:104260},{name:"Argenteuil",population:107221},{name:"Montreuil",population:104139},{name:"Saint-Paul",population:103916},{name:"Roubaix",population:98712},{name:"Tourcoing",population:97442},{name:"Nanterre",population:94525},{name:"Avignon",population:91343},{name:"Cr\xe9teil",population:90195},{name:"Poitiers",population:87698},{name:"Versailles",population:85771},{name:"Pau",population:77200},{name:"Colombes",population:85177},{name:"Vitry-sur-Seine",population:92909},{name:"Aulnay-sous-Bois",population:82514},{name:"Asni\xe8res-sur-Seine",population:86742},{name:"Courbevoie",population:81603},{name:"Cherbourg-en-Cotentin",population:80076},{name:"Rueil-Malmaison",population:78145},{name:"Bourges",population:64668},{name:"Le Cannet",population:41531},{name:"Dunkerque",population:86865},{name:"Saint-Maur-des-Foss\xe9s",population:75214},{name:"Valence",population:63848},{name:"Quimper",population:63532},{name:"Antibes",population:75820},{name:"Troyes",population:61996},{name:"Auxerre",population:34734},{name:"Bourgoin-Jallieu",population:28447},{name:"Cannes",population:73421},{name:"Calais",population:72929},{name:"Saint-Brieuc",population:44472},{name:"Saint-Herblain",population:46352},{name:"Saint-Priest",population:46845},{name:"La Rochelle",population:75736},{name:"Rez\xe9",population:42068},{name:"Saint-Andr\xe9",population:55653},{name:"Montauban",population:60489},{name:"Chambery",population:58753},{name:"Aix-les-Bains",population:30812},{name:"Boulogne-sur-Mer",population:42092},{name:"Ch\xe2teauroux",population:43442},{name:"Chalon-sur-Sa\xf4ne",population:45166},{name:"Albi",population:49532},{name:"M\xe2con",population:34350},{name:"Colmar",population:67714},{name:"Dole",population:23575},{name:"\xc9pinal",population:32006},{name:"Montb\xe9liard",population:25405},{name:"Valenciennes",population:43336},{name:"Thionville",population:40578},{name:"Tarbes",population:43363},{name:"Haguenau",population:35112},{name:"Charleville-M\xe9zi\xe8res",population:46348},{name:"\xc9vreux",population:47533},{name:"Saint-\xc9tienne-du-Rouvray",population:28408},{name:"Drancy",population:71043},{name:"Noisy-le-Grand",population:66888},{name:"Ivry-sur-Seine",population:63486},{name:"\xc9vry-Courcouronnes",population:67591},{name:"Villeneuve-d'Ascq",population:62408},{name:"Sarcelles",population:58546},{name:"Le Blanc-Mesnil",population:55519},{name:"Alfortville",population:44818},{name:"Saint-Ouen",population:53107},{name:"Neuilly-sur-Seine",population:59940},{name:"Clichy",population:62854},{name:"Pantin",population:57001},{name:"Maisons-Alfort",population:54843},{name:"Malakoff",population:30420},{name:"Bagneux",population:40336},{name:"Fontenay-sous-Bois",population:52424},{name:"Issy-les-Moulineaux",population:67198},{name:"Bondy",population:54866},{name:"Bobigny",population:54787},{name:"Les Lilas",population:23001},{name:"Vincennes",population:49568},{name:"Saint-Mand\xe9",population:22563},{name:"Montrouge",population:50260},{name:"Bagnolet",population:35773},{name:"Rosny-sous-Bois",population:46527},{name:"Noisy-le-Sec",population:45674},{name:"Le Pr\xe9-Saint-Gervais",population:17050},{name:"Romainville",population:47028},{name:"L'\xcele-Saint-Denis",population:8047},{name:"Le Raincy",population:14481},{name:"Neuilly-Plaisance",population:20778},{name:"Neuilly-sur-Marne",population:35608},{name:"Gagny",population:39902},{name:"Gournay-sur-Marne",population:6787},{name:"Villemomble",population:29968},{name:"Le Perreux-sur-Marne",population:33902},{name:"Bry-sur-Marne",population:16888},{name:"Champigny-sur-Marne",population:76818},{name:"Saint-Maurice",population:14568},{name:"Joinville-le-Pont",population:19052},{name:"Nogent-sur-Marne",population:31849},{name:"Sevran",population:51249},{name:"Villepinte",population:37725},{name:"Tremblay-en-France",population:35885},{name:"Gonesse",population:25677},{name:"Garges-l\xe8s-Gonesse",population:42528},{name:"Goussainville",population:30991},{name:"Villiers-le-Bel",population:27145},{name:"Bezons",population:28712},{name:"Puteaux",population:44891},{name:"Levallois-Perret",population:64110},{name:"Aubervilliers",population:88625},{name:"La Courneuve",population:43354},{name:"\xc9pinay-sur-Seine",population:54781},{name:"Villetaneuse",population:12312},{name:"Pierrefitte-sur-Seine",population:29561},{name:"Stains",population:38105},{name:"Saint-Gratien",population:20767},{name:"Enghien-les-Bains",population:11325},{name:"Soisy-sous-Montmorency",population:17818},{name:"Ermont",population:28421},{name:"Eaubonne",population:24476},{name:"Saint-Leu-la-For\xeat",population:15450},{name:"Taverny",population:26436},{name:"Bessancourt",population:8084},{name:"Fr\xe9pillon",population:3334},{name:"Butry-sur-Oise",population:2308},{name:"M\xe9ry-sur-Oise",population:9875},{name:"M\xe9riel",population:5200},{name:"Valmondois",population:1234},{name:"L'Isle-Adam",population:11815},{name:"Parmain",population:5600},{name:"Nesles-la-Vall\xe9e",population:1774},{name:"Nointel",population:823},{name:"Champagne-sur-Oise",population:4756},{name:"Persan",population:12500},{name:"Beaumont-sur-Oise",population:9567},{name:"Bernes-sur-Oise",population:2500},{name:"Bruy\xe8res-sur-Oise",population:3500}];var st=a(79722);const ot=()=>{const[e,t]=(0,n.useState)([]),[a,r]=(0,n.useState)(!1),[i,l]=(0,n.useState)(null),[m,p]=(0,n.useState)(!1),[x,A]=(0,n.useState)(null),[g,y]=(0,n.useState)({nom:"",adresse:"",ville:"",latitude:"",longitude:"",population:"",description:"",responsable:"",type:"EGLISE",image:null}),[C,S]=(0,n.useState)(!1),[_,k]=(0,n.useState)(null),[R,I]=(0,n.useState)([]),[D,E]=(0,n.useState)(!1),[W,N]=(0,n.useState)([]),[M,L]=(0,n.useState)(!1),[F,O]=(0,n.useState)(null),[T,B]=(0,n.useState)(""),[z,P]=(0,n.useState)(null);(0,n.useEffect)(()=>{b.A.init()},[]);(0,Ue.m)();const{notification:G,showSuccess:H,showError:K,hideNotification:V}=(0,Te.h)(),{canCreateChurches:X,canUpdateChurches:Z,canDeleteChurches:Y}=(0,Be.S)(),Q=async()=>{r(!0);try{var e;const a=await q.apiService.churches.getAll();t((null===(e=a.data)||void 0===e?void 0:e.data)||a.data||[]),l(null)}catch(a){const e=(0,v.hS)(a,"le chargement des \xe9glises");l(e.message),t([])}finally{r(!1)}};(0,n.useEffect)(()=>{Q(),(async()=>{try{var e;const t=await q.apiService.users.getGovernance(),a=(null===(e=t.data)||void 0===e?void 0:e.data)||t.data||[];I(a)}catch(n){var t,a;let e=b.A.t("dashboard.churches.loadResponsablesError");500===(null===(t=n.response)||void 0===t?void 0:t.status)?e=b.A.t("dashboard.churches.serverError"):403===(null===(a=n.response)||void 0===a?void 0:a.status)?e=b.A.t("dashboard.churches.accessDenied"):n.message&&!n.message.includes("Request failed with status code")&&(e=n.message),I([])}})()},[]);const te=n.useCallback(function(e,t){let a;return function(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];clearTimeout(a),a=setTimeout(()=>{clearTimeout(a),e(...r)},t)}}(async e=>{if(e&&!(e.length<2))try{E(!0);const r=(e=>rt.find(t=>t.name.toLowerCase()===e.toLowerCase()))(e);if(r){y(e=>(0,f.A)((0,f.A)({},e),{},{population:r.population.toString(),ville:r.name}));try{var t;const e=null===(t=(await q.apiService.churches.getCityInfo(r.name)).data)||void 0===t?void 0:t.data;e&&e.latitude&&e.longitude&&y(t=>(0,f.A)((0,f.A)({},t),{},{latitude:e.latitude.toString(),longitude:e.longitude.toString()}))}catch(n){}H(b.A.t("dashboard.churches.cityInfoRetrieved",{cityName:r.name}))}else{var a;const t=null===(a=(await q.apiService.churches.getCityInfo(e)).data)||void 0===a?void 0:a.data;t&&(y(a=>{var n,r,s;return(0,f.A)((0,f.A)({},a),{},{latitude:(null===(n=t.latitude)||void 0===n?void 0:n.toString())||"",longitude:(null===(r=t.longitude)||void 0===r?void 0:r.toString())||"",population:(null===(s=t.population)||void 0===s?void 0:s.toString())||"",ville:t.ville||e})}),H(b.A.t("dashboard.churches.cityInfoRetrieved",{cityName:t.ville})))}}catch(i){}finally{E(!1)}},1e3),[]);const ae=()=>{S(!1),k(null)};return(0,n.useEffect)(()=>{m||(O(null),B(""),P(null))},[m]),(0,U.jsx)(Ge.A,{allowedRoles:["SUPER_ADMIN"],children:(0,U.jsxs)(s.A,{children:[(0,U.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[(0,U.jsx)(o.A,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:b.A.t("dashboard.churches.title")}),(0,U.jsx)(pe.A,{variant:"contained",startIcon:(0,U.jsx)(Ee.A,{}),onClick:()=>p(!0),disabled:!X,children:b.A.t("dashboard.churches.newChurch")})]}),a?(0,U.jsx)(Le.A,{titre:b.A.t("dashboard.churches.loading")}):i?(0,U.jsx)(Fe.A,{error:i,title:b.A.t("dashboard.churches.loadingError")}):(0,U.jsx)(xe.A,{"data-aos":"fade-up",component:w.A,children:(0,U.jsxs)(Ae.A,{children:[(0,U.jsx)(ge.A,{children:(0,U.jsxs)(fe.A,{children:[(0,U.jsx)(be.A,{children:b.A.t("dashboard.churches.table.name")}),(0,U.jsx)(be.A,{children:b.A.t("dashboard.churches.table.city")}),(0,U.jsx)(be.A,{children:b.A.t("dashboard.churches.table.address")}),(0,U.jsx)(be.A,{children:b.A.t("dashboard.churches.table.members")}),(0,U.jsx)(be.A,{children:b.A.t("dashboard.churches.table.responsible")}),(0,U.jsx)(be.A,{align:"right",children:b.A.t("dashboard.churches.table.actions")})]})}),(0,U.jsxs)(ve.A,{children:[Array.isArray(e)?e.map(e=>(0,U.jsxs)(fe.A,{children:[(0,U.jsx)(be.A,{children:e.nom}),(0,U.jsx)(be.A,{children:e.ville||"-"}),(0,U.jsx)(be.A,{children:e.adresse||"-"}),(0,U.jsx)(be.A,{children:e.nombre_membres||0}),(0,U.jsx)(be.A,{children:e.responsable?e.responsable.username||e.responsable.pseudo||e.responsable.email:"-"}),(0,U.jsxs)(be.A,{align:"right",children:[(0,U.jsx)(d.A,{onClick:()=>(e=>{var t,a;y({nom:e.nom,adresse:e.adresse||"",ville:e.ville||"",latitude:e.latitude||"",longitude:e.longitude||"",population:e.population||"",description:e.description||"",responsable:(null===(t=e.responsable)||void 0===t?void 0:t.id)||(null===(a=e.responsable)||void 0===a?void 0:a._id)||"",type:e.type||"EGLISE",image:null}),P(null),A(e.id||e._id),p(!0)})(e),color:"primary",size:"small",disabled:!Z,title:Z?"":b.A.t("dashboard.churches.readOnlyAdmin"),children:(0,U.jsx)(Ie.A,{})}),(0,U.jsx)(d.A,{color:"error",onClick:()=>(e=>{k(e),S(!0)})(e),disabled:!Y,title:Y?"":b.A.t("dashboard.churches.readOnlyAdmin"),children:(0,U.jsx)(De.A,{})})]})]},e.id||e._id)):null,Array.isArray(e)&&0===e.length&&(0,U.jsx)(fe.A,{children:(0,U.jsx)(be.A,{colSpan:2,align:"center",children:b.A.t("dashboard.churches.noChurches")})})]})]})}),(0,U.jsxs)(ye.A,{open:m,onClose:()=>{p(!1),A(null),y({nom:"",adresse:"",ville:"",latitude:"",longitude:"",population:"",description:"",responsable:"",type:"EGLISE",image:null}),P(null)},maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{width:"100%",maxWidth:"500px",margin:"20px"}},children:[(0,U.jsx)(we.A,{children:x?b.A.t("dashboard.churches.dialog.editTitle"):b.A.t("dashboard.churches.dialog.createTitle")}),(0,U.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{const e=new FormData;e.append("nom",g.nom),e.append("adresse",g.adresse),e.append("ville",g.ville),e.append("latitude",g.latitude?parseFloat(g.latitude):""),e.append("longitude",g.longitude?parseFloat(g.longitude):""),e.append("population",g.population?parseInt(g.population):""),e.append("description",g.description),e.append("responsable_id",g.responsable||""),e.append("type",g.type),z&&e.append("image",z),x?(await q.apiService.churches.update(x,e),H(b.A.t("dashboard.churches.updateSuccess"))):(await q.apiService.churches.create(e),H(b.A.t("dashboard.churches.createSuccess"))),p(!1),y({nom:"",adresse:"",ville:"",latitude:"",longitude:"",population:"",description:"",responsable:"",type:"EGLISE",image:null}),P(null),A(null),await Q()}catch(i){var t,a,n,r;let e=b.A.t("dashboard.churches.operationError");if(500===(null===(t=i.response)||void 0===t?void 0:t.status))e=b.A.t("dashboard.churches.serverError");else if(400===(null===(a=i.response)||void 0===a?void 0:a.status)){var s,o;e=(null===(s=i.response)||void 0===s||null===(o=s.data)||void 0===o?void 0:o.message)||b.A.t("dashboard.churches.invalidData")}else 404===(null===(n=i.response)||void 0===n?void 0:n.status)?e=b.A.t("dashboard.churches.notFound"):403===(null===(r=i.response)||void 0===r?void 0:r.status)?e=b.A.t("dashboard.churches.accessDenied"):i.message&&!i.message.includes("Request failed with status code")&&(e=i.message);K(e);(0,v.hS)(i,"erreur d\xe9taill\xe9e:")}},children:[(0,U.jsx)(Ce.A,{sx:{display:"flex",justifyContent:"center"},children:(0,U.jsxs)(s.A,{sx:{width:"100%",maxWidth:"450px"},children:[(0,U.jsx)($.A,{fullWidth:!0,label:b.A.t("dashboard.churches.form.churchName"),value:g.nom,onChange:e=>y((0,f.A)((0,f.A)({},g),{},{nom:e.target.value})),required:!0,margin:"normal"}),(0,U.jsx)(nt.A,{fullWidth:!0,options:rt,getOptionLabel:e=>"string"===typeof e?e:e.name,value:g.ville,onChange:(e,t)=>{const a="string"===typeof t?t:(null===t||void 0===t?void 0:t.name)||"";y((0,f.A)((0,f.A)({},g),{},{ville:a})),a&&te(a)},renderInput:e=>(0,U.jsx)($.A,(0,f.A)((0,f.A)({},e),{},{label:b.A.t("dashboard.churches.form.city"),margin:"normal",InputProps:(0,f.A)((0,f.A)({},e.InputProps),{},{endAdornment:(0,U.jsxs)(U.Fragment,{children:[D&&(0,U.jsx)(j.A,{size:20}),e.InputProps.endAdornment]})}),helperText:D?b.A.t("dashboard.churches.form.retrievingInfo"):b.A.t("dashboard.churches.form.cityHelper")})),renderOption:(e,t)=>(0,U.jsx)(s.A,(0,f.A)((0,f.A)({component:"li"},e),{},{children:(0,U.jsxs)(s.A,{children:[(0,U.jsx)(o.A,{variant:"body1",children:t.name}),(0,U.jsxs)(o.A,{variant:"caption",color:"text.secondary",children:[b.A.t("dashboard.churches.form.population"),": ",t.population.toLocaleString()," ",b.A.t("dashboard.churches.form.inhabitants")]})]})}))}),(0,U.jsx)(nt.A,{fullWidth:!0,options:W,value:F,inputValue:T,getOptionLabel:e=>{if("string"===typeof e)return e;const t=e.address||{};return[t.house_number,t.road,t.postcode,t.city||t.town||t.village||""].filter(Boolean).join(", ")},isOptionEqualToValue:(e,t)=>e.id===t.id,filterOptions:e=>e,onInputChange:(e,t,a)=>{B(t),y((0,f.A)((0,f.A)({},g),{},{adresse:t})),"input"===a&&O(null),t&&t.length>2?(async e=>{if(!e||e.length<3)return[];L(!0);try{const t="https://nominatim.openstreetmap.org/search",a=((await st.A.get(t,{params:{q:e,format:"json",addressdetails:1,limit:5,countrycodes:"fr"}})).data||[]).map(e=>(0,f.A)((0,f.A)({},e),{},{id:e.place_id}));N(a)}catch(i){N([])}finally{L(!1)}})(t):N([])},onChange:async(e,t)=>{if(O(t),!t)return;const a="string"===typeof t?t:t.display_name;if(B(a),y(e=>(0,f.A)((0,f.A)({},e),{},{adresse:a})),"string"!==typeof t){const e=t.address.city||t.address.town||t.address.village||t.address.municipality||t.address.county||"",a=t.lat,s=t.lon;y(t=>(0,f.A)((0,f.A)({},t),{},{ville:e,latitude:a,longitude:s}));try{var n;const t=null===(n=(await q.apiService.churches.getCityInfo(e)).data)||void 0===n?void 0:n.data;t&&t.population&&y(e=>(0,f.A)((0,f.A)({},e),{},{population:t.population.toString()}))}catch(r){}}},loading:M,renderInput:e=>(0,U.jsx)($.A,(0,f.A)((0,f.A)({},e),{},{label:b.A.t("dashboard.churches.form.fullAddress"),margin:"normal",InputProps:(0,f.A)((0,f.A)({},e.InputProps),{},{endAdornment:(0,U.jsxs)(U.Fragment,{children:[M&&(0,U.jsx)(j.A,{size:20}),e.InputProps.endAdornment]})}),helperText:b.A.t("dashboard.churches.form.addressHelper")})),renderOption:(e,t)=>{const a=t.address||{},n=[a.house_number,a.road,a.postcode,a.city||a.town||a.village||""].filter(Boolean);return(0,U.jsx)(s.A,(0,f.A)((0,f.A)({component:"li"},e),{},{children:(0,U.jsx)(o.A,{variant:"body1",children:n.join(", ")})}))}}),(0,U.jsx)(s.A,{sx:{display:"flex",gap:2},children:(0,U.jsx)($.A,{fullWidth:!0,label:b.A.t("dashboard.churches.form.cityPopulation"),type:"number",value:g.population,onChange:e=>y((0,f.A)((0,f.A)({},g),{},{population:e.target.value})),margin:"normal"})}),(0,U.jsx)($.A,{fullWidth:!0,label:b.A.t("dashboard.churches.form.description"),multiline:!0,rows:3,value:g.description,onChange:e=>y((0,f.A)((0,f.A)({},g),{},{description:e.target.value})),margin:"normal"}),(0,U.jsxs)(c.A,{fullWidth:!0,margin:"normal",children:[(0,U.jsx)(J.A,{id:"responsable-label",children:b.A.t("dashboard.churches.form.responsible")}),(0,U.jsxs)(u.A,{labelId:"responsable-label",value:g.responsable,label:b.A.t("dashboard.churches.form.responsible"),onChange:e=>y((0,f.A)((0,f.A)({},g),{},{responsable:e.target.value})),children:[(0,U.jsx)(h.A,{value:"",children:(0,U.jsx)("em",{children:b.A.t("dashboard.churches.form.none")})}),R.length>0?R.map(e=>{var t;return(0,U.jsxs)(h.A,{value:e.id||e._id,children:[e.username||e.pseudo||e.email," - ",(null===(t=e.eglise_locale)||void 0===t?void 0:t.nom)||b.A.t("dashboard.churches.form.noAssignedChurch")]},e.id||e._id)}):(0,U.jsx)(h.A,{disabled:!0,children:b.A.t("dashboard.churches.form.noGovernanceUsers")})]})]}),(0,U.jsxs)(c.A,{fullWidth:!0,margin:"normal",children:[(0,U.jsx)(J.A,{id:"type-label",children:b.A.t("dashboard.churches.form.type")}),(0,U.jsxs)(u.A,{labelId:"type-label",value:g.type,label:b.A.t("dashboard.churches.form.type"),onChange:e=>y((0,f.A)((0,f.A)({},g),{},{type:e.target.value})),required:!0,children:[(0,U.jsx)(h.A,{value:"EGLISE",children:b.A.t("dashboard.churches.form.typeChurch")}),(0,U.jsx)(h.A,{value:"MISSION",children:b.A.t("dashboard.churches.form.typeMission")})]})]}),(0,U.jsxs)(pe.A,{variant:"outlined",component:"label",fullWidth:!0,sx:{mt:1,mb:2},children:[z?z.name:b.A.t("dashboard.churches.form.chooseImage"),(0,U.jsx)("input",{type:"file",accept:"image/*",hidden:!0,onChange:e=>{e.target.files&&e.target.files[0]&&P(e.target.files[0])}})]})]})}),(0,U.jsxs)(Se.A,{children:[(0,U.jsx)(pe.A,{onClick:()=>{p(!1),A(null),y({nom:"",adresse:"",ville:"",latitude:"",longitude:"",population:"",description:"",responsable:"",type:"EGLISE",image:null}),P(null)},children:b.A.t("common.actions.cancel")}),(0,U.jsx)(pe.A,{type:"submit",variant:"contained",color:"primary",children:x?b.A.t("common.actions.update"):b.A.t("common.actions.create")})]})]})]}),(0,U.jsx)(We.A,{open:C,title:b.A.t("dashboard.churches.deleteDialog.title"),content:_?b.A.t("dashboard.churches.deleteDialog.content",{churchName:_.nom}):b.A.t("dashboard.churches.deleteDialog.contentGeneric"),onClose:ae,onConfirm:async()=>{if(_)try{await q.apiService.churches.delete(_.id||_._id),H(b.A.t("dashboard.churches.deleteSuccess")),await Q()}catch(o){var e,t,a,n;let i=b.A.t("dashboard.churches.deleteError");if(500===(null===(e=o.response)||void 0===e?void 0:e.status))i=b.A.t("dashboard.churches.deleteServerError");else if(400===(null===(t=o.response)||void 0===t?void 0:t.status)){var r,s;i=(null===(r=o.response)||void 0===r||null===(s=r.data)||void 0===s?void 0:s.message)||b.A.t("dashboard.churches.deleteConstraintError")}else 404===(null===(a=o.response)||void 0===a?void 0:a.status)?i=b.A.t("dashboard.churches.notFound"):403===(null===(n=o.response)||void 0===n?void 0:n.status)?i=b.A.t("dashboard.churches.accessDenied"):o.message&&!o.message.includes("Request failed with status code")&&(i=o.message);K(i);(0,v.hS)(o,"erreur de suppression d\xe9taill\xe9e:")}finally{ae()}}}),(0,U.jsx)(_e.A,{open:G.open,autoHideDuration:4e3,onClose:V,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,U.jsx)(ee.A,{onClose:V,severity:G.severity,sx:{width:"100%"},children:G.message})})]})})},it=()=>{const[e,t]=(0,n.useState)([]),[a,r]=(0,n.useState)(!1),[i,l]=(0,n.useState)(null),[c,u]=(0,n.useState)(!1),[h,m]=(0,n.useState)(null),[p,x]=(0,n.useState)(!1),[A,g]=(0,n.useState)(null),[y,C]=(0,n.useState)({nom:""}),[S,_]=(0,n.useState)("");(0,n.useEffect)(()=>{b.A.init()},[]);(0,Ue.m)();const{notification:k,showSuccess:R,showError:I,hideNotification:D}=(0,Te.h)(),{canCreateDepartments:E,canUpdateDepartments:W,canDeleteDepartments:N}=(0,Be.S)(),M=async()=>{r(!0);try{var e;const a=await q.apiService.departments.getAll();t((null===(e=a.data)||void 0===e?void 0:e.data)||a.data||[]),l(null)}catch(a){l(e.message),t([]);const e=(0,v.hS)(a,"l'op\xe9ration")}finally{r(!1)}};(0,n.useEffect)(()=>{M()},[]);const L=()=>{u(!1),m(null)};return(0,U.jsx)(Ge.A,{allowedRoles:["SUPER_ADMIN"],children:(0,U.jsxs)(s.A,{children:[(0,U.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[(0,U.jsx)(o.A,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:b.A.t("dashboard.departments.title")}),(0,U.jsx)(pe.A,{variant:"contained",startIcon:(0,U.jsx)(Ee.A,{}),onClick:()=>x(!0),disabled:!E,children:b.A.t("dashboard.departments.newDepartment")})]}),(0,U.jsx)($.A,{fullWidth:!0,variant:"outlined",placeholder:b.A.t("dashboard.departments.searchPlaceholder"),value:S,onChange:e=>_(e.target.value),InputProps:{startAdornment:(0,U.jsx)(Ne.A,{sx:{mr:1,color:"text.secondary"}})},sx:{mb:3}}),a?(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",my:3},children:(0,U.jsx)(j.A,{})}):i?(0,U.jsx)(Fe.A,{error:i,title:b.A.t("dashboard.departments.loadingError")}):(0,U.jsx)(xe.A,{"data-aos":"fade-up",component:w.A,children:(0,U.jsxs)(Ae.A,{children:[(0,U.jsx)(ge.A,{children:(0,U.jsxs)(fe.A,{children:[(0,U.jsx)(be.A,{children:b.A.t("dashboard.departments.table.name")}),(0,U.jsx)(be.A,{align:"right",children:b.A.t("dashboard.departments.table.actions")})]})}),(0,U.jsxs)(ve.A,{children:[Array.isArray(e)?e.filter(e=>{if(!e||!e.nom)return!1;const t=(S||"").toLowerCase();return String(e.nom).toLowerCase().includes(t)}).map(e=>(0,U.jsxs)(fe.A,{children:[(0,U.jsx)(be.A,{children:e.nom}),(0,U.jsxs)(be.A,{align:"right",children:[(0,U.jsx)(d.A,{onClick:()=>(e=>{C({nom:e.nom}),g(e.id||e._id),x(!0)})(e),color:"primary",size:"small",disabled:!W,title:W?"":b.A.t("dashboard.departments.readOnlyAdmin"),children:(0,U.jsx)(Ie.A,{})}),(0,U.jsx)(d.A,{color:"error",onClick:()=>(e=>{m(e),u(!0)})(e),disabled:!N,title:N?"":b.A.t("dashboard.departments.readOnlyAdmin"),children:(0,U.jsx)(De.A,{})})]})]},e.id||e._id)):null,Array.isArray(e)&&0===e.filter(e=>e.nom.toLowerCase().includes(S.toLowerCase())).length&&(0,U.jsx)(fe.A,{children:(0,U.jsx)(be.A,{colSpan:2,align:"center",children:0===e.length?b.A.t("dashboard.departments.noDepartments"):b.A.t("dashboard.departments.noSearchResults")})})]})]})}),(0,U.jsxs)(ye.A,{open:p,onClose:()=>{x(!1),g(null),C({nom:""})},maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{width:"100%",maxWidth:"500px",margin:"20px"}},children:[(0,U.jsx)(we.A,{children:A?b.A.t("dashboard.departments.dialog.editTitle"):b.A.t("dashboard.departments.dialog.createTitle")}),(0,U.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{A?(await q.apiService.departments.update(A,y),R(b.A.t("dashboard.departments.updateSuccess"))):(await q.apiService.departments.create(y),R(b.A.t("dashboard.departments.createSuccess"))),x(!1),C({nom:""}),g(null),await M()}catch(t){I(t.message||b.A.t("dashboard.departments.operationError"))}},children:[(0,U.jsx)(Ce.A,{sx:{display:"flex",justifyContent:"center"},children:(0,U.jsx)(s.A,{sx:{width:"100%",maxWidth:"450px"},children:(0,U.jsx)($.A,{fullWidth:!0,label:b.A.t("dashboard.departments.form.departmentName"),value:y.nom,onChange:e=>C((0,f.A)((0,f.A)({},y),{},{nom:e.target.value})),margin:"normal",required:!0})})}),(0,U.jsxs)(Se.A,{children:[(0,U.jsx)(pe.A,{onClick:()=>{x(!1),g(null),C({nom:""})},children:b.A.t("common.actions.cancel")}),(0,U.jsx)(pe.A,{type:"submit",variant:"contained",color:"primary",children:A?b.A.t("common.actions.update"):b.A.t("common.actions.create")})]})]})]}),(0,U.jsx)(We.A,{open:c,title:b.A.t("dashboard.departments.deleteDialog.title"),content:h?b.A.t("dashboard.departments.deleteDialog.content",{departmentName:h.nom}):b.A.t("dashboard.departments.deleteDialog.contentGeneric"),onClose:L,onConfirm:async()=>{if(h)try{await q.apiService.departments.delete(h.id||h._id),R(b.A.t("dashboard.departments.deleteSuccess")),await M()}catch(e){I(e.message||b.A.t("dashboard.departments.deleteError"))}finally{L()}}})]})})},lt=["#0088FE","#00C49F","#FFBB28","#FF8042","#B455C6","#FF6666","#82ca9d","#8884d8","#ffc658","#a4de6c","#d0ed57"],dt=e=>{let{selectedChurch:t}=e;const{data:r,loading:i,error:l,refresh:c}=P("users-stats-".concat((null===t||void 0===t?void 0:t.id)||"none"),async()=>{var e;if(!t)return[];const{apiService:n}=await Promise.resolve().then(a.bind(a,41894)),r={churchId:t.id},s=await n.users.getAll(r);return((null===(e=s.data)||void 0===e?void 0:e.data)||s.data||[]).filter(e=>{var a;return e.eglise_locale_id===t.id||(null===(a=e.eglise_locale)||void 0===a?void 0:a.id)===t.id})},{ttl:3e5,staleWhileRevalidate:!0});(0,n.useEffect)(()=>{if(t){const e=setTimeout(()=>{c()},100);return()=>clearTimeout(e)}},[t]);const u=(0,n.useMemo)(()=>{if(!r||0===r.length)return[];const e={};r.forEach(t=>{const a=t.qualification||"Non d\xe9finie";let n="Non d\xe9finie";if("Non d\xe9finie"!==a){const e=Z.Ls.find(e=>e.value===a);n=e?e.label:(0,ze.B)(a,a)}e[n]||(e[n]={name:n,value:0}),e[n].value++});return Object.values(e).sort((e,t)=>t.value-e.value)},[r]),h=(0,n.useMemo)(()=>{if(!r||0===r.length)return[];const e={};return r.forEach(t=>{const a=t.genre||"Non d\xe9fini";e[a]||(e[a]={name:a,value:0}),e[a].value++}),Object.values(e).sort((e,t)=>t.value-e.value)},[r]),m=(0,n.useMemo)(()=>{if(!r||0===r.length)return[];const e={};r.forEach(t=>{const a=t.tranche_age||"Non d\xe9finie";e[a]||(e[a]={name:a,value:0}),e[a].value++});const t=["0 - 2 ans","2 ans - 6 ans","7 ans - 12 ans","13 ans - 18 ans","19 ans - 25 ans","26 ans - 35 ans","36 ans - 55 ans","56 ans - 85 ans","85 ans et plus","Non d\xe9finie"];return Object.values(e).sort((e,a)=>{const n=t.indexOf(e.name),r=t.indexOf(a.name);return-1===n?1:-1===r?-1:n-r})},[r]),p=((0,n.useMemo)(()=>{if(!r||0===r.length)return[];const e={};return r.forEach(t=>{const a=t.ville_residence||"Non d\xe9finie";e[a]||(e[a]={name:a,value:0}),e[a].value++}),Object.values(e).sort((e,t)=>t.value-e.value).slice(0,10)},[r]),(0,n.useMemo)(()=>u.map(e=>({qualification:e.name,count:e.value})).sort((e,t)=>t.count-e.count),[u]));return t?(0,U.jsxs)(s.A,{children:[(0,U.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",mb:3,alignItems:"center"},children:[(0,U.jsx)(o.A,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:"Statistiques Membres"}),(0,U.jsx)(d.A,{onClick:c,disabled:i,"aria-label":b.A.t("common.actions.refresh"),children:(0,U.jsx)(O.A,{})})]}),i?(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",my:4},children:(0,U.jsx)(j.A,{})}):l?(0,U.jsx)(o.A,{color:"error",children:l}):(0,U.jsxs)(y.A,{children:[(0,U.jsx)(y.A,{"data-aos":"fade-up",item:!0,xs:12,md:6,sx:{mt:4},children:(0,U.jsxs)(w.A,{sx:{p:3,backgroundColor:"#f9f9f9",overflowX:"auto"},children:[(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:b.A.t("home.qualificationDistribution")}),(0,U.jsx)(C.u,{width:"100%",height:350,children:(0,U.jsxs)(L.E,{data:p,children:[(0,U.jsx)(D.d,{strokeDasharray:"3 3"}),(0,U.jsx)(E.W,{dataKey:"qualification",angle:-30,textAnchor:"end",interval:0,height:80}),(0,U.jsx)(W.h,{allowDecimals:!1}),(0,U.jsx)(R.m,{}),(0,U.jsx)(F.y,{dataKey:"count",fill:"#FFBB28"})]})})]})}),(0,U.jsx)(y.A,{"data-aos":"fade-up",item:!0,xs:12,md:6,sx:{mt:4},children:(0,U.jsxs)(w.A,{sx:{p:3,backgroundColor:"#f9f9f9",overflowX:"auto"},children:[(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:b.A.t("home.genreDistribution")}),(0,U.jsx)(C.u,{width:"100%",height:500,children:(0,U.jsxs)(S.r,{children:[(0,U.jsx)(_.F,{data:h,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:200,label:e=>{let{name:t,value:a}=e;const n=h.reduce((e,t)=>e+t.value,0),r=n?(a/n*100).toFixed(1):0;return"".concat(t,": ").concat(a," (").concat(r,"%)")},children:h.map((e,t)=>(0,U.jsx)(k.f,{fill:lt[t%lt.length]},"cell-".concat(t)))}),(0,U.jsx)(N.s,{}),(0,U.jsx)(R.m,{})]})})]})}),(0,U.jsx)(y.A,{"data-aos":"fade-up",item:!0,xs:12,md:6,sx:{mt:4},children:(0,U.jsxs)(w.A,{sx:{p:3,backgroundColor:"#f9f9f9",overflowX:"auto"},children:[(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:b.A.t("home.ageDistribution")}),(0,U.jsx)(C.u,{width:"100%",height:350,children:(0,U.jsxs)(L.E,{data:m,children:[(0,U.jsx)(D.d,{strokeDasharray:"3 3"}),(0,U.jsx)(E.W,{dataKey:"name"}),(0,U.jsx)(W.h,{allowDecimals:!1}),(0,U.jsx)(R.m,{}),(0,U.jsx)(F.y,{dataKey:"value",fill:"#00C49F"})]})})]})})]})]}):(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",my:4},children:(0,U.jsx)(o.A,{variant:"h6",color:"text.secondary",children:"Veuillez s\xe9lectionner une \xe9glise pour voir les statistiques"})})};var ct=a(94527),ut=a(9896),ht=a(99419),mt=a(12023),pt=a(34867),xt=a(76036),At=a(13318),gt=(a(66433),a(80228)),ft=a.n(gt);const bt={Ain:"Auvergne-Rh\xf4ne-Alpes",Aisne:"Hauts-de-France",Allier:"Auvergne-Rh\xf4ne-Alpes","Alpes-de-Haute-Provence":"Provence-Alpes-C\xf4te d'Azur","Hautes-Alpes":"Provence-Alpes-C\xf4te d'Azur","Alpes-Maritimes":"Provence-Alpes-C\xf4te d'Azur","Ard\xe8che":"Auvergne-Rh\xf4ne-Alpes",Ardennes:"Grand Est","Ari\xe8ge":"Occitanie",Aube:"Grand Est",Aude:"Occitanie",Aveyron:"Occitanie","Bouches-du-Rh\xf4ne":"Provence-Alpes-C\xf4te d'Azur",Calvados:"Normandie",Cantal:"Auvergne-Rh\xf4ne-Alpes",Charente:"Nouvelle-Aquitaine","Charente-Maritime":"Nouvelle-Aquitaine",Cher:"Centre-Val de Loire","Corr\xe8ze":"Nouvelle-Aquitaine","C\xf4te-d'Or":"Bourgogne-Franche-Comt\xe9","C\xf4tes-d'Armor":"Bretagne",Creuse:"Nouvelle-Aquitaine",Dordogne:"Nouvelle-Aquitaine",Doubs:"Bourgogne-Franche-Comt\xe9","Dr\xf4me":"Auvergne-Rh\xf4ne-Alpes",Eure:"Normandie","Eure-et-Loir":"Centre-Val de Loire","Finist\xe8re":"Bretagne","Corse-du-Sud":"Corse","Haute-Corse":"Corse",Gard:"Occitanie","Haute-Garonne":"Occitanie",Gers:"Occitanie",Gironde:"Nouvelle-Aquitaine","H\xe9rault":"Occitanie","Ille-et-Vilaine":"Bretagne",Indre:"Centre-Val de Loire","Indre-et-Loire":"Centre-Val de Loire","Is\xe8re":"Auvergne-Rh\xf4ne-Alpes",Jura:"Bourgogne-Franche-Comt\xe9",Landes:"Nouvelle-Aquitaine","Loir-et-Cher":"Centre-Val de Loire",Loire:"Auvergne-Rh\xf4ne-Alpes","Haute-Loire":"Auvergne-Rh\xf4ne-Alpes","Loire-Atlantique":"Pays de la Loire",Loiret:"Centre-Val de Loire",Lot:"Occitanie","Lot-et-Garonne":"Nouvelle-Aquitaine","Loz\xe8re":"Occitanie","Maine-et-Loire":"Pays de la Loire",Manche:"Normandie",Marne:"Grand Est","Haute-Marne":"Grand Est",Mayenne:"Pays de la Loire","Meurthe-et-Moselle":"Grand Est",Meuse:"Grand Est",Morbihan:"Bretagne",Moselle:"Grand Est","Ni\xe8vre":"Bourgogne-Franche-Comt\xe9",Nord:"Hauts-de-France",Oise:"Hauts-de-France",Orne:"Normandie","Pas-de-Calais":"Hauts-de-France","Puy-de-D\xf4me":"Auvergne-Rh\xf4ne-Alpes","Pyr\xe9n\xe9es-Atlantiques":"Nouvelle-Aquitaine","Hautes-Pyr\xe9n\xe9es":"Occitanie","Pyr\xe9n\xe9es-Orientales":"Occitanie","Bas-Rhin":"Grand Est","Haut-Rhin":"Grand Est","Rh\xf4ne":"Auvergne-Rh\xf4ne-Alpes","Haute-Sa\xf4ne":"Bourgogne-Franche-Comt\xe9","Sa\xf4ne-et-Loire":"Bourgogne-Franche-Comt\xe9",Sarthe:"Pays de la Loire",Savoie:"Auvergne-Rh\xf4ne-Alpes","Haute-Savoie":"Auvergne-Rh\xf4ne-Alpes",Paris:"\xcele-de-France","Seine-Maritime":"Normandie","Seine-et-Marne":"\xcele-de-France",Yvelines:"\xcele-de-France","Deux-S\xe8vres":"Nouvelle-Aquitaine",Somme:"Hauts-de-France",Tarn:"Occitanie","Tarn-et-Garonne":"Occitanie",Var:"Provence-Alpes-C\xf4te d'Azur",Vaucluse:"Provence-Alpes-C\xf4te d'Azur","Vend\xe9e":"Pays de la Loire",Vienne:"Nouvelle-Aquitaine","Haute-Vienne":"Nouvelle-Aquitaine",Vosges:"Grand Est",Yonne:"Bourgogne-Franche-Comt\xe9","Territoire de Belfort":"Bourgogne-Franche-Comt\xe9",Essonne:"\xcele-de-France","Hauts-de-Seine":"\xcele-de-France","Seine-Saint-Denis":"\xcele-de-France","Val-de-Marne":"\xcele-de-France","Val-d'Oise":"\xcele-de-France"};delete ft().Icon.Default.prototype._getIconUrl,ft().Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const vt=new(ft().Icon)({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-violet.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),jt=new(ft().Icon)({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});function yt(){const e=(0,ut.ko)();return(0,n.useEffect)(()=>{e.setView([46.603354,1.888334],6)},[e]),null}function wt(e){switch(e){case"Zone Nord-Ouest":return"#4791db";case"Zone Nord-Est":return"#e57373";case"Zone Sud-Ouest":return"#ffeb3b";case"Zone Sud-Est":return"#66bb6a";case"Zone Centre":return"#9e9e9e";default:return"#e0e0e0"}}function Ct(e,t){let a=parseInt(e.replace("#",""),16);return"#"+(Math.floor((a>>16)*t)<<16|Math.floor((a>>8&255)*t)<<8|Math.floor((255&a)*t)).toString(16).padStart(6,"0")}function St(e){let{setZoom:t}=e;return(0,ut.Po)({zoomend:e=>{t(e.target.getZoom())}}),null}const _t=e=>{let{active:t=!0}=e;const{canCreateChurches:a}=(0,Be.S)(),[r,i]=(0,n.useState)([]),[l,d]=(0,n.useState)(!0),[c,u]=(0,n.useState)(null),h=(0,n.useRef)(null),[p,x]=(0,n.useState)([]),[A,g]=(0,n.useState)(null),[f,b]=(0,n.useState)(null),[j,y]=(0,n.useState)(8),[C,S]=(0,n.useState)(null),[_,k]=(0,n.useState)(null),R=(0,n.useRef)(null),[I,D]=(0,n.useState)(!1),E=[48.5,-1.7],W=async()=>{try{var e;d(!0);const t=await q.apiService.churches.getAll(),a=(null===(e=t.data)||void 0===e?void 0:e.data)||t.data||[];a.forEach(e=>{});const n=a.filter(e=>e.latitude&&e.longitude&&!isNaN(parseFloat(e.latitude))&&!isNaN(parseFloat(e.longitude)));i(n),u(null)}catch(t){const e=(0,v.hS)(t,"erreur lors du chargement des \xe9glises:");u(e.message),i([])}finally{d(!1)}};(0,n.useEffect)(()=>{t&&W()},[t]),(0,n.useEffect)(()=>{fetch("/zones.json").then(e=>e.json()).then(x),fetch("/regions.geojson").then(e=>e.json()).then(g),fetch("/departements.geojson").then(e=>e.json()).then(b)},[]),(0,n.useEffect)(()=>{_&&y(_.getZoom())},[_]),(0,n.useEffect)(()=>{window.dispatchEvent(new Event("resize"))},[]),(0,n.useEffect)(()=>{if(!R.current||!_)return;const e=setTimeout(()=>_.invalidateSize(),100),t=setTimeout(()=>_.invalidateSize(),500),a=new window.ResizeObserver(()=>{_.invalidateSize()});return a.observe(R.current),()=>{a.disconnect(),clearTimeout(e),clearTimeout(t)}},[_]),(0,n.useEffect)(()=>{const e=setTimeout(()=>D(!0),100);return()=>clearTimeout(e)},[]);return l?(0,U.jsx)(Le.A,{titre:"Chargement de la carte..."}):c?(0,U.jsx)(Fe.A,{error:c,title:"Erreur de chargement"}):(0,U.jsxs)(s.A,{children:[(0,U.jsxs)(s.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,U.jsx)(o.A,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:"Mission et Implantation"}),(0,U.jsxs)(s.A,{sx:{display:"flex",gap:2},children:[(0,U.jsx)(pe.A,{variant:"outlined",onClick:()=>{h.current&&h.current.setView([46.603354,1.888334],6)},sx:{minWidth:120},children:"Centrer sur la France"}),(0,U.jsx)(pe.A,{variant:"outlined",onClick:()=>{h.current&&h.current.setView(E,7)},sx:{minWidth:120},children:"Zone Nord-Ouest"}),(0,U.jsx)(pe.A,{variant:"contained",startIcon:(0,U.jsx)(O.A,{}),onClick:W,disabled:l,children:"Actualiser"})]})]}),(0,U.jsxs)(s.A,{ref:R,sx:{height:"600px",width:"100%",minWidth:"300px",minHeight:"300px",mb:3,border:"2px solid #ccc",borderRadius:"8px",overflow:"hidden",position:"relative",boxSizing:"border-box"},children:[I&&(0,U.jsxs)(ht.W,{center:[46.603354,1.888334],zoom:8,minZoom:5,maxZoom:12,style:{height:"600px",width:"100%"},zoomControl:!0,scrollWheelZoom:!0,whenCreated:e=>{h.current=e,k(e)},ref:h,children:[(0,U.jsx)(St,{setZoom:y}),(0,U.jsx)(yt,{}),(0,U.jsx)(mt.e,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),j<=6&&A&&p.length>0&&(0,U.jsx)(pt.k,{data:A,style:e=>{const t=p.find(t=>t.regions.includes(e.properties.nom)),a=t?wt(t.nom):"#EEE";return{fillColor:C===e.properties.nom?Ct(a,.6):a,weight:2,color:"#333",fillOpacity:.5,cursor:"pointer"}},onEachFeature:(e,t)=>{t.on({mouseover:()=>S(e.properties.nom),mouseout:()=>S(null)});const a=p.find(t=>t.regions.includes(e.properties.nom));t.bindTooltip("".concat(e.properties.nom," (").concat(a?a.nom:"",")"),{sticky:!0})}}),A&&(0,U.jsx)(pt.k,{data:A,style:()=>({fillOpacity:0,weight:5,color:"#000",dashArray:"6,4",pointerEvents:"none",zIndex:1200})}),j>=7&&f&&p.length>0&&(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(pt.k,{data:f,style:e=>{const t=bt[e.properties.nom],a=p.find(e=>e.regions.includes(t)),n=a?wt(a.nom):"#EEE";return{fillColor:C===e.properties.nom?Ct(n,.6):n,weight:1,color:"#333",fillOpacity:.5,cursor:"pointer"}},onEachFeature:(e,t)=>{t.on({mouseover:()=>S(e.properties.nom),mouseout:()=>S(null)});const a=bt[e.properties.nom];t.bindTooltip("".concat(e.properties.nom," (").concat(a,")"),{sticky:!0})}}),0===f.features.length&&(0,U.jsx)(o.A,{color:"error",children:"Aucun polygone de d\xe9partement n'est visible (features vides)"})]}),r.length>0&&r.map(e=>{var t;return(0,U.jsx)(xt.p,{position:[parseFloat(e.latitude),parseFloat(e.longitude)],icon:"MISSION"===e.type?jt:vt,children:(0,U.jsx)(At.z,{maxWidth:300,children:(0,U.jsxs)(s.A,{sx:{minWidth:250,maxWidth:300},children:[(0,U.jsx)(s.A,{sx:{width:"100%",mb:1,display:"flex",justifyContent:"center"},children:e.image?(0,U.jsx)("img",{src:$e(e.image),alt:e.nom,style:{maxWidth:"100%",maxHeight:200,borderRadius:8,objectFit:"cover",border:"1px solid #ccc"},onError:e=>{e.target.onerror=null,e.target.style.display="none"}}):(0,U.jsx)(s.A,{sx:{width:"100%",height:150,bgcolor:"grey.200",borderRadius:2,display:"flex",alignItems:"center",justifyContent:"center",border:"1px dashed #ccc"},children:(0,U.jsx)(o.A,{variant:"body2",color:"text.secondary",children:"Aucune image"})})}),(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,sx:{fontWeight:"bold",color:"MISSION"===e.type?"#2e7d32":"primary.main"},children:e.nom}),(0,U.jsxs)(s.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:1},children:[(0,U.jsx)(m.A,{label:"Ville: ".concat(e.ville||"Non sp\xe9cifi\xe9e"),color:(e.type,"primary"),size:"small",sx:{fontSize:"0.72rem",backgroundColor:"MISSION"===e.type?"#2e7d32":void 0,color:"MISSION"===e.type?"white":void 0}}),(0,U.jsx)(m.A,{label:"Population: ".concat((null===(t=e.population)||void 0===t?void 0:t.toLocaleString())||"Non sp\xe9cifi\xe9e"),color:(e.type,"secondary"),size:"small",sx:{fontSize:"0.72rem",backgroundColor:"MISSION"===e.type?"#35BB3B":void 0,color:"MISSION"===e.type?"white":void 0}})]}),(0,U.jsxs)(o.A,{variant:"body2",paragraph:!0,sx:{mb:1},children:[(0,U.jsx)("strong",{children:"Adresse : "}),e.adresse||"Non sp\xe9cifi\xe9e"]}),e.responsable&&(0,U.jsxs)(o.A,{variant:"body2",paragraph:!0,sx:{mb:1},children:[(0,U.jsx)("strong",{children:"Responsable : "}),e.responsable.username]}),(0,U.jsxs)(o.A,{variant:"body2",paragraph:!0,sx:{mb:1},children:[(0,U.jsx)("strong",{children:"Nombre de membres : "}),e.nombre_membres||"Non sp\xe9cifi\xe9"]}),e.description&&(0,U.jsxs)(o.A,{variant:"body2",sx:{mb:1},children:[(0,U.jsx)("strong",{children:"Description : "}),e.description]})]})})},e.id||e._id)})]}),(0,U.jsxs)(s.A,{sx:{position:"absolute",bottom:16,right:16,background:"rgba(255,255,255,0.95)",borderRadius:2,boxShadow:3,p:2,minWidth:180,zIndex:1200},children:[(0,U.jsx)(o.A,{variant:"subtitle2",sx:{fontWeight:"bold",mb:1},children:"L\xe9gende des zones"}),[{nom:"Zone Nord-Ouest",color:wt("Zone Nord-Ouest")},{nom:"Zone Nord-Est",color:wt("Zone Nord-Est")},{nom:"Zone Sud-Ouest",color:wt("Zone Sud-Ouest")},{nom:"Zone Sud-Est",color:wt("Zone Sud-Est")},{nom:"Zone Centre",color:wt("Zone Centre")}].map(e=>(0,U.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",mb:.5},children:[(0,U.jsx)(s.A,{sx:{width:20,height:20,background:e.color,borderRadius:"4px",border:"1px solid #888",mr:1}}),(0,U.jsx)(o.A,{variant:"body2",children:e.nom})]},e.nom)),(0,U.jsx)(ct.A,{sx:{my:1}}),(0,U.jsx)(o.A,{variant:"subtitle2",sx:{fontWeight:"bold",mb:1},children:"Marqueurs"}),(0,U.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",mb:.5},children:[(0,U.jsx)("img",{src:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-violet.png",alt:"\xc9glise",style:{width:20,height:32,marginRight:8}}),(0,U.jsx)(o.A,{variant:"body2",children:"\xc9glise"})]}),(0,U.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",mb:.5},children:[(0,U.jsx)("img",{src:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",alt:"Mission",style:{width:20,height:32,marginRight:8}}),(0,U.jsx)(o.A,{variant:"body2",children:"Mission"})]})]})]}),0===r.length&&!l&&(0,U.jsxs)(w.A,{sx:{p:3,textAlign:"center"},children:[(0,U.jsx)(o.A,{variant:"h6",color:"text.secondary",children:"Aucune \xe9glise avec coordonn\xe9es g\xe9ographiques trouv\xe9e"}),(0,U.jsx)(o.A,{variant:"body2",color:"text.secondary",children:"Ajoutez des coordonn\xe9es (latitude/longitude) aux \xe9glises pour les afficher sur la carte"})]})]})};var kt=a(33699),Rt=a(1725),It=a(38865),Dt=a(56465),Et=a(40847),Wt=a(30838),Nt=a(82058),Mt=a(3665),Lt=a(94045),Ft=a(37305),Ot=a(98914);const Tt=e=>{if(!e)return"";const t=new Date(e);if(isNaN(t.getTime()))return"";return t.toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})},Bt=()=>{var e,t;console.log("Testimonies component rendering...");const{selectedChurch:a}=(0,Ot.w)(),{notification:r,showSuccess:i,showError:l,hideNotification:p}=(0,Te.h)(),[x,A]=(0,n.useState)([]),[g,f]=(0,n.useState)(!1),[b,v]=(0,n.useState)(1),[w,C]=(0,n.useState)(1),[S,_]=(0,n.useState)(""),[k,R]=(0,n.useState)(""),[I,D]=(0,n.useState)(!1),[E,W]=(0,n.useState)(null),[N,M]=(0,n.useState)(!1),[L,F]=(0,n.useState)(!1),[T,B]=(0,n.useState)(null),[z,P]=(0,n.useState)(!1),[G,H]=(0,n.useState)(null),[K,V]=(0,n.useState)(""),X=[{value:"",label:"Toutes les cat\xe9gories"},{value:"INTIMACY",label:"Intimit\xe9 avec Dieu"},{value:"LEADERSHIP",label:"Leadership"},{value:"HEALING",label:"Gu\xe9rison/Sant\xe9"},{value:"PROFESSIONAL",label:"Professionnel"},{value:"BUSINESS",label:"Entreprises/Affaires"},{value:"FINANCES",label:"Finances"},{value:"DELIVERANCE",label:"D\xe9livrance"},{value:"FAMILY",label:"Famille"}],Z=async()=>{if(console.log("loadTestimonies called, selectedChurch:",a),null!==a&&void 0!==a&&a.id){f(!0);try{const e={page:b.toString(),limit:"10",churchId:a.id};S&&(e.search=S),k&&(e.category=k),I&&(e.isRead="false");const t=(await q.apiService.testimonies.getAll(e)).data;t.success?(A(t.data.testimonies||[]),C(t.data.totalPages||1)):l(t.message||"Erreur lors du chargement des t\xe9moignages")}catch(e){l("Erreur de connexion lors du chargement des t\xe9moignages"),console.error("Erreur:",e)}finally{f(!1)}}};(0,n.useEffect)(()=>{Z()},[a,b,S,k,I]);const Y=()=>{F(!1),B(null)},Q=()=>{P(!1),H(null),V("")},ne=e=>{var t,a;return e?e.isAnonymous?"Anonyme":"".concat(null!==(t=e.firstName)&&void 0!==t?t:""," ").concat(null!==(a=e.lastName)&&void 0!==a?a:"").trim()||"\u2014":"\u2014"},re=e=>{if(!e)return"\u2014";const t=X.find(t=>t.value===e);return t?t.label:String(e)};return a?(0,U.jsxs)(s.A,{children:[(0,U.jsxs)(s.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,U.jsx)(o.A,{variant:"h4",component:"h1",gutterBottom:!0,children:"Gestion des t\xe9moignages"}),(0,U.jsx)(pe.A,{variant:"outlined",startIcon:(0,U.jsx)(O.A,{}),onClick:()=>{Z()},disabled:g,children:"Actualiser"})]}),(0,U.jsx)(te.A,{sx:{mb:3},children:(0,U.jsx)(ae.A,{children:(0,U.jsxs)(y.A,{container:!0,spacing:2,alignItems:"center",children:[(0,U.jsx)(y.A,{item:!0,xs:12,md:4,sx:{width:"30%"},children:(0,U.jsx)($.A,{fullWidth:!0,placeholder:"Rechercher dans les t\xe9moignages...",value:S,onChange:e=>{_(e.target.value),v(1)},InputProps:{startAdornment:(0,U.jsx)(kt.A,{position:"start",children:(0,U.jsx)(Ne.A,{})})}})}),(0,U.jsx)(y.A,{item:!0,xs:12,md:4,sx:{width:"30%"},children:(0,U.jsxs)(c.A,{fullWidth:!0,children:[(0,U.jsx)(J.A,{children:"Cat\xe9gorie"}),(0,U.jsx)(u.A,{value:k,onChange:e=>{R(e.target.value),v(1)},label:"Cat\xe9gorie",children:X.map(e=>(0,U.jsx)(h.A,{value:e.value,children:e.label},e.value))})]})}),(0,U.jsx)(y.A,{item:!0,xs:12,md:4,sx:{width:"30%"},children:(0,U.jsx)(Rt.A,{control:(0,U.jsx)(It.A,{checked:I,onChange:e=>{D(e.target.checked),v(1)},color:"primary"}),label:"Non lus uniquement"})}),(0,U.jsx)(y.A,{item:!0,xs:12,md:4,children:(0,U.jsx)(s.A,{display:"flex",justifyContent:"center",children:(0,U.jsx)(m.A,{icon:(0,U.jsx)(Et.A,{}),label:"".concat(x.length," t\xe9moignage(s)"),color:"primary",variant:"outlined"})})})]})})}),g?(0,U.jsx)(s.A,{display:"flex",justifyContent:"center",py:4,children:(0,U.jsx)(j.A,{})}):0===x.length?(0,U.jsx)(ee.A,{severity:"info",children:"Aucun t\xe9moignage trouv\xe9 pour cette \xe9glise."}):(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(y.A,{container:!0,spacing:2,children:x.map(e=>{var t,a;return(0,U.jsx)(y.A,{item:!0,xs:12,md:6,lg:4,sx:{width:"100%"},children:(0,U.jsxs)(te.A,{sx:{height:"100%",display:"flex",flexDirection:"column",opacity:e.isRead?.7:1,border:e.isRead?"1px solid rgb(184, 184, 185)":"1px solid rgba(119, 64, 201, 0.77)",boxShadow:e.isRead?"none":"0 2px 8px rgba(106, 57, 182, 0.15)"},children:[(0,U.jsxs)(ae.A,{sx:{flexGrow:1},children:[(0,U.jsxs)(s.A,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[(0,U.jsx)(s.A,{display:"flex",gap:1,alignItems:"center",children:(0,U.jsx)(m.A,{label:re(e.category),color:"primary",size:"small"})}),(0,U.jsx)(o.A,{variant:"body2",color:"text.primary",sx:{fontSize:"0.75rem",fontWeight:500},children:Tt(e.createdAt)})]}),(0,U.jsx)(o.A,{variant:"h6",gutterBottom:!0,children:ne(e)}),(0,U.jsx)(o.A,{variant:"body2",color:"text.primary",sx:{display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden",mb:2},children:e.content}),e.note&&(0,U.jsxs)(s.A,{sx:{bgcolor:"rgba(106, 57, 182, 0.08)",p:2,borderRadius:2,mb:2,border:"1px solid",borderColor:"rgba(106, 57, 182, 0.2)",position:"relative"},children:[(0,U.jsxs)(s.A,{display:"flex",alignItems:"center",gap:1,mb:1,children:[(0,U.jsx)(s.A,{sx:{width:20,height:20,borderRadius:"50%",bgcolor:"primary.main",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,U.jsx)(Wt.A,{sx:{color:"white",fontSize:"16px"}})}),(0,U.jsx)(o.A,{variant:"subtitle2",color:"primary.dark",sx:{fontWeight:600},children:"Note"})]}),(0,U.jsx)(o.A,{variant:"body2",color:"text.primary",sx:{lineHeight:1.6,fontStyle:"italic",pl:3},children:e.note})]}),(null===(t=e.network)||void 0===t?void 0:t.nom)&&(0,U.jsx)(m.A,{icon:(0,U.jsx)(Me.A,{}),label:"R\xe9seau : ".concat(e.network.nom),size:"small",color:"primary",variant:"outlined",sx:{mb:1,fontSize:"0.75rem"}}),(null===(a=e.illustrations)||void 0===a?void 0:a.length)>0&&(0,U.jsx)(m.A,{icon:(0,U.jsx)(Nt.A,{}),label:"".concat(e.illustrations.length," fichier(s)"),size:"small",color:"secondary",variant:"outlined",sx:{mb:1,fontSize:"0.75rem"}})]}),(0,U.jsx)(s.A,{sx:{p:2,pt:0},children:(0,U.jsxs)(s.A,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,U.jsxs)(s.A,{display:"flex",gap:1,children:[(0,U.jsx)(Ke.A,{title:"Voir le t\xe9moignage",children:(0,U.jsx)(d.A,{size:"small",onClick:()=>(async e=>{if(W(e),M(!0),!e.isRead)try{await q.apiService.testimonies.markAsRead(e.id),Z()}catch(t){console.error("Erreur lors du marquage automatique comme lu:",t)}})(e),sx:{color:e.isRead?"#666":"#6a39b6","&:hover":{backgroundColor:e.isRead?"rgba(102, 102, 102, 0.1)":"rgba(106, 57, 182, 0.1)"}},children:(0,U.jsx)(Mt.A,{})})}),(0,U.jsx)(Ke.A,{title:e.note?"Modifier la note":"Ajouter une note",children:(0,U.jsx)(d.A,{size:"small",color:e.note?"primary":"default",onClick:()=>(e=>{H(e),V(e.note||""),P(!0)})(e),children:(0,U.jsx)(Lt.A,{})})})]}),(0,U.jsx)(Ke.A,{title:"Supprimer",children:(0,U.jsx)(d.A,{size:"small",color:"error",onClick:()=>(e=>{B(e),F(!0)})(e),children:(0,U.jsx)(De.A,{})})})]})})]})},e.id)})}),w>1&&(0,U.jsx)(s.A,{display:"flex",justifyContent:"center",mt:4,children:(0,U.jsx)(Dt.A,{count:w,page:b,onChange:(e,t)=>{v(t)},color:"primary",size:"large"})})]}),(0,U.jsxs)(ye.A,{open:N,onClose:()=>M(!1),maxWidth:"md",fullWidth:!0,children:[(0,U.jsxs)(we.A,{children:["T\xe9moignage de ",E&&ne(E)]}),(0,U.jsx)(Ce.A,{children:(0,U.jsx)(s.A,{sx:{pt:2},children:E&&(0,U.jsxs)(s.A,{children:[(0,U.jsx)(s.A,{display:"flex",gap:1,mb:2,children:(0,U.jsx)(m.A,{label:re(E.category),color:"primary",size:"small"})}),(0,U.jsx)(o.A,{variant:"body1",paragraph:!0,children:E.content}),(null===(e=E.network)||void 0===e?void 0:e.nom)&&(0,U.jsx)(m.A,{icon:(0,U.jsx)(Me.A,{}),label:"R\xe9seau : ".concat(E.network.nom),size:"small",color:"primary",variant:"outlined",sx:{mb:2,fontSize:"0.75rem"}}),(null===(t=E.illustrations)||void 0===t?void 0:t.length)>0&&(0,U.jsxs)(s.A,{sx:{mb:2},children:[(0,U.jsx)(m.A,{icon:(0,U.jsx)(Nt.A,{}),label:"".concat(E.illustrations.length," fichier(s) joint(s)"),size:"small",color:"secondary",variant:"outlined",sx:{mb:1,fontSize:"0.75rem"}}),(0,U.jsx)(s.A,{sx:{mt:1},children:E.illustrations.map((e,t)=>(0,U.jsx)(m.A,{label:e.originalName,icon:(0,U.jsx)(Ft.A,{}),clickable:!0,onClick:()=>window.open("http://localhost:5001/uploads/testimonies/".concat(e.fileName),"_blank"),sx:{mr:1,mb:1}},t))})]})]})})}),(0,U.jsx)(Se.A,{children:(0,U.jsx)(pe.A,{onClick:()=>M(!1),children:"Fermer"})})]}),(0,U.jsx)(We.A,{open:L,title:"Supprimer le t\xe9moignage",content:T?'\xcates-vous s\xfbr de vouloir supprimer le t\xe9moignage "'.concat(T.title||"sans titre",'" ?'):"\xcates-vous s\xfbr de vouloir supprimer ce t\xe9moignage ?",onClose:Y,onConfirm:async()=>{if(T)try{const e=(await q.apiService.testimonies.delete(T.id)).data;e.success?(i("T\xe9moignage supprim\xe9 avec succ\xe8s"),Z()):l(e.message||"Erreur lors de la suppression")}catch(e){l("Erreur de connexion lors de la suppression"),console.error("Erreur:",e)}finally{Y()}}}),(0,U.jsxs)(ye.A,{open:z,onClose:Q,maxWidth:"md",fullWidth:!0,children:[(0,U.jsx)(we.A,{children:null!==G&&void 0!==G&&G.note?"Modifier la note":"Ajouter une note"}),(0,U.jsx)(Ce.A,{children:(0,U.jsxs)(s.A,{sx:{pt:2},children:[G&&(0,U.jsxs)(o.A,{variant:"body2",color:"text.primary",gutterBottom:!0,children:["T\xe9moignage de ",ne(G)," - ",re(G.category)]}),(0,U.jsx)($.A,{fullWidth:!0,multiline:!0,rows:6,value:K,onChange:e=>V(e.target.value),placeholder:"Ajoutez votre note sur ce t\xe9moignage...",variant:"outlined",sx:{mt:2}})]})}),(0,U.jsxs)(Se.A,{children:[(0,U.jsx)(pe.A,{onClick:Q,children:"Annuler"}),(null===G||void 0===G?void 0:G.note)&&(0,U.jsx)(pe.A,{onClick:async()=>{V("");try{const e=(await q.apiService.testimonies.addNote(G.id,"")).data;e.success?(i(e.message),Z(),Q()):l(e.message||"Erreur lors de la suppression de la note")}catch(e){l("Erreur de connexion lors de la suppression de la note"),console.error("Erreur:",e)}},color:"error",children:"Supprimer la note"}),(0,U.jsx)(pe.A,{onClick:async()=>{if(G)try{const e=(await q.apiService.testimonies.addNote(G.id,K)).data;e.success?(i(e.message),Z(),Q()):l(e.message||"Erreur lors de l'ajout de la note")}catch(e){l("Erreur de connexion lors de l'ajout de la note"),console.error("Erreur:",e)}},variant:"contained",disabled:!K.trim(),children:null!==G&&void 0!==G&&G.note?"Modifier":"Ajouter"})]})]}),(0,U.jsx)(_e.A,{open:r.open,autoHideDuration:4e3,onClose:p,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,U.jsx)(ee.A,{onClose:p,severity:r.severity,sx:{width:"100%"},children:r.message})})]}):(0,U.jsx)(ee.A,{severity:"warning",children:"Veuillez s\xe9lectionner une \xe9glise pour voir les t\xe9moignages."})},zt=n.memo(e=>{let{activeSection:t,selectedChurch:a,user:r,permissions:i,refreshKey:l}=e;(0,n.useEffect)(()=>{b.A.init()},[]);const d=(0,n.useMemo)(()=>({stats:H,statsReseaux:X,statsCultes:Q,statsMembres:dt,statsPrevisionnel:re,statsAssistance:oe,chaineImpact:me,networks:Pe,networksRecap:qe,carousel:He,users:tt,usersRetired:at,churches:ot,departments:it,missionImplantation:_t,testimonies:Bt}),[])[t];return(0,n.useMemo)(()=>{if(!d)return(0,U.jsx)(s.A,{sx:{p:3,textAlign:"center"},children:(0,U.jsx)(o.A,{variant:"h6",color:"error",children:b.A.t("dashboard.menu.sectionNotFound")})});const e={active:"missionImplantation"===t,selectedChurch:a,user:r,refreshKey:l};return(0,U.jsx)(s.A,{sx:{display:"block",width:"100%",overflow:"hidden"},children:(0,U.jsx)(d,(0,f.A)({},e))})},[d,t,a,r])});zt.displayName="DashboardContent";const Pt=zt;var qt=a(80045),Ut=a(57268),Gt=a(57401),Ht=a(95315),Kt=a(79801),Vt=a(66185),Xt=a(9820),Zt=a(14282),Yt=a(13106),Qt=a(23907),Jt=a(73069),$t=a(49982),ea=a(65979),ta=a(7762),aa=a(77955),na=a(64375),ra=a(99478),sa=a(96429),oa=a(16936),ia=a(23862),la=a(20366),da=a(65404);const ca=[{text:"Statistiques",icon:(0,U.jsx)(Zt.A,{}),children:[{id:"stats",text:b.A.t("menu.overview"),icon:(0,U.jsx)(Yt.A,{})},{id:"statsReseaux",text:b.A.t("menu.networks"),icon:(0,U.jsx)(Qt.A,{})},{id:"statsCultes",text:b.A.t("menu.services"),icon:(0,U.jsx)(Jt.A,{})},{id:"statsMembres",text:b.A.t("menu.members"),icon:(0,U.jsx)($t.A,{})},{id:"statsPrevisionnel",text:b.A.t("menu.forecasts"),icon:(0,U.jsx)(ea.A,{})},{id:"statsAssistance",text:b.A.t("menu.attendance"),icon:(0,U.jsx)($t.A,{})}]},{text:"R\xe9seaux",icon:(0,U.jsx)(ta.A,{}),children:[{id:"networks",text:"Gestion des r\xe9seaux",icon:(0,U.jsx)(ta.A,{})},{id:"networksRecap",text:"R\xe9capitulatif des effectifs",icon:(0,U.jsx)(aa.A,{})},{id:"chaineImpact",text:"Chaine d'impact",icon:(0,U.jsx)(ta.A,{})}]},{text:"Membres",icon:(0,U.jsx)($t.A,{}),children:[{id:"users",text:"Gestion des membres",icon:(0,U.jsx)($t.A,{})},{id:"usersRetired",text:"Membres retir\xe9s",icon:(0,U.jsx)(aa.A,{})}]},{text:"Mission et Implantation",icon:(0,U.jsx)(na.A,{}),children:[{id:"missionImplantation",text:"Carte interactive",icon:(0,U.jsx)(na.A,{})}]},{text:"T\xe9moignages",icon:(0,U.jsx)(ra.A,{}),children:[{id:"testimonies",text:"Gestion des t\xe9moignages",icon:(0,U.jsx)(sa.A,{})}]},{text:"Configuration",icon:(0,U.jsx)(oa.A,{}),children:[{id:"churches",text:"\xc9glises",icon:(0,U.jsx)(ia.A,{})},{id:"departments",text:"D\xe9partements",icon:(0,U.jsx)(la.A,{})},{id:"carousel",text:"Carousel",icon:(0,U.jsx)(da.A,{})}]}];var ua=a(87338);const ha=["active"],ma=(0,x.Ay)(Ut.Ay)(e=>{let{theme:t}=e;return{width:320,flexShrink:0,overflowX:"hidden","& .MuiDrawer-paper":{width:320,boxSizing:"border-box",backgroundColor:t.palette.primary.main,color:t.palette.primary.contrastText,overflowX:"hidden"}}}),pa=(0,x.Ay)(e=>{let{active:t}=e,a=(0,qt.A)(e,ha);return(0,U.jsx)(Gt.Ay,(0,f.A)({},a))})(e=>{let{theme:t,active:a}=e;return{margin:"8px 16px",borderRadius:t.shape.borderRadius,backgroundColor:a?"rgba(255, 255, 255, 0.2)":"transparent",cursor:"pointer","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"},"& .MuiListItemIcon-root":{color:t.palette.primary.contrastText}}}),xa=e=>{let{activeSection:t,expandedItems:a,onSectionChange:r,onToggleExpanded:i,onLogout:d,mobileOpen:c,setMobileOpen:u,selectedChurch:h,setSelectedChurch:m,showChurchFilter:p,user:x,permissions:A}=e;(0,n.useEffect)(()=>{b.A.init()},[]);(0,Ue.m)();const{isManager:g,canAccessConfig:v}=(0,Be.S)(),j=(0,ua.Zp)(),y=ca.filter(e=>!("Configuration"===e.text&&!v)).map(e=>{const t={Statistiques:b.A.t("dashboard.menu.statistics"),"R\xe9seaux":b.A.t("dashboard.menu.networks"),Membres:b.A.t("dashboard.menu.members"),"Mission et Implantation":b.A.t("dashboard.menu.mission"),Configuration:b.A.t("dashboard.menu.configuration"),"Vue d'ensemble":b.A.t("dashboard.menu.overview"),Cultes:b.A.t("dashboard.menu.services"),"Gestion des r\xe9seaux":b.A.t("dashboard.menu.networkManagement"),"R\xe9capitulatif des effectifs":b.A.t("dashboard.menu.networkRecap"),"Gestion des membres":b.A.t("dashboard.menu.memberManagement"),"Membres retir\xe9s":b.A.t("dashboard.menu.retiredMembers"),"Carte interactive":b.A.t("dashboard.menu.interactiveMap"),"\xc9glises":b.A.t("dashboard.menu.churches"),"D\xe9partements":b.A.t("dashboard.menu.departments"),Carousel:b.A.t("dashboard.menu.carousel")};return(0,f.A)((0,f.A)({},e),{},{text:t[e.text]||e.text,children:e.children?e.children.map(e=>(0,f.A)((0,f.A)({},e),{},{text:t[e.text]||e.text})):void 0})}),w=(0,U.jsxs)("div",{children:[(0,U.jsx)(l.A,{children:(0,U.jsx)(o.A,{variant:"h4",noWrap:!0,sx:{color:"white",fontWeight:"bold",letterSpacing:2,py:2,cursor:"pointer"},onClick:()=>window.location.reload(),children:g?b.A.t("dashboard.menu.management"):b.A.t("dashboard.menu.administration")})}),(0,U.jsx)(ct.A,{sx:{bgcolor:"rgba(255,255,255,0.12)"}}),(0,U.jsxs)(Ht.A,{children:[y.map(e=>(0,U.jsxs)(n.Fragment,{children:[(0,U.jsxs)(pa,{active:t===e.id?1:0,onClick:()=>(e=>{e.children?i(e.text):r(e.id)})(e),children:[(0,U.jsx)(Kt.A,{children:e.icon}),(0,U.jsx)(Vt.A,{primary:e.text,sx:{"& .MuiListItemText-primary":{color:"white",fontWeight:"bold"}}}),e.children&&(0,U.jsx)(Re.A,{sx:{color:"white",marginLeft:"auto",marginRight:"9px",transition:"transform 0.2s",transform:a.includes(e.text)?"rotate(0deg)":"rotate(-90deg)"}})]}),e.children&&(0,U.jsx)(je.A,{in:a.includes(e.text),timeout:"auto",unmountOnExit:!0,children:(0,U.jsx)(Ht.A,{component:"div",disablePadding:!0,children:e.children.map(e=>(0,U.jsxs)(pa,{sx:{pl:4,background:t===e.id?"rgba(255,255,255,0.15)":"transparent"},active:t===e.id?1:0,onClick:()=>{r(e.id)},children:[(0,U.jsx)(Kt.A,{children:e.icon}),(0,U.jsx)(Vt.A,{primary:e.text,sx:{"& .MuiListItemText-primary":{color:"white"}}})]},e.id))})})]},e.text||e.id)),(0,U.jsxs)(pa,{onClick:()=>j("/"),children:[(0,U.jsx)(Kt.A,{children:(0,U.jsx)(Xt.A,{})}),(0,U.jsx)(Vt.A,{primary:b.A.t("dashboard.menu.backToSite"),sx:{"& .MuiListItemText-primary":{color:"white",fontWeight:"bold"}}})]})]})]});return(0,U.jsxs)(s.A,{component:"nav",sx:{width:{sm:320},flexShrink:{sm:0}},children:[(0,U.jsx)(ma,{variant:"temporary",open:c,onClose:()=>u(!1),ModalProps:{keepMounted:!0},sx:{display:{xs:"block",sm:"none"}},children:w}),(0,U.jsx)(ma,{variant:"permanent",sx:{display:{xs:"none",sm:"block"}},open:!0,children:w})]})};var Aa=a(13417),ga=a(7509),fa=a(8319),ba=a(2967);const va=(0,x.Ay)(s.A)(e=>{let{theme:t}=e;return{flexGrow:1,padding:t.spacing(3),marginTop:64,backgroundColor:"#f5f5f5",minHeight:"100vh",width:"100%",overflow:"hidden",overflowY:"hidden",boxSizing:"border-box"}}),ja=()=>{const{user:e}=(0,r.d4)(e=>e.auth),t=(0,Be.S)(),{churches:a}=(0,Oe.RN)(),{selectedChurch:x,changeSelectedChurch:f}=(0,Ot.w)(),v=(0,ua.Zp)(),j=(0,r.wA)(),[y,w]=(0,n.useState)("stats"),[C,S]=(0,n.useState)([b.A.t("dashboard.expandedItems")]),[_,k]=(0,n.useState)(!1),[R,I]=(0,n.useState)(0),[D,E]=(0,n.useState)(!1),[W,N]=(0,n.useState)({unread_count:0}),[M,L]=(0,n.useState)(!1),[F,O]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{if(e){L(!0);try{const e=await fa.A.getMessageStats();e.success&&N(e.data||{unread_count:0})}catch(t){}finally{L(!1)}}})()},[e]);return t.canAccessDashboard?(0,U.jsx)(Ge.A,{allowedRoles:["SUPER_ADMIN","ADMIN","MANAGER"],children:(0,U.jsxs)(s.A,{sx:{display:"flex",width:"100%",overflow:"hidden",overflowY:"hidden"},children:[(0,U.jsx)(i.A,{position:"fixed",sx:{width:{sm:"calc(100% - ".concat(320,"px)")},ml:{sm:"".concat(320,"px")}},children:(0,U.jsxs)(l.A,{children:[(0,U.jsx)(d.A,{color:"inherit",edge:"start",onClick:()=>k(!_),sx:{mr:2,display:{sm:"none"}},children:(0,U.jsx)(A.A,{})}),(0,U.jsx)(o.A,{sx:{color:"white",flexGrow:1},variant:"h6",noWrap:!0,children:b.A.t("dashboard.title")}),!t.isManager&&a.length>0&&(0,U.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",gap:2,mr:2},children:[(0,U.jsxs)(o.A,{variant:"body2",sx:{color:"white"},children:[b.A.t("dashboard.church")," :"]}),(0,U.jsx)(c.A,{size:"small",sx:{minWidth:200},children:(0,U.jsxs)(u.A,{value:(null===x||void 0===x?void 0:x.id)||(null===x||void 0===x?void 0:x._id)||"",onChange:e=>{return t=e.target.value,f(t),void I(e=>e+1);var t},displayEmpty:!0,renderValue:t=>{if(!t){const t="object"===typeof(null===e||void 0===e?void 0:e.eglise_locale)?e.eglise_locale.id||e.eglise_locale._id:null===e||void 0===e?void 0:e.eglise_locale,n=a.find(e=>(e.id||e._id)===t);return n?n.nom:b.A.t("dashboard.selectChurch")}const n=a.find(e=>(e.id||e._id)===t);return n?n.nom:b.A.t("dashboard.selectChurch")},sx:{backgroundColor:"rgba(255, 255, 255, 0.37)",color:"text.primary",backdropFilter:"blur(10px)","& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.11)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.39)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.49)"}},children:[(0,U.jsx)(h.A,{value:"",disabled:!0,children:(0,U.jsx)(o.A,{sx:{color:"rgba(0, 0, 0, 0.5)",fontStyle:"italic"},children:b.A.t("dashboard.selectChurch")})}),a.map(e=>(0,U.jsx)(h.A,{value:e.id||e._id,children:e.nom},e.id||e._id))]})})]}),(0,U.jsx)(m.A,{label:(0,Qe.WX)((null===e||void 0===e?void 0:e.current_role)||(null===e||void 0===e?void 0:e.role))||b.A.t("dashboard.defaultRole"),sx:{backgroundColor:"rgba(255,255,255,0.2)",color:"white",border:"1px solid rgba(255,255,255,0.3)",mr:2},size:"small"}),(0,U.jsx)(d.A,{color:"inherit",onClick:()=>{E(!0)},sx:{ml:1},title:b.A.t("navigation.messaging"),children:(0,U.jsx)(p.A,{badgeContent:W.unread_count,color:"error",invisible:0===W.unread_count,children:(0,U.jsx)(g.A,{})})}),(0,U.jsx)(ba.A,{anchorEl:F,onMenuOpen:e=>{O(e.currentTarget)},onMenuClose:()=>{O(null)}})]})}),(0,U.jsx)(xa,{activeSection:y,expandedItems:C,onSectionChange:e=>{w(e),window.location.hash=e;const t=ca.find(t=>t.children&&t.children.some(t=>t.id===e));if(t){const e={Statistiques:b.A.t("dashboard.menu.statistics"),"R\xe9seaux":b.A.t("dashboard.menu.networks"),Membres:b.A.t("dashboard.menu.members"),"Mission et Implantation":b.A.t("dashboard.menu.mission"),Configuration:b.A.t("dashboard.menu.configuration")}[t.text]||t.text;S(t=>[e])}},onToggleExpanded:e=>{S(t=>t.includes(e)?t.filter(t=>t!==e):[e])},onLogout:()=>{j((0,Aa.ri)()),v("/login")},mobileOpen:_,setMobileOpen:k,selectedChurch:x,setSelectedChurch:f,showChurchFilter:!t.isManager,user:e,permissions:t}),(0,U.jsx)(va,{children:(0,U.jsx)(Pt,{activeSection:y,selectedChurch:x,user:e,permissions:t,showChurchFilter:!1,refreshKey:R})}),(0,U.jsx)(ga.A,{open:D,onClose:()=>{E(!1)}})]})}):(0,U.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,U.jsx)(o.A,{variant:"h4",color:"error",children:b.A.t("dashboard.unauthorized")})})}},88324:(e,t,a)=>{a.d(t,{A:()=>r});var n=a(78816);const r={getChaineImpact:async e=>{try{return(await n.A.get("/chaine-impact?church_id=".concat(e))).data}catch(t){throw t}},getChaineImpactByUser:async e=>{try{return(await n.A.get("/chaine-impact/user/".concat(e))).data}catch(t){throw t}},updateChaineImpact:async e=>{try{return(await n.A.post("/chaine-impact/update",{church_id:e})).data}catch(t){throw t}},deleteChaineImpact:async e=>{try{return(await n.A.delete("/chaine-impact/".concat(e))).data}catch(t){throw t}}}}}]);
//# sourceMappingURL=41.0f4f0ce6.chunk.js.map