"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[460],{16460:(e,t,s)=>{s.r(t),s.d(t,{default:()=>ye});var r=s(89379),a=s(65043),i=s(56266),n=s(77210),l=s(45350),o=s(87338),d=s(22094),c=s(91244),u=s(94799),m=s(53969),h=s(55895),p=s(49806),A=s(26529),v=s(42579),g=s(12097),x=s(53089),b=s(16128),f=s(95563),y=s(33023),j=s(81911),_=s(78776),w=s(24343),C=s(47471),k=s(85877),E=s(1725),S=s(85030),F=s(10256),T=s(79067),I=s(67203),D=s(83759),R=s(70916),W=s(91449),M=s(58128),P=s(69302),B=s(65979),q=s(69594),L=s(99161),N=s(90160),O=s(22950),U=s(61773),z=s(5362),G=s(37528),V=s(72301),H=s(37531),K=s(83140),Q=s(94527),J=s(82656),X=s(70579);const Z=e=>{var t;let{open:s,onClose:n,onSave:l,networkData:o,isLoading:d=!1}=e;const[u,p]=(0,a.useState)({date:new Date,type_culte:"",groupes_previsions:{}}),[A,v]=(0,a.useState)(0),[f,E]=(0,a.useState)({});(0,a.useEffect)(()=>{if(null!==o&&void 0!==o&&o.grs&&Array.isArray(o.grs)){const e={};o.grs.forEach(t=>{var s,r,a,i,n,l;const o=(null===(s=t.members)||void 0===s?void 0:s.length)||0,d=t.nom||"GR ".concat((null===(r=t.responsable1)||void 0===r||null===(a=r.username)||void 0===a?void 0:a.split(" ")[0])||"Sans nom").concat(null!==(i=t.responsable2)&&void 0!==i&&i.username?" & ".concat(null===(n=t.responsable2)||void 0===n||null===(l=n.username)||void 0===l?void 0:l.split(" ")[0]):"");e[t.id]={id:t.id,nom:d,effectif_actuel:o,valeur_previsionnelle:o}}),p(t=>(0,r.A)((0,r.A)({},t),{},{groupes_previsions:e}))}},[o]),(0,a.useEffect)(()=>{const e=Object.values(u.groupes_previsions).reduce((e,t)=>e+(parseInt(t.valeur_previsionnelle)||0),0);v(e)},[u.groupes_previsions]);const S=()=>{E({}),n()},F=J.ze.filter(e=>"Tous"!==e.value);return(0,X.jsxs)(y.A,{open:s,onClose:S,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{height:"90vh"}},children:[(0,X.jsxs)(j.A,{children:[(0,X.jsx)(h.A,{variant:"h5",component:"div",children:i.A.t("previsionnel.modal.title")}),(0,X.jsxs)(h.A,{variant:"body2",color:"text.secondary",children:[i.A.t("previsionnel.modal.subtitle")," - ",null===o||void 0===o||null===(t=o.reseau)||void 0===t?void 0:t.nom]})]}),(0,X.jsxs)(_.A,{dividers:!0,sx:{p:3},children:[(0,X.jsx)(m.A,{component:"form",sx:{mb:3},children:(0,X.jsxs)(x.A,{container:!0,spacing:3,children:[(0,X.jsx)(x.A,{item:!0,xs:12,md:6,children:(0,X.jsx)(w.A,{fullWidth:!0,type:"date",label:i.A.t("previsionnel.form.date"),value:u.date?u.date.toISOString().split("T")[0]:"",onChange:e=>p(t=>(0,r.A)((0,r.A)({},t),{},{date:new Date(e.target.value)})),error:!!f.date,helperText:f.date,required:!0,InputLabelProps:{shrink:!0},sx:{minWidth:200}})}),(0,X.jsx)(x.A,{item:!0,xs:12,md:6,children:(0,X.jsx)(w.A,{select:!0,fullWidth:!0,label:i.A.t("previsionnel.form.typeCulte"),value:u.type_culte,onChange:e=>p(t=>(0,r.A)((0,r.A)({},t),{},{type_culte:e.target.value})),error:!!f.type_culte,helperText:f.type_culte,required:!0,sx:{minWidth:200},children:F.map(e=>(0,X.jsx)(C.A,{value:e.value,children:e.label},e.value))})})]})}),(0,X.jsx)(Q.A,{sx:{my:3}}),f.previsions&&(0,X.jsx)(W.A,{severity:"error",sx:{mb:3},children:f.previsions}),(0,X.jsxs)(m.A,{sx:{mb:3},children:[(0,X.jsx)(h.A,{variant:"h6",gutterBottom:!0,children:i.A.t("previsionnel.form.groupes")}),(0,X.jsx)(h.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:i.A.t("previsionnel.form.groupesDescription")}),(0,X.jsx)(x.A,{container:!0,spacing:2,children:Object.values(u.groupes_previsions).map(e=>(0,X.jsx)(x.A,{item:!0,xs:12,sm:6,md:4,children:(0,X.jsx)(c.A,{variant:"outlined",sx:{height:"100%"},children:(0,X.jsxs)(b.A,{children:[(0,X.jsx)(h.A,{variant:"subtitle1",gutterBottom:!0,children:e.nom}),(0,X.jsx)(m.A,{sx:{mb:2},children:(0,X.jsxs)(h.A,{variant:"body2",color:"text.secondary",children:[i.A.t("previsionnel.form.totalMembres")," : ",(0,X.jsx)("strong",{children:e.effectif_actuel})]})}),(0,X.jsx)(w.A,{fullWidth:!0,type:"number",variant:"outlined",label:i.A.t("previsionnel.form.valeurPrevisionnelle"),value:e.valeur_previsionnelle,onChange:t=>((e,t)=>{const s=parseInt(t)||0;p(t=>(0,r.A)((0,r.A)({},t),{},{groupes_previsions:(0,r.A)((0,r.A)({},t.groupes_previsions),{},{[e]:(0,r.A)((0,r.A)({},t.groupes_previsions[e]),{},{valeur_previsionnelle:s})})}))})(e.id,t.target.value),inputProps:{min:0},size:"small"})]})})},e.id))})]}),(0,X.jsx)(Q.A,{sx:{my:3}}),(0,X.jsxs)(m.A,{sx:{mb:3},children:[(0,X.jsx)(h.A,{variant:"h6",gutterBottom:!0,children:i.A.t("previsionnel.form.invites")}),(0,X.jsx)(h.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:i.A.t("previsionnel.form.invitesDescription")}),(0,X.jsx)(w.A,{fullWidth:!0,type:"number",label:i.A.t("previsionnel.form.nombreInvites"),value:u.invites||0,onChange:e=>p(t=>(0,r.A)((0,r.A)({},t),{},{invites:parseInt(e.target.value)||0})),inputProps:{min:0},sx:{maxWidth:300}})]}),(0,X.jsx)(Q.A,{sx:{my:3}})]}),(0,X.jsxs)(k.A,{sx:{p:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,X.jsxs)(h.A,{variant:"h6",sx:{fontWeight:"bold"},children:[i.A.t("previsionnel.form.totalPrevisionnel")," : ",(0,X.jsx)("strong",{children:A+(u.invites||0)})]}),(0,X.jsxs)(m.A,{children:[(0,X.jsx)(g.A,{onClick:S,disabled:d,sx:{mr:1},children:i.A.t("common.actions.cancel")}),(0,X.jsx)(g.A,{variant:"contained",onClick:()=>{if(!(()=>{const e={};return u.date||(e.date=i.A.t("errors.validation.dateRequired")),u.type_culte||(e.type_culte=i.A.t("errors.validation.typeCulteRequired")),Object.values(u.groupes_previsions).some(e=>(parseInt(e.valeur_previsionnelle)||0)>0)||(e.previsions=i.A.t("previsionnel.errors.noPrevision")),E(e),0===Object.keys(e).length})())return;const e=A+(u.invites||0),t={date:u.date.toISOString(),type_culte:u.type_culte,total_prevu:e,invites:u.invites||0,network_id:o.reseau.id,church_id:o.reseau.church_id||o.reseau.eglise_id,groupes_previsions:Object.values(u.groupes_previsions).map(e=>({group_id:e.id,effectif_actuel:e.effectif_actuel,valeur_previsionnelle:e.valeur_previsionnelle}))};l(t)},disabled:d||A+(u.invites||0)===0,children:d?i.A.t("common.actions.loading"):i.A.t("previsionnel.form.save")})]})]})]})};var Y=s(56198),$=s(65506);const ee=e=>{var t,s;let{open:n,onClose:l,networkData:o,onSave:d,isLoading:u=!1}=e;const[p,A]=(0,a.useState)({date:(new Date).toISOString().split("T")[0],type_culte:"",groupes_assistance:{},invites:0}),[v,f]=(0,a.useState)(!1),[E,S]=(0,a.useState)(null),[F,T]=(0,a.useState)(null),[I,R]=(0,a.useState)(0);(0,a.useEffect)(()=>{if(n&&null!==o&&void 0!==o&&o.grs&&Array.isArray(o.grs)){const e={};o.grs.forEach(t=>{var s,r,a,i,n,l;const o=(null===(s=t.members)||void 0===s?void 0:s.length)||0,d=t.nom||"GR ".concat((null===(r=t.responsable1)||void 0===r||null===(a=r.username)||void 0===a?void 0:a.split(" ")[0])||"Sans nom").concat(null!==(i=t.responsable2)&&void 0!==i&&i.username?" & ".concat(null===(n=t.responsable2)||void 0===n||null===(l=n.username)||void 0===l?void 0:l.split(" ")[0]):"");e[t.id]={id:t.id,nom:d,effectif_actuel:o,nombre_presents:o}}),A(t=>(0,r.A)((0,r.A)({},t),{},{groupes_assistance:e}))}},[n,o]),(0,a.useEffect)(()=>{(async()=>{var e;if(p.date&&p.type_culte&&null!==o&&void 0!==o&&null!==(e=o.reseau)&&void 0!==e&&e.id)try{const e=await $.A.getStats({network_id:o.reseau.id,date_from:p.date,date_to:p.date,type_culte:p.type_culte});e.data&&e.data.details&&e.data.details.length>0?T(e.data.details[0]):T(null)}catch(E){T(null)}})()},[p.date,p.type_culte,null===o||void 0===o||null===(t=o.reseau)||void 0===t?void 0:t.id]),(0,a.useEffect)(()=>{const e=Object.values(p.groupes_assistance).reduce((e,t)=>e+(t.nombre_presents||0),0);R(e)},[p.groupes_assistance]);const M=(e,t)=>{A(s=>(0,r.A)((0,r.A)({},s),{},{[e]:t}))},P=()=>{S(null),T(null),l()},B=F?I-F.previsionnel:null,q=J.ze.filter(e=>"Tous"!==e.value);return(0,X.jsxs)(y.A,{open:n,onClose:P,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{height:"90vh"}},children:[(0,X.jsxs)(j.A,{children:[(0,X.jsx)(h.A,{variant:"h5",component:"div",children:i.A.t("assistance.form.title")}),(0,X.jsxs)(h.A,{variant:"body2",color:"text.secondary",children:[i.A.t("assistance.form.subtitle")," - ",null===o||void 0===o||null===(s=o.reseau)||void 0===s?void 0:s.nom]})]}),(0,X.jsxs)(_.A,{dividers:!0,sx:{p:3},children:[(0,X.jsx)(m.A,{component:"form",sx:{mb:3},children:(0,X.jsxs)(x.A,{container:!0,spacing:3,children:[(0,X.jsx)(x.A,{item:!0,xs:12,md:6,children:(0,X.jsx)(w.A,{fullWidth:!0,type:"date",label:i.A.t("assistance.form.date"),value:p.date,onChange:e=>M("date",e.target.value),InputLabelProps:{shrink:!0},sx:{minWidth:200}})}),(0,X.jsx)(x.A,{item:!0,xs:12,md:6,children:(0,X.jsx)(w.A,{select:!0,fullWidth:!0,label:i.A.t("assistance.form.typeCulte"),value:p.type_culte,onChange:e=>M("type_culte",e.target.value),sx:{minWidth:200},children:q.map(e=>(0,X.jsx)(C.A,{value:e.value,children:e.label},e.value))})})]})}),(0,X.jsx)(Q.A,{sx:{my:3}}),E&&(0,X.jsx)(W.A,{severity:"error",sx:{mb:3},children:E}),(0,X.jsxs)(m.A,{sx:{mb:3},children:[(0,X.jsx)(h.A,{variant:"h6",gutterBottom:!0,children:i.A.t("assistance.form.groupes")}),(0,X.jsx)(h.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:i.A.t("assistance.form.groupesDescription")}),(0,X.jsx)(x.A,{container:!0,spacing:2,children:Object.values(p.groupes_assistance).map(e=>(0,X.jsx)(x.A,{item:!0,xs:12,sm:6,md:4,children:(0,X.jsx)(c.A,{variant:"outlined",sx:{height:"100%"},children:(0,X.jsxs)(b.A,{children:[(0,X.jsx)(h.A,{variant:"subtitle1",gutterBottom:!0,children:e.nom}),(0,X.jsx)(m.A,{sx:{mb:2},children:(0,X.jsxs)(h.A,{variant:"body2",color:"text.secondary",children:[i.A.t("assistance.form.totalMembres")," : ",(0,X.jsx)("strong",{children:e.effectif_actuel})]})}),(0,X.jsx)(w.A,{fullWidth:!0,type:"number",variant:"outlined",label:i.A.t("assistance.form.nombrePresents"),value:e.nombre_presents||"",onChange:t=>{return s=e.id,a="nombre_presents",i=parseInt(t.target.value)||0,void A(e=>(0,r.A)((0,r.A)({},e),{},{groupes_assistance:(0,r.A)((0,r.A)({},e.groupes_assistance),{},{[s]:(0,r.A)((0,r.A)({},e.groupes_assistance[s]),{},{[a]:i})})}));var s,a,i},inputProps:{min:0,max:e.effectif_actuel},size:"small"})]})})},e.id))})]}),(0,X.jsx)(Q.A,{sx:{my:3}}),(0,X.jsxs)(m.A,{sx:{mb:3},children:[(0,X.jsx)(h.A,{variant:"h6",gutterBottom:!0,children:i.A.t("assistance.form.invites")}),(0,X.jsx)(h.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:i.A.t("assistance.form.invitesDescription")}),(0,X.jsx)(w.A,{fullWidth:!0,type:"number",label:i.A.t("assistance.form.nombreInvites"),value:p.invites||0,onChange:e=>A(t=>(0,r.A)((0,r.A)({},t),{},{invites:parseInt(e.target.value)||0})),inputProps:{min:0},sx:{maxWidth:300}})]}),(0,X.jsx)(Q.A,{sx:{my:3}}),F&&(0,X.jsxs)(m.A,{sx:{mb:3},children:[(0,X.jsx)(h.A,{variant:"h6",gutterBottom:!0,children:i.A.t("assistance.form.comparisonTitle")}),(0,X.jsx)(h.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:i.A.t("assistance.form.comparisonDescription")}),(0,X.jsxs)(x.A,{container:!0,spacing:2,children:[(0,X.jsx)(x.A,{item:!0,xs:12,sm:4,children:(0,X.jsxs)(c.A,{variant:"outlined",sx:{p:2,textAlign:"center"},children:[(0,X.jsx)(h.A,{variant:"body2",color:"text.secondary",children:i.A.t("assistance.form.previsionnel")}),(0,X.jsx)(h.A,{variant:"h6",color:"primary",children:F.previsionnel})]})}),(0,X.jsx)(x.A,{item:!0,xs:12,sm:4,children:(0,X.jsxs)(c.A,{variant:"outlined",sx:{p:2,textAlign:"center"},children:[(0,X.jsx)(h.A,{variant:"body2",color:"text.secondary",children:i.A.t("assistance.form.presents")}),(0,X.jsx)(h.A,{variant:"h6",color:"success.main",children:I})]})}),(0,X.jsx)(x.A,{item:!0,xs:12,sm:4,children:(0,X.jsxs)(c.A,{variant:"outlined",sx:{p:2,textAlign:"center"},children:[(0,X.jsx)(h.A,{variant:"body2",color:"text.secondary",children:i.A.t("assistance.form.ecart")}),(0,X.jsx)(D.A,{label:B>=0?"+".concat(B):B,color:B>=0?"success":"error",size:"medium"})]})})]})]})]}),(0,X.jsxs)(k.A,{sx:{p:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,X.jsxs)(h.A,{variant:"h6",sx:{fontWeight:"bold"},children:[i.A.t("assistance.form.totalPresents")," : ",(0,X.jsx)("strong",{children:I+(p.invites||0)}),p.invites>0&&(0,X.jsxs)(h.A,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:["(",I," membres + ",p.invites," invit\xe9s)"]})]}),(0,X.jsxs)(m.A,{children:[(0,X.jsx)(g.A,{onClick:P,disabled:u,sx:{mr:1},children:i.A.t("common.actions.cancel")}),(0,X.jsx)(g.A,{variant:"contained",onClick:async()=>{f(!0),S(null);try{if(!p.date||!p.type_culte)throw new Error("Veuillez remplir tous les champs obligatoires");if(0===I)throw new Error("Veuillez saisir au moins un pr\xe9sent");const e={date:new Date(p.date).toISOString(),type_culte:p.type_culte,total_presents:I+(p.invites||0),invites:p.invites||0,network_id:o.reseau.id,church_id:o.reseau.church_id||o.reseau.eglise_id,groupes_assistance:Object.values(p.groupes_assistance).map(e=>({group_id:e.id,effectif_actuel:e.effectif_actuel,nombre_presents:e.nombre_presents}))};d(e)}catch(E){var e,t;S((null===(e=E.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||E.message||"Erreur lors de l'enregistrement")}finally{f(!1)}},disabled:u||0===I,children:u?i.A.t("common.actions.loading"):i.A.t("assistance.form.save")})]})]})]})};var te=s(80172),se=s(14333),re=s(12843),ae=s(63898),ie=s(6013),ne=s(93201),le=s(15521),oe=s(42227);const de=e=>{let{open:t,onClose:s,networkData:n}=e;const[l,o]=(0,a.useState)(0),[d,u]=(0,a.useState)(!1),[p,x]=(0,a.useState)([]),[f,w]=(0,a.useState)([]),[C,E]=(0,a.useState)(null),[S,F]=(0,a.useState)({open:!1,type:null,item:null,title:"",content:""}),[T,I]=(0,a.useState)({open:!1,message:"",severity:"success"});(0,a.useEffect)(()=>{var e;t&&null!==n&&void 0!==n&&null!==(e=n.reseau)&&void 0!==e&&e.id&&M()},[t,n]),(0,a.useEffect)(()=>{if(t){const e=setTimeout(()=>{const e=document.querySelector('[role="dialog"]');e&&e.focus()},100);return()=>clearTimeout(e)}},[t]);const M=async()=>{var e;if(null!==n&&void 0!==n&&null!==(e=n.reseau)&&void 0!==e&&e.id){u(!0),E(null);try{var t,s,r,a;const e=await $.A.getStats({network_id:n.reseau.id,limit:50}),i=await Y.A.getStats({network_id:n.reseau.id,limit:50}),l=(null===(t=e.data)||void 0===t?void 0:t.details)||(null===(s=e.data)||void 0===s?void 0:s.data)||[],o=(null===(r=i.data)||void 0===r?void 0:r.details)||(null===(a=i.data)||void 0===a?void 0:a.data)||[];x(l),w(o)}catch(C){console.error("Erreur lors du chargement de l'historique:",C),E(i.A.t("history.loadingError"))}finally{u(!1)}}},B=(e,t)=>{const s="previsionnel"===e,r=(0,le.GP)(new Date(t.date),"dd/MM/yyyy",{locale:oe.fr}),a=t.type_culte||i.A.t("history.defaultCulteType");F({open:!0,type:e,item:t,title:"Supprimer ".concat(s?"le pr\xe9visionnel":"l'assistance"),content:"\xcates-vous s\xfbr de vouloir supprimer ".concat(s?"le pr\xe9visionnel":"l'assistance"," du ").concat(r," (").concat(a,") ?")})},q=()=>{I(e=>(0,r.A)((0,r.A)({},e),{},{open:!1}))},N=e=>{try{return(0,le.GP)(new Date(e),"dd/MM/yyyy",{locale:oe.fr})}catch(t){return e}},O=e=>({CULTE_DIMANCHE:i.A.t("previsionnel.form.typeCulte.dimanche"),CULTE_MERCREDI:i.A.t("previsionnel.form.typeCulte.mercredi"),CULTE_VENDREDI:i.A.t("previsionnel.form.typeCulte.vendredi"),CULTE_SPECIAL:i.A.t("previsionnel.form.typeCulte.special"),REUNION_PRIERE:i.A.t("previsionnel.form.typeCulte.reunionPriere"),ETUDE_BIBLIQUE:i.A.t("previsionnel.form.typeCulte.etudeBiblique")}[e]||e),U=e=>(0,X.jsx)(c.A,{sx:{mb:1.5,"&:hover":{boxShadow:2}},children:(0,X.jsx)(b.A,{sx:{p:2},children:(0,X.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,X.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,X.jsx)(ae.A,{color:"primary",sx:{fontSize:"1.2rem"}}),(0,X.jsxs)(m.A,{children:[(0,X.jsx)(h.A,{variant:"subtitle1",color:"primary",sx:{fontSize:"1rem"},children:N(e.date)}),(0,X.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:2,mt:.5},children:[(0,X.jsx)(D.A,{label:O(e.type_culte),color:"primary",variant:"outlined",size:"small",sx:{fontSize:"0.8rem",fontWeight:"bold"}}),(0,X.jsx)(D.A,{label:"".concat(i.A.t("previsionnel.form.totalMembres")," : ").concat(e.previsionnel||e.total_previsionnel||0),color:"primary",variant:"outlined",size:"small",sx:{fontSize:"0.8rem",fontWeight:"bold"}})]})]})]}),(0,X.jsx)(m.A,{sx:{display:"flex",gap:1},children:(0,X.jsx)(A.A,{title:i.A.t("common.actions.delete"),children:(0,X.jsx)(v.A,{color:"error",size:"small",onClick:()=>B("previsionnel",e),children:(0,X.jsx)(z.A,{})})})})]})})}),G=e=>(0,X.jsx)(c.A,{sx:{mb:1.5,"&:hover":{boxShadow:2}},children:(0,X.jsx)(b.A,{sx:{p:2},children:(0,X.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,X.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,X.jsx)(ae.A,{color:"success",sx:{fontSize:"1.2rem"}}),(0,X.jsxs)(m.A,{children:[(0,X.jsx)(h.A,{variant:"subtitle1",color:"success.main",sx:{fontSize:"1rem"},children:N(e.date)}),(0,X.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:2,mt:.5},children:[(0,X.jsx)(D.A,{label:O(e.type_culte),color:"success",variant:"outlined",size:"small",sx:{fontSize:"0.8rem",fontWeight:"bold"}}),(0,X.jsx)(D.A,{label:"".concat(i.A.t("previsionnel.form.totalMembres")," : ").concat(e.effectif_reel||e.total_presents||0),color:"success",variant:"outlined",size:"small",sx:{fontSize:"0.8rem",fontWeight:"bold"}})]})]})]}),(0,X.jsx)(m.A,{sx:{display:"flex",gap:1},children:(0,X.jsx)(A.A,{title:i.A.t("common.actions.delete"),children:(0,X.jsx)(v.A,{color:"error",size:"small",onClick:()=>B("assistance",e),children:(0,X.jsx)(z.A,{})})})})]})})},e.id);return(0,X.jsxs)(X.Fragment,{children:[(0,X.jsxs)(y.A,{open:t,onClose:s,maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!1,disableRestoreFocus:!1,keepMounted:!1,PaperProps:{sx:{minHeight:"70vh"}},children:[(0,X.jsx)(j.A,{children:(0,X.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,X.jsxs)(h.A,{variant:"h5",sx:{display:"flex",alignItems:"center",gap:1},children:[(0,X.jsx)(L.A,{color:"primary"}),i.A.t("home.historyOfCultes")]}),(0,X.jsx)(m.A,{sx:{display:"flex",gap:1},children:(0,X.jsx)(A.A,{title:i.A.t("common.actions.refresh"),children:(0,X.jsx)(v.A,{onClick:M,disabled:d,children:(0,X.jsx)(P.A,{})})})})]})}),(0,X.jsxs)(_.A,{children:[(0,X.jsx)(m.A,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:(0,X.jsxs)(se.A,{value:l,onChange:(e,t)=>o(t),sx:{mb:-1},children:[(0,X.jsx)(re.A,{label:(0,X.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,X.jsx)(ie.A,{fontSize:"small"}),i.A.t("home.previsions")," (",Array.isArray(p)?p.length:0,")"]})}),(0,X.jsx)(re.A,{label:(0,X.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,X.jsx)(ne.A,{fontSize:"small"}),i.A.t("home.assistance")," (",Array.isArray(f)?f.length:0,")"]})})]})}),d?(0,X.jsx)(m.A,{sx:{display:"flex",justifyContent:"center",p:4},children:(0,X.jsx)(te.A,{})}):C?(0,X.jsx)(W.A,{severity:"error",sx:{m:2},children:C}):0===l?Array.isArray(p)&&0!==p.length?(0,X.jsx)(m.A,{sx:{p:2},children:p.map((e,t)=>(0,X.jsx)("div",{children:U(e)},e.id||"".concat(e.date,"-").concat(e.type_culte,"-").concat(t)))}):(0,X.jsxs)(m.A,{sx:{textAlign:"center",p:4},children:[(0,X.jsx)(ie.A,{sx:{fontSize:48,color:"text.secondary",mb:2}}),(0,X.jsx)(h.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:i.A.t("previsionnel.dashboard.noData")}),(0,X.jsx)(h.A,{variant:"body2",color:"text.secondary",children:i.A.t("previsionnel.dashboard.noDataDescription")})]}):Array.isArray(f)&&0!==f.length?(0,X.jsx)(m.A,{sx:{p:2},children:f.map((e,t)=>(0,X.jsx)("div",{children:G(e)},e.id||"".concat(e.date,"-").concat(e.type_culte,"-").concat(t)))}):(0,X.jsxs)(m.A,{sx:{textAlign:"center",p:4},children:[(0,X.jsx)(ne.A,{sx:{fontSize:48,color:"text.secondary",mb:2}}),(0,X.jsx)(h.A,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:i.A.t("assistance.dashboard.noData")}),(0,X.jsx)(h.A,{variant:"body2",color:"text.secondary",children:i.A.t("assistance.dashboard.noDataDescription")})]})]}),(0,X.jsx)(k.A,{children:(0,X.jsx)(g.A,{onClick:s,color:"primary",children:i.A.t("common.close")})})]}),(0,X.jsxs)(y.A,{open:S.open,onClose:()=>F({open:!1,type:null,item:null,title:"",content:""}),disableEscapeKeyDown:!1,disableRestoreFocus:!1,keepMounted:!1,children:[(0,X.jsx)(j.A,{children:S.title}),(0,X.jsx)(_.A,{children:(0,X.jsx)(h.A,{children:S.content})}),(0,X.jsxs)(k.A,{children:[(0,X.jsx)(g.A,{onClick:()=>F({open:!1,type:null,item:null,title:"",content:""}),children:i.A.t("common.actions.cancel")}),(0,X.jsx)(g.A,{onClick:async()=>{if(S.item)try{if("previsionnel"===S.type){const e=S.item.id;if(!e)return void I({open:!0,message:"ID du pr\xe9visionnel manquant",severity:"error"});await $.A.delete(e),x(t=>t.filter(t=>t.id!==e)),I({open:!0,message:i.A.t("history.deletePrevisionnelSuccess"),severity:"success"})}else if("assistance"===S.type){const e=S.item.id;if(!e)return void I({open:!0,message:"ID de l'assistance manquant",severity:"error"});await Y.A.delete(e),w(t=>t.filter(t=>t.id!==e)),I({open:!0,message:i.A.t("history.deleteAssistanceSuccess"),severity:"success"})}F({open:!1,type:null,item:null,title:"",content:""})}catch(C){console.error("\u274c Erreur lors de la suppression:",C),I({open:!0,message:i.A.t("history.deleteError"),severity:"error"})}},color:"error",variant:"contained",children:i.A.t("common.actions.delete")})]})]}),(0,X.jsx)(R.A,{open:T.open,autoHideDuration:4e3,onClose:q,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,X.jsx)(W.A,{onClose:q,severity:T.severity,sx:{width:"100%"},children:T.message})})]})};var ce=s(70360),ue=s(78816),me=s(41894),he=s(39408),pe=s(88324);new class{constructor(){this.themes={light:{name:"light",displayName:"Clair",icon:"\u2600\ufe0f",description:"Th\xe8me clair pour une utilisation en journ\xe9e",variables:{"--primary-color":"#4B0082","--primary-light":"#8A2BE2","--primary-dark":"#2D004D","--secondary-color":"#8A2BE2","--secondary-light":"#B19CD9","--secondary-dark":"#6A1B9A","--background-primary":"#FFFFFF","--background-secondary":"#F8F9FA","--background-tertiary":"#E9ECEF","--background-elevated":"#FFFFFF","--background-overlay":"rgba(0, 0, 0, 0.5)","--text-primary":"#212529","--text-secondary":"#6C757D","--text-tertiary":"#ADB5BD","--text-inverse":"#FFFFFF","--text-muted":"#6C757D","--border-primary":"#DEE2E6","--border-secondary":"#E9ECEF","--border-accent":"#4B0082","--border-focus":"#4B0082","--success-color":"#28A745","--success-light":"#D4EDDA","--success-dark":"#1E7E34","--warning-color":"#FFC107","--warning-light":"#FFF3CD","--warning-dark":"#D39E00","--error-color":"#DC3545","--error-light":"#F8D7DA","--error-dark":"#C82333","--info-color":"#17A2B8","--info-light":"#D1ECF1","--info-dark":"#117A8B","--shadow-light":"rgba(0, 0, 0, 0.1)","--shadow-medium":"rgba(0, 0, 0, 0.15)","--shadow-heavy":"rgba(0, 0, 0, 0.25)","--card-background":"#FFFFFF","--card-border":"#E9ECEF","--input-background":"#FFFFFF","--input-border":"#DEE2E6","--input-focus":"#4B0082","--button-primary":"#4B0082","--button-secondary":"#6C757D","--button-text":"#FFFFFF","--navbar-background":"#FFFFFF","--navbar-border":"#E9ECEF","--sidebar-background":"#F8F9FA","--sidebar-border":"#E9ECEF","--menu-background":"#FFFFFF","--menu-hover":"#F8F9FA","--table-header":"#F8F9FA","--table-row":"#FFFFFF","--table-row-hover":"#F8F9FA","--table-border":"#E9ECEF","--modal-background":"#FFFFFF","--modal-overlay":"rgba(0, 0, 0, 0.5)","--modal-border":"#E9ECEF","--toast-background":"#FFFFFF","--toast-border":"#E9ECEF","--toast-shadow":"rgba(0, 0, 0, 0.15)","--chart-colors":["#4B0082","#8A2BE2","#B19CD9","#6A1B9A","#2D004D"],"--focus-ring":"rgba(75, 0, 130, 0.25)","--selection-background":"rgba(75, 0, 130, 0.2)","--scrollbar-track":"#F1F3F4","--scrollbar-thumb":"#C1C1C1","--scrollbar-thumb-hover":"#A8A8A8"}},dark:{name:"dark",displayName:"Sombre",icon:"\ud83c\udf19",description:"Th\xe8me sombre pour une utilisation nocturne",variables:{"--primary-color":"#8A2BE2","--primary-light":"#B19CD9","--primary-dark":"#4B0082","--secondary-color":"#B19CD9","--secondary-light":"#D4C4E8","--secondary-dark":"#8A2BE2","--background-primary":"#121212","--background-secondary":"#1E1E1E","--background-tertiary":"#2D2D2D","--background-elevated":"#2D2D2D","--background-overlay":"rgba(0, 0, 0, 0.7)","--text-primary":"#FFFFFF","--text-secondary":"#B0B0B0","--text-tertiary":"#808080","--text-inverse":"#121212","--text-muted":"#808080","--border-primary":"#404040","--border-secondary":"#2D2D2D","--border-accent":"#8A2BE2","--border-focus":"#8A2BE2","--success-color":"#4CAF50","--success-light":"#1B5E20","--success-dark":"#2E7D32","--warning-color":"#FF9800","--warning-light":"#E65100","--warning-dark":"#F57C00","--error-color":"#F44336","--error-light":"#B71C1C","--error-dark":"#D32F2F","--info-color":"#2196F3","--info-light":"#0D47A1","--info-dark":"#1976D2","--shadow-light":"rgba(0, 0, 0, 0.3)","--shadow-medium":"rgba(0, 0, 0, 0.4)","--shadow-heavy":"rgba(0, 0, 0, 0.6)","--card-background":"#2D2D2D","--card-border":"#404040","--input-background":"#1E1E1E","--input-border":"#404040","--input-focus":"#8A2BE2","--button-primary":"#8A2BE2","--button-secondary":"#404040","--button-text":"#FFFFFF","--navbar-background":"#1E1E1E","--navbar-border":"#404040","--sidebar-background":"#2D2D2D","--sidebar-border":"#404040","--menu-background":"#2D2D2D","--menu-hover":"#404040","--table-header":"#2D2D2D","--table-row":"#1E1E1E","--table-row-hover":"#2D2D2D","--table-border":"#404040","--modal-background":"#2D2D2D","--modal-overlay":"rgba(0, 0, 0, 0.7)","--modal-border":"#404040","--toast-background":"#2D2D2D","--toast-border":"#404040","--toast-shadow":"rgba(0, 0, 0, 0.4)","--chart-colors":["#8A2BE2","#B19CD9","#D4C4E8","#4B0082","#2D004D"],"--focus-ring":"rgba(138, 43, 226, 0.25)","--selection-background":"rgba(138, 43, 226, 0.2)","--scrollbar-track":"#2D2D2D","--scrollbar-thumb":"#404040","--scrollbar-thumb-hover":"#505050"}}},this.currentTheme=this.getStoredTheme()||"light",this.autoTheme=this.getStoredAutoTheme()||!0,this.systemTheme=this.detectSystemTheme(),this.init()}init(){this.applyTheme(this.currentTheme),this.listenToSystemThemeChanges(),this.listenToThemeChanges()}detectSystemTheme(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}getStoredTheme(){try{return localStorage.getItem("user_theme")||"light"}catch(e){return"light"}}setStoredTheme(e){try{localStorage.setItem("user_theme",e)}catch(t){}}getStoredAutoTheme(){try{const e=localStorage.getItem("user_auto_theme");return!e||JSON.parse(e)}catch(e){return!0}}setStoredAutoTheme(e){try{localStorage.setItem("user_auto_theme",JSON.stringify(e))}catch(t){}}setTheme(e){this.themes[e]||(e="light"),this.currentTheme=e,this.setStoredTheme(e),this.applyTheme(e),this.dispatchThemeChangeEvent()}setAutoTheme(e){this.autoTheme=e,this.setStoredAutoTheme(e),e&&(this.applyTheme(this.systemTheme),this.currentTheme=this.systemTheme)}applyTheme(e){const t=this.themes[e];if(!t)return;const s=document.documentElement;Object.entries(t.variables).forEach(e=>{let[t,r]=e;s.style.setProperty(t,r)}),s.setAttribute("data-theme",e),s.classList.remove("theme-light","theme-dark"),s.classList.add("theme-".concat(e))}getCurrentTheme(){return this.currentTheme}getCurrentThemeInfo(){return this.themes[this.currentTheme]}getAvailableThemes(){return Object.values(this.themes).map(e=>({name:e.name,displayName:e.displayName,icon:e.icon,description:e.description}))}isThemeSupported(e){return this.themes.hasOwnProperty(e)}getCSSVariable(e){const t=document.documentElement;return getComputedStyle(t).getPropertyValue(e)}setCSSVariable(e,t){document.documentElement.style.setProperty(e,t)}getAllCSSVariables(){const e=this.themes[this.currentTheme];return e?e.variables:{}}dispatchThemeChangeEvent(){const e=new CustomEvent("themeChanged",{detail:{theme:this.currentTheme,themeInfo:this.getCurrentThemeInfo(),autoTheme:this.autoTheme}});window.dispatchEvent(e)}listenToThemeChanges(){window.addEventListener("themeChanged",e=>{})}listenToSystemThemeChanges(){if(window.matchMedia){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{this.systemTheme=e.matches?"dark":"light",this.autoTheme&&(this.applyTheme(this.systemTheme),this.currentTheme=this.systemTheme,this.dispatchThemeChangeEvent())})}}applySystemTheme(){this.autoTheme&&(this.applyTheme(this.systemTheme),this.currentTheme=this.systemTheme,this.dispatchThemeChangeEvent())}getContrastRatio(e,t){return 4.5}checkAccessibility(){const e=this.getCurrentThemeInfo().variables;return{textContrast:this.getContrastRatio(e["--text-primary"],e["--background-primary"]),focusRing:void 0!==e["--focus-ring"],selectionBackground:void 0!==e["--selection-background"]}}generateCustomTheme(e){return{name:"custom",displayName:"Personnalis\xe9",icon:"\ud83c\udfa8",description:"Th\xe8me personnalis\xe9 g\xe9n\xe9r\xe9 automatiquement",variables:{"--primary-color":e}}}exportThemeConfig(){return{currentTheme:this.currentTheme,autoTheme:this.autoTheme,systemTheme:this.systemTheme,themeInfo:this.getCurrentThemeInfo(),cssVariables:this.getAllCSSVariables()}}importThemeConfig(e){try{return e.currentTheme&&this.setTheme(e.currentTheme),void 0!==e.autoTheme&&this.setAutoTheme(e.autoTheme),!0}catch(t){return!1}}resetTheme(){this.setTheme("light"),this.setAutoTheme(!0)}prepareForPrint(){Object.entries({"--background-primary":"#FFFFFF","--text-primary":"#000000","--border-primary":"#CCCCCC"}).forEach(e=>{let[t,s]=e;this.setCSSVariable(t,s)})}restoreAfterPrint(){this.applyTheme(this.currentTheme)}};s(54434),s(61549);s(63777),s(47946),s(27473);ue.A,me.A,he.A,i.A,$.A,Y.A,pe.A;var Ae=s(30342),ve=s(98914),ge=s(57488),xe=s(21281);const be=(0,M.Ay)(c.A)(e=>{let{theme:t}=e;return{height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.2s ease-in-out","&:hover":{transform:"translateY(-4px)"}}}),fe=(0,M.Ay)(u.A)(e=>{let{theme:t}=e;return{padding:t.spacing(2),textAlign:"center",height:"100%",minWidth:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:t.spacing(1)}}),ye=()=>{var e,t,s,c,M,Q;const{user:te,isAuthenticated:se}=(0,Ae.A)(),{id:re}=(0,o.g)(),{selectedChurch:ae}=(0,ve.w)();(0,a.useEffect)(()=>{i.A.init()},[]);const{canCreateGroups:ie,canUpdateGroups:ne,canDeleteGroups:le,canUpdateUsers:oe,isAdmin:ue,isManager:he,isSuperAdmin:pe,isCollecteurReseaux:ye}=(0,l.S)(),je={isAdmin:ue,isManager:he,isSuperAdmin:pe,isCollecteurReseaux:ye},_e=e=>!e&&je.isAdmin?i.A.t("dashboard.members.permissions.adminReadOnly"):!e&&je.isManager?i.A.t("dashboard.members.permissions.managerFullRights"):"",[we,Ce]=(0,a.useState)([]),[ke,Ee]=(0,a.useState)([]),[Se,Fe]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{try{var e,t;const[s,r]=await Promise.all([me.A.churches.getAll(),me.A.departments.getAll()]),a=(null===(e=s.data)||void 0===e?void 0:e.data)||s.data||[],i=(null===(t=r.data)||void 0===t?void 0:t.data)||r.data||[];Ce(Array.isArray(a)?a:[]),Ee(Array.isArray(i)?i:[])}catch(Se){Ce([]),Ee([])}})()},[]);const[Te,Ie]=(0,a.useState)(""),[De,Re]=(0,a.useState)(""),[We,Me]=(0,a.useState)(""),[Pe,Be]=(0,a.useState)(""),[qe,Le]=(0,a.useState)(""),[Ne,Oe]=(0,a.useState)(!1),[Ue,ze]=(0,a.useState)(!1),[Ge,Ve]=(0,a.useState)(!1),[He,Ke]=(0,a.useState)(!1),[Qe,Je]=(0,a.useState)(null),[Xe,Ze]=(0,a.useState)(null),[Ye,$e]=(0,a.useState)(!1),[et,tt]=(0,a.useState)(!1),[st,rt]=(0,a.useState)(!1),[at,it]=(0,a.useState)(!1),[nt,lt]=(0,a.useState)(!1),[ot,dt]=(0,a.useState)({open:!1,message:"",severity:"info"}),[ct,ut]=(0,a.useState)({username:"",pseudo:"",email:"",password:"",role:"MEMBRE",genre:"",tranche_age:"",profession:"",ville_residence:"",origine:"",situation_matrimoniale:"",niveau_education:"",departement:"",departement_ids:[],qualification:"",telephone:"",adresse:"",image:""}),[mt,ht]=(0,a.useState)(!1),[pt,At]=(0,a.useState)({username:"",pseudo:"",genre:"",tranche_age:"",profession:"",ville_residence:"",origine:"",situation_matrimoniale:"",niveau_education:"",departement:"",departement_ids:[],qualification:"",email:"",telephone:"",adresse:"",image:""}),[vt,gt]=(0,a.useState)(!1),[xt,bt]=(0,a.useState)(null),[ft,yt]=(0,a.useState)(null),[jt,_t]=(0,a.useState)(null),[wt,Ct]=(0,a.useState)(null);(0,a.useEffect)(()=>{},[pt]);const[kt,Et]=(0,a.useState)({reseau:{},stats:[],grs:[],members:{},available_users:[]}),[St,Ft]=(0,a.useState)(!0),[Tt,It]=(0,a.useState)([]),Dt=async()=>{try{if(!re)return void Fe(i.A.t("networks.details.missingNetworkId"));let n={};if(null!==ae&&void 0!==ae&&ae.id||null!==ae&&void 0!==ae&&ae._id){n={churchId:ae.id||ae._id}}else if(null!==te&&void 0!==te&&te.eglise_locale){let e;"object"===typeof te.eglise_locale?e=te.eglise_locale.id||te.eglise_locale._id:"string"===typeof te.eglise_locale&&(e=te.eglise_locale),e&&"undefined"!==e&&"null"!==e&&(n={churchId:e})}0===Object.keys(n).length&&je.isSuperAdmin&&(n={});let l={},o={},d=[],c=[],u=[];try{var e;const t=await me.A.networks.getById(re);l=(null===(e=t.data)||void 0===e?void 0:e.data)||t.data||{}}catch(Se){}try{var t;const e=await me.A.networks.getStatsById(re);o=(null===(t=e.data)||void 0===t?void 0:t.data)||e.data||{}}catch(Se){}try{var s;const e=await me.A.networks.getGroups(re);d=(null===(s=e.data)||void 0===s?void 0:s.data)||e.data||[]}catch(Se){}try{var r;const e=await me.A.networks.getMembers(re);c=(null===(r=e.data)||void 0===r?void 0:r.data)||e.data||[]}catch(Se){}if(Object.keys(n).length>0)try{var a;const e=await me.A.users.getAvailable(n);u=(null===(a=e.data)||void 0===a?void 0:a.data)||e.data||[]}catch(Se){}Et({reseau:l,stats:o,grs:Array.isArray(d)?d:[],members:Array.isArray(c)?c:[],available_users:Array.isArray(u)?u:[]})}catch(l){const e=(0,n.hS)(l,"erreur fetchdata:");Fe(e.message)}finally{Ft(!1)}};(0,a.useEffect)(()=>{Dt()},[re]),(0,a.useEffect)(()=>{if("SUPER_ADMIN"!==((null===te||void 0===te?void 0:te.current_role)||(null===te||void 0===te?void 0:te.role))){let e="";null!==ae&&void 0!==ae&&ae.id||null!==ae&&void 0!==ae&&ae._id?e=ae.id||ae._id:null!==te&&void 0!==te&&te.eglise_locale&&(e="object"===typeof te.eglise_locale?te.eglise_locale.id||te.eglise_locale._id:te.eglise_locale),e&&ut(t=>(0,r.A)((0,r.A)({},t),{},{eglise_locale:e}))}},[te,ae]),(0,a.useEffect)(()=>{if(Te||De){const e=Rt(Te,De);Le(e)}else Le("")},[Te,De,kt.available_users]);const Rt=(e,t)=>{if(!e)return"";const s=kt.available_users.find(t=>(t.id||t._id)===e),r=kt.available_users.find(e=>(e.id||e._id)===t);let a="";if(s?a=s.pseudo||s.username:r&&(a=r.pseudo||r.username),!a)return"";const i=a.replace(/[^a-zA-Z\xc0-\xff0-9\s]/g,"").replace(/\s+/g,"_").trim();return"GR_".concat(i)},[Wt,Mt]=(0,a.useState)(!1),[Pt,Bt]=(0,a.useState)(null),qt=async e=>{try{if(!Qe)return void dt({open:!0,message:i.A.t("networks.details.noGroupSelected"),severity:"error"});const m=Qe.id||Qe._id;if(!m)return void dt({open:!0,message:i.A.t("networks.details.invalidGroupId"),severity:"error"});if(He){var t,s,a,n,l,o;let h=e.image||"";if(xt)try{var d,c,u;const e=new FormData;e.append("image",xt);const t=await me.A.users.uploadProfileImage(e);if(h=(null===(d=t.data)||void 0===d||null===(c=d.data)||void 0===c?void 0:c.image)||(null===(u=t.data)||void 0===u?void 0:u.image),!h)throw new Error("URL de l'image non re\xe7ue")}catch(Se){return void ge.oR.error(i.A.t("errors.imageUploadFailed"))}const p=(0,r.A)((0,r.A)({},e),{},{password:e.password||i.A.t("auth.register.defaultPassword"),role:"MEMBRE",image:h});if("SUPER_ADMIN"!==((null===te||void 0===te?void 0:te.current_role)||(null===te||void 0===te?void 0:te.role))){let e="";null!==ae&&void 0!==ae&&ae.id||null!==ae&&void 0!==ae&&ae._id?e=ae.id||ae._id:null!==te&&void 0!==te&&te.eglise_locale&&(e="object"===typeof te.eglise_locale?te.eglise_locale.id||te.eglise_locale._id:te.eglise_locale),e&&(p.eglise_locale_id=e)}e.departement_ids&&e.departement_ids.length>0&&(p.departement_ids=e.departement_ids),delete p.eglise_locale,delete p.departement,Object.keys(p).forEach(e=>{""===p[e]&&(p[e]=null)});const A=await me.A.users.create(p),v=(null===(t=A.data)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.id)||(null===(a=A.data)||void 0===a||null===(n=a.data)||void 0===n?void 0:n._id)||(null===(l=A.data)||void 0===l?void 0:l.id)||(null===(o=A.data)||void 0===o?void 0:o._id);await me.A.groups.addMember(m,v)}else{if(!e.user_id)return void dt({open:!0,message:i.A.t("networks.details.missingMemberId"),severity:"error"});await me.A.groups.addMember(m,e.user_id)}Ve(!1),Ke(!1),Ze(null),ut({username:"",pseudo:"",email:"",password:"",role:"MEMBRE",genre:"",tranche_age:"",profession:"",ville_residence:"",origine:"",situation_matrimoniale:"",niveau_education:"",departement:"",departement_ids:[],qualification:"",telephone:"",adresse:"",image:""}),dt({open:!0,message:i.A.t("success.memberAdded"),severity:"success"}),await Dt()}catch(Se){var m,h,p,A,v;let t=i.A.t("errors.api.addMember");if(400===(null===(m=Se.response)||void 0===m?void 0:m.status)){var g,x,b,f;const s=null===(g=Se.response)||void 0===g||null===(x=g.data)||void 0===x?void 0:x.message;t=s||(null!==(b=Se.response)&&void 0!==b&&null!==(f=b.data)&&void 0!==f&&f.error?Se.response.data.error:i.A.t("errors.validation.invalidData"))}else if(409===(null===(h=Se.response)||void 0===h?void 0:h.status))t=i.A.t("errors.user.alreadyExists");else if(401===(null===(p=Se.response)||void 0===p?void 0:p.status)){var y,j;const s=(null===(y=Se.response)||void 0===y||null===(j=y.data)||void 0===j?void 0:j.message)||"";t=s.includes("droits")||s.includes("autoris\xe9")||s.includes("\xe9glise")?i.A.t("errors.permissions.addMember"):s.includes("token")||s.includes("expir\xe9")||s.includes("Non autoris\xe9")?i.A.t("errors.session.expired"):s||i.A.t("errors.authorization")}else if(403===(null===(A=Se.response)||void 0===A?void 0:A.status))t=i.A.t("errors.permissions.addMember");else if(500===(null===(v=Se.response)||void 0===v?void 0:v.status)){var _,w,C,k;const s=(null===(_=Se.response)||void 0===_||null===(w=_.data)||void 0===w?void 0:w.error)||(null===(C=Se.response)||void 0===C||null===(k=C.data)||void 0===k?void 0:k.message);t=s?"Erreur serveur: ".concat(s):i.A.t("errors.server.internal")}else Se.message&&!Se.message.includes("Request failed with status code")&&(t=Se.message);dt({open:!0,message:t,severity:"error"})}},[Lt,Nt]=(0,a.useState)(!1),[Ot,Ut]=(0,a.useState)({grId:null,userId:null});return St?(0,X.jsx)(V.A,{titre:i.A.t("networks.details.loading")}):Se?(0,X.jsx)(H.A,{error:Se,title:i.A.t("errors.loading")}):se?(0,X.jsx)(d.A,{allowedRoles:["SUPER_ADMIN","ADMIN","MANAGER","COLLECTEUR_RESEAUX"],children:(0,X.jsxs)(m.A,{sx:{minHeight:"100vh",bgcolor:"background.default"},children:[(0,X.jsx)(G.A,{}),(0,X.jsxs)(p.A,{maxWidth:"lg",sx:{mt:4,mb:4},children:[(0,X.jsxs)(m.A,{display:"flex",justifyContent:"space-between",mb:2,children:[(0,X.jsxs)(h.A,{variant:"h4",sx:{mb:4,color:"primary.main",fontWeight:"bold"},children:[i.A.t("networks.details.title")," - ",kt.reseau.nom]}),(0,X.jsx)(m.A,{display:"flex",alignItems:"center",children:(0,X.jsx)(A.A,{title:i.A.t("common.actions.refresh"),children:(0,X.jsx)(v.A,{color:"primary",onClick:Dt,sx:{border:"1px solid #ddd",bgcolor:"#fff","&:hover":{bgcolor:"#f5f5f5"}},children:(0,X.jsx)(P.A,{})})})})]}),(0,X.jsxs)(u.A,{"data-aos":"fade-up",sx:{p:3,mb:4},children:[(0,X.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,X.jsx)(h.A,{variant:"h5",children:i.A.t("networks.details.networkResponsibles")}),(je.isAdmin||je.isSuperAdmin||je.isCollecteurReseaux||je.isManager)&&(0,X.jsxs)(m.A,{sx:{display:"flex",gap:2},children:[(0,X.jsx)(g.A,{variant:"contained",startIcon:(0,X.jsx)(B.A,{}),onClick:()=>$e(!0),sx:{backgroundColor:"#2E7D32","&:hover":{backgroundColor:"#1B5E20"}},children:i.A.t("previsionnel.button.create")}),(0,X.jsx)(g.A,{variant:"contained",startIcon:(0,X.jsx)(q.A,{}),onClick:()=>tt(!0),sx:{backgroundColor:"#1976d2","&:hover":{backgroundColor:"#1565c0"}},children:i.A.t("assistance.form.save")}),(0,X.jsx)(g.A,{variant:"outlined",startIcon:(0,X.jsx)(L.A,{}),onClick:()=>rt(!0),sx:{borderColor:"#FF9800",color:"#FF9800","&:hover":{borderColor:"#F57C00",backgroundColor:"#FFF3E0"}},children:i.A.t("common.history")})]})]}),(0,X.jsxs)(x.A,{container:!0,spacing:2,children:[(0,X.jsx)(x.A,{item:!0,xs:12,md:6,children:(0,X.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,X.jsx)(N.A,{}),(0,X.jsxs)(m.A,{children:[(0,X.jsx)(h.A,{variant:"subtitle2",children:i.A.t("networks.details.responsable1")}),(0,X.jsx)(h.A,{children:null===(e=kt.reseau.responsable1)||void 0===e?void 0:e.username})]})]})}),(null===(t=kt.reseau.responsable2)||void 0===t?void 0:t.username)&&(0,X.jsx)(x.A,{item:!0,xs:12,md:6,children:(0,X.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,X.jsx)(N.A,{}),(0,X.jsxs)(m.A,{children:[(0,X.jsx)(h.A,{variant:"subtitle2",children:i.A.t("networks.details.responsable2")}),(0,X.jsx)(h.A,{children:null===(s=kt.reseau.responsable2)||void 0===s?void 0:s.username})]})]})})]})]}),(0,X.jsxs)(u.A,{"data-aos":"fade-up",sx:{p:3,mb:4},children:[(0,X.jsx)(h.A,{variant:"h5",gutterBottom:!0,children:i.A.t("networks.details.statistics")}),(0,X.jsxs)(x.A,{container:!0,spacing:2,children:[(zt=kt.stats||{},[{key:"12",label:"12",value:zt[12]||0},{key:"144",label:"144",value:zt[144]||0},{key:"1728",label:"1728",value:zt[1728]||0},{key:"totalGroups",label:i.A.t("networks.details.stats.totalGroups"),value:zt.totalGroups||0},{key:"Responsables de GR",label:i.A.t("networks.details.stats.groupResponsibles"),value:zt["Responsables de GR"]||0},{key:"Leader",label:i.A.t("networks.details.stats.leaders"),value:zt.Leader||0},{key:"Leader (Tous)",label:i.A.t("networks.details.stats.allLeaders"),value:zt["Leader (Tous)"]||0},{key:"Membre simple",label:i.A.t("networks.details.stats.simpleMembers"),value:zt["Membre simple"]||0}].filter(e=>e.value>0)).map((e,t)=>(0,X.jsx)(x.A,{item:!0,xs:6,sm:4,md:2,children:(0,X.jsxs)(fe,{children:[(0,X.jsx)(h.A,{variant:"body2",sx:{mb:1},children:e.label}),(0,X.jsx)(h.A,{variant:"h4",color:"primary",children:e.value})]})},t)),(0,X.jsx)(x.A,{item:!0,xs:6,sm:4,md:2,children:(0,X.jsxs)(fe,{children:[(0,X.jsx)(h.A,{variant:"body2",sx:{mb:1},children:i.A.t("networks.details.groupesReveil")}),(0,X.jsx)(h.A,{variant:"h4",color:"primary",children:kt.grs.length})]})}),(0,X.jsx)(x.A,{item:!0,xs:6,sm:4,md:2,children:(0,X.jsxs)(fe,{children:[(0,X.jsx)(h.A,{variant:"body2",sx:{mb:1},children:i.A.t("networks.details.effectifTotal")}),(0,X.jsx)(h.A,{variant:"h4",color:"primary",children:((e,t,s,r,a,i,n,l,o)=>{const d=new Set;null===(e=kt.grs)||void 0===e||e.forEach(e=>{var t;null===(t=e.members)||void 0===t||t.forEach(e=>{var t,s;const r=(null===e||void 0===e?void 0:e.id)||(null===e||void 0===e?void 0:e._id)||(null===e||void 0===e||null===(t=e.user)||void 0===t?void 0:t.id)||(null===e||void 0===e||null===(s=e.user)||void 0===s?void 0:s._id);r&&d.add(r)})});const c=(null===(t=kt.reseau)||void 0===t||null===(s=t.responsable1)||void 0===s?void 0:s.id)||(null===(r=kt.reseau)||void 0===r||null===(a=r.responsable1)||void 0===a?void 0:a._id),u=(null===(i=kt.reseau)||void 0===i||null===(n=i.responsable2)||void 0===n?void 0:n.id)||(null===(l=kt.reseau)||void 0===l||null===(o=l.responsable2)||void 0===o?void 0:o._id);return c&&d.add(c),u&&d.add(u),d.size})()})]})})]})]}),(0,X.jsxs)(m.A,{"data-aos":"fade-up",sx:{mb:4},children:[(0,X.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,X.jsx)(h.A,{variant:"h5",children:i.A.t("networks.details.groupesReveil")}),(je.isAdmin||je.isSuperAdmin||je.isCollecteurReseaux)&&(0,X.jsx)(g.A,{variant:"contained",startIcon:(0,X.jsx)(O.A,{}),onClick:()=>Oe(!0),disabled:!ie,title:_e(ie),children:i.A.t("networks.details.addGR")})]}),(0,X.jsx)(x.A,{container:!0,sx:{mx:"auto"},alignItems:"stretch",children:(Array.isArray(kt.grs)?kt.grs:[]).map(e=>{var t,s,r,a,n,l,o,d,c,u;return(0,X.jsx)(x.A,{"data-aos":"fade-up",sx:{width:"100%",padding:"10px 10px 10px 10px","@media (min-width:500px) and (max-width:849px)":{width:"50%"},"@media (min-width:850px) and (max-width:1199px)":{width:"33.33%"},"@media (min-width:1200px) and (max-width:1599px)":{width:"25%"},"@media (min-width:1600px)":{width:"20%"}},children:(0,X.jsxs)(be,{children:[(0,X.jsxs)(b.A,{children:[(0,X.jsxs)(m.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,X.jsxs)(h.A,{variant:"h6",children:["GR ",null===(t=e.responsable1)||void 0===t||null===(s=t.username)||void 0===s?void 0:s.split(" ")[0],(null===(r=e.responsable2)||void 0===r?void 0:r.username)&&" & ".concat(null===(a=e.responsable2)||void 0===a||null===(n=a.username)||void 0===n?void 0:n.split(" ")[0])]}),(je.isAdmin||je.isSuperAdmin||je.isCollecteurReseaux)&&(0,X.jsxs)(m.A,{children:[(0,X.jsx)(v.A,{color:"primary",onClick:()=>{Je(e),ze(!0)},disabled:!ne,title:_e(ne),children:(0,X.jsx)(U.A,{})}),(0,X.jsx)(v.A,{color:"error",onClick:()=>{return t=e.id,Bt(t),void Mt(!0);var t},disabled:!le,title:_e(le),children:(0,X.jsx)(z.A,{})})]})]}),(0,X.jsxs)(m.A,{sx:{mb:2},children:[(0,X.jsx)(h.A,{variant:"subtitle2",children:i.A.t("networks.details.responsable1")}),(0,X.jsx)(h.A,{children:null===(l=e.responsable1)||void 0===l?void 0:l.username}),(null===(o=e.responsable2)||void 0===o?void 0:o.username)&&(0,X.jsxs)(X.Fragment,{children:[(0,X.jsx)(h.A,{variant:"subtitle2",sx:{mt:1},children:i.A.t("networks.details.responsable2")}),(0,X.jsx)(h.A,{children:null===(d=e.responsable2)||void 0===d?void 0:d.username})]}),(0,X.jsxs)(h.A,{sx:{mt:1},children:[(0,X.jsx)("strong",{children:i.A.t("networks.details.nombreMembres")})," ",null===(c=e.members)||void 0===c?void 0:c.length]})]}),null===(u=e.members)||void 0===u?void 0:u.map(t=>{var s,r,a;const n=null===(s=kt.members)||void 0===s?void 0:s.find(e=>{var s,r,a,i;return((null===(s=e.user)||void 0===s?void 0:s.id)||(null===(r=e.user)||void 0===r?void 0:r._id))===((null===(a=t.user)||void 0===a?void 0:a.id)||(null===(i=t.user)||void 0===i?void 0:i._id))}),l=(null===n||void 0===n?void 0:n.user)||t.user||{};return(0,X.jsxs)(m.A,{sx:{p:1,mb:1,borderRadius:1,bgcolor:"background.default",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,X.jsxs)(h.A,{children:[l.username||i.A.t("common_text.unknownName")," (",(0,X.jsx)(h.A,{component:"span",variant:"caption",sx:{fontWeight:"bold",fontSize:"0.9rem"},children:(0,xe.B)(l.qualification,i.A.t("common.unknown"))}),")"]}),(je.isAdmin||je.isCollecteurReseaux||je.isSuperAdmin)&&(0,X.jsxs)(m.A,{children:[(0,X.jsx)(v.A,{size:"small",onClick:()=>{var e;Ze(l.id||l._id),At({username:l.username||"",pseudo:l.pseudo||"",genre:l.genre||"",tranche_age:l.tranche_age||"",profession:l.profession||"",ville_residence:l.ville_residence||"",origine:l.origine||"",situation_matrimoniale:l.situation_matrimoniale||"",niveau_education:l.niveau_education||"",departement:l.departement||"",departement_ids:(null===(e=l.user_departments)||void 0===e?void 0:e.map(e=>e.department_id))||[],qualification:l.qualification||"",email:l.email||"",telephone:l.telephone||"",adresse:l.adresse||"",image:l.image||""}),setTimeout(()=>{},100),ht(!0)},disabled:!oe,title:_e(oe),children:(0,X.jsx)(U.A,{})}),(0,X.jsx)(v.A,{size:"small",color:"error",onClick:()=>{return t=e.id,s=l.id||l._id,Ut({grId:t,userId:s}),void Nt(!0);var t,s},disabled:!ne,title:_e(ne),children:(0,X.jsx)(z.A,{})})]})]},(null===(r=t.user)||void 0===r?void 0:r.id)||(null===(a=t.user)||void 0===a?void 0:a._id)||t._id||"member-".concat(Math.random()))})]}),(0,X.jsx)(f.A,{sx:{mt:"auto",p:2},children:(je.isAdmin||je.isCollecteurReseaux||je.isSuperAdmin)&&(0,X.jsx)(g.A,{fullWidth:!0,variant:"contained",onClick:()=>{Je(e),Ve(!0)},disabled:!ne,title:_e(ne),children:i.A.t("networks.details.addMember")})})]})},e.id)})})]}),(0,X.jsxs)(y.A,{open:Ne,onClose:()=>Oe(!1),children:[(0,X.jsx)(j.A,{children:i.A.t("networks.details.addGroupDialog")}),(0,X.jsx)(_.A,{children:(0,X.jsxs)(m.A,{component:"form",sx:{pt:2},children:[(0,X.jsx)(w.A,{select:!0,fullWidth:!0,label:i.A.t("networks.details.responsable1"),sx:{mb:2},required:!0,value:Te||"",onChange:e=>Ie(e.target.value),children:kt.available_users.map(e=>(0,X.jsx)(C.A,{value:e.id||e._id,children:e.username},e.id||e._id))}),(0,X.jsxs)(w.A,{select:!0,fullWidth:!0,label:i.A.t("networks.details.responsable2Disabled"),sx:{mb:2},value:De||"",onChange:e=>Re(e.target.value),disabled:!0,InputProps:{style:{backgroundColor:"#f5f5f5",color:"#666"}},helperText:i.A.t("common.actions.fieldTemporarilyDisabled"),children:[(0,X.jsx)(C.A,{value:"",children:i.A.t("common.actions.none")}),kt.available_users.filter(e=>e._id!==Te).map(e=>(0,X.jsx)(C.A,{value:e.id||e._id,children:e.username},e.id||e._id))]}),(0,X.jsxs)(w.A,{select:!0,fullWidth:!0,label:i.A.t("networks.details.responsibleQualification"),sx:{mb:2},required:!0,value:We||"",onChange:e=>Me(e.target.value),helperText:i.A.t("networks.details.qualificationAutoAssigned"),children:[(0,X.jsx)(C.A,{value:"QUALIFICATION_12",children:"12"}),(0,X.jsx)(C.A,{value:"QUALIFICATION_144",children:"144"}),(0,X.jsx)(C.A,{value:"QUALIFICATION_1728",children:"1728"}),(0,X.jsx)(C.A,{value:"QUALIFICATION_20738",children:"20738"}),(0,X.jsx)(C.A,{value:"QUALIFICATION_248832",children:"248832"})]}),(0,X.jsxs)(w.A,{select:!0,fullWidth:!0,label:i.A.t("networks.details.superior"),sx:{mb:2},value:Pe||"",onChange:e=>Be(e.target.value),helperText:i.A.t("networks.details.selectSuperior"),children:[(0,X.jsx)(C.A,{value:"",children:i.A.t("networks.details.noSuperior")}),(null===(c=kt.reseau)||void 0===c?void 0:c.responsable1)&&(0,X.jsxs)(C.A,{value:kt.reseau.responsable1.id||kt.reseau.responsable1._id,children:[kt.reseau.responsable1.username," - ",i.A.t("networks.details.networkResponsible")]}),(null===(M=kt.reseau)||void 0===M?void 0:M.responsable2)&&(0,X.jsxs)(C.A,{value:kt.reseau.responsable2.id||kt.reseau.responsable2._id,children:[kt.reseau.responsable2.username," - ",i.A.t("networks.details.networkResponsible")]}),null===(Q=kt.grs)||void 0===Q?void 0:Q.map(e=>{var t,s,r;return(0,X.jsxs)(C.A,{value:(null===(t=e.responsable1)||void 0===t?void 0:t.id)||(null===(s=e.responsable1)||void 0===s?void 0:s._id),children:[null===(r=e.responsable1)||void 0===r?void 0:r.username," - ",e.qualification||i.A.t("networks.details.group")]},e.id||e._id)})]}),(0,X.jsx)(w.A,{fullWidth:!0,label:i.A.t("networks.details.nomGroupe"),sx:{mb:2},value:qe||"",InputProps:{readOnly:!0},placeholder:i.A.t("networks.details.nameAutoGenerated"),helperText:i.A.t("networks.details.nameGeneratedFromResponsible")})]})}),(0,X.jsxs)(k.A,{children:[(0,X.jsx)(g.A,{onClick:()=>Oe(!1),children:i.A.t("networks.details.cancel")}),(0,X.jsx)(g.A,{variant:"contained",onClick:()=>(async e=>{try{const t=(0,r.A)((0,r.A)({},e),{},{network_id:re,responsable1_id:Te,qualification:We,superieur_hierarchique_id:Pe||null});De&&(t.responsable2_id=De),await me.A.groups.create(t),Oe(!1),dt({open:!0,message:i.A.t("success.groupCreated"),severity:"success"}),await Dt(),Ie(null),Re(null),Me(""),Be(""),Le("")}catch(Se){var t,s;if(401===(null===(t=Se.response)||void 0===t?void 0:t.status)){var a,n;const t=(null===(a=Se.response)||void 0===a||null===(n=a.data)||void 0===n?void 0:n.message)||"";t.includes("droits")||t.includes("autoris\xe9")||t.includes("\xe9glise")?dt({open:!0,message:i.A.t("errors.permissions.insufficient"),severity:"warning"}):t.includes("token")||t.includes("expir\xe9")||t.includes("Non autoris\xe9")?dt({open:!0,message:i.A.t("errors.session.expired"),severity:"warning"}):dt({open:!0,message:t||i.A.t("errors.authorization"),severity:"warning"})}else if(403===(null===(s=Se.response)||void 0===s?void 0:s.status)){var l,o;dt({open:!0,message:(null===(l=Se.response)||void 0===l||null===(o=l.data)||void 0===o?void 0:o.message)||i.A.t("errors.accessDenied"),severity:"warning"})}else{var d,c;dt({open:!0,message:(null===(d=Se.response)||void 0===d||null===(c=d.data)||void 0===c?void 0:c.message)||i.A.t("errors.api.createGroup"),severity:"error"})}}})({responsable1:Te,responsable2:De,qualification:We,superieur_hierarchique:Pe}),disabled:!ie||!Te||!We,title:_e(ie),children:i.A.t("common.actions.add")})]})]}),(0,X.jsxs)(y.A,{open:Ge,onClose:()=>{Ve(!1),Ke(!1),gt(!1),ut({username:"",pseudo:"",email:"",password:"",role:"MEMBRE",genre:"",tranche_age:"",profession:"",ville_residence:"",origine:"",situation_matrimoniale:"",niveau_education:"",departement:"",departement_ids:[],qualification:"",telephone:"",adresse:"",image:""})},maxWidth:"sm",fullWidth:!0,children:[(0,X.jsx)(j.A,{children:i.A.t("networks.details.addMember")}),(0,X.jsxs)(_.A,{children:[(0,X.jsxs)(m.A,{sx:{pt:2,mb:2},children:[(0,X.jsx)(g.A,{variant:He?"outlined":"contained",onClick:()=>Ke(!1),sx:{mr:1},disabled:!ne,title:_e(ie),children:i.A.t("networks.details.selectExistingMember")}),(0,X.jsx)(g.A,{variant:He?"contained":"outlined",onClick:()=>Ke(!0),disabled:!ne,title:_e(ie),children:i.A.t("networks.details.createNewMember")})]}),(0,X.jsx)(m.A,{component:"form",sx:{pt:2},children:He?(0,X.jsxs)(X.Fragment,{children:[(0,X.jsx)(w.A,{fullWidth:!0,label:i.A.t("auth.register.username"),value:ct.username,onChange:e=>ut((0,r.A)((0,r.A)({},ct),{},{username:e.target.value})),sx:{mb:2},required:!0,disabled:!ne,title:_e(ie)}),(0,X.jsx)(w.A,{fullWidth:!0,label:i.A.t("auth.register.pseudo"),value:ct.pseudo,onChange:e=>ut((0,r.A)((0,r.A)({},ct),{},{pseudo:e.target.value})),sx:{mb:2},required:!0,disabled:!ne,title:_e(ie)}),(0,X.jsx)(w.A,{fullWidth:!0,label:i.A.t("auth.register.email"),type:"email",value:ct.email,onChange:e=>ut((0,r.A)((0,r.A)({},ct),{},{email:e.target.value})),sx:{mb:2},required:!0,disabled:!ne,title:_e(ie)}),(0,X.jsx)(w.A,{fullWidth:!0,label:i.A.t("auth.register.telephone"),value:ct.telephone,onChange:e=>ut((0,r.A)((0,r.A)({},ct),{},{telephone:e.target.value})),sx:{mb:2},required:!0,disabled:!ne,title:_e(ie)}),(0,X.jsx)(w.A,{fullWidth:!0,label:i.A.t("auth.register.adresse"),value:ct.adresse,onChange:e=>ut((0,r.A)((0,r.A)({},ct),{},{adresse:e.target.value})),sx:{mb:2},disabled:!ne,title:_e(ie)}),(0,X.jsxs)(m.A,{sx:{mb:2},children:[(0,X.jsx)(h.A,{variant:"subtitle2",sx:{mb:1},children:i.A.t("auth.register.profileImage")}),(ct.image||ft)&&(0,X.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,X.jsx)("img",{src:ft||ct.image,alt:"Aper\xe7u",style:{width:60,height:60,borderRadius:"50%",objectFit:"cover",marginRight:16}}),(0,X.jsx)(g.A,{size:"small",color:"error",onClick:()=>{bt(null),yt(null),ut(e=>(0,r.A)((0,r.A)({},e),{},{image:""}))},disabled:!ne,children:i.A.t("common.actions.remove")})]}),(0,X.jsxs)(g.A,{variant:"outlined",component:"label",disabled:!ne,sx:{mb:1},children:[i.A.t("auth.register.selectImage"),(0,X.jsx)("input",{type:"file",hidden:!0,accept:"image/*",onChange:e=>{const t=e.target.files[0];if(t){if(!t.type.startsWith("image/"))return void ge.oR.error(i.A.t("errors.validation.invalidImageType"));if(t.size>5242880)return void ge.oR.error(i.A.t("errors.validation.imageTooLarge"));bt(t);const e=new FileReader;e.onload=e=>{yt(e.target.result)},e.readAsDataURL(t)}}})]})]}),(0,X.jsx)(w.A,{select:!0,fullWidth:!0,label:i.A.t("auth.register.genre"),value:ct.genre,onChange:e=>ut((0,r.A)((0,r.A)({},ct),{},{genre:e.target.value})),sx:{mb:2},required:!0,disabled:!ne,title:_e(ie),children:J.xG.map(e=>(0,X.jsx)(C.A,{value:e.value,children:e.label},e.value))}),(0,X.jsx)(w.A,{select:!0,fullWidth:!0,label:i.A.t("auth.register.ageRange"),value:ct.tranche_age,onChange:e=>ut((0,r.A)((0,r.A)({},ct),{},{tranche_age:e.target.value})),sx:{mb:2},required:!0,disabled:!ne,title:_e(ie),children:J.T.map(e=>(0,X.jsx)(C.A,{value:e.value,children:e.label},e.value))}),(0,X.jsx)(w.A,{fullWidth:!0,label:i.A.t("auth.register.profession"),value:ct.profession,onChange:e=>ut((0,r.A)((0,r.A)({},ct),{},{profession:e.target.value})),sx:{mb:2},required:!0,disabled:!ne,title:_e(ie)}),(0,X.jsx)(w.A,{fullWidth:!0,label:i.A.t("auth.register.villeResidence"),value:ct.ville_residence,onChange:e=>ut((0,r.A)((0,r.A)({},ct),{},{ville_residence:e.target.value})),sx:{mb:2},required:!0,disabled:!ne,title:_e(ie)}),(0,X.jsx)(w.A,{select:!0,fullWidth:!0,label:i.A.t("auth.register.originCountry"),value:ct.origine,onChange:e=>ut((0,r.A)((0,r.A)({},ct),{},{origine:e.target.value})),sx:{mb:2},required:!0,disabled:!ne,title:_e(ie),children:ce.F.map(e=>(0,X.jsx)(C.A,{value:e.value,children:e.label},e.value))}),(0,X.jsx)(w.A,{select:!0,fullWidth:!0,label:i.A.t("auth.register.situationMatrimoniale"),value:ct.situation_matrimoniale,onChange:e=>ut((0,r.A)((0,r.A)({},ct),{},{situation_matrimoniale:e.target.value})),sx:{mb:2},required:!0,disabled:!ne,title:_e(ie),children:J.LA.map(e=>(0,X.jsx)(C.A,{value:e.value,children:e.label},e.value))}),(0,X.jsx)(w.A,{select:!0,fullWidth:!0,label:i.A.t("auth.register.educationLevel"),value:ct.niveau_education,onChange:e=>ut((0,r.A)((0,r.A)({},ct),{},{niveau_education:e.target.value})),sx:{mb:2},required:!0,disabled:!ne,title:_e(ie),children:J.RD.map(e=>(0,X.jsx)(C.A,{value:e.value,children:e.label},e.value))}),(0,X.jsx)(w.A,{select:!0,fullWidth:!0,label:i.A.t("auth.register.qualification"),value:ct.qualification,onChange:e=>ut((0,r.A)((0,r.A)({},ct),{},{qualification:e.target.value})),required:!0,disabled:!ne,title:_e(ie),children:J.Ls.filter(e=>![i.A.t("qualifications.governance"),i.A.t("qualifications.networkResponsible"),i.A.t("qualifications.ecodim"),i.A.t("qualifications.ecodimResponsible")].includes(e.value)).map(e=>(0,X.jsx)(C.A,{value:e.value,children:e.label},e.value))}),(0,X.jsx)(E.A,{control:(0,X.jsx)(S.A,{checked:vt,onChange:e=>gt(e.target.checked),disabled:!ne,title:_e(ie)}),label:i.A.t("networks.details.sertDepartement"),sx:{mb:2}}),vt&&(0,X.jsxs)(F.A,{fullWidth:!0,sx:{mb:2},disabled:!ne,children:[(0,X.jsx)(T.A,{children:i.A.t("auth.register.departments")}),(0,X.jsx)(I.A,{multiple:!0,value:ct.departement_ids||[],onChange:e=>ut((0,r.A)((0,r.A)({},ct),{},{departement_ids:e.target.value})),renderValue:e=>(0,X.jsx)(m.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(e=>{const t=ke.find(t=>(t.id||t._id)===e);return(0,X.jsx)(D.A,{label:t?t.nom:e,size:"small"},e)})}),children:ke.map(e=>(0,X.jsx)(C.A,{value:e.id||e._id,children:e.nom},e.id||e._id))})]})]}):(0,X.jsx)(w.A,{select:!0,fullWidth:!0,label:i.A.t("networks.details.selectMember"),value:Xe||"",onChange:e=>{Ze(e.target.value)},required:!0,disabled:!ne,title:_e(ie),children:kt.available_users.filter(e=>![i.A.t("qualifications.governance"),i.A.t("qualifications.networkResponsible"),i.A.t("qualifications.ecodim"),i.A.t("qualifications.ecodimResponsible")].includes(e.qualification)).map(e=>(0,X.jsxs)(C.A,{value:e.id||e._id,children:[e.username," (",(0,X.jsx)(h.A,{component:"span",variant:"caption",sx:{fontWeight:"bold",fontSize:"0.75rem"},children:(0,xe.B)(e.qualification)}),")"]},e.id||e._id))})})]}),(0,X.jsxs)(k.A,{children:[(0,X.jsx)(g.A,{onClick:()=>{let e="";"SUPER_ADMIN"!==((null===te||void 0===te?void 0:te.current_role)||(null===te||void 0===te?void 0:te.role))&&(null!==ae&&void 0!==ae&&ae.id||null!==ae&&void 0!==ae&&ae._id?e=ae.id||ae._id:null!==te&&void 0!==te&&te.eglise_locale&&(e="object"===typeof te.eglise_locale?te.eglise_locale.id||te.eglise_locale._id:te.eglise_locale)),Ve(!1),Ke(!1),ut({username:"",pseudo:"",email:"",password:"",role:"MEMBRE",genre:"",tranche_age:"",profession:"",ville_residence:"",origine:"",situation_matrimoniale:"",niveau_education:"",eglise_locale:e,departement:"",departement_ids:[],qualification:"",telephone:"",adresse:"",image:""})},children:i.A.t("networks.details.cancel")}),(0,X.jsx)(g.A,{variant:"contained",onClick:e=>{if(He)qt(ct);else{if(!Xe)return void dt({open:!0,message:i.A.t("networks.details.selectMember"),severity:"error"});qt({user_id:Xe})}},disabled:!ne||(He?!ct.username||!ct.email||!ct.qualification:!Xe),title:_e(ie),children:i.A.t("networks.details.addMember")})]})]}),(0,X.jsxs)(y.A,{open:Ue,onClose:()=>ze(!1),onEnter:async()=>{if(Qe)try{var e;const t=Qe.id||Qe._id;if(!t)return void dt({open:!0,message:i.A.t("networks.details.invalidGroupId"),severity:"error"});const s=await me.A.groups.getById(t),r=(null===(e=s.data)||void 0===e?void 0:e.data)||s.data||{};Ie(r.responsable1?"object"===typeof r.responsable1?r.responsable1.id||r.responsable1._id:r.responsable1:""),Re(r.responsable2?"object"===typeof r.responsable2?r.responsable2.id||r.responsable2._id:r.responsable2:"")}catch(t){Ie(""),Re(""),dt({open:!0,message:i.A.t("errors.api.getGroup"),severity:"error"})}},children:[(0,X.jsx)(j.A,{children:i.A.t("networks.details.editGR")}),(0,X.jsx)(_.A,{children:(0,X.jsxs)(m.A,{component:"form",sx:{pt:2},children:[(0,X.jsx)(w.A,{select:!0,fullWidth:!0,label:i.A.t("networks.details.responsable1"),value:Te,onChange:e=>Ie(e.target.value),sx:{mb:2,minWidth:250},required:!0,children:kt.available_users.map(e=>(0,X.jsxs)(C.A,{value:e.id||e._id,children:[e.username," (",(0,X.jsx)(h.A,{component:"span",variant:"caption",sx:{fontWeight:"bold",fontSize:"0.75rem"},children:(0,xe.B)(e.qualification)}),")"]},e.id||e._id))}),(0,X.jsxs)(w.A,{select:!0,fullWidth:!0,label:i.A.t("networks.details.responsable2"),value:De,onChange:e=>Re(e.target.value),sx:{mb:2,minWidth:250},disabled:!0,InputProps:{style:{backgroundColor:"#f5f5f5",color:"#666"}},helperText:i.A.t("common.actions.fieldTemporarilyDisabled"),children:[(0,X.jsx)(C.A,{value:"",children:i.A.t("common.actions.none")}),kt.available_users.map(e=>(0,X.jsxs)(C.A,{value:e.id||e._id,children:[e.username," (",(0,X.jsx)(h.A,{component:"span",variant:"caption",sx:{fontWeight:"bold",fontSize:"0.75rem"},children:(0,xe.B)(e.qualification)}),")"]},e.id||e._id))]})]})}),(0,X.jsxs)(k.A,{children:[(0,X.jsx)(g.A,{onClick:()=>{ze(!1),Ie(""),Re("")},children:i.A.t("networks.details.cancel")}),(0,X.jsx)(g.A,{variant:"contained",onClick:()=>{const e=(null===Qe||void 0===Qe?void 0:Qe.id)||(null===Qe||void 0===Qe?void 0:Qe._id);if(!e)return void dt({open:!0,message:i.A.t("networks.details.invalidGroupId"),severity:"error"});(async e=>{try{const t=e.id||e._id;if(!t)return void dt({open:!0,message:i.A.t("networks.details.invalidGroupId"),severity:"error"});await me.A.groups.update(t,e),ze(!1),Je(null),dt({open:!0,message:i.A.t("success.groupUpdated"),severity:"success"}),await Dt()}catch(Se){dt({open:!0,message:i.A.t("errors.api.updateGroup"),severity:"error"})}})({id:e,responsable1_id:Te,responsable2_id:De||null})},color:"primary",disabled:!ne||!Te,title:_e(ne),children:i.A.t("common.actions.edit")})]})]}),(0,X.jsxs)(y.A,{open:mt,onClose:()=>ht(!1),maxWidth:"sm",fullWidth:!0,children:[(0,X.jsx)(j.A,{children:i.A.t("networks.details.editMember")}),(0,X.jsx)(_.A,{children:(0,X.jsxs)(m.A,{component:"form",sx:{pt:2},children:[(0,X.jsx)(w.A,{fullWidth:!0,label:i.A.t("networks.details.username"),value:pt.username,onChange:e=>At((0,r.A)((0,r.A)({},pt),{},{username:e.target.value})),sx:{mb:2},required:!0,disabled:!oe,title:_e(oe)}),(0,X.jsx)(w.A,{fullWidth:!0,label:i.A.t("networks.details.pseudo"),value:pt.pseudo,onChange:e=>At((0,r.A)((0,r.A)({},pt),{},{pseudo:e.target.value})),sx:{mb:2},disabled:!oe,title:_e(oe)}),(0,X.jsx)(w.A,{fullWidth:!0,label:i.A.t("networks.details.email"),value:pt.email,onChange:e=>At((0,r.A)((0,r.A)({},pt),{},{email:e.target.value})),sx:{mb:2},disabled:!oe,title:_e(oe)}),(0,X.jsx)(w.A,{fullWidth:!0,label:i.A.t("networks.details.telephone"),value:pt.telephone,onChange:e=>At((0,r.A)((0,r.A)({},pt),{},{telephone:e.target.value})),sx:{mb:2},disabled:!oe,title:_e(oe)}),(0,X.jsx)(w.A,{fullWidth:!0,label:i.A.t("networks.details.address"),value:pt.adresse,onChange:e=>At((0,r.A)((0,r.A)({},pt),{},{adresse:e.target.value})),sx:{mb:2},disabled:!oe,title:_e(oe)}),(0,X.jsxs)(m.A,{sx:{mb:2},children:[(0,X.jsx)(h.A,{variant:"subtitle2",sx:{mb:1},children:i.A.t("auth.register.profileImage")}),(pt.image||wt)&&(0,X.jsxs)(m.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,X.jsx)("img",{src:wt||pt.image,alt:"Aper\xe7u",style:{width:60,height:60,borderRadius:"50%",objectFit:"cover",marginRight:16}}),(0,X.jsx)(g.A,{size:"small",color:"error",onClick:()=>{_t(null),Ct(null),At(e=>(0,r.A)((0,r.A)({},e),{},{image:""}))},disabled:!oe,children:i.A.t("common.actions.remove")})]}),(0,X.jsxs)(g.A,{variant:"outlined",component:"label",disabled:!oe,sx:{mb:1},children:[i.A.t("auth.register.selectImage"),(0,X.jsx)("input",{type:"file",hidden:!0,accept:"image/*",onChange:e=>{const t=e.target.files[0];if(t){if(!t.type.startsWith("image/"))return void ge.oR.error(i.A.t("errors.validation.invalidImageType"));if(t.size>5242880)return void ge.oR.error(i.A.t("errors.validation.imageTooLarge"));_t(t);const e=new FileReader;e.onload=e=>{Ct(e.target.result)},e.readAsDataURL(t)}}})]}),(0,X.jsx)(h.A,{variant:"caption",display:"block",sx:{mt:1,color:"text.secondary"},children:"L'image sera envoy\xe9e lors de la modification du membre"})]}),(0,X.jsx)(w.A,{select:!0,fullWidth:!0,label:i.A.t("networks.details.genre"),value:pt.genre,onChange:e=>At((0,r.A)((0,r.A)({},pt),{},{genre:e.target.value})),sx:{mb:2},disabled:!oe,title:_e(oe),children:J.xG.map(e=>(0,X.jsx)(C.A,{value:e.value,children:e.label},e.value))}),(0,X.jsx)(w.A,{select:!0,fullWidth:!0,label:i.A.t("networks.details.ageRange"),value:pt.tranche_age,onChange:e=>At((0,r.A)((0,r.A)({},pt),{},{tranche_age:e.target.value})),sx:{mb:2},disabled:!oe,title:_e(oe),children:J.T.map(e=>(0,X.jsx)(C.A,{value:e.value,children:e.label},e.value))}),(0,X.jsx)(w.A,{fullWidth:!0,label:i.A.t("networks.details.profession"),value:pt.profession,onChange:e=>At((0,r.A)((0,r.A)({},pt),{},{profession:e.target.value})),sx:{mb:2},disabled:!oe,title:_e(oe)}),(0,X.jsx)(w.A,{fullWidth:!0,label:i.A.t("networks.details.residenceCity"),value:pt.ville_residence,onChange:e=>At((0,r.A)((0,r.A)({},pt),{},{ville_residence:e.target.value})),sx:{mb:2},disabled:!oe,title:_e(oe)}),(0,X.jsx)(w.A,{select:!0,fullWidth:!0,label:i.A.t("networks.details.origin"),value:pt.origine,onChange:e=>At((0,r.A)((0,r.A)({},pt),{},{origine:e.target.value})),sx:{mb:2},disabled:!oe,title:_e(oe),children:ce.F.map(e=>(0,X.jsx)(C.A,{value:e.value,children:e.label},e.value))}),(0,X.jsx)(w.A,{select:!0,fullWidth:!0,label:i.A.t("networks.details.maritalStatus"),value:pt.situation_matrimoniale,onChange:e=>At((0,r.A)((0,r.A)({},pt),{},{situation_matrimoniale:e.target.value})),sx:{mb:2},disabled:!oe,title:_e(oe),children:J.LA.map(e=>(0,X.jsx)(C.A,{value:e.value,children:e.label},e.value))}),(0,X.jsx)(w.A,{select:!0,fullWidth:!0,label:i.A.t("networks.details.educationLevel"),value:pt.niveau_education,onChange:e=>At((0,r.A)((0,r.A)({},pt),{},{niveau_education:e.target.value})),sx:{mb:2},disabled:!oe,title:_e(oe),children:J.RD.map(e=>(0,X.jsx)(C.A,{value:e.value,children:e.label},e.value))}),(0,X.jsxs)(F.A,{fullWidth:!0,sx:{mb:2},disabled:!oe,children:[(0,X.jsx)(T.A,{children:i.A.t("auth.register.departments")}),(0,X.jsx)(I.A,{multiple:!0,value:pt.departement_ids||[],onChange:e=>At((0,r.A)((0,r.A)({},pt),{},{departement_ids:e.target.value})),renderValue:e=>(0,X.jsx)(m.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map(e=>{const t=ke.find(t=>(t.id||t._id)===e);return(0,X.jsx)(D.A,{label:t?t.nom:e,size:"small"},e)})}),children:ke.map(e=>(0,X.jsx)(C.A,{value:e.id||e._id,children:e.nom},e.id||e._id))})]}),(0,X.jsx)(w.A,{select:!0,fullWidth:!0,label:i.A.t("networks.details.qualification"),value:pt.qualification,onChange:e=>At((0,r.A)((0,r.A)({},pt),{},{qualification:e.target.value})),sx:{mb:2},disabled:!oe,title:_e(oe),children:J.Ls.map(e=>(0,X.jsx)(C.A,{value:e.value,children:e.label},e.value))})]})}),(0,X.jsxs)(k.A,{children:[(0,X.jsx)(g.A,{onClick:()=>ht(!1),children:i.A.t("networks.details.cancel")}),(0,X.jsx)(g.A,{variant:"contained",onClick:()=>(async e=>{try{const a=Xe;if(!a)return void dt({open:!0,message:i.A.t("networks.details.userIdNotFound"),severity:"error"});let n=e.image||"";if(jt)try{var t,s,r;const e=new FormData;e.append("image",jt);const a=await me.A.users.uploadProfileImage(e);if(n=(null===(t=a.data)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.image)||(null===(r=a.data)||void 0===r?void 0:r.image),!n)throw new Error("URL de l'image non re\xe7ue")}catch(Se){return void ge.oR.error(i.A.t("errors.imageUploadFailed"))}const l=Object.keys(e).reduce((t,s)=>(("user_id"===s||"_id"===s||"id"===s||""!==e[s]&&void 0!==e[s]&&null!==e[s])&&(t[s]=e[s]),t),{});n&&(l.image=n),await me.A.users.update(a,l),ht(!1),At({username:"",pseudo:"",email:"",password:"",genre:"",tranche_age:"",profession:"",ville_residence:"",origine:"",situation_matrimoniale:"",niveau_education:"",departement:"",departement_ids:[],qualification:"",telephone:"",adresse:"",image:""}),dt({open:!0,message:i.A.t("success.memberUpdated"),severity:"success"}),await Dt()}catch(Se){var a,n,l,o;let t=i.A.t("errors.api.updateMember");if(400===(null===(a=Se.response)||void 0===a?void 0:a.status)){var d,c,u,m;t=(null===(d=Se.response)||void 0===d||null===(c=d.data)||void 0===c?void 0:c.message)||(null!==(u=Se.response)&&void 0!==u&&null!==(m=u.data)&&void 0!==m&&m.error?Se.response.data.error:i.A.t("errors.validation.invalidData"))}else if(404===(null===(n=Se.response)||void 0===n?void 0:n.status))t=i.A.t("errors.member.notFound");else if(403===(null===(l=Se.response)||void 0===l?void 0:l.status))t=i.A.t("errors.permissions.updateMember");else if(500===(null===(o=Se.response)||void 0===o?void 0:o.status)){var h,p,A,v;const s=(null===(h=Se.response)||void 0===h||null===(p=h.data)||void 0===p?void 0:p.error)||(null===(A=Se.response)||void 0===A||null===(v=A.data)||void 0===v?void 0:v.message);t=s?"Erreur serveur: ".concat(s):i.A.t("errors.server.internal")}else Se.message&&!Se.message.includes("Request failed with status code")&&(t=Se.message);dt({open:!0,message:t,severity:"error"})}})(pt),disabled:!oe,title:_e(oe),children:i.A.t("common.actions.edit")})]})]})]}),(0,X.jsx)(K.A,{open:Wt,title:i.A.t("networks.details.deleteGr"),content:i.A.t("networks.details.deleteGrContent"),onClose:()=>{Mt(!1),Bt(null)},onConfirm:async()=>{try{await me.A.groups.delete(Pt),await Dt(),dt({open:!0,message:i.A.t("success.groupDeleted"),severity:"success"})}catch(Se){dt({open:!0,message:i.A.t("errors.api.deleteGroup"),severity:"error"})}finally{Mt(!1),Bt(null)}}}),(0,X.jsx)(K.A,{open:Lt,title:i.A.t("networks.details.deleteMember"),content:i.A.t("networks.details.deleteMemberContent"),onClose:()=>{Nt(!1),Ut({grId:null,userId:null})},onConfirm:async()=>{const{grId:e,userId:t}=Ot;try{await me.A.groups.removeMember(e,t),dt({open:!0,message:i.A.t("success.memberDeleted"),severity:"success"}),await Dt()}catch(Se){var s,r,a,n;let t=i.A.t("errors.api.deleteMember");if(400===(null===(s=Se.response)||void 0===s?void 0:s.status)){var l,o,d,c;const s=null===(l=Se.response)||void 0===l||null===(o=l.data)||void 0===o?void 0:o.message;t=s||(null!==(d=Se.response)&&void 0!==d&&null!==(c=d.data)&&void 0!==c&&c.error?Se.response.data.error:i.A.t("errors.member.cannotDelete"))}else if(404===(null===(r=Se.response)||void 0===r?void 0:r.status))t=i.A.t("errors.memberOrGroup.notFound");else if(403===(null===(a=Se.response)||void 0===a?void 0:a.status))t=i.A.t("errors.permissions.deleteMember");else if(500===(null===(n=Se.response)||void 0===n?void 0:n.status)){var u,m,h,p;const s=(null===(u=Se.response)||void 0===u||null===(m=u.data)||void 0===m?void 0:m.error)||(null===(h=Se.response)||void 0===h||null===(p=h.data)||void 0===p?void 0:p.message);t=s?"Erreur serveur: ".concat(s):i.A.t("errors.server.internal")}else Se.message&&!Se.message.includes("Request failed with status code")&&(t=Se.message);dt({open:!0,message:t,severity:"error"})}finally{Nt(!1),Ut({grId:null,userId:null})}}}),(0,X.jsx)(R.A,{open:ot.open,autoHideDuration:2e3,onClose:()=>dt((0,r.A)((0,r.A)({},ot),{},{open:!1})),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,X.jsx)(W.A,{onClose:()=>dt((0,r.A)((0,r.A)({},ot),{},{open:!1})),severity:ot.severity,sx:{width:"100%"},children:ot.message})}),(0,X.jsx)(Z,{open:Ye,onClose:()=>{$e(!1)},onSave:async e=>{it(!0);try{await $.A.create(e),dt({open:!0,message:i.A.t("previsionnel.success.created"),severity:"success"}),$e(!1),await Dt()}catch(Se){var t,s;const r=(null===(t=Se.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||i.A.t("errors.api.operation");dt({open:!0,message:r,severity:"error"})}finally{it(!1)}},networkData:kt,isLoading:at}),(0,X.jsx)(ee,{open:et,onClose:()=>{tt(!1)},onSave:async e=>{lt(!0);try{await Y.A.create(e),dt({open:!0,message:i.A.t("assistance.success.created"),severity:"success"}),tt(!1),await Dt()}catch(Se){var t,s;const r=(null===(t=Se.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||i.A.t("errors.api.operation");dt({open:!0,message:r,severity:"error"})}finally{lt(!1)}},networkData:kt,isLoading:nt}),(0,X.jsx)(de,{open:st,onClose:()=>rt(!1),networkData:kt})]})}):(0,X.jsx)(m.A,{sx:{minHeight:"100vh",bgcolor:"background.default",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,X.jsx)(h.A,{variant:"h6",color:"error",children:i.A.t("auth.loginRequired")})});var zt}},21281:(e,t,s)=>{s.d(t,{B:()=>a,l:()=>r});const r=e=>e?e.startsWith("QUALIFICATION_")?e.replace("QUALIFICATION_",""):e:"",a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Non d\xe9finie";if(!e)return t;return r(e)||t}},22094:(e,t,s)=>{s.d(t,{A:()=>d});s(65043);var r=s(53969),a=s(94799),i=s(55895),n=s(45350),l=s(56266),o=s(70579);const d=e=>{let{allowedRoles:t=[],children:s,fallback:d=null,showMessage:c=!0}=e;const u=(0,n.S)();return t.some(e=>{switch(e){case"SUPER_ADMIN":return u.isSuperAdmin;case"ADMIN":return u.isAdmin;case"MANAGER":return u.isManager;case"SUPERVISEUR":return u.isSuperviseur;case"COLLECTEUR_CULTE":return u.isCollecteurCulte;case"COLLECTEUR_RESEAUX":return u.isCollecteurReseaux;default:return!1}})?s:d||(c?(0,o.jsx)(r.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh",p:3},children:(0,o.jsxs)(a.A,{elevation:3,sx:{p:4,textAlign:"center",maxWidth:500},children:[(0,o.jsx)(i.A,{variant:"h5",color:"error",gutterBottom:!0,children:l.A.t("errors.accessDenied")}),(0,o.jsx)(i.A,{variant:"body1",color:"text.secondary",paragraph:!0,children:l.A.t("errors.insufficientPermissions")}),(0,o.jsx)(i.A,{variant:"body2",color:"text.secondary",children:l.A.t("errors.contactAdmin")})]})}):null)}},37531:(e,t,s)=>{s.d(t,{A:()=>c});var r=s(89379),a=(s(65043),s(53969)),i=s(91449),n=s(41968),l=s(55895),o=s(56266),d=s(70579);const c=e=>{let{error:t,title:s=o.A.t("common.actions.error"),variant:c="error",showTitle:u=!0,showIcon:m=!0,sx:h={},onClose:p,action:A}=e;if(!t)return null;const v=e=>{switch(e){case"VALIDATION":case"NETWORK":return"warning";case"AUTHENTICATION":case"AUTHORIZATION":return"info";default:return"error"}},g=t.type&&t.message?{type:t.type,message:t.message,severity:v(t.type)}:t.userMessage?{type:"UNKNOWN",message:t.userMessage,severity:"error"}:t.message&&"string"===typeof t.message?{type:"UNKNOWN",message:t.message,severity:"error"}:{type:"UNKNOWN",message:o.A.t("common.unexpectedError"),severity:"error"};return(0,d.jsx)(a.A,{sx:(0,r.A)({mb:2},h),children:(0,d.jsxs)(i.A,{severity:g.severity,variant:c,onClose:p,action:A,sx:{"& .MuiAlert-message":{width:"100%"}},children:[u&&(0,d.jsx)(n.A,{sx:{fontWeight:"bold"},children:s}),(0,d.jsx)(l.A,{variant:"body2",component:"div",children:g.message}),!1]})})}},39408:(e,t,s)=>{s.d(t,{A:()=>a});var r=s(89379);const a=new class{constructor(){this.storageKey="user_preferences",this.defaultPreferences={language:"fr",theme:"light",autoTheme:!0},this.loadPreferences()}loadPreferences(){try{const e=localStorage.getItem(this.storageKey);this.preferences=e?(0,r.A)((0,r.A)({},this.defaultPreferences),JSON.parse(e)):(0,r.A)({},this.defaultPreferences)}catch(e){this.preferences=(0,r.A)({},this.defaultPreferences)}}savePreferences(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.preferences))}catch(e){}}getPreference(e){return this.preferences[e]}setPreference(e,t){this.preferences[e]=t,this.savePreferences(),this.applyPreferences()}getAllPreferences(){return(0,r.A)({},this.preferences)}applyPreferences(){this.applyTheme(),this.applyLanguage()}applyTheme(){const{theme:e,autoTheme:t}=this.preferences;if(t){const e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";document.documentElement.setAttribute("data-theme",e)}else document.documentElement.setAttribute("data-theme",e)}applyLanguage(){const{language:e}=this.preferences;document.documentElement.setAttribute("lang",e),window.dispatchEvent(new CustomEvent("languageChanged",{detail:{language:e}}))}listenToSystemTheme(){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{this.preferences.autoTheme&&this.applyTheme()})}init(){this.applyPreferences(),this.listenToSystemTheme()}}},56198:(e,t,s)=>{s.d(t,{A:()=>a});var r=s(78816);const a=new class{async create(e){try{return(await r.A.post("/assistance",e)).data}catch(t){throw t}}async getStats(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{const t=new URLSearchParams;Object.keys(e).forEach(s=>{e[s]&&t.append(s,e[s])});return(await r.A.get("/assistance/stats?".concat(t.toString()))).data}catch(t){throw t}}async getById(e){try{return(await r.A.get("/assistance/".concat(e))).data}catch(t){throw t}}async update(e,t){try{return(await r.A.put("/assistance/".concat(e),t)).data}catch(s){throw s}}async delete(e){try{return(await r.A.delete("/assistance/".concat(e))).data}catch(t){throw t}}}},61549:(e,t,s)=>{s.d(t,{A:()=>S});var r=s(89379),a=s(65043),i=s(94799),n=s(53969),l=s(55895),o=s(53089),d=s(10256),c=s(79067),u=s(67203),m=s(47471),h=s(1725),p=s(85030),A=s(94527),v=s(12097),g=s(91449),x=s(16936),b=s(15939),f=s(4573),y=s(85490),j=s(57488),_=s(39408),w=s(78816);const C=new class{async getPreferences(){try{return(await w.A.get("/preferences")).data}catch(e){throw console.error("Erreur lors de la r\xe9cup\xe9ration des pr\xe9f\xe9rences:",e),e}}async updatePreferences(e){try{return(await w.A.put("/preferences",e)).data}catch(t){throw console.error("Erreur lors de la mise \xe0 jour des pr\xe9f\xe9rences:",t),t}}async updateEmailPreferences(e){try{return(await w.A.put("/preferences/email",{email_notifications:e})).data}catch(t){throw console.error("Erreur lors de la mise \xe0 jour des pr\xe9f\xe9rences email:",t),t}}};var k=s(56266),E=s(70579);const S=()=>{const[e,t]=(0,a.useState)({language:"fr",theme:"light",autoTheme:!0,email_notifications:!0}),[s,w]=(0,a.useState)({language:"fr",theme:"light",autoTheme:!0,email_notifications:!0}),[S,F]=(0,a.useState)(!1),[T,I]=(0,a.useState)(!1),[D,R]=(0,a.useState)(0);(0,a.useEffect)(()=>{(async()=>{try{var e,s,r,a;const i=k.A.getCurrentLanguage(),n=_.A.getPreference("autoTheme")||!0,l=await C.getPreferences(),o={language:(null===l||void 0===l||null===(e=l.data)||void 0===e?void 0:e.language)||i,theme:(null===l||void 0===l||null===(s=l.data)||void 0===s?void 0:s.theme)||"light",autoTheme:n,email_notifications:null===(r=null===l||void 0===l||null===(a=l.data)||void 0===a?void 0:a.email_notifications)||void 0===r||r};t(o),w(o)}catch(i){console.error("Erreur lors du chargement des pr\xe9f\xe9rences:",i);const e={language:k.A.getCurrentLanguage(),theme:"light",autoTheme:_.A.getPreference("autoTheme")||!0,email_notifications:!0};t(e),w(e)}})()},[e.theme]),(0,a.useEffect)(()=>{const t=s.language!==e.language,r=s.theme!==e.theme,a=s.autoTheme!==e.autoTheme,i=s.email_notifications!==e.email_notifications;I(t||r||a||i)},[e,s]),(0,a.useEffect)(()=>{if(D>0){const e=k.A.getCurrentLanguage();t(t=>(0,r.A)((0,r.A)({},t),{},{language:e,theme:t.theme}))}},[D]);const W=(e,s)=>{t(t=>(0,r.A)((0,r.A)({},t),{},{[e]:s})),I(!0)};return(0,E.jsxs)(i.A,{sx:{p:3,mb:3},children:[(0,E.jsxs)(n.A,{display:"flex",alignItems:"center",mb:3,children:[(0,E.jsx)(x.A,{sx:{mr:2,color:"primary.main"}}),(0,E.jsx)(l.A,{variant:"h6",component:"h3",children:k.A.t("profile.preferences.title")})]}),(0,E.jsxs)(o.A,{container:!0,spacing:3,children:[(0,E.jsx)(o.A,{item:!0,xs:12,md:6,children:(0,E.jsxs)(n.A,{children:[(0,E.jsxs)(n.A,{display:"flex",alignItems:"center",mb:2,children:[(0,E.jsx)(b.A,{sx:{mr:1,color:"primary.main"}}),(0,E.jsx)(l.A,{variant:"subtitle1",fontWeight:"bold",children:k.A.t("profile.preferences.language.title")})]}),(0,E.jsxs)(d.A,{fullWidth:!0,children:[(0,E.jsx)(c.A,{children:k.A.t("profile.preferences.language.title")}),(0,E.jsx)(u.A,{value:e.language,onChange:e=>W("language",e.target.value),label:k.A.t("profile.preferences.language.title"),children:k.A.getAvailableLanguages().map(e=>(0,E.jsx)(m.A,{value:e.code,children:(0,E.jsxs)(n.A,{display:"flex",alignItems:"center",children:[(0,E.jsx)("span",{style:{marginRight:"8px"},children:e.flag}),(0,E.jsx)("span",{children:e.nativeName||e.code.toUpperCase()})]})},e.code))})]})]})}),(0,E.jsx)(o.A,{item:!0,xs:12,md:6,children:(0,E.jsxs)(n.A,{children:[(0,E.jsxs)(n.A,{display:"flex",alignItems:"center",mb:2,children:[(0,E.jsx)(f.A,{sx:{mr:1,color:"primary.main"}}),(0,E.jsx)(l.A,{variant:"subtitle1",fontWeight:"bold",children:k.A.t("profile.preferences.email.title")})]}),(0,E.jsx)(h.A,{control:(0,E.jsx)(p.A,{checked:e.email_notifications,onChange:e=>W("email_notifications",e.target.checked),color:"primary"}),label:(0,E.jsxs)(n.A,{children:[(0,E.jsx)(l.A,{variant:"body2",children:k.A.t("profile.preferences.email.notifications")}),(0,E.jsx)(l.A,{variant:"caption",color:"text.secondary",children:k.A.t("profile.preferences.email.description")})]})})]})}),(0,E.jsx)(o.A,{item:!0,xs:12,md:6,children:(0,E.jsxs)(n.A,{children:[(0,E.jsxs)(n.A,{display:"flex",alignItems:"center",mb:2,children:[(0,E.jsx)(y.A,{sx:{mr:1,color:"primary.main"}}),(0,E.jsx)(l.A,{variant:"subtitle1",fontWeight:"bold",children:k.A.t("profile.preferences.theme.title")})]}),(0,E.jsx)(l.A,{variant:"body2",color:"text.secondary",sx:{fontStyle:"italic"},children:k.A.t("profile.preferences.theme.disabled")})]})})]}),(0,E.jsx)(A.A,{sx:{my:3}}),(0,E.jsxs)(n.A,{display:"flex",gap:2,justifyContent:"flex-end",children:[(0,E.jsx)(v.A,{variant:"outlined",onClick:()=>{t({language:"fr",theme:"light",autoTheme:!0}),k.A.setLanguage("fr"),I(!1),w(e)},disabled:S,children:k.A.t("common.actions.reset")}),(0,E.jsx)(v.A,{variant:"contained",onClick:async()=>{F(!0);try{k.A.setLanguage(e.language),_.A.setPreference("autoTheme",e.autoTheme);try{const t=await C.updatePreferences({email_notifications:e.email_notifications,language:e.language,theme:e.theme});t&&t.success?console.log("\u2705 Pr\xe9f\xe9rences sauvegard\xe9es avec succ\xe8s via l'API"):console.warn("\u26a0\ufe0f R\xe9ponse API inattendue:",t)}catch(t){console.error("\u274c Erreur API lors de la sauvegarde des pr\xe9f\xe9rences:",t),j.oR.error("Erreur lors de la sauvegarde sur le serveur, mais les changements locaux sont appliqu\xe9s")}R(e=>e+1),window.dispatchEvent(new CustomEvent("languageOrThemeChanged",{detail:{language:e.language,theme:e.theme,timestamp:Date.now()}})),j.oR.success(k.A.t("success.preferencesSaved")),I(!1),w(e)}catch(s){j.oR.error(k.A.t("errors.general")),console.error("Erreur de sauvegarde:",s)}finally{F(!1)}},disabled:S||!T,startIcon:null,children:S?k.A.t("common.actions.saving"):k.A.t("profile.actions.savePreferences")})]}),T&&(0,E.jsx)(g.A,{severity:"info",sx:{mt:2},children:k.A.t("profile.preferences.unsavedChanges")})]})}},65506:(e,t,s)=>{s.d(t,{A:()=>a});var r=s(78816);const a=new class{async create(e){try{return(await r.A.post("/previsionnels",e)).data}catch(t){throw t}}async getByNetwork(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const s=new URLSearchParams;t.page&&s.append("page",t.page),t.limit&&s.append("limit",t.limit),t.type_culte&&s.append("type_culte",t.type_culte),t.date_from&&s.append("date_from",t.date_from),t.date_to&&s.append("date_to",t.date_to);return(await r.A.get("/previsionnels/network/".concat(e,"?").concat(s.toString()))).data}catch(s){throw s}}async getById(e){try{return(await r.A.get("/previsionnels/".concat(e))).data}catch(t){throw t}}async update(e,t){try{return(await r.A.put("/previsionnels/".concat(e),t)).data}catch(s){throw s}}async delete(e){try{return(await r.A.delete("/previsionnels/".concat(e))).data}catch(t){throw t}}async getStats(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{const t=new URLSearchParams;e.church_id&&t.append("church_id",e.church_id),e.network_id&&t.append("network_id",e.network_id),e.type_culte&&t.append("type_culte",e.type_culte),e.date_from&&t.append("date_from",e.date_from),e.date_to&&t.append("date_to",e.date_to);const s="/previsionnels/stats?".concat(t.toString());return(await r.A.get(s)).data}catch(t){throw t}}}},83140:(e,t,s)=>{s.d(t,{A:()=>u});s(65043);var r=s(33023),a=s(81911),i=s(78776),n=s(9200),l=s(85877),o=s(12097),d=s(56266),c=s(70579);const u=e=>{let{open:t,onClose:s,onConfirm:u,title:m,content:h}=e;return(0,c.jsxs)(r.A,{open:t,onClose:s,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,c.jsx)(a.A,{id:"alert-dialog-title",children:m}),(0,c.jsx)(i.A,{children:(0,c.jsx)(n.A,{id:"alert-dialog-description",children:h})}),(0,c.jsxs)(l.A,{children:[(0,c.jsx)(o.A,{onClick:s,children:d.A.t("common.actions.cancel")}),(0,c.jsx)(o.A,{onClick:u,color:"error",variant:"contained",autoFocus:!0,children:d.A.t("common.actions.delete")})]})]})}},88324:(e,t,s)=>{s.d(t,{A:()=>a});var r=s(78816);const a={getChaineImpact:async e=>{try{return(await r.A.get("/chaine-impact?church_id=".concat(e))).data}catch(t){throw t}},getChaineImpactByUser:async e=>{try{return(await r.A.get("/chaine-impact/user/".concat(e))).data}catch(t){throw t}},updateChaineImpact:async e=>{try{return(await r.A.post("/chaine-impact/update",{church_id:e})).data}catch(t){throw t}},deleteChaineImpact:async e=>{try{return(await r.A.delete("/chaine-impact/".concat(e))).data}catch(t){throw t}}}}}]);
//# sourceMappingURL=460.e8f4d708.chunk.js.map