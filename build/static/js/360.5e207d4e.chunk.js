"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[360],{20360:(e,t,r)=>{r.r(t),r.d(t,{default:()=>R});var s=r(89379),n=r(65043),i=r(56266),l=r(77210),o=r(94799),a=r(53969),d=r(49806),c=r(55895),u=r(10256),h=r(79067),A=r(67203),x=r(47471),m=r(53089),p=r(12097),v=r(58128),b=r(37528),g=r(87338),j=r(72301),w=r(37531),f=r(41894),y=r(83003),_=r(45350),k=r(98914),S=r(22094),C=r(70579);const N=(0,v.Ay)(o.A)(e=>{let{theme:t}=e;return{padding:t.spacing(3),height:"100%",display:"flex",flexDirection:"column",gap:t.spacing(2),transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out","&:hover":{transform:"translateY(-5px)",boxShadow:t.shadows[4]}}}),E=(0,v.Ay)(a.A)(e=>{let{theme:t}=e;return{display:"flex",justifyContent:"space-between",alignItems:"center",padding:t.spacing(1),borderBottom:"1px solid ".concat(t.palette.divider),"&:last-child":{borderBottom:"none"}}}),R=()=>{const e=(0,g.Zp)(),{user:t}=(0,y.d4)(e=>e.auth),r=(0,_.S)(),{selectedChurch:o,changeSelectedChurch:v,churches:R}=(0,k.w)(),[I,M]=(0,n.useState)([]),[T,W]=(0,n.useState)(!0),[U,L]=(0,n.useState)(null),[O,B]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{if(t&&"collecteur_reseaux"===(t.current_role||t.role))try{const e=t.id||t._id;if(!e)return;const r=await f.apiService.users.getNetwork(e);B(r.data.networkId)}catch(e){B(null)}})()},[t]),(0,n.useEffect)(()=>{(async()=>{try{var e;let n;if(r.isAdmin||r.isSuperAdmin||r.isManager){if(!o)return M([]),void W(!1);{const e=o.id||o._id;n=await f.apiService.networks.getAll({churchId:e})}}else if(null!==t&&void 0!==t&&t.eglise_locale){const e="object"===typeof t.eglise_locale?t.eglise_locale.id||t.eglise_locale._id:t.eglise_locale;n=await f.apiService.networks.getAll({churchId:e})}else n=await f.apiService.networks.getAll();const i=((null===(e=n.data)||void 0===e?void 0:e.data)||n.data||[]).map(async e=>{try{const t=await f.apiService.networks.getStatsById(e.id||e._id);return(0,s.A)((0,s.A)({},e),{},{stats:t.data})}catch(t){(0,l.hS)(t,"erreur lors de la r\xe9cup\xe9ration des stats pour ".concat(e.nom,":"));return(0,s.A)((0,s.A)({},e),{},{stats:null})}}),a=await Promise.all(i),d=a.map(e=>{var t,r,s,n,i,l,o,a,d,c,u,h,A,x,m,p,v;const b=null!==(t=null===(r=e.stats)||void 0===r?void 0:r.data)&&void 0!==t?t:{};return{id:e.id||e._id,nom:e.nom,responsables:null!==(s=e.responsable2)&&void 0!==s&&s.username?"".concat(null===(n=e.responsable1)||void 0===n||null===(i=n.username)||void 0===i?void 0:i.split(" ")[0]," & ").concat(null===(l=e.responsable2)||void 0===l||null===(o=l.username)||void 0===o?void 0:o.split(" ")[0]):null===(a=e.responsable1)||void 0===a||null===(d=a.username)||void 0===d?void 0:d.split(" ")[0],nb_gr:null!==(c=b.totalGroups)&&void 0!==c?c:0,nb_12:null!==(u=b[12])&&void 0!==u?u:0,nb_144:null!==(h=b[144])&&void 0!==h?h:0,nb_1728:null!==(A=b[1728])&&void 0!==A?A:0,nb_respo_gr:null!==(x=b["Responsables de GR"])&&void 0!==x?x:0,nb_leader:null!==(m=b.Leader)&&void 0!==m?m:0,nb_leader_tous:null!==(p=b["Leader (Tous)"])&&void 0!==p?p:0,nb_membre:null!==(v=b["Membre simple"])&&void 0!==v?v:0}}).sort((e,t)=>{const r=D(e);return D(t)-r});M(d),W(!1)}catch(n){L(n.message),W(!1)}})()},[t,o]);const D=e=>(e.nb_12||0)+(e.nb_144||0)+(e.nb_1728||0)+(e.nb_leader||0)+(e.nb_membre||0)+(e.responsables?e.responsables.split("&").length:0);return T?(0,C.jsx)(j.A,{titre:i.A.t("networks.loading")}):U?(0,C.jsx)(w.A,{error:U,title:i.A.t("errors.loading")}):(0,C.jsx)(S.A,{allowedRoles:["SUPER_ADMIN","ADMIN","MANAGER","COLLECTEUR_RESEAUX"],children:(0,C.jsxs)(a.A,{sx:{minHeight:"100vh",bgcolor:"background.default"},children:[(0,C.jsx)(b.A,{}),(0,C.jsxs)(d.A,{maxWidth:"lg",sx:{mt:0,mb:4},children:[(0,C.jsxs)(a.A,{sx:{mb:4,display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"stretch",sm:"center"},gap:{xs:2,sm:0}},children:[(0,C.jsx)(c.A,{variant:"h4",sx:{color:"primary.main",fontWeight:"bold"},children:i.A.t("networks.list.title")}),(r.isAdmin||r.isSuperAdmin)&&(0,C.jsxs)(u.A,{sx:{minWidth:{xs:"100%",sm:250},maxWidth:{xs:"100%",sm:300}},children:[(0,C.jsx)(h.A,{id:"church-select-label",children:i.A.t("networks.list.filterByChurch")}),(0,C.jsx)(A.A,{labelId:"church-select-label",value:(null===o||void 0===o?void 0:o.id)||(null===o||void 0===o?void 0:o._id)||"",label:i.A.t("networks.list.filterByChurch"),onChange:e=>{const t=e.target.value;v(t)},sx:{backgroundColor:"#fdfdfd"},children:R.map(e=>(0,C.jsx)(x.A,{value:e.id||e._id,children:e.nom},e.id||e._id))})]})]}),0===I.length?(0,C.jsxs)(a.A,{sx:{textAlign:"center",py:8,px:2,backgroundColor:"background.paper",borderRadius:2,border:"2px dashed",borderColor:"divider",mx:2},children:[(0,C.jsx)(c.A,{variant:"h5",color:"text.secondary",gutterBottom:!0,children:"Aucun r\xe9seau trouv\xe9"}),(0,C.jsx)(c.A,{variant:"body1",color:"text.secondary",sx:{mb:3},children:o?i.A.t("networks.noNetworksForChurch",{churchName:o.nom}):i.A.t("networks.noNetworksAvailable")}),(0,C.jsx)(c.A,{variant:"body2",color:"text.secondary",children:"Les r\xe9seaux appara\xeetront ici une fois cr\xe9\xe9s"})]}):(0,C.jsx)(m.A,{container:!0,children:I.map(r=>(0,C.jsx)(m.A,{"data-aos":"fade-up",sx:{width:"100%",padding:"10px 10px 10px 10px","@media (min-width:700px) and (max-width:1099px)":{width:"50%"},"@media (min-width:1100px) and (max-width:1599px)":{width:"33.33%"},"@media (min-width:1600px)":{width:"25%"},flexBasis:"unset",maxWidth:"unset",flexGrow:0,flexShrink:0,height:"100%"},children:(0,C.jsxs)(N,{elevation:2,children:[(0,C.jsx)(c.A,{variant:"h5",gutterBottom:!0,children:r.nom}),(0,C.jsxs)(E,{children:[(0,C.jsx)(c.A,{variant:"subtitle2",children:i.A.t("networks.list.responsables")}),(0,C.jsx)(c.A,{children:r.responsables||"-"})]}),(0,C.jsxs)(E,{children:[(0,C.jsx)(c.A,{variant:"subtitle2",children:i.A.t("networks.list.gr")}),(0,C.jsx)(c.A,{children:r.nb_gr})]}),(0,C.jsxs)(E,{children:[(0,C.jsx)(c.A,{variant:"subtitle2",children:i.A.t("networks.list.group12")}),(0,C.jsx)(c.A,{children:r.nb_12})]}),(0,C.jsxs)(E,{children:[(0,C.jsx)(c.A,{variant:"subtitle2",children:i.A.t("networks.list.group144")}),(0,C.jsx)(c.A,{children:r.nb_144})]}),(0,C.jsxs)(E,{children:[(0,C.jsx)(c.A,{variant:"subtitle2",children:i.A.t("networks.list.group1728")}),(0,C.jsx)(c.A,{children:r.nb_1728})]}),(0,C.jsxs)(E,{children:[(0,C.jsx)(c.A,{variant:"subtitle2",children:i.A.t("networks.list.responsableGR")}),(0,C.jsx)(c.A,{children:r.nb_respo_gr})]}),(0,C.jsxs)(E,{children:[(0,C.jsx)(c.A,{variant:"subtitle2",children:i.A.t("networks.list.leader")}),(0,C.jsx)(c.A,{children:r.nb_leader})]}),(0,C.jsxs)(E,{children:[(0,C.jsx)(c.A,{variant:"subtitle2",children:i.A.t("networks.list.leaderAll")}),(0,C.jsx)(c.A,{children:r.nb_leader_tous})]}),(0,C.jsxs)(E,{children:[(0,C.jsx)(c.A,{variant:"subtitle2",children:i.A.t("networks.list.member")}),(0,C.jsx)(c.A,{children:r.nb_membre})]}),(0,C.jsxs)(E,{children:[(0,C.jsx)(c.A,{variant:"h6",sx:{fontWeight:"bold",fontSize:"1.1rem",color:"primary.main"},children:i.A.t("networks.list.total")}),(0,C.jsx)(c.A,{sx:{fontWeight:"bold",fontSize:"1.1rem",color:"primary.main"},children:D(r)})]}),(0,C.jsx)(a.A,{sx:{mt:"auto",pt:2},children:(0,C.jsx)(p.A,{variant:"contained",color:"primary",fullWidth:!0,onClick:()=>e("/networks/".concat(r.id)),disabled:"collecteur_reseaux"===((null===t||void 0===t?void 0:t.current_role)||(null===t||void 0===t?void 0:t.role))&&(null===O||String(O)!==String(r.id)),children:i.A.t("common.actions.view")})})]})},r.id))})]})]})})}},22094:(e,t,r)=>{r.d(t,{A:()=>d});r(65043);var s=r(53969),n=r(94799),i=r(55895),l=r(45350),o=r(56266),a=r(70579);const d=e=>{let{allowedRoles:t=[],children:r,fallback:d=null,showMessage:c=!0}=e;const u=(0,l.S)();return t.some(e=>{switch(e){case"SUPER_ADMIN":return u.isSuperAdmin;case"ADMIN":return u.isAdmin;case"MANAGER":return u.isManager;case"SUPERVISEUR":return u.isSuperviseur;case"COLLECTEUR_CULTE":return u.isCollecteurCulte;case"COLLECTEUR_RESEAUX":return u.isCollecteurReseaux;default:return!1}})?r:d||(c?(0,a.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh",p:3},children:(0,a.jsxs)(n.A,{elevation:3,sx:{p:4,textAlign:"center",maxWidth:500},children:[(0,a.jsx)(i.A,{variant:"h5",color:"error",gutterBottom:!0,children:o.A.t("errors.accessDenied")}),(0,a.jsx)(i.A,{variant:"body1",color:"text.secondary",paragraph:!0,children:o.A.t("errors.insufficientPermissions")}),(0,a.jsx)(i.A,{variant:"body2",color:"text.secondary",children:o.A.t("errors.contactAdmin")})]})}):null)}},37531:(e,t,r)=>{r.d(t,{A:()=>c});var s=r(89379),n=(r(65043),r(53969)),i=r(91449),l=r(41968),o=r(55895),a=r(56266),d=r(70579);const c=e=>{let{error:t,title:r=a.A.t("common.actions.error"),variant:c="error",showTitle:u=!0,showIcon:h=!0,sx:A={},onClose:x,action:m}=e;if(!t)return null;const p=e=>{switch(e){case"VALIDATION":case"NETWORK":return"warning";case"AUTHENTICATION":case"AUTHORIZATION":return"info";default:return"error"}},v=t.type&&t.message?{type:t.type,message:t.message,severity:p(t.type)}:t.userMessage?{type:"UNKNOWN",message:t.userMessage,severity:"error"}:t.message&&"string"===typeof t.message?{type:"UNKNOWN",message:t.message,severity:"error"}:{type:"UNKNOWN",message:a.A.t("common.unexpectedError"),severity:"error"};return(0,d.jsx)(n.A,{sx:(0,s.A)({mb:2},A),children:(0,d.jsxs)(i.A,{severity:v.severity,variant:c,onClose:x,action:m,sx:{"& .MuiAlert-message":{width:"100%"}},children:[u&&(0,d.jsx)(l.A,{sx:{fontWeight:"bold"},children:r}),(0,d.jsx)(o.A,{variant:"body2",component:"div",children:v.message}),!1]})})}},41968:(e,t,r)=>{r.d(t,{A:()=>b});var s=r(89379),n=r(80045),i=r(65043),l=r(58387),o=r(31807),a=r(58128),d=r(51612),c=r(28301),u=r(55895),h=r(79857),A=r(86061);function x(e){return(0,A.Ay)("MuiAlertTitle",e)}(0,h.A)("MuiAlertTitle",["root"]);var m=r(70579);const p=["className"],v=(0,a.Ay)(u.A,{name:"MuiAlertTitle",slot:"Root"})((0,d.A)(e=>{let{theme:t}=e;return{fontWeight:t.typography.fontWeightMedium,marginTop:-2}})),b=i.forwardRef(function(e,t){const r=(0,c.b)({props:e,name:"MuiAlertTitle"}),{className:i}=r,a=(0,n.A)(r,p),d=r,u=(e=>{const{classes:t}=e;return(0,o.A)({root:["root"]},x,t)})(d);return(0,m.jsx)(v,(0,s.A)({gutterBottom:!0,component:"div",ownerState:d,ref:t,className:(0,l.A)(u.root,i)},a))})}}]);
//# sourceMappingURL=360.5e207d4e.chunk.js.map