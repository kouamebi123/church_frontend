import{j as t,u as W,v as L,w as S,b1 as E,x as B,n as x,r as d,h as C,B as j,T as y,G as i,i as s,M as m}from"./mui-mRVmBbre.js";import{b as I,o as N,q as P,i as o,n as D,a as k,h as A,r as M,s as n,t as _,v as Y}from"./index-tM-Ac5N7.js";import{E as U}from"./ErrorMessage-G4UKRMcw.js";import{u as O}from"./useNotification-Dvvg7ylT.js";import{A as w}from"./AccessControl-DiRRByFc.js";import{f as F}from"./utils-DP_tgNw_.js";import"./vendor-Bzgz95E1.js";import"./redux-DbjaNwcH.js";import"./router-BwhLjOj0.js";const R=({open:h,onClose:u,title:f="Succès",content:c="L'opération a réussi."})=>t.jsxs(W,{open:h,onClose:u,"aria-labelledby":"success-dialog-title","aria-describedby":"success-dialog-description",children:[t.jsx(L,{id:"success-dialog-title",sx:{color:"success.main"},children:f}),t.jsx(S,{children:t.jsx(E,{id:"success-dialog-description",children:c})}),t.jsx(B,{children:t.jsx(x,{onClick:u,autoFocus:!0,variant:"contained",color:"success",children:"OK"})})]}),$=M({culte:_().required("Le type de culte est requis"),orateur:_().required("L'orateur est requis"),date:Y().required("La date est requise"),total_adultes:n().min(0,"Le nombre doit être positif").required("Le nombre d'adultes est requis"),total_enfants:n().min(0,"Le nombre doit être positif").required("Le nombre d'enfants est requis"),total_chantres:n().min(0,"Le nombre doit être positif").required("Le nombre de chantres est requis"),total_protocoles:n().min(0,"Le nombre doit être positif").required("Le nombre de protocoles est requis"),total_multimedia:n().min(0,"Le nombre doit être positif").required("Le nombre de multimedia est requis"),total_respo_ecodim:n().min(0,"Le nombre doit être positif").required("Le responsable ECODIM est requis"),total_animateurs_ecodim:n().min(0,"Le nombre doit être positif").required("Le nombre d'animateurs ECODIM est requis"),total_enfants_ecodim:n().min(0,"Le nombre doit être positif").required("Le nombre d'enfants ECODIM est requis"),superviseur:_().required("Le superviseur est requis"),invitationYoutube:n().min(0,"Le nombre doit être positif"),invitationTiktok:n().min(0,"Le nombre doit être positif"),invitationInstagram:n().min(0,"Le nombre doit être positif"),invitationPhysique:n().min(0,"Le nombre doit être positif")}),ee=()=>{const[h,u]=d.useState(!1),[f,c]=d.useState(!0),[b,q]=d.useState(null),[p,T]=d.useState([]),{selectedChurch:v}=I(),{user:g}=N(),{showError:l}=O();d.useEffect(()=>{(async()=>{try{const a=await k.users.getAll({role:"SUPERVISEUR"});T(a.data?.data||a.data||[]),c(!1)}catch(a){A(a,o.t("errors.api.loadUsers")),q(a.response?.data?.message||a.message||o.t("errors.api.loadUsers")),c(!1)}})()},[]);const e=P({initialValues:{culte:"",orateur:"",date:new Date,total_adultes:"",total_enfants:"",total_chantres:"",total_protocoles:"",total_multimedia:"",total_respo_ecodim:"",total_animateurs_ecodim:"",total_enfants_ecodim:"",superviseur:null,invitationYoutube:0,invitationTiktok:0,invitationInstagram:0,invitationPhysique:0},validationSchema:$,onSubmit:async r=>{try{if(!v?.id){l(o.t("errors.api.selectChurch"));return}if(!g?.id){l("Utilisateur non connecté");return}const a={date:r.date,culte:r.culte,orateur:r.orateur,eglise_id:v.id,nombre_present:Number(r.total_adultes)+Number(r.total_enfants),responsable_id:r.superviseur||null,total_adultes:Number(r.total_adultes),total_enfants:Number(r.total_enfants),total_chantres:Number(r.total_chantres),total_protocoles:Number(r.total_protocoles),total_multimedia:Number(r.total_multimedia),total_respo_ecodim:Number(r.total_respo_ecodim),total_animateurs_ecodim:Number(r.total_animateurs_ecodim),total_enfants_ecodim:Number(r.total_enfants_ecodim),collecteur_culte_id:g?.id,superviseur_id:r.superviseur,invitationYoutube:Number(r.invitationYoutube),invitationTiktok:Number(r.invitationTiktok),invitationInstagram:Number(r.invitationInstagram),invitationPhysique:Number(r.invitationPhysique)};await k.services.create(a),u(!0)}catch(a){a.response?.status===400?l(o.t("errors.api.invalidData")):a.response?.status===500?l(o.t("errors.api.serverError")):a.response?.data?.message?l(a.response.data.message):l(a.message||o.t("errors.api.createService"))}}});return f?t.jsx("div",{children:"Chargement..."}):b?t.jsx(U,{error:b,title:o.t("errors.loading")}):v?.id?t.jsx(w,{allowedRoles:["SUPER_ADMIN","ADMIN","MANAGER","COLLECTEUR_CULTE"],children:t.jsxs(C,{"data-aos":"fade-up",elevation:3,sx:{p:4},children:[t.jsx("form",{onSubmit:e.handleSubmit,children:t.jsxs(i,{container:!0,spacing:3,children:[t.jsx(i,{item:!0,xs:12,sm:6,children:t.jsx(s,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,select:!0,id:"service-form-culte",name:"culte",label:o.t("services.list.typeCulte"),value:e.values.culte,onChange:e.handleChange,error:e.touched.culte&&!!e.errors.culte,helperText:e.touched.culte&&e.errors.culte,autoComplete:"off",children:D.map(r=>t.jsx(m,{value:r.value,children:r.label},r.value))})}),t.jsx(i,{item:!0,xs:12,sm:6,children:t.jsx(s,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,type:"date",id:"service-form-date",name:"date",label:o.t("services.list.dateCulte"),value:F(e.values.date,"yyyy-MM-dd"),onChange:r=>e.setFieldValue("date",new Date(r.target.value)),error:e.touched.date&&!!e.errors.date,helperText:e.touched.date&&e.errors.date,InputLabelProps:{shrink:!0},autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,children:t.jsx(s,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-orateur",name:"orateur",label:o.t("services.list.orateur"),value:e.values.orateur,onChange:e.handleChange,error:e.touched.orateur&&!!e.errors.orateur,helperText:e.touched.orateur&&e.errors.orateur,autoComplete:"name"})}),t.jsx(i,{item:!0,xs:12,sm:6,children:t.jsx(s,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-total-adultes",name:"total_adultes",label:o.t("services.list.nombreAdultes"),type:"number",value:e.values.total_adultes,onChange:e.handleChange,error:e.touched.total_adultes&&!!e.errors.total_adultes,helperText:e.touched.total_adultes&&e.errors.total_adultes,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,sm:6,children:t.jsx(s,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-total-enfants",name:"total_enfants",label:o.t("services.list.nombreEnfants"),type:"number",value:e.values.total_enfants,onChange:e.handleChange,error:e.touched.total_enfants&&!!e.errors.total_enfants,helperText:e.touched.total_enfants&&e.errors.total_enfants,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,sm:4,children:t.jsx(s,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-total-chantres",name:"total_chantres",label:o.t("services.list.nombreChantres"),type:"number",value:e.values.total_chantres,onChange:e.handleChange,error:e.touched.total_chantres&&!!e.errors.total_chantres,helperText:e.touched.total_chantres&&e.errors.total_chantres,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,sm:4,children:t.jsx(s,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-total-protocoles",name:"total_protocoles",label:o.t("services.list.nombreProtocoles"),type:"number",value:e.values.total_protocoles,onChange:e.handleChange,error:e.touched.total_protocoles&&!!e.errors.total_protocoles,helperText:e.touched.total_protocoles&&e.errors.total_protocoles,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,sm:4,children:t.jsx(s,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-total-multimedia",name:"total_multimedia",label:o.t("services.list.nombreMultimedia"),type:"number",value:e.values.total_multimedia,onChange:e.handleChange,error:e.touched.total_multimedia&&!!e.errors.total_multimedia,helperText:e.touched.total_multimedia&&e.errors.total_multimedia,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,sm:4,children:t.jsx(s,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-total-respo-ecodim",name:"total_respo_ecodim",label:o.t("services.list.responsableEcodim"),type:"number",value:e.values.total_respo_ecodim,onChange:e.handleChange,error:e.touched.total_respo_ecodim&&!!e.errors.total_respo_ecodim,helperText:e.touched.total_respo_ecodim&&e.errors.total_respo_ecodim,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,sm:4,children:t.jsx(s,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-total-animateurs-ecodim",name:"total_animateurs_ecodim",label:o.t("services.list.nombreAnimateurs"),type:"number",value:e.values.total_animateurs_ecodim,onChange:e.handleChange,error:e.touched.total_animateurs_ecodim&&!!e.errors.total_animateurs_ecodim,helperText:e.touched.total_animateurs_ecodim&&e.errors.total_animateurs_ecodim,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,sm:4,children:t.jsx(s,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-total-enfants-ecodim",name:"total_enfants_ecodim",label:`${o.t("services.list.nombreEnfants")} ${o.t("services.list.enfEcodim")}`,type:"number",value:e.values.total_enfants_ecodim,onChange:e.handleChange,error:e.touched.total_enfants_ecodim&&!!e.errors.total_enfants_ecodim,helperText:e.touched.total_enfants_ecodim&&e.errors.total_enfants_ecodim,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,sm:6,children:t.jsxs(s,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,select:!0,id:"service-form-superviseur",name:"superviseur",label:o.t("services.form.supervisor"),value:e.values.superviseur||"",onChange:e.handleChange,error:e.touched.superviseur&&!!e.errors.superviseur,helperText:e.touched.superviseur&&e.errors.superviseur,required:!0,autoComplete:"off",children:[t.jsx(m,{value:"",children:o.t("services.list.selectSuperviseur")}),p&&p.length>0?p.map(r=>t.jsx(m,{value:r._id||r.id,children:r.username||r.pseudo||o.t("common_text.unknownName")},r._id||r.id)):t.jsx(m,{disabled:!0,children:o.t("services.list.noSuperviseur")})]})}),t.jsx(i,{item:!0,xs:12,sm:6,children:t.jsx(s,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-invitation-youtube",name:"invitationYoutube",label:o.t("services.list.invitationsYoutube"),type:"number",value:e.values.invitationYoutube,onChange:e.handleChange,error:e.touched.invitationYoutube&&!!e.errors.invitationYoutube,helperText:e.touched.invitationYoutube&&e.errors.invitationYoutube,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,sm:6,children:t.jsx(s,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-invitation-tiktok",name:"invitationTiktok",label:o.t("services.list.invitationsTiktok"),type:"number",value:e.values.invitationTiktok,onChange:e.handleChange,error:e.touched.invitationTiktok&&!!e.errors.invitationTiktok,helperText:e.touched.invitationTiktok&&e.errors.invitationTiktok,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,sm:6,children:t.jsx(s,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-invitation-instagram",name:"invitationInstagram",label:o.t("services.list.invitationsInstagram"),type:"number",value:e.values.invitationInstagram,onChange:e.handleChange,error:e.touched.invitationInstagram&&!!e.errors.invitationInstagram,helperText:e.touched.invitationInstagram&&e.errors.invitationInstagram,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,sm:6,children:t.jsx(s,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-invitation-physique",name:"invitationPhysique",label:o.t("services.list.invitationsPhysiques"),type:"number",value:e.values.invitationPhysique,onChange:e.handleChange,error:e.touched.invitationPhysique&&!!e.errors.invitationPhysique,helperText:e.touched.invitationPhysique&&e.errors.invitationPhysique,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,children:t.jsxs(j,{display:"flex",justifyContent:"flex-end",gap:2,sx:{mt:1,right:0},children:[t.jsx(x,{variant:"outlined",color:"secondary",onClick:()=>e.resetForm(),children:o.t("common.actions.reset")}),t.jsx(x,{type:"submit",variant:"contained",color:"primary",children:o.t("common.actions.save")})]})})]})}),t.jsx(R,{open:h,onClose:()=>{u(!1),e.resetForm()},title:o.t("success.success"),content:o.t("success.serviceCreated")})]})}):t.jsx(C,{"data-aos":"fade-up",elevation:3,sx:{p:4},children:t.jsxs(j,{sx:{textAlign:"center",py:4},children:[t.jsx(y,{variant:"h6",color:"error",gutterBottom:!0,children:o.t("home.noChurchSelected")}),t.jsx(y,{variant:"body1",children:o.t("home.selectChurchForService")})]})})};export{ee as default};
