import{j as t,u as W,B as v,a as S,X as L,v as E,w as B,b1 as I,x as N,n as _,r as u,h as j,T as k,G as i,i as a,M as m}from"./mui-mRVmBbre.js";import{b as P,o as F,q as D,i as o,n as w,a as y,h as A,r as Y,s as n,t as b,v as M}from"./index-D-mMtbrf.js";import{E as R}from"./ErrorMessage-BkFv1zZc.js";import{u as U}from"./useNotification-Dvvg7ylT.js";import{A as O}from"./AccessControl-Bo8DCupw.js";import{f as $}from"./utils-DP_tgNw_.js";import"./vendor-Bzgz95E1.js";import"./redux-DbjaNwcH.js";import"./router-BwhLjOj0.js";const V=({open:h,onClose:d,title:f="Succès",content:c="L'opération a réussi."})=>t.jsxs(W,{open:h,onClose:d,"aria-labelledby":"success-dialog-title","aria-describedby":"success-dialog-description",PaperProps:{sx:{borderRadius:"24px",boxShadow:"0 20px 60px rgba(16, 185, 129, 0.15)",overflow:"hidden"}},children:[t.jsxs(v,{sx:{textAlign:"center",pt:4,background:"linear-gradient(145deg, #FFFFFF 0%, #ECFDF5 100%)"},children:[t.jsx(S,{sx:{m:"0 auto",mb:2,background:"linear-gradient(135deg, #10B981, #059669)",width:64,height:64,boxShadow:"0 8px 24px rgba(16, 185, 129, 0.25)",animation:"scaleIn 0.6s ease-out"},children:t.jsx(L,{sx:{fontSize:36}})}),t.jsx(E,{id:"success-dialog-title",sx:{fontWeight:700,background:"linear-gradient(135deg, #10B981, #059669)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",fontSize:"1.5rem"},children:f})]}),t.jsx(B,{sx:{textAlign:"center",pb:3},children:t.jsx(I,{id:"success-dialog-description",sx:{fontSize:"1rem",color:"text.secondary"},children:c})}),t.jsx(N,{sx:{justifyContent:"center",pb:3},children:t.jsx(_,{onClick:d,autoFocus:!0,variant:"contained",color:"success",sx:{borderRadius:"12px",px:4,py:1.2,fontWeight:700,background:"linear-gradient(135deg, #10B981, #059669)",boxShadow:"0 4px 12px rgba(16, 185, 129, 0.25)","&:hover":{background:"linear-gradient(135deg, #059669, #047857)",boxShadow:"0 8px 20px rgba(16, 185, 129, 0.35)",transform:"translateY(-2px)"}},children:"OK"})})]}),z=Y({culte:b().required("Le type de culte est requis"),orateur:b().required("L'orateur est requis"),date:M().required("La date est requise"),total_adultes:n().min(0,"Le nombre doit être positif").required("Le nombre d'adultes est requis"),total_enfants:n().min(0,"Le nombre doit être positif").required("Le nombre d'enfants est requis"),total_chantres:n().min(0,"Le nombre doit être positif").required("Le nombre de chantres est requis"),total_protocoles:n().min(0,"Le nombre doit être positif").required("Le nombre de protocoles est requis"),total_multimedia:n().min(0,"Le nombre doit être positif").required("Le nombre de multimedia est requis"),total_respo_ecodim:n().min(0,"Le nombre doit être positif").required("Le responsable ECODIM est requis"),total_animateurs_ecodim:n().min(0,"Le nombre doit être positif").required("Le nombre d'animateurs ECODIM est requis"),total_enfants_ecodim:n().min(0,"Le nombre doit être positif").required("Le nombre d'enfants ECODIM est requis"),superviseur:b().required("Le superviseur est requis"),invitationYoutube:n().min(0,"Le nombre doit être positif"),invitationTiktok:n().min(0,"Le nombre doit être positif"),invitationInstagram:n().min(0,"Le nombre doit être positif"),invitationPhysique:n().min(0,"Le nombre doit être positif")}),re=()=>{const[h,d]=u.useState(!1),[f,c]=u.useState(!0),[g,q]=u.useState(null),[p,T]=u.useState([]),{selectedChurch:x}=P(),{user:C}=F(),{showError:l}=U();u.useEffect(()=>{(async()=>{try{const s=await y.users.getAll({role:"SUPERVISEUR"});T(s.data?.data||s.data||[]),c(!1)}catch(s){A(s,o.t("errors.api.loadUsers")),q(s.response?.data?.message||s.message||o.t("errors.api.loadUsers")),c(!1)}})()},[]);const e=D({initialValues:{culte:"",orateur:"",date:new Date,total_adultes:"",total_enfants:"",total_chantres:"",total_protocoles:"",total_multimedia:"",total_respo_ecodim:"",total_animateurs_ecodim:"",total_enfants_ecodim:"",superviseur:null,invitationYoutube:0,invitationTiktok:0,invitationInstagram:0,invitationPhysique:0},validationSchema:z,onSubmit:async r=>{try{if(!x?.id){l(o.t("errors.api.selectChurch"));return}if(!C?.id){l("Utilisateur non connecté");return}const s={date:r.date,culte:r.culte,orateur:r.orateur,eglise_id:x.id,nombre_present:Number(r.total_adultes)+Number(r.total_enfants),responsable_id:r.superviseur||null,total_adultes:Number(r.total_adultes),total_enfants:Number(r.total_enfants),total_chantres:Number(r.total_chantres),total_protocoles:Number(r.total_protocoles),total_multimedia:Number(r.total_multimedia),total_respo_ecodim:Number(r.total_respo_ecodim),total_animateurs_ecodim:Number(r.total_animateurs_ecodim),total_enfants_ecodim:Number(r.total_enfants_ecodim),collecteur_culte_id:C?.id,superviseur_id:r.superviseur,invitationYoutube:Number(r.invitationYoutube),invitationTiktok:Number(r.invitationTiktok),invitationInstagram:Number(r.invitationInstagram),invitationPhysique:Number(r.invitationPhysique)};await y.services.create(s),d(!0)}catch(s){s.response?.status===400?l(o.t("errors.api.invalidData")):s.response?.status===500?l(o.t("errors.api.serverError")):s.response?.data?.message?l(s.response.data.message):l(s.message||o.t("errors.api.createService"))}}});return f?t.jsx("div",{children:"Chargement..."}):g?t.jsx(R,{error:g,title:o.t("errors.loading")}):x?.id?t.jsx(O,{allowedRoles:["SUPER_ADMIN","ADMIN","MANAGER","COLLECTEUR_CULTE"],children:t.jsxs(j,{"data-aos":"fade-up",elevation:0,sx:{p:5,background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(10px)",borderRadius:"24px",border:"1px solid rgba(102, 45, 145, 0.1)",boxShadow:"0 10px 40px rgba(102, 45, 145, 0.12)"},children:[t.jsx("form",{onSubmit:e.handleSubmit,children:t.jsxs(i,{container:!0,spacing:3,children:[t.jsx(i,{item:!0,xs:12,sm:6,children:t.jsx(a,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,select:!0,id:"service-form-culte",name:"culte",label:o.t("services.list.typeCulte"),value:e.values.culte,onChange:e.handleChange,error:e.touched.culte&&!!e.errors.culte,helperText:e.touched.culte&&e.errors.culte,autoComplete:"off",children:w.map(r=>t.jsx(m,{value:r.value,children:r.label},r.value))})}),t.jsx(i,{item:!0,xs:12,sm:6,children:t.jsx(a,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,type:"date",id:"service-form-date",name:"date",label:o.t("services.list.dateCulte"),value:$(e.values.date,"yyyy-MM-dd"),onChange:r=>e.setFieldValue("date",new Date(r.target.value)),error:e.touched.date&&!!e.errors.date,helperText:e.touched.date&&e.errors.date,InputLabelProps:{shrink:!0},autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,children:t.jsx(a,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-orateur",name:"orateur",label:o.t("services.list.orateur"),value:e.values.orateur,onChange:e.handleChange,error:e.touched.orateur&&!!e.errors.orateur,helperText:e.touched.orateur&&e.errors.orateur,autoComplete:"name"})}),t.jsx(i,{item:!0,xs:12,sm:6,children:t.jsx(a,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-total-adultes",name:"total_adultes",label:o.t("services.list.nombreAdultes"),type:"number",value:e.values.total_adultes,onChange:e.handleChange,error:e.touched.total_adultes&&!!e.errors.total_adultes,helperText:e.touched.total_adultes&&e.errors.total_adultes,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,sm:6,children:t.jsx(a,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-total-enfants",name:"total_enfants",label:o.t("services.list.nombreEnfants"),type:"number",value:e.values.total_enfants,onChange:e.handleChange,error:e.touched.total_enfants&&!!e.errors.total_enfants,helperText:e.touched.total_enfants&&e.errors.total_enfants,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,sm:4,children:t.jsx(a,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-total-chantres",name:"total_chantres",label:o.t("services.list.nombreChantres"),type:"number",value:e.values.total_chantres,onChange:e.handleChange,error:e.touched.total_chantres&&!!e.errors.total_chantres,helperText:e.touched.total_chantres&&e.errors.total_chantres,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,sm:4,children:t.jsx(a,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-total-protocoles",name:"total_protocoles",label:o.t("services.list.nombreProtocoles"),type:"number",value:e.values.total_protocoles,onChange:e.handleChange,error:e.touched.total_protocoles&&!!e.errors.total_protocoles,helperText:e.touched.total_protocoles&&e.errors.total_protocoles,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,sm:4,children:t.jsx(a,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-total-multimedia",name:"total_multimedia",label:o.t("services.list.nombreMultimedia"),type:"number",value:e.values.total_multimedia,onChange:e.handleChange,error:e.touched.total_multimedia&&!!e.errors.total_multimedia,helperText:e.touched.total_multimedia&&e.errors.total_multimedia,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,sm:4,children:t.jsx(a,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-total-respo-ecodim",name:"total_respo_ecodim",label:o.t("services.list.responsableEcodim"),type:"number",value:e.values.total_respo_ecodim,onChange:e.handleChange,error:e.touched.total_respo_ecodim&&!!e.errors.total_respo_ecodim,helperText:e.touched.total_respo_ecodim&&e.errors.total_respo_ecodim,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,sm:4,children:t.jsx(a,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-total-animateurs-ecodim",name:"total_animateurs_ecodim",label:o.t("services.list.nombreAnimateurs"),type:"number",value:e.values.total_animateurs_ecodim,onChange:e.handleChange,error:e.touched.total_animateurs_ecodim&&!!e.errors.total_animateurs_ecodim,helperText:e.touched.total_animateurs_ecodim&&e.errors.total_animateurs_ecodim,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,sm:4,children:t.jsx(a,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-total-enfants-ecodim",name:"total_enfants_ecodim",label:`${o.t("services.list.nombreEnfants")} ${o.t("services.list.enfEcodim")}`,type:"number",value:e.values.total_enfants_ecodim,onChange:e.handleChange,error:e.touched.total_enfants_ecodim&&!!e.errors.total_enfants_ecodim,helperText:e.touched.total_enfants_ecodim&&e.errors.total_enfants_ecodim,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,sm:6,children:t.jsxs(a,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,select:!0,id:"service-form-superviseur",name:"superviseur",label:o.t("services.form.supervisor"),value:e.values.superviseur||"",onChange:e.handleChange,error:e.touched.superviseur&&!!e.errors.superviseur,helperText:e.touched.superviseur&&e.errors.superviseur,required:!0,autoComplete:"off",children:[t.jsx(m,{value:"",children:o.t("services.list.selectSuperviseur")}),p&&p.length>0?p.map(r=>t.jsx(m,{value:r._id||r.id,children:r.username||r.pseudo||o.t("common_text.unknownName")},r._id||r.id)):t.jsx(m,{disabled:!0,children:o.t("services.list.noSuperviseur")})]})}),t.jsx(i,{item:!0,xs:12,sm:6,children:t.jsx(a,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-invitation-youtube",name:"invitationYoutube",label:o.t("services.list.invitationsYoutube"),type:"number",value:e.values.invitationYoutube,onChange:e.handleChange,error:e.touched.invitationYoutube&&!!e.errors.invitationYoutube,helperText:e.touched.invitationYoutube&&e.errors.invitationYoutube,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,sm:6,children:t.jsx(a,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-invitation-tiktok",name:"invitationTiktok",label:o.t("services.list.invitationsTiktok"),type:"number",value:e.values.invitationTiktok,onChange:e.handleChange,error:e.touched.invitationTiktok&&!!e.errors.invitationTiktok,helperText:e.touched.invitationTiktok&&e.errors.invitationTiktok,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,sm:6,children:t.jsx(a,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-invitation-instagram",name:"invitationInstagram",label:o.t("services.list.invitationsInstagram"),type:"number",value:e.values.invitationInstagram,onChange:e.handleChange,error:e.touched.invitationInstagram&&!!e.errors.invitationInstagram,helperText:e.touched.invitationInstagram&&e.errors.invitationInstagram,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,sm:6,children:t.jsx(a,{sx:{minWidth:250,backgroundColor:"#fdfdfd"},fullWidth:!0,id:"service-form-invitation-physique",name:"invitationPhysique",label:o.t("services.list.invitationsPhysiques"),type:"number",value:e.values.invitationPhysique,onChange:e.handleChange,error:e.touched.invitationPhysique&&!!e.errors.invitationPhysique,helperText:e.touched.invitationPhysique&&e.errors.invitationPhysique,autoComplete:"off"})}),t.jsx(i,{item:!0,xs:12,children:t.jsxs(v,{display:"flex",justifyContent:"flex-end",gap:2,sx:{mt:1,right:0},children:[t.jsx(_,{variant:"outlined",color:"secondary",onClick:()=>e.resetForm(),children:o.t("common.actions.reset")}),t.jsx(_,{type:"submit",variant:"contained",color:"primary",children:o.t("common.actions.save")})]})})]})}),t.jsx(V,{open:h,onClose:()=>{d(!1),e.resetForm()},title:o.t("success.success"),content:o.t("success.serviceCreated")})]})}):t.jsx(j,{"data-aos":"fade-up",elevation:0,sx:{p:5,borderRadius:"24px",background:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(10px)",border:"2px solid rgba(102, 45, 145, 0.1)",boxShadow:"0 10px 40px rgba(102, 45, 145, 0.08)"},children:t.jsxs(v,{sx:{textAlign:"center",py:4},children:[t.jsx(k,{variant:"h6",color:"error",gutterBottom:!0,children:o.t("home.noChurchSelected")}),t.jsx(k,{variant:"body1",children:o.t("home.selectChurchForService")})]})})};export{re as default};
