const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-tM-Ac5N7.js","assets/mui-mRVmBbre.js","assets/vendor-Bzgz95E1.js","assets/redux-DbjaNwcH.js","assets/utils-DP_tgNw_.js","assets/router-BwhLjOj0.js","assets/index-Dy7-slVV.css"])))=>i.map(i=>d[i]);
import{r as d,j as n,B as f,T as y,I as Ie,aW as Bt,z as ht,G as te,h as Ee,R as yt,F as Fe,s as Ge,t as He,M as we,i as Ze,A as ot,aT as At,aU as Dt,C as Be,b9 as ba,ba as ja,bb as wa,a as Ca,n as Te,a$ as pn,bc as Li,b2 as nn,b3 as Yt,b4 as sn,b5 as ze,b6 as $,b7 as Kt,bd as Dr,be as Ss,aS as Kn,D as gn,a_ as Pn,bf as Ls,u as Ot,v as Rt,w as zt,x as Nt,S as kn,U as bt,bg as Sa,bh as fs,ae as Or,bi as La,al as Xr,bj as As,k as Ta,ag as Ts,ah as Es,bk as Ea,bl as Rr,m as Jr,X as Pa,af as ka,bm as Ia,bn as Ma,bo as Ps,aO as ks,bp as Aa,bq as zr,br as Da,bs as Oa,aE as Ra,bt as za,aL as Ci,aZ as Na,bu as Ba,aC as ps,bv as Nr,bw as Br,bx as Wa,by as Wr,bz as Za,aV as Fa,bA as Ha,bB as Ua,bC as qa,aM as Ga,bD as Qr,a9 as Zr,O as Ds,ao as gs,ab as xs,bE as $a,aa as Va,$ as Ya,bF as Ka,aq as Xa,o as Ja,a8 as Qa}from"./mui-mRVmBbre.js";import{u as el,b as tl}from"./redux-DbjaNwcH.js";import{d as hn,l as nt,i as o,a as de,n as Si,A as eo,c as Xt,h as jt,L as Ti,e as Ei,w as nl,o as il,x as sl,G as rl,T as ol,C as al,S as ll,g as cl,R as _s,Q as to,p as no,z as Fr,y as vs,_ as dl,b as Os,B as ul,U as hl,M as ml,D as fl,E as pl}from"./index-tM-Ac5N7.js";import{R as it,P as Rs,a as zs,C as Ns,T as st,L as mn,b as Tt,X as ft,Y as pt,c as _t,d as xt,B as tn,e as Ht}from"./charts-CgpetR2m.js";import{p as gl,a as xl,f as Pi,b as fn}from"./themeService-BmrTQJz0.js";import{D as In}from"./DeleteConfirmDialog-CIKPnhKB.js";import{S as Mn}from"./SecureErrorMessage-C13siMY2.js";import{a as _l,b as vl,c as yl}from"./useApi-DgHcifJO.js";import{u as xn}from"./useNotification-Dvvg7ylT.js";import"./preferencesService-CpvhBlZK.js";import{A as ki}from"./AccessControl-DiRRByFc.js";import{a as bl}from"./utils-DP_tgNw_.js";import{g as jl}from"./vendor-Bzgz95E1.js";import{u as io}from"./router-BwhLjOj0.js";const Hr={getChaineImpact:async l=>{try{return(await hn.get(`/chaine-impact?church_id=${l}`)).data}catch(u){throw u}},getChaineImpactByUser:async l=>{try{return(await hn.get(`/chaine-impact/user/${l}`)).data}catch(u){throw u}},updateChaineImpact:async l=>{try{return(await hn.post("/chaine-impact/update",{church_id:l})).data}catch(u){throw u}},deleteChaineImpact:async l=>{try{return(await hn.delete(`/chaine-impact/${l}`)).data}catch(u){throw u}}},so={getHistory:async(l={})=>{try{return(await hn.get("/activities/history",{params:l})).data}catch(u){throw nt.error("Erreur lors de la récupération de l'historique:",u),u}},getStats:async(l={})=>{try{return(await hn.get("/activities/stats",{params:l})).data}catch(u){throw nt.error("Erreur lors de la récupération des statistiques:",u),u}},logActivity:async l=>{try{return(await hn.post("/activities/log",l,{timeout:5e3})).data}catch{return null}}},Ke={pageLoads:0,apiCalls:0,cacheHits:0,cacheMisses:0,renderTimes:[],memoryUsage:[]},wl=l=>{const u=d.useRef(performance.now()),c=d.useRef(0);d.useEffect(()=>{const B=performance.now()-u.current;Ke.renderTimes.push({component:l,time:B,timestamp:Date.now()}),Ke.renderTimes.length>100&&Ke.renderTimes.shift(),Ke.pageLoads++});const p=d.useCallback((B,C,P)=>{c.current++,Ke.apiCalls++},[l]);d.useEffect(()=>{if("memory"in performance){const B=performance.memory;Ke.memoryUsage.push({component:l,used:B.usedJSHeapSize,total:B.totalJSHeapSize,limit:B.jsHeapSizeLimit,timestamp:Date.now()}),Ke.memoryUsage.length>50&&Ke.memoryUsage.shift()}},[l]);const b=d.useCallback(()=>{const B=Ke.renderTimes.length>0?Ke.renderTimes.reduce((P,S)=>P+S.time,0)/Ke.renderTimes.length:0,C=Ke.memoryUsage.length>0?Ke.memoryUsage.reduce((P,S)=>P+S.used,0)/Ke.memoryUsage.length:0;return{component:l,pageLoads:Ke.pageLoads,apiCalls:Ke.apiCalls,cacheHits:Ke.cacheHits,cacheMisses:Ke.cacheMisses,avgRenderTime:B.toFixed(2),avgMemoryUsage:(C/1024/1024).toFixed(2)+" MB",timestamp:Date.now()}},[l]),H=d.useCallback(()=>{Ke.cacheHits++},[]),w=d.useCallback(()=>{Ke.cacheMisses++},[]);return{trackApiCall:p,trackCacheHit:H,trackCacheMiss:w,getPerformanceStats:b,apiCallCount:c.current}},ys=new Map,bs=new Map,Cl=120*1e3,Mt=(l,u,c=[])=>{const[p,b]=d.useState(null),[H,w]=d.useState(!1),[B,C]=d.useState(null),P=wl(`useGlobalCache-${l}`),S=d.useCallback(()=>{const W=bs.get(l);return W?Date.now()-W<Cl:!1},[l]),k=d.useCallback(()=>{const W=ys.get(l);return W?P.trackCacheHit():P.trackCacheMiss(),W},[l,P]),D=d.useCallback(W=>{ys.set(l,W),bs.set(l,Date.now())},[l]),K=d.useCallback(async(W=!1)=>{if(!W&&S()){const ee=k();if(ee)return b(ee),ee}w(!0),C(null);const oe=performance.now();try{const ee=await u(),J=performance.now()-oe;return P.trackApiCall(l,J,!0),D(ee),b(ee),ee}catch(ee){const J=performance.now()-oe;throw P.trackApiCall(l,J,!1),C(ee),ee}finally{w(!1)}},[u,S,k,D,l,P]);d.useEffect(()=>{K()},c);const X=d.useCallback(()=>K(!0),[K]),F=d.useCallback(()=>{ys.delete(l),bs.delete(l)},[l]);return{data:p,loading:H,error:B,refresh:X,clearCache:F}},Tn=["#e6194b","#3cb44b","#ffe119","#4363d8","#f58231","#911eb4","#46f0f0","#f032e6","#bcf60c","#fabebe","#008080","#e6beff","#9a6324","#fffac8","#800000","#aaffc3","#808000","#ffd8b1","#000075","#808080","#ffffff","#000000","#a28ef5","#ffb6b9","#00c49f","#0088fe","#ffc658","#ff8042","#7b68ee","#f0e130"],Sl=({selectedChurch:l,refreshKey:u})=>{d.useEffect(()=>{o.init()},[]);const{data:c,loading:p,error:b,refresh:H}=Mt(`globalStats-${l?.id||"none"}`,async()=>{if(!l)return{};const I={churchId:l.id};try{const A=await de.stats.getOverview(I);return A.data?.data||A.data||{}}catch(A){throw A}},[u]),{data:w,loading:B,error:C,refresh:P}=Mt(`networkStats-${l?.id||"none"}`,async()=>{if(!l)return[];const I={churchId:l.id},A=await de.networks.getStats(I),N=A.data?.data||A.data||[];return Array.isArray(N)?N.map(q=>({name:q.nom,value:q.memberCount||0})):[]},[u]),{data:S,loading:k,error:D,refresh:K}=Mt(`networkEvolution-${l?.id||"none"}`,async()=>{if(!l)return[];const I={churchId:l.id},A=await de.stats.getNetworksEvolution(I),N=A.data?.data||A.data||[];return Array.isArray(N)?N:[]},[u]),{data:X,loading:F,error:W,refresh:oe}=Mt(`serviceAttendance-${l?.id||"none"}`,async()=>{if(!l)return[];const I={churchId:l.id},A=await de.services.getAll(I),N=A.data?.data||A.data||[];return Array.isArray(N)?N:[]},[u]),{loading:ee,error:J,refresh:x}=Mt(`networkYearCompare-${l?.id||"none"}`,async()=>{if(!l)return[];const I=new Date().getFullYear(),N={years:`${I-1},${I}`,churchId:l.id},R=await de.stats.getNetworksComparison(N),q=R.data?.data||R.data||[];return Array.isArray(q)?q:[]},[u]);if(d.useEffect(()=>{if(l){const I=setTimeout(()=>H(),100),A=setTimeout(()=>P(),300),N=setTimeout(()=>K(),500),R=setTimeout(()=>oe(),700),q=setTimeout(()=>x(),900);return()=>{clearTimeout(I),clearTimeout(A),clearTimeout(N),clearTimeout(R),clearTimeout(q)}}},[l]),!l)return n.jsx(f,{sx:{display:"flex",justifyContent:"center",my:4},children:n.jsx(y,{variant:"h6",color:"text.secondary",children:o.t("stats.selectChurch")})});new Date().getFullYear();const v=p||B||k||F||ee,_=b||C||D||W||J,V=I=>{if(!I)return null;let A=o.t("common.errorOccurred");return typeof I=="string"?A=I:I?.message?A=I.message:I?.response?.data?.message&&(A=I.response.data.message),A.includes("Request failed with status code 500")?A=o.t("errors.server500"):A.includes("Request failed with status code 429")&&(A=o.t("errors.tooManyRequests")),n.jsx(y,{color:"error",sx:{mt:2,textAlign:"center"},children:A})};return n.jsxs(f,{sx:{width:"100%",overflow:"hidden",overflowX:"auto"},children:[n.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",mb:6,alignItems:"center"},children:[n.jsx(y,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:o.t("stats.overview")}),n.jsx(Ie,{onClick:H,disabled:v,"aria-label":o.t("common.actions.refresh"),children:n.jsx(Bt,{})})]}),v?n.jsx(f,{sx:{display:"flex",justifyContent:"center",my:4},children:n.jsx(ht,{})}):_?V(_):n.jsxs(n.Fragment,{children:[n.jsx(te,{"data-aos":"fade-up",container:!0,spacing:2,sx:{mb:3},children:[{value:c?.total_all||0,label:o.t("stats.members")},{value:c?.total_reseaux||0,label:o.t("stats.networks")},{value:c?.total_gr||0,label:o.t("stats.groups")},{value:c?.total_resp_reseaux||0,label:o.t("stats.networkLeaders")},{value:c?.total_resp_gr||0,label:o.t("stats.groupLeaders")},{value:c?.total_leaders||0,label:o.t("stats.leaders")},{value:c?.total_leaders_all||0,label:o.t("stats.allLeaders")},{value:c?.total_reguliers||0,label:o.t("stats.regulars")},{value:c?.total_integration||0,label:o.t("stats.integration")},{value:c?.total_irreguliers||0,label:o.t("stats.irregulars")},{value:c?.total_gouvernance||0,label:o.t("stats.governance")},{value:c?.total_ecodim||0,label:o.t("stats.ecodim")},{value:c?.total_resp_ecodim||0,label:o.t("stats.ecodimLeaders")},{value:c?.total_personnes_isolees||0,label:o.t("stats.isolatedPersons")}].map((I,A)=>n.jsx(te,{xs:6,sm:4,md:3,lg:2,children:n.jsxs(Ee,{sx:{p:2,textAlign:"center",minHeight:80},children:[n.jsx(y,{color:"text.secondary",children:I.label}),n.jsx(y,{variant:"h5",children:I.value})]})},A))}),n.jsxs(te,{"data-aos":"fade-up",container:!0,spacing:1,sx:{display:"block"},children:[n.jsx(te,{xs:12,md:6,children:n.jsxs(Ee,{sx:{p:3,width:"100%",backgroundColor:"#f9f9f9",overflowX:"auto",display:"flex",flexDirection:"column",justifyContent:"center"},children:[n.jsx(y,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:o.t("stats.membersByNetwork")}),!w||w.length===0?n.jsx(f,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:400},children:n.jsx(y,{variant:"h6",color:"text.secondary",children:B?o.t("common.actions.loading"):o.t("stats.noDataForChurch")})}):n.jsxs(n.Fragment,{children:[n.jsx(f,{children:n.jsx(f,{sx:{flex:1,minHeight:0,alignItems:"center",justifyContent:"center"},children:n.jsx(it,{width:"100%",height:600,children:n.jsxs(Rs,{children:[n.jsx(zs,{data:w,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:250,label:(({cx:I,cy:A,midAngle:N,innerRadius:R,outerRadius:q,percent:E,index:j})=>{const Y=Math.PI/180,re=R+(q-R)*1.15,ie=I+re*Math.cos(-N*Y),Q=A+re*Math.sin(-N*Y),pe=w?.[j]?.value||0,ne=(w||[]).reduce((Oe,Me)=>Oe+(Me.value||0),0),ce=ne>0?(pe/ne*100).toFixed(1):0;return n.jsx("text",{x:ie,y:Q,fill:Tn[j%Tn.length],textAnchor:ie>I?"start":"end",dominantBaseline:"central",fontSize:16,fontWeight:600,children:`${w[j]?.name}: ${pe} (${ce}%)`})}),children:(w||[]).map((I,A)=>n.jsx(Ns,{fill:Tn[A%Tn.length]},`cell-${A}`))}),n.jsx(st,{})]})})})}),n.jsx(f,{sx:{bgcolor:"#f9f9f9",borderRadius:2,border:"1px solid #e0e0e0",p:4},children:(()=>{const I=new Date,A=I.toLocaleString("fr-FR",{month:"long"}),N=I.getFullYear(),R=I.getDate(),q=(w||[]).reduce((Q,pe)=>Q+(pe.value||0),0),E=[...w||[]].sort((Q,pe)=>(pe.value||0)-(Q.value||0)),j=E[0],Y=E[1],re=new Date(I.getFullYear(),I.getMonth(),1),ie=(w||[]).filter(Q=>Q.createdAt?new Date(Q.createdAt)>=re:!1);return n.jsxs(y,{sx:{fontSize:18,color:"#444",fontStyle:"italic",textAlign:"center"},children:[o.t("stats.interpretation.datePrefix"),n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:`${R} ${A} ${N}`}),o.t("stats.interpretation.totalMembers"),n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:q}),n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:o.t("stats.interpretation.persons")}),j&&n.jsxs(n.Fragment,{children:[o.t("stats.interpretation.largestNetwork"),n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:` « ${j.name} »`}),o.t("stats.interpretation.with"),n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:j.value}),n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:o.t("stats.interpretation.members")}),Y&&n.jsxs(n.Fragment,{children:[o.t("stats.interpretation.followedBy"),n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:` « ${Y.name} »`}),o.t("stats.interpretation.parentheses"),n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:Y.value}),n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:o.t("stats.interpretation.members")}),o.t("stats.interpretation.closeParentheses")]}),ie&&ie.length>0&&n.jsxs(n.Fragment,{children:[o.t("stats.interpretation.inMonth"),n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:`${A} ${N}`}),o.t("stats.interpretation.networks"),n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:(ie||[]).map(Q=>`« ${Q.name} »`).join(", ")}),o.t("stats.interpretation.wereCreated")]})]})]})})()})]})]})}),n.jsx(te,{"data-aos":"fade-up",xs:12,md:8,sx:{minWidth:400,mt:3},children:n.jsxs(Ee,{sx:{p:3,height:520,minWidth:0,overflowX:"auto",display:"flex",flexDirection:"column",justifyContent:"center",backgroundColor:"#f9f9f9"},children:[n.jsx(y,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:o.t("stats.monthlyEvolution")}),n.jsx(f,{sx:{flex:1,minHeight:0,display:"flex",alignItems:"center",justifyContent:"center"},children:Array.isArray(S)&&S.length>0&&Object.keys(S[0]).length>1?n.jsx(it,{width:"100%",height:440,children:n.jsxs(mn,{data:S,margin:{top:20,right:20,left:0,bottom:0},children:[n.jsx(Tt,{strokeDasharray:"3 3"}),n.jsx(ft,{dataKey:"month"}),n.jsx(pt,{allowDecimals:!1}),n.jsx(st,{}),n.jsx(_t,{}),Object.keys(S[0]).filter(I=>I!=="month").map((I,A)=>n.jsx(xt,{type:"monotone",dataKey:I,stroke:Tn[A%Tn.length],strokeWidth:2,dot:!1},I))]})}):n.jsx(y,{sx:{color:"#888",fontSize:20,textAlign:"center",width:"100%"},children:o.t("stats.noMonthlyData")})})]})}),n.jsx(te,{"data-aos":"fade-up",xs:12,md:8,sx:{minWidth:400,mt:3},children:n.jsxs(Ee,{sx:{p:3,minHeight:320,backgroundColor:"#f9f9f9"},children:[n.jsx(y,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:o.t("stats.networkComparison")}),n.jsx(it,{width:"100%",height:400,children:n.jsxs(tn,{data:(()=>{if(!S||S.length===0)return[];const I=S.slice(-3);return(Object.keys(I[0]||{}).filter(N=>N!=="month")||[]).map(N=>{const R={network:N};return(I||[]).forEach((q,E)=>{const j=new Date(q.month+"-01").toLocaleString("fr-FR",{month:"short",year:"2-digit"});R[j]=q[N]||0}),R})})(),children:[n.jsx(st,{}),n.jsx(Tt,{strokeDasharray:"3 3"}),n.jsx(ft,{dataKey:"network"}),n.jsx(pt,{allowDecimals:!1}),n.jsx(_t,{}),!S||S.length===0?null:(S.slice(-3)||[]).map((A,N)=>{const R=new Date(A.month+"-01").toLocaleString("fr-FR",{month:"short",year:"2-digit"}),q=["#8884d8","#82ca9d","#ffc658"];return n.jsx(Ht,{dataKey:R,fill:q[N%q.length],name:R.charAt(0).toUpperCase()+R.slice(1),activeBar:!1},R)})]})})]})}),n.jsx(te,{"data-aos":"fade-up",xs:12,md:12,sx:{minWidth:400,mt:3},children:n.jsxs(Ee,{sx:{p:3,height:520,minWidth:0,overflowX:"auto",display:"flex",flexDirection:"column",justifyContent:"center",backgroundColor:"#f9f9f9"},children:[n.jsx(y,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:o.t("stats.serviceAttendance")}),n.jsx(f,{sx:{flex:1,minHeight:0,display:"flex",alignItems:"center",justifyContent:"center"},children:n.jsx(it,{width:"100%",height:440,children:n.jsxs(mn,{data:(()=>{const I=(X||[]).map(q=>new Date(q.date).toISOString().slice(0,10));return([...new Set(I)].sort().slice(-8)||[]).map(q=>{const E={date:new Date(q).toLocaleDateString("fr-FR")};return[o.t("stats.service1"),o.t("stats.service2"),o.t("stats.service3")].forEach((j,Y)=>{const re=(X||[]).find(ie=>new Date(ie.date).toISOString().slice(0,10)===q&&ie.culte===j);E[`culte${Y+1}`]=re?(re.total_adultes||0)+(re.total_enfants||0)+(re.total_chantres||0)+(re.total_protocoles||0)+(re.total_multimedia||0)+(re.total_respo_ecodim||0)+(re.total_animateurs_ecodim||0)+(re.total_enfants_ecodim||0):0}),E})})(),margin:{top:20,right:20,left:0,bottom:0},children:[n.jsx(Tt,{strokeDasharray:"3 3"}),n.jsx(ft,{dataKey:"date"}),n.jsx(pt,{allowDecimals:!1,interval:0,tickCount:10}),n.jsx(st,{}),n.jsx(_t,{}),n.jsx(xt,{type:"monotone",dataKey:"culte1",stroke:"#1976d2",name:o.t("stats.service1"),strokeWidth:2,dot:!0}),n.jsx(xt,{type:"monotone",dataKey:"culte2",stroke:"#FFBB28",name:o.t("stats.service2"),strokeWidth:2,dot:!0}),n.jsx(xt,{type:"monotone",dataKey:"culte3",stroke:"#43a047",name:o.t("stats.service3"),strokeWidth:2,dot:!0})]})})})]})})]})]})]})},En=["#0088FE","#00C49F","#FFBB28","#FF8042","#B455C6","#FF6666","#82ca9d","#8884d8","#ffc658","#a4de6c","#d0ed57"],Ur=l=>!l||l.length===0?[]:l.map(u=>{if(!u.evolution||u.evolution.length<2)return{name:u.nom,croissance:o.t("statsReseaux.new")};const c=u.evolution[u.evolution.length-1],p=u.evolution[u.evolution.length-2];if(p.memberCount===0)return{name:u.nom,croissance:o.t("statsReseaux.new")};const b=(c.memberCount-p.memberCount)/p.memberCount*100;return{name:u.nom,croissance:Math.round(b)}}),Ll=({selectedChurch:l,refreshKey:u})=>{d.useEffect(()=>{o.init()},[]);const{data:c,loading:p,error:b,refresh:H}=Mt(`networkStats-${l?.id||"none"}`,async()=>{if(!l)return[];const v={churchId:l.id},_=await de.networks.getStats(v),V=_.data?.data||_.data||[];return Array.isArray(V)?V.filter(A=>A&&A.nom&&(A.memberCount||0)>0).map(A=>({name:A.nom||"Réseau sans nom",value:A.memberCount||0})):[]},[u]),{data:w,loading:B,error:C,refresh:P}=Mt(`networkEvolution-${l?.id||"none"}`,async()=>{if(!l)return[];const v={churchId:l.id},_=await de.stats.getNetworksEvolution(v),V=_.data?.data||_.data||[];return Array.isArray(V)?V:[]},[u]),{loading:S,error:k,refresh:D}=Mt(`networkYearCompare-${l?.id||"none"}`,async()=>{if(!l)return[];const v=new Date().getFullYear(),V={years:`${v-1},${v}`,churchId:l.id},I=await de.stats.getNetworksComparison(V),A=I.data?.data||I.data||[];return Array.isArray(A)?A:[]},[u]),{data:K,loading:X,error:F,refresh:W}=Mt(`networkQualificationStats-${l?.id||"none"}`,async()=>{if(!l)return[];try{const v={churchId:l.id},_=await de.networks.getQualificationStats(v),V=_.data?.data||_.data||[];return Array.isArray(V)?V.filter(A=>A&&A.networkName&&A.totalMembers>0).map(A=>{const N={name:A.networkName};return A.qualifications&&typeof A.qualifications=="object"&&Object.entries(A.qualifications).forEach(([R,q])=>{R&&q!==void 0&&q!==null&&q>0&&R!==o.t("statsReseaux.notSpecified")&&(N[R]=q)}),N}).filter(A=>Object.keys(A).some(R=>R!=="name")):[]}catch{return[]}});if(d.useEffect(()=>{if(l){const v=setTimeout(()=>{H(),P(),D(),W()},100);return()=>clearTimeout(v)}},[l]),!l)return n.jsx(f,{sx:{display:"flex",justifyContent:"center",my:4},children:n.jsx(y,{variant:"h6",color:"text.secondary",children:"Veuillez sélectionner une église pour voir les statistiques"})});const oe=p||B||S||X,ee=v=>v?typeof v=="string"?v:v?.message?v.message:v?.response?.data?.message?v.response.data.message:o.t("common.errorOccurred"):null,J=ee(b)||ee(C)||ee(k)||ee(F),x=v=>{if(!v)return null;let _=o.t("common.errorOccurred");return typeof v=="string"?_=v:v?.message?_=v.message:v?.response?.data?.message&&(_=v.response.data.message),n.jsx(y,{color:"error",sx:{mt:2,textAlign:"center"},children:_})};return n.jsxs(f,{children:[n.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",mb:3,alignItems:"center"},children:[n.jsx(y,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:o.t("statsReseaux.title")}),n.jsx(Ie,{onClick:H,disabled:oe,"aria-label":o.t("common.actions.refresh"),children:n.jsx(Bt,{})})]}),oe?n.jsx(f,{sx:{display:"flex",justifyContent:"center",my:4},children:n.jsx(ht,{})}):J?x(J):n.jsxs(te,{children:[n.jsx(te,{"data-aos":"fade-up",item:!0,xs:12,sx:{mt:0},children:n.jsxs(Ee,{sx:{p:3,backgroundColor:"#f9f9f9",overflowX:"auto"},children:[n.jsx(y,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:o.t("statsReseaux.membersByNetwork")}),!c||c.length===0?n.jsx(f,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:400},children:n.jsx(y,{variant:"h6",color:"text.secondary",children:p?o.t("common.loading"):o.t("statsReseaux.noDataForChurch")})}):n.jsx(it,{width:"100%",height:600,children:n.jsxs(Rs,{children:[n.jsx(zs,{data:c,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:250,label:({name:v,value:_})=>{if(!v||_===void 0||_===null)return"";const V=(c||[]).reduce((A,N)=>A+(N.value||0),0),I=V?(_/V*100).toFixed(1):0;return`${v}: ${_} (${I}%)`},children:(c||[]).map((v,_)=>n.jsx(Ns,{fill:En[_%En.length]},`cell-${_}`))}),n.jsx(st,{})]})}),n.jsx(f,{sx:{bgcolor:"#f9f9f9",borderRadius:2,border:"1px solid #e0e0e0",p:4},children:(()=>{const v=new Date,_=v.toLocaleString("fr-FR",{month:"long"}),V=v.getFullYear(),I=v.getDate(),A=(c||[]).reduce((Y,re)=>Y+(re.value||0),0),N=[...c||[]].filter(Y=>Y&&Y.value!==void 0&&Y.value!==null).sort((Y,re)=>(re.value||0)-(Y.value||0)),R=N[0],q=N[1],E=new Date(v.getFullYear(),v.getMonth(),1),j=(c||[]).filter(Y=>Y.createdAt?new Date(Y.createdAt)>=E:!1);return n.jsxs(y,{sx:{fontSize:18,color:"#444",fontStyle:"italic",textAlign:"center"},children:[o.t("statsReseaux.interpretation.datePrefix"),n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:`${I} ${_} ${V}`}),o.t("statsReseaux.interpretation.totalMembers"),n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:A}),n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:" personnes."}),R&&R.name&&R.value&&n.jsxs(n.Fragment,{children:[" Le plus grand réseau est ",n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:` « ${R.name} »`})," avec ",n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:R.value}),n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:" membres"}),q&&q.name&&q.value&&n.jsxs(n.Fragment,{children:[", suivi du réseau ",n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:` « ${q.name} »`})," (",n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:q.value}),n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:" membres"}),")"]}),"."]}),j.length>0&&j.every(Y=>Y&&Y.name)&&n.jsxs(n.Fragment,{children:[" ",j.length===1?n.jsxs(n.Fragment,{children:[o.t("statsReseaux.inMonth"),n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:`${_} ${V}`}),", le réseau ",n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:` « ${j[0].name} »`})," a vu le jour."]}):n.jsxs(n.Fragment,{children:[o.t("statsReseaux.inMonth"),n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:`${_} ${V}`}),", les réseaux ",n.jsx(f,{component:"span",fontWeight:"bold",color:"primary.main",children:(j||[]).filter(Y=>Y&&Y.name).map(Y=>`« ${Y.name} »`).join(", ")})," ont vu le jour."]})]})]})})()})]})}),n.jsx(te,{"data-aos":"fade-up",item:!0,xs:12,sx:{mt:4},children:n.jsxs(Ee,{sx:{p:3,height:520,minWidth:0,overflowX:"auto",display:"flex",flexDirection:"column",justifyContent:"center",backgroundColor:"#f9f9f9"},children:[n.jsx(y,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:o.t("statsReseaux.monthlyEvolution")}),n.jsx(f,{sx:{flex:1,minHeight:0,display:"flex",alignItems:"center",justifyContent:"center"},children:n.jsx(it,{width:"100%",height:440,children:n.jsxs(mn,{data:w,margin:{top:20,right:20,left:0,bottom:0},children:[n.jsx(Tt,{strokeDasharray:"3 3"}),n.jsx(ft,{dataKey:"month"}),n.jsx(pt,{allowDecimals:!1}),n.jsx(st,{}),n.jsx(_t,{}),(w||[]).length>0&&Object.keys((w||[])[0]||{}).filter(v=>v!=="month").map((v,_)=>n.jsx(xt,{type:"monotone",dataKey:v,stroke:En[_%En.length],strokeWidth:2,dot:!1},v))]})})})]})}),n.jsx(te,{"data-aos":"fade-up",item:!0,xs:12,sx:{mt:4},children:n.jsxs(Ee,{sx:{p:3,minHeight:320,backgroundColor:"#f9f9f9",overflowX:"auto"},children:[n.jsx(y,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:o.t("statsReseaux.networkComparison")}),n.jsx(it,{width:"100%",height:400,children:n.jsxs(tn,{data:(()=>{if(!w||w.length===0)return[];const v=w.slice(-3);return(Object.keys(v[0]||{}).filter(V=>V!=="month")||[]).map(V=>{const I={network:V};return(v||[]).forEach((A,N)=>{const R=new Date(A.month+"-01").toLocaleString("fr-FR",{month:"short",year:"2-digit"});I[R]=A[V]||0}),I})})(),margin:{top:20,right:20,left:0,bottom:0},children:[n.jsx(st,{}),n.jsx(Tt,{strokeDasharray:"3 3"}),n.jsx(ft,{dataKey:"network"}),n.jsx(pt,{allowDecimals:!1}),n.jsx(_t,{}),!w||w.length===0?null:(w.slice(-3)||[]).map((_,V)=>{const I=new Date(_.month+"-01").toLocaleString("fr-FR",{month:"short",year:"2-digit"}),A=["#8884d8","#82ca9d","#ffc658"];return n.jsx(Ht,{dataKey:I,fill:A[V%A.length],name:I.charAt(0).toUpperCase()+I.slice(1),activeBar:!1},I)})]})})]})}),K&&K.length>0&&n.jsx(te,{"data-aos":"fade-up",item:!0,xs:12,sx:{mt:4},children:n.jsxs(Ee,{sx:{p:3,minHeight:320,backgroundColor:"#f9f9f9",overflowX:"auto"},children:[n.jsx(y,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:o.t("statsReseaux.internalComposition")}),n.jsx(it,{width:"100%",height:400,children:n.jsxs(tn,{data:K,margin:{top:20,right:20,left:0,bottom:0},children:[n.jsx(Tt,{strokeDasharray:"3 3"}),n.jsx(ft,{dataKey:"name"}),n.jsx(pt,{allowDecimals:!1}),n.jsx(st,{}),n.jsx(_t,{}),(Array.from(new Set((K||[]).flatMap(_=>Object.keys(_||{}).filter(V=>V!=="name"))))||[]).map((_,V)=>n.jsx(Ht,{dataKey:_,stackId:"a",fill:En[V%En.length],name:_},_))]})})]})}),w&&w.length>1&&n.jsx(te,{"data-aos":"fade-up",item:!0,xs:12,sx:{mt:4},children:n.jsxs(Ee,{sx:{p:3,minHeight:320,backgroundColor:"#f9f9f9",overflowX:"auto"},children:[n.jsx(y,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:o.t("statsReseaux.growthRate")}),n.jsx(it,{width:"100%",height:400,children:n.jsxs(tn,{data:Ur(w),margin:{top:20,right:20,left:0,bottom:0},children:[n.jsx(Tt,{strokeDasharray:"3 3"}),n.jsx(ft,{dataKey:"name"}),n.jsx(pt,{allowDecimals:!1,tickFormatter:v=>v+"%"}),n.jsx(st,{formatter:v=>v!==null?v+"%":"N/A"}),n.jsx(_t,{}),n.jsx(Ht,{dataKey:"croissance",fill:"#82ca9d",name:o.t("statsReseaux.growth")})]})}),(()=>{const v=Ur(w);if(!v.length)return null;const _=(v||[]).filter(j=>typeof j.croissance=="number"&&j.croissance>0),V=(v||[]).filter(j=>typeof j.croissance=="number"&&j.croissance<0),I=(v||[]).filter(j=>j.croissance===0),A=(v||[]).filter(j=>j.croissance===o.t("statsReseaux.new")),N=_.filter(j=>j.name||j.nom),R=V.filter(j=>j.name||j.nom),q=I.filter(j=>j.name||j.nom),E=A.filter(j=>j.name||j.nom);return N.length===0&&R.length===0&&q.length===0&&E.length===0?null:n.jsx(f,{sx:{bgcolor:"#f9f9f9",borderRadius:2,border:"1px solid #e0e0e0",p:4,mt:3},children:n.jsxs(y,{sx:{fontSize:18,color:"#444",fontStyle:"italic",textAlign:"center"},children:[N.length>0&&n.jsxs(n.Fragment,{children:[n.jsxs(f,{component:"span",fontWeight:"bold",color:"success.main",children:["Réseaux en croissance : ",N.map(j=>`« ${j.name||j.nom} » (+${j.croissance}%)`).join(", ")]}),".",n.jsx("br",{})]}),R.length>0&&n.jsxs(n.Fragment,{children:[n.jsxs(f,{component:"span",fontWeight:"bold",color:"error.main",children:["Réseaux en baisse : ",R.map(j=>`« ${j.name||j.nom} » (${j.croissance}%)`).join(", ")]}),".",n.jsx("br",{})]}),q.length>0&&n.jsxs(n.Fragment,{children:[n.jsxs(f,{component:"span",fontWeight:"bold",color:"warning.main",children:["Réseaux stables : ",q.map(j=>`« ${j.name||j.nom} »`).join(", ")]}),".",n.jsx("br",{})]}),E.length>0&&n.jsxs(n.Fragment,{children:[n.jsxs(f,{component:"span",fontWeight:"bold",color:"info.main",children:["Nouveaux réseaux : ",E.map(j=>`« ${j.name||j.nom} »`).join(", ")]}),".",n.jsx("br",{})]})]})})})()]})})]})]})},js=["#8884d8","#82ca9d","#ffc658"],Tl=({selectedChurch:l})=>{const{data:u,loading:c,error:p,refresh:b}=Mt(`services-${l||"none"}`,async()=>{if(!l)return[];const D=new Date,K=new Date(D.getFullYear(),D.getMonth()-2,1),X=new Date(D.getFullYear(),D.getMonth()+1,0),F=K.toISOString().slice(0,10),W=X.toISOString().slice(0,10),oe={start:F,end:W,churchId:l.id},ee=await de.services.getAll(oe);return ee.data?.data||ee.data||[]},{ttl:3e5,staleWhileRevalidate:!0});d.useEffect(()=>{if(l){const D=setTimeout(()=>{b()},100);return()=>clearTimeout(D)}},[l]);const H=yt.useMemo(()=>{if(!u||u.length===0)return[];const D=u.map(F=>new Date(F.date).toISOString().slice(0,10));return[...new Set(D)].sort().slice(-8).map(F=>{const W={date:new Date(F).toLocaleDateString("fr-FR")};return["Culte 1","Culte 2","Culte 3"].forEach((oe,ee)=>{const J=u.find(x=>new Date(x.date).toISOString().slice(0,10)===F&&x.culte===oe);W[`culte${ee+1}`]=J?(J.total_adultes||0)+(J.total_enfants||0)+(J.total_chantres||0)+(J.total_protocoles||0)+(J.total_multimedia||0)+(J.total_respo_ecodim||0)+(J.total_animateurs_ecodim||0)+(J.total_enfants_ecodim||0):0}),W})},[u]),w=["total_chantres","total_protocoles","total_multimedia","total_respo_ecodim","total_animateurs_ecodim"],B=yt.useCallback(D=>{if(!u||u.length===0)return[];const K=u.map(W=>new Date(W.date).toISOString().slice(0,10));return[...new Set(K)].sort().slice(-8).map(W=>{const oe={date:new Date(W).toLocaleDateString("fr-FR")},ee=u.find(_=>new Date(_.date).toISOString().slice(0,10)===W&&_.culte===D),J=ee?(ee.total_adultes||0)+(ee.total_enfants||0)+(ee.total_chantres||0)+(ee.total_protocoles||0)+(ee.total_multimedia||0)+(ee.total_respo_ecodim||0)+(ee.total_animateurs_ecodim||0)+(ee.total_enfants_ecodim||0):0,x=ee?w.reduce((_,V)=>_+(ee[V]||0),0):0,v=J-x;return oe.audienceSansServiteurs=v,oe.audienceAvecServiteurs=J,oe})},[u,w]),C=yt.useMemo(()=>B("Culte 1"),[B]),P=yt.useMemo(()=>B("Culte 2"),[B]),S=yt.useMemo(()=>B("Culte 3"),[B]),k=D=>typeof D=="string"?D:D?.message?D.message:D?.response?.data?.message?D.response.data.message:"Une erreur est survenue lors du chargement des données";return l?n.jsxs(f,{children:[n.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",mb:3,alignItems:"center"},children:[n.jsx(y,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:"Statistiques Cultes"}),n.jsx(Ie,{onClick:b,disabled:c,"aria-label":o.t("common.actions.refresh"),children:n.jsx(Bt,{})})]}),c?n.jsx(f,{sx:{display:"flex",justifyContent:"center",my:4},children:n.jsx(ht,{})}):p?n.jsx(y,{color:"error",children:k(p)}):n.jsxs(Ee,{"data-aos":"fade-up",sx:{p:3,height:520,minWidth:0,overflowX:"auto",display:"flex",flexDirection:"column",justifyContent:"center",backgroundColor:"#f9f9f9"},children:[n.jsx(y,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:"Fréquentation des cultes par culte (8 derniers dimanches)"}),n.jsx(f,{sx:{flex:1,minHeight:0,display:"flex",alignItems:"center",justifyContent:"center"},children:n.jsx(it,{width:"100%",height:440,children:n.jsxs(mn,{data:H,margin:{top:20,right:20,left:0,bottom:0},children:[n.jsx(Tt,{strokeDasharray:"3 3"}),n.jsx(ft,{dataKey:"date"}),n.jsx(pt,{allowDecimals:!1}),n.jsx(st,{}),n.jsx(_t,{}),n.jsx(xt,{type:"monotone",dataKey:"culte1",stroke:js[0],strokeWidth:2,dot:!0,name:"Culte 1"}),n.jsx(xt,{type:"monotone",dataKey:"culte2",stroke:js[1],strokeWidth:2,dot:!0,name:"Culte 2"}),n.jsx(xt,{type:"monotone",dataKey:"culte3",stroke:js[2],strokeWidth:2,dot:!0,name:"Culte 3"})]})})})]}),n.jsxs(Ee,{sx:{p:3,mt:4,backgroundColor:"#f9f9f9"},children:[n.jsx(y,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:"Audience - Culte 1"}),n.jsx(it,{width:"100%",height:300,children:n.jsxs(mn,{data:C,children:[n.jsx(ft,{dataKey:"date"}),n.jsx(pt,{allowDecimals:!1}),n.jsx(st,{}),n.jsx(_t,{}),n.jsx(xt,{type:"monotone",dataKey:"audienceSansServiteurs",stroke:"#1976d2",strokeWidth:2,dot:!0,name:"Audience, à l'exception des serviteurs"}),n.jsx(xt,{type:"monotone",dataKey:"audienceAvecServiteurs",stroke:"#43a047",strokeWidth:2,dot:!0,name:"Audience, avec les serviteurs"})]})})]}),n.jsxs(Ee,{sx:{p:3,mt:4,backgroundColor:"#f9f9f9"},children:[n.jsx(y,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:"Audience - Culte 2"}),n.jsx(it,{width:"100%",height:300,children:n.jsxs(mn,{data:P,children:[n.jsx(ft,{dataKey:"date"}),n.jsx(pt,{allowDecimals:!1}),n.jsx(st,{}),n.jsx(_t,{}),n.jsx(xt,{type:"monotone",dataKey:"audienceSansServiteurs",stroke:"#1976d2",strokeWidth:2,dot:!0,name:"Audience, à l'exception des serviteurs"}),n.jsx(xt,{type:"monotone",dataKey:"audienceAvecServiteurs",stroke:"#43a047",strokeWidth:2,dot:!0,name:"Audience, avec les serviteurs"})]})})]}),n.jsxs(Ee,{sx:{p:3,mt:4,backgroundColor:"#f9f9f9"},children:[n.jsx(y,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:"Audience - Culte 3"}),n.jsx(it,{width:"100%",height:300,children:n.jsxs(mn,{data:S,children:[n.jsx(ft,{dataKey:"date"}),n.jsx(pt,{allowDecimals:!1}),n.jsx(st,{}),n.jsx(_t,{}),n.jsx(xt,{type:"monotone",dataKey:"audienceSansServiteurs",stroke:"#1976d2",strokeWidth:2,dot:!0,name:"Audience, à l'exception des serviteurs"}),n.jsx(xt,{type:"monotone",dataKey:"audienceAvecServiteurs",stroke:"#43a047",strokeWidth:2,dot:!0,name:"Audience, avec les serviteurs"})]})})]})]}):n.jsx(f,{sx:{display:"flex",justifyContent:"center",my:4},children:n.jsx(y,{variant:"h6",color:"text.secondary",children:"Veuillez sélectionner une église pour voir les statistiques"})})},El=({selectedChurch:l,user:u})=>{const c=()=>{const x=new Date,v=x.getFullYear(),_=new Date(v,0,1),V=Math.floor((x-_)/(1440*60*1e3));let I=Math.ceil((V+_.getDay()+1)/7);if(I===0){const A=v-1,N=new Date(A,0,1),R=Math.floor((x-N)/(1440*60*1e3));I=Math.ceil((R+N.getDay()+1)/7)}if(I=I-1,I<=0){const A=v-1;return I=52,`${A}-W${I.toString().padStart(2,"0")}`}return`${v}-W${I.toString().padStart(2,"0")}`},[p,b]=d.useState({church_id:l?.id||"",network_id:"",type_culte:"",date_from:c()}),[H,w]=d.useState(!1),[B,C]=d.useState(null),[P,S]=d.useState(null),[k,D]=d.useState([]);d.useEffect(()=>{const x=async()=>{try{const v=await de.networks.getAll({churchId:l?.id}),_=v.data?.data||v.data||[];if(Array.isArray(_)){D(_);const V=Si.find(I=>I.value!=="Tous");b(I=>({...I,network_id:"",type_culte:V?V.value:""}))}else D([])}catch{D([])}};l?.id?x():D([])},[l]),d.useEffect(()=>{l?.id&&p.type_culte&&p.date_from&&K()},[l?.id,p.network_id,p.type_culte,p.date_from,k.length]);const K=async()=>{w(!0),C(null);try{const x={...p};if(p.date_from&&p.date_from.includes("-W"))try{const[_,V]=p.date_from.split("-W"),I=parseInt(V),A=new Date(_,0,1),N=new Date(_,0,1);for(;N.getDay()!==4;)N.setDate(N.getDate()+1);const R=new Date(N);R.setDate(N.getDate()+(I-1)*7-3);const q=new Date(R);if(q.setDate(R.getDate()+6),isNaN(R.getTime())||isNaN(q.getTime()))throw new Error("Dates invalides générées");x.date_from=R.toISOString().split("T")[0],x.date_to=q.toISOString().split("T")[0]}catch{delete x.date_from}const v=await gl.getStats(x);if(v.success){const _=v.data,V={total_previsionnel:_.total_previsionnel||0,total_effectif_reel:_.total_effectif||0,chartData:_.chart_data||[],details:_.details||[]};S(V)}else C(v.message||"Erreur lors du chargement des statistiques"),S(null)}catch(x){C(x.response?.data?.message||"Erreur lors du chargement des statistiques"),S(null)}finally{w(!1)}},X=(x,v)=>{b(_=>({..._,[x]:v}))},F=x=>{if(!x)return"";try{const[v,_]=x.split("-W"),V=parseInt(_),I=new Date(v,0,1),A=new Date(v,0,1);for(;A.getDay()!==4;)A.setDate(A.getDate()+1);const N=new Date(A);N.setDate(A.getDate()+(V-1)*7-3);const R=new Date(N);R.setDate(N.getDate()+6);const q={weekday:"long",day:"numeric",month:"long",year:"numeric"};return`Semaine ${V} (${R.toLocaleDateString("fr-FR",q)})`}catch{return x}},W=P?.chartData||[],oe=P?.total_previsionnel||0,ee=P?.total_effectif_reel||0,J=oe-ee;return n.jsxs(f,{sx:{p:3},children:[n.jsx(y,{variant:"h4",gutterBottom:!0,children:o.t("previsionnel.dashboard.title")}),n.jsx(y,{variant:"body1",color:"text.secondary",sx:{mb:3},children:o.t("previsionnel.dashboard.subtitle")}),n.jsxs(Ee,{sx:{p:3,mb:3},children:[n.jsx(y,{variant:"h6",gutterBottom:!0,children:o.t("previsionnel.dashboard.filters.title")}),n.jsxs(te,{container:!0,spacing:3,alignItems:"flex-start",children:[n.jsx(te,{item:!0,xs:12,sm:6,md:4,children:n.jsxs(Fe,{fullWidth:!0,children:[n.jsx(Ge,{id:"stats-previsionnel-network-label",children:o.t("previsionnel.dashboard.filters.network")}),n.jsxs(He,{id:"stats-previsionnel-network",name:"network_id",sx:{minWidth:"100px"},value:p.network_id,onChange:x=>X("network_id",x.target.value),label:o.t("previsionnel.dashboard.filters.network"),labelId:"stats-previsionnel-network-label",autoComplete:"off",children:[n.jsx(we,{value:"",children:n.jsx("strong",{children:"Tous les réseaux"})}),k.map(x=>n.jsx(we,{value:x.id,children:x.nom},x.id))]})]})}),n.jsx(te,{item:!0,xs:12,sm:6,md:4,children:n.jsxs(Fe,{fullWidth:!0,children:[n.jsx(Ge,{id:"stats-previsionnel-type-label",children:o.t("previsionnel.dashboard.filters.type")}),n.jsxs(He,{id:"stats-previsionnel-type",name:"type_culte",sx:{minWidth:"100px"},value:p.type_culte,onChange:x=>X("type_culte",x.target.value),label:o.t("previsionnel.dashboard.filters.type"),labelId:"stats-previsionnel-type-label",autoComplete:"off",children:[n.jsx(we,{value:"",children:"Tous"}),Si.filter(x=>x.value!=="Tous").map(x=>n.jsx(we,{value:x.value,children:x.label},x.value))]})]})}),n.jsx(te,{item:!0,xs:12,sm:6,md:4,children:n.jsx(Ze,{fullWidth:!0,id:"stats-previsionnel-week",name:"date_from",type:"week",label:"Semaine",sx:{minWidth:"100px"},value:p.date_from||"",onChange:x=>X("date_from",x.target.value),InputLabelProps:{shrink:!0},helperText:p.date_from?F(p.date_from):"Format: Semaine/Mois/Année",autoComplete:"off"})})]})]}),B&&n.jsx(ot,{severity:"error",sx:{mb:3},children:B}),P&&n.jsxs(te,{container:!0,spacing:3,sx:{mb:3},children:[n.jsx(te,{item:!0,xs:12,md:4,children:n.jsx(At,{children:n.jsxs(Dt,{children:[n.jsx(y,{color:"textSecondary",gutterBottom:!0,children:"Total Prévisionnel"}),n.jsx(y,{variant:"h4",children:oe})]})})}),n.jsx(te,{item:!0,xs:12,md:4,children:n.jsx(At,{children:n.jsxs(Dt,{children:[n.jsx(y,{color:"textSecondary",gutterBottom:!0,children:"Effectif Réseau"}),n.jsx(y,{variant:"h4",children:ee})]})})}),n.jsx(te,{item:!0,xs:12,md:4,children:n.jsx(At,{children:n.jsxs(Dt,{children:[n.jsx(y,{color:"textSecondary",gutterBottom:!0,children:"Différence"}),n.jsxs(y,{variant:"h4",color:J>=0?"success.main":"error.main",children:[J>=0?"+":"",J]})]})})})]}),W.length>0?n.jsxs(Ee,{sx:{p:3,mb:3},children:[n.jsx(y,{variant:"h6",gutterBottom:!0,children:o.t("previsionnel.dashboard.chart.title")}),n.jsx(it,{width:"100%",height:400,children:n.jsxs(tn,{data:W,children:[n.jsx(Tt,{strokeDasharray:"3 3"}),n.jsx(ft,{dataKey:"date"}),n.jsx(pt,{}),n.jsx(st,{}),n.jsx(_t,{}),n.jsx(Ht,{dataKey:"effectif_reel",fill:"#8884d8",name:o.t("previsionnel.dashboard.chart.effectifReel")}),n.jsx(Ht,{dataKey:"previsionnel",fill:"#82ca9d",name:o.t("previsionnel.dashboard.chart.previsionnel")})]})})]}):!H&&!B&&n.jsx(Ee,{sx:{p:3,mb:3,textAlign:"center"},children:n.jsx(y,{variant:"h6",color:"text.secondary",children:o.t("previsionnel.dashboard.chart.noData")})}),P?.details&&P.details.length>0&&n.jsxs(Ee,{sx:{p:3},children:[n.jsx(y,{variant:"h6",gutterBottom:!0,children:o.t("previsionnel.dashboard.table.title")}),n.jsx(f,{sx:{overflowX:"auto"},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[n.jsx("thead",{children:n.jsxs("tr",{style:{backgroundColor:"#f5f5f5"},children:[n.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #ddd"},children:o.t("previsionnel.dashboard.table.network")}),n.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #ddd"},children:o.t("previsionnel.dashboard.table.type")}),n.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #ddd"},children:o.t("previsionnel.dashboard.table.date")}),n.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #ddd"},children:o.t("previsionnel.dashboard.table.effectifReel")}),n.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #ddd"},children:o.t("previsionnel.dashboard.table.previsionnel")}),n.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid #ddd"},children:o.t("previsionnel.dashboard.table.difference")})]})}),n.jsx("tbody",{children:P.details.map((x,v)=>n.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[n.jsx("td",{style:{padding:"12px"},children:x.network_name}),n.jsx("td",{style:{padding:"12px"},children:x.type_culte}),n.jsx("td",{style:{padding:"12px"},children:new Date(x.date).toLocaleDateString("fr-FR")}),n.jsx("td",{style:{padding:"12px"},children:x.effectif_reel}),n.jsx("td",{style:{padding:"12px"},children:x.previsionnel}),n.jsx("td",{style:{padding:"12px"},children:n.jsx(Be,{label:x.difference>=0?`+${x.difference}`:x.difference,color:x.difference>=0?"success":"error",size:"small"})})]},v))})]})})]}),H&&n.jsx(f,{sx:{display:"flex",justifyContent:"center",p:3},children:n.jsx(ht,{})})]})},Pl=({selectedChurch:l,user:u})=>{const c=()=>{const x=new Date,v=x.getFullYear(),_=new Date(v,0,1),V=Math.floor((x-_)/(1440*60*1e3));let I=Math.ceil((V+_.getDay()+1)/7);if(I===0){const A=v-1,N=new Date(A,0,1),R=Math.floor((x-N)/(1440*60*1e3));I=Math.ceil((R+N.getDay()+1)/7)}return`${v}-W${I.toString().padStart(2,"0")}`},[p,b]=d.useState({church_id:l?.id||"",network_id:"",type_culte:"",date_from:c()}),[H,w]=d.useState(!1),[B,C]=d.useState(null),[P,S]=d.useState(null),[k,D]=d.useState([]);d.useEffect(()=>{const x=async()=>{try{const v=await de.networks.getAll({churchId:l?.id}),_=v.data?.data||v.data||[];if(Array.isArray(_)){D(_);const V=Si.find(I=>I.value!=="Tous");b(I=>({...I,network_id:"",type_culte:V?V.value:""}))}else D([])}catch{D([])}};l?.id?x():D([])},[l]),d.useEffect(()=>{l?.id&&p.type_culte&&p.date_from&&K()},[l?.id,p.network_id,p.type_culte,p.date_from,k.length]);const K=async()=>{w(!0),C(null);try{const x={...p};if(p.date_from&&p.date_from.includes("-W"))try{const[_,V]=p.date_from.split("-W");let I=parseInt(V);if(I=I-1,I<=0){const Y=parseInt(_)-1;I=52}const A=I<=0?parseInt(_)-1:parseInt(_),N=I<=0?52:I,R=new Date(A,0,1),q=new Date(A,0,1);for(;q.getDay()!==4;)q.setDate(q.getDate()+1);const E=new Date(q);E.setDate(q.getDate()+(N-1)*7-3);const j=new Date(E);if(j.setDate(E.getDate()+6),isNaN(E.getTime())||isNaN(j.getTime()))throw new Error("Dates invalides générées");x.date_from=E.toISOString().split("T")[0],x.date_to=j.toISOString().split("T")[0]}catch{delete x.date_from}const v=await xl.getStats(x);if(v.success){const _=v.data,V={total_presents:_.total_presents||0,total_effectif_reel:_.effectif_reel||0,chartData:_.chart_data||[],details:_.details||[]};S(V)}else C(v.message||"Erreur lors du chargement des statistiques"),S(null)}catch(x){C(x.response?.data?.message||"Erreur lors du chargement des statistiques"),S(null)}finally{w(!1)}},X=(x,v)=>{b(_=>({..._,[x]:v}))},F=x=>{if(!x)return"";try{const[v,_]=x.split("-W"),V=parseInt(_);let I=V-1,A=parseInt(v);I<=0&&(A=parseInt(v)-1,I=52);const N=new Date(A,0,1),R=new Date(A,0,1);for(;R.getDay()!==4;)R.setDate(R.getDate()+1);const q=new Date(R);q.setDate(R.getDate()+(I-1)*7-3);const E=new Date(q);E.setDate(q.getDate()+6);const j={weekday:"long",day:"numeric",month:"long",year:"numeric"};return`Semaine ${V} → Données semaine ${I} (${E.toLocaleDateString("fr-FR",j)})`}catch{return x}},W=P?.chartData||[],oe=P?.total_presents||0,ee=P?.total_effectif_reel||0,J=oe-ee;return n.jsxs(f,{sx:{p:3},children:[n.jsx(y,{variant:"h4",gutterBottom:!0,children:o.t("assistance.dashboard.title")}),n.jsx(y,{variant:"body1",color:"text.secondary",sx:{mb:3},children:o.t("assistance.dashboard.subtitle")}),n.jsxs(Ee,{sx:{p:3,mb:3},children:[n.jsx(y,{variant:"h6",gutterBottom:!0,children:o.t("assistance.dashboard.filters.title")}),n.jsxs(te,{container:!0,spacing:3,alignItems:"flex-start",children:[n.jsx(te,{item:!0,xs:12,sm:6,md:4,children:n.jsxs(Fe,{fullWidth:!0,children:[n.jsx(Ge,{id:"stats-assistance-network-label",children:o.t("assistance.dashboard.filters.network")}),n.jsxs(He,{id:"stats-assistance-network",name:"network_id",sx:{minWidth:"100px"},value:p.network_id,onChange:x=>X("network_id",x.target.value),label:o.t("assistance.dashboard.filters.network"),labelId:"stats-assistance-network-label",autoComplete:"off",children:[n.jsx(we,{value:"",children:n.jsx("strong",{children:"Tous les réseaux"})}),k.map(x=>n.jsx(we,{value:x.id,children:x.nom},x.id))]})]})}),n.jsx(te,{item:!0,xs:12,sm:6,md:4,children:n.jsxs(Fe,{fullWidth:!0,children:[n.jsx(Ge,{id:"stats-assistance-type-label",children:o.t("assistance.dashboard.filters.type")}),n.jsxs(He,{id:"stats-assistance-type",name:"type_culte",sx:{minWidth:"100px"},value:p.type_culte,onChange:x=>X("type_culte",x.target.value),label:o.t("assistance.dashboard.filters.type"),labelId:"stats-assistance-type-label",autoComplete:"off",children:[n.jsx(we,{value:"",children:"Tous"}),Si.filter(x=>x.value!=="Tous").map(x=>n.jsx(we,{value:x.value,children:x.label},x.value))]})]})}),n.jsx(te,{item:!0,xs:12,sm:6,md:4,children:n.jsx(Ze,{fullWidth:!0,id:"stats-assistance-week",name:"date_from",type:"week",label:o.t("common.actions.week"),sx:{minWidth:"100px"},value:p.date_from||"",onChange:x=>X("date_from",x.target.value),InputLabelProps:{shrink:!0},helperText:p.date_from?F(p.date_from):"Format: Semaine/Mois/Année",autoComplete:"off"})})]})]}),B&&n.jsx(ot,{severity:"error",sx:{mb:3},children:B}),P&&n.jsxs(te,{container:!0,spacing:3,sx:{mb:3},children:[n.jsx(te,{item:!0,xs:12,md:4,children:n.jsx(At,{children:n.jsxs(Dt,{children:[n.jsx(y,{color:"textSecondary",gutterBottom:!0,children:"Total Présents"}),n.jsx(y,{variant:"h4",children:oe})]})})}),n.jsx(te,{item:!0,xs:12,md:4,children:n.jsx(At,{children:n.jsxs(Dt,{children:[n.jsx(y,{color:"textSecondary",gutterBottom:!0,children:"Effectif Réseau"}),n.jsx(y,{variant:"h4",children:ee})]})})}),n.jsx(te,{item:!0,xs:12,md:4,children:n.jsx(At,{children:n.jsxs(Dt,{children:[n.jsx(y,{color:"textSecondary",gutterBottom:!0,children:"Différence"}),n.jsxs(y,{variant:"h4",color:J>=0?"success.main":"error.main",children:[J>=0?"+":"",J]})]})})})]}),W.length>0?n.jsxs(Ee,{sx:{p:3,mb:3},children:[n.jsx(y,{variant:"h6",gutterBottom:!0,children:o.t("assistance.dashboard.chart.title")}),n.jsx(it,{width:"100%",height:400,children:n.jsxs(tn,{data:W,children:[n.jsx(Tt,{strokeDasharray:"3 3"}),n.jsx(ft,{dataKey:"date"}),n.jsx(pt,{}),n.jsx(st,{}),n.jsx(_t,{}),n.jsx(Ht,{dataKey:"effectif_reel",fill:"var(--chart-purple)",name:o.t("assistance.dashboard.chart.effectifReel")}),n.jsx(Ht,{dataKey:"assistance",fill:"var(--chart-yellow)",name:o.t("assistance.dashboard.chart.assistance")})]})})]}):!H&&!B&&n.jsx(Ee,{sx:{p:3,mb:3,textAlign:"center"},children:n.jsx(y,{variant:"h6",color:"text.secondary",children:o.t("assistance.dashboard.chart.noData")})}),P?.details&&P.details.length>0&&n.jsxs(Ee,{sx:{p:3},children:[n.jsx(y,{variant:"h6",gutterBottom:!0,children:o.t("assistance.dashboard.table.title")}),n.jsx(f,{sx:{overflowX:"auto"},children:n.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[n.jsx("thead",{children:n.jsxs("tr",{style:{backgroundColor:"var(--table-header-bg)"},children:[n.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid var(--table-border)"},children:o.t("assistance.dashboard.table.network")}),n.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid var(--table-border)"},children:o.t("assistance.dashboard.table.type")}),n.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid var(--table-border)"},children:o.t("assistance.dashboard.table.date")}),n.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid var(--table-border)"},children:o.t("assistance.dashboard.table.effectifReel")}),n.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid var(--table-border)"},children:o.t("assistance.dashboard.table.assistance")}),n.jsx("th",{style:{padding:"12px",textAlign:"left",borderBottom:"1px solid var(--table-border)"},children:o.t("assistance.dashboard.table.difference")})]})}),n.jsx("tbody",{children:P.details.map((x,v)=>n.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[n.jsx("td",{style:{padding:"12px"},children:x.network_name}),n.jsx("td",{style:{padding:"12px"},children:x.type_culte}),n.jsx("td",{style:{padding:"12px"},children:new Date(x.date).toLocaleDateString("fr-FR")}),n.jsx("td",{style:{padding:"12px"},children:x.effectif_reel}),n.jsx("td",{style:{padding:"12px"},children:x.assistance}),n.jsx("td",{style:{padding:"12px"},children:n.jsx(Be,{label:x.assistance-x.effectif_reel>=0?`+${x.assistance-x.effectif_reel}`:x.assistance-x.effectif_reel,color:x.assistance-x.effectif_reel>=0?"success":"error",size:"small"})})]},v))})]})})]}),H&&n.jsx(f,{sx:{display:"flex",justifyContent:"center",p:3},children:n.jsx(ht,{})})]})},ro=({node:l,expandedNodes:u,onToggle:c,level:p=0})=>{const b=l.children&&l.children.length>0,H=u.has(l.id),w=C=>{switch(C){case 0:return"Responsable d'église";case 1:return"Responsable de réseau";case 2:return"12";case 3:return"144";case 4:return"1728";case 5:return"20738";case 6:return"248832";default:return`Niveau ${C}`}},B=C=>{switch(C){case 0:return"primary";case 1:return"secondary";case 2:return"success";case 3:return"info";case 4:return"warning";case 5:return"error";case 6:return"default";default:return"default"}};return n.jsxs(f,{sx:{position:"relative"},children:[n.jsxs(f,{onClick:()=>b&&c(l.id),sx:{cursor:b?"pointer":"default",display:"flex",flexDirection:"column",alignItems:"center",p:2,border:"2px solid",borderColor:`${B(l.niveau)}.main`,borderRadius:2,bgcolor:`${B(l.niveau)}.50`,minWidth:l.niveau===0?200:l.niveau===1?160:130,transition:"all 0.3s ease",mb:b&&H?2:0,"&:hover":b?{transform:"translateY(-2px)",boxShadow:"0 4px 20px rgba(0,0,0,0.15)",borderColor:`${B(l.niveau)}.dark`}:{}},children:[b&&n.jsx(f,{sx:{position:"absolute",top:-8,right:-8,bgcolor:"white",border:"2px solid",borderColor:`${B(l.niveau)}.main`,borderRadius:"50%",width:28,height:28,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"bold",color:`${B(l.niveau)}.main`,boxShadow:"0 2px 8px rgba(0,0,0,0.2)",zIndex:10},children:H?"−":"+"}),b&&n.jsx(f,{sx:{position:"absolute",bottom:-8,left:"50%",transform:"translateX(-50%)",width:0,height:0,borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:`8px solid ${B(l.niveau)}.main`,filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.2))"}}),n.jsx(Ca,{src:l.user.image?`${eo}/${l.user.image}`:void 0,sx:{width:l.niveau===0?80:l.niveau===1?60:50,height:l.niveau===0?80:l.niveau===1?60:50,mb:1,border:"2px solid",borderColor:`${B(l.niveau)}.main`},onError:C=>{},children:l.user.username?.charAt(0)?.toUpperCase()}),n.jsx(y,{variant:l.niveau===0?"subtitle1":"body2",sx:{fontWeight:"bold",textAlign:"center",mb:.5,color:"text.primary"},children:l.user.username}),n.jsx(y,{variant:"caption",sx:{color:`${B(l.niveau)}.main`,fontWeight:"600",textAlign:"center"},children:w(l.niveau)}),n.jsx(Be,{label:`${l.children.length} leader${l.children.length>1?"s":""}`,color:B(l.niveau),variant:"filled",size:"small",sx:{mt:1,fontSize:"0.7rem"}})]}),b&&H&&n.jsxs(f,{sx:{mt:3,position:"relative"},children:[n.jsx(f,{sx:{position:"absolute",top:-30,left:"50%",transform:"translateX(-50%)",width:4,height:30,bgcolor:`${B(l.niveau)}.main`,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.2)"}}),l.children.length>1&&n.jsx(f,{sx:{position:"absolute",top:-15,left:"50%",transform:"translateX(-50%)",width:"calc(100% - 120px)",height:4,bgcolor:`${B(l.niveau)}.main`,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.2)",zIndex:5}}),l.children.map((C,P)=>n.jsx(f,{sx:{position:"absolute",top:-15,left:"50%",transform:"translateX(-50%)",width:4,height:15,bgcolor:`${B(l.niveau)}.main`,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.2)",zIndex:5}},`line-${C.id}`)),n.jsx(f,{sx:{display:"flex",justifyContent:"center",gap:4,flexWrap:"nowrap",position:"relative",pt:1,minWidth:"max-content",width:"100%","&::-webkit-scrollbar":{height:"8px"},"&::-webkit-scrollbar-track":{backgroundColor:"#f1f1f1",borderRadius:"4px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#c1c1c1",borderRadius:"4px","&:hover":{backgroundColor:"#a8a8a8"}}},children:l.children.map((C,P)=>n.jsxs(f,{sx:{position:"relative",flexShrink:0},children:[" ",n.jsx(f,{sx:{position:"absolute",top:-15,left:"50%",transform:"translateX(-50%)",width:10,height:10,bgcolor:`${B(l.niveau)}.main`,borderRadius:"50%",border:"3px solid white",boxShadow:"0 2px 8px rgba(0,0,0,0.3)",zIndex:10}}),n.jsx(ro,{node:C,expandedNodes:u,onToggle:c,level:p+1})]},C.id))})]})]})},kl=({selectedChurch:l})=>{const[u,c]=d.useState(null),[p,b]=d.useState(!1),[H,w]=d.useState(null),[B,C]=d.useState(new Set),[P,S]=d.useState(1),[k,D]=d.useState({x:0,y:0}),[K,X]=d.useState(!1),[F,W]=d.useState({x:0,y:0}),[oe,ee]=d.useState({x:0,y:0}),J=d.useRef(null),x=async()=>{if(l?.id){b(!0),w(null);try{const j=await Hr.getChaineImpact(l.id);if(j.success&&j.tree){if(c(j),j.tree.length>0){const Y=j.tree.find(re=>re.niveau===0)||j.tree[0];C(new Set([Y.id]))}}else c(null)}catch{w("Erreur lors du chargement de la chaîne d'impact")}finally{b(!1)}}},v=async()=>{if(l?.id){w(null);try{await Hr.updateChaineImpact(l.id),await x()}catch{w("Erreur lors de la mise à jour de la chaîne d'impact")}}},_=j=>{const Y=new Set(B);Y.has(j)?Y.delete(j):Y.add(j),C(Y)},V=j=>{j.preventDefault(),j.stopPropagation(),j.button===0&&(X(!0),W({x:j.clientX,y:j.clientY}),ee(k))},I=j=>{if(j.preventDefault(),K){const Y=j.clientX-F.x,re=j.clientY-F.y;D({x:oe.x+Y,y:oe.y+re})}},A=j=>{j.preventDefault(),X(!1)},N=j=>{j.preventDefault(),j.stopPropagation();const Y=j.deltaY>0?.9:1.1,re=Math.max(.1,Math.min(3,P*Y));S(re)},R=()=>{S(j=>Math.min(3,j*1.2))},q=()=>{S(j=>Math.max(.1,j/1.2))},E=()=>{S(1),D({x:0,y:0})};return d.useEffect(()=>{x()},[l?.id]),l?.id?n.jsxs(f,{sx:{p:3},children:[n.jsxs(f,{sx:{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n.jsxs(y,{variant:"h4",component:"h1",gutterBottom:!0,children:["Chaîne d'Impact - ",l.nom]}),n.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsxs(f,{sx:{display:"flex",alignItems:"center",mr:2,p:1,bgcolor:"grey.100",borderRadius:1},children:[n.jsx(y,{variant:"caption",sx:{mr:1,color:"text.secondary"},children:"Navigation carte"}),n.jsx(Ie,{size:"small",onClick:q,"aria-label":"Zoom arrière",children:n.jsx(ba,{})}),n.jsxs(y,{variant:"caption",sx:{mx:1,minWidth:"40px",textAlign:"center"},children:[Math.round(P*100),"%"]}),n.jsx(Ie,{size:"small",onClick:R,"aria-label":"Zoom avant",children:n.jsx(ja,{})}),n.jsx(Ie,{size:"small",onClick:E,"aria-label":"Vue d'ensemble",sx:{ml:1},children:n.jsx(wa,{})})]}),n.jsx(Ie,{onClick:v,disabled:p,"aria-label":o.t("common.actions.refresh"),sx:{mr:1},children:n.jsx(Bt,{})})]})]}),u&&n.jsx(f,{sx:{mb:3},children:n.jsxs(y,{variant:"body2",color:"text.secondary",children:["Total de ",u.total_nodes," nœud",u.total_nodes>1?"s":""," dans la hiérarchie"]})}),H&&n.jsx(ot,{severity:"error",sx:{mb:3},onClose:()=>w(null),children:H}),p?n.jsx(f,{sx:{display:"flex",justifyContent:"center",p:4},children:n.jsx(ht,{})}):!u||!u.tree||u.tree.length===0?n.jsxs(f,{sx:{textAlign:"center",p:4},children:[n.jsx(y,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"Aucune chaîne d'impact trouvée"}),n.jsx(y,{variant:"body2",color:"text.secondary",children:o.t("chaineImpact.updateChainMessage")})]}):n.jsxs(Ee,{"data-testid":"chaine-impact-container",ref:J,sx:{p:0,overflow:"hidden",position:"relative",height:"600px",cursor:K?"grabbing":"grab",userSelect:"none",touchAction:"none"},onMouseDown:V,onMouseMove:I,onMouseUp:A,onMouseLeave:A,onWheel:N,children:[n.jsx(f,{sx:{position:"absolute",top:10,left:10,zIndex:10,bgcolor:"rgba(255,255,255,0.9)",p:1,borderRadius:1,fontSize:"0.75rem",color:"text.secondary"},children:"Glisser pour déplacer • Molette pour zoomer"}),n.jsx(f,{sx:{width:"100%",height:"100%",overflow:"hidden",position:"relative"},children:n.jsx(f,{sx:{position:"absolute",top:"50%",left:"50%",transform:`translate(-50%, -50%) translate(${k.x}px, ${k.y}px) scale(${P})`,transformOrigin:"center center",transition:K?"none":"transform 0.1s ease-out",display:"flex",flexDirection:"column",alignItems:"center",minWidth:"max-content",py:2},children:u.tree.map(j=>n.jsx(ro,{node:j,expandedNodes:B,onToggle:_,level:0},j.id))})})]})]}):n.jsx(f,{sx:{p:3,textAlign:"center"},children:n.jsx(y,{variant:"h6",color:"text.secondary",children:"Veuillez sélectionner une église pour voir sa chaîne d'impact"})})},dt=async(l,u,c=null,p=null,b=null)=>{sessionStorage.getItem("token")&&sessionStorage.getItem("token")&&so.logActivity({action:l,entity_type:u,entity_id:c,entity_name:p,details:b}).catch(()=>{})},rt={CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE",LOGIN:"LOGIN",LOGOUT:"LOGOUT",VIEW:"VIEW",EXPORT:"EXPORT",IMPORT:"IMPORT"},ut={USER:"USER",NETWORK:"NETWORK",GROUP:"GROUP",SERVICE:"SERVICE",CHURCH:"CHURCH",DEPARTMENT:"DEPARTMENT",TESTIMONY:"TESTIMONY",CAROUSEL:"CAROUSEL",PREVISIONNEL:"PREVISIONNEL",ASSISTANCE:"ASSISTANCE",MESSAGE:"MESSAGE"},Il=({selectedChurch:l,user:u})=>{const{networks:c,loading:p,error:b,fetchNetworks:H,createNetwork:w,updateNetwork:B,deleteNetwork:C}=_l(l?{churchId:l.id}:{}),P=d.useCallback(async()=>{l?.id&&await H({churchId:l.id})},[H,l?.id]);d.useEffect(()=>{l?.id&&P()},[l?.id,P]);const{notification:S,showSuccess:k,showError:D,hideNotification:K}=xn(),{canCreateNetworks:X,canUpdateNetworks:F,canDeleteNetworks:W}=Xt(),[oe,ee]=d.useState(null),[J,x]=d.useState(null),[v,_]=d.useState({}),[V,I]=d.useState({}),[A,N]=d.useState({}),[R,q]=d.useState(!1),[E,j]=d.useState(!1),[Y,re]=d.useState(null),[ie,Q]=d.useState({nom:"",responsable1:"",responsable2:null}),[pe,ne]=d.useState(null),[ce,Oe]=d.useState(""),[Me,Ce]=d.useState([]),[Se,xe]=d.useState(null),[at,lt]=d.useState([]),[Et,$e]=d.useState(""),Xe=d.useCallback(async()=>{try{const O=await de.users.getAvailable({churchId:l?.id}),ae=O.data?.data||O.data||[];if(pe&&ie.responsable1)try{const be=await de.users.getById(ie.responsable1),De=be.data?.data||be.data;De&&(ae.some(ke=>(ke.id||ke._id)===(De.id||De._id))||ae.push(De))}catch{}Ce(ae)}catch(O){const ae=jt(O,"le chargement des membres disponibles");xe(ae.message)}},[l?.id,pe,ie.responsable1]),M=d.useCallback(async()=>{try{const O=await de.churches.getAll();lt(O.data?.data||O.data||[])}catch{lt([])}},[]),U=async O=>{if(ee(oe===O?null:O),x(null),!v[O])try{const ae=await de.networks.getById(O);_(be=>({...be,[O]:ae.data?.data||ae.data}))}catch{}if(!V[O])try{const ae=await de.networks.getGroups(O);I(be=>({...be,[O]:ae.data?.data||ae.data}))}catch{}},me=async O=>{if(x(J===O?null:O),!A[O])try{const ae=await de.groups.getById(O),be=ae.data?.data||ae.data;N(De=>({...De,[O]:be}))}catch(ae){jt(ae,"le chargement du groupe")}};if(d.useEffect(()=>{H(),Xe(),M()},[l,H,Xe,M]),!l)return n.jsx(f,{sx:{display:"flex",justifyContent:"center",my:4},children:n.jsx(y,{variant:"h6",color:"text.secondary",children:o.t("dashboard.networks.selectChurchMessage")})});const G=async O=>{if(O.preventDefault(),!ie.nom||!ie.responsable1){$e("Le nom et le responsable principal sont requis");return}try{const ae={nom:ie.nom,responsable1:ie.responsable1,...ie.responsable2&&{responsable2:ie.responsable2},church:l.id};if(pe)await B(pe,ae),k("Réseau modifié avec succès"),await dt(rt.UPDATE,ut.NETWORK,pe,ae.nom,`Réseau modifié: ${ae.nom}`);else{const be=await w(ae);k("Réseau créé avec succès"),await dt(rt.CREATE,ut.NETWORK,be?.id||be?._id,ae.nom,`Réseau créé: ${ae.nom}`)}q(!1),Q({nom:"",responsable1:"",responsable2:null}),ne(null),$e(""),setTimeout(()=>{P()},100)}catch(ae){const be=ae.response?.data?.message||ae.message||"Erreur lors de l'opération";$e(be),D(be)}},_e=O=>{Q({nom:O.nom,responsable1:O.responsable1?.id||O.responsable1?._id||O.responsable1||"",responsable2:O.responsable2?.id||O.responsable2?._id||O.responsable2||null}),ne(O.id||O._id),q(!0),setTimeout(()=>{Xe()},100)},Je=O=>{re(O),j(!0)},Ue=()=>{j(!1),re(null)},vt=async()=>{if(Y)try{await C(Y.id||Y._id),k("Réseau supprimé avec succès"),await dt(rt.DELETE,ut.NETWORK,Y.id||Y._id,Y.nom,`Réseau supprimé: ${Y.nom}`),setTimeout(()=>{P()},100)}catch(O){D(O.response?.data?.message||O.message||"Erreur lors de la suppression")}finally{Ue()}};return n.jsxs(f,{sx:{width:"100%",overflow:"hidden",overflowX:"auto"},children:[n.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[n.jsx(y,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:o.t("dashboard.networks.management")}),n.jsxs(f,{sx:{display:"flex",gap:2},children:[n.jsx(Ie,{onClick:P,disabled:p,"aria-label":o.t("common.actions.refresh"),children:n.jsx(Bt,{})}),n.jsx(Te,{variant:"contained",startIcon:n.jsx(pn,{}),onClick:()=>{q(!0),$e("")},disabled:!X||!l?.id,children:o.t("dashboard.networks.newNetwork")})]})]}),n.jsx(Ze,{"data-aos":"fade-up",fullWidth:!0,variant:"outlined",placeholder:o.t("dashboard.networks.searchPlaceholder"),value:ce,onChange:O=>Oe(O.target.value),InputProps:{startAdornment:n.jsx(Li,{sx:{mr:1,color:"text.secondary"}})},sx:{mb:3}}),p?n.jsx(Ti,{titre:o.t("dashboard.networks.loading")}):b?n.jsx(Mn,{error:b,title:o.t("dashboard.networks.loadingError")}):n.jsx(nn,{"data-aos":"fade-up",component:Ee,children:n.jsxs(Yt,{children:[n.jsx(sn,{children:n.jsxs(ze,{children:[n.jsx($,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Nom"}),n.jsx($,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Responsable(s)"}),n.jsx($,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Église"}),n.jsx($,{align:"right",sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:o.t("dashboard.networks.table.actions")})]})}),n.jsxs(Kt,{children:[Array.isArray(c)?c.filter(O=>O.nom.toLowerCase().includes(ce.toLowerCase())).map(O=>n.jsxs(yt.Fragment,{children:[n.jsxs(ze,{hover:!0,onClick:()=>U(O.id||O._id),style:{cursor:"pointer"},children:[n.jsxs($,{children:[n.jsx(Ie,{size:"small",children:oe===(O.id||O._id)?n.jsx(Dr,{}):n.jsx(Ss,{})}),O.nom]}),n.jsx($,{children:(()=>{const ae=z=>z?.username||z?.pseudo||z?.email||"-",be=typeof O.responsable1=="object"?ae(O.responsable1):ae(Me.find(z=>(z.id||z._id)===O.responsable1)),De=typeof O.responsable2=="object"?ae(O.responsable2):ae(Me.find(z=>(z.id||z._id)===O.responsable2));return be&&De&&De!=="-"?`${be} & ${De}`:be&&be!=="-"?be:De&&De!=="-"?De:"-"})()}),n.jsx($,{children:O.church&&at.find(ae=>(ae.id||ae._id)===(O.church?.id||O.church?._id||O.church))?.nom||"-"}),n.jsxs($,{align:"right",children:[n.jsx(Ie,{onClick:ae=>{ae.stopPropagation(),_e(O)},color:"primary",size:"small",disabled:!F,children:n.jsx(Kn,{})}),n.jsx(Ie,{onClick:ae=>{ae.stopPropagation(),Je(O)},color:"error",size:"small",disabled:!W,children:n.jsx(gn,{})}),n.jsx(Ie,{onClick:ae=>{ae.stopPropagation(),window.open(`/networks/${O.id||O._id}`,"_blank")},color:"info",size:"small",title:o.t("common.actions.view"),children:n.jsx(Pn,{})})]})]}),n.jsx(ze,{children:n.jsx($,{style:{paddingBottom:0,paddingTop:0},colSpan:3,children:n.jsx(Ls,{in:oe===(O.id||O._id),timeout:"auto",unmountOnExit:!0,children:n.jsx(f,{margin:1,children:n.jsx(Yt,{size:"small",children:n.jsx(Kt,{children:Array.isArray(V[O.id||O._id])&&V[O.id||O._id].map(ae=>n.jsxs(yt.Fragment,{children:[n.jsx(ze,{hover:!0,onClick:be=>{be.stopPropagation(),me(ae.id||ae._id)},style:{cursor:"pointer"},children:n.jsx($,{children:n.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(Pn,{color:"primary"}),J===(ae.id||ae._id)?n.jsx(Dr,{}):n.jsx(Ss,{}),n.jsx(y,{variant:"body2",sx:{fontWeight:500},children:ae.responsable2?.username?`GR ${ae.responsable1?.username} & ${ae.responsable2?.username}`:`GR ${ae.responsable1?.username}`})]})})}),n.jsx(ze,{children:n.jsx($,{style:{paddingBottom:0,paddingTop:0},colSpan:3,children:n.jsx(Ls,{in:J===(ae.id||ae._id),timeout:"auto",unmountOnExit:!0,children:n.jsx(f,{margin:1,children:n.jsx("ol",{style:{paddingLeft:"2rem"},children:(A[ae.id||ae._id]?.members||[]).map(be=>{const De=be.user||be,z=be.id||be._id||De.id||De._id,ke=De.username||De.pseudo||"Nom inconnu",Qe=Pi(De.qualification,"Non définie");return n.jsxs("li",{style:{background:"#f5f5f5",borderRadius:"8px",padding:"8px 12px",marginBottom:"8px",color:"#333",display:"flex",alignItems:"center",boxShadow:"0 1px 3px rgba(0,0,0,0.04)",transition:"background 0.2s",cursor:"pointer"},onMouseOver:Ut=>Ut.currentTarget.style.background="#e3f2fd",onMouseOut:Ut=>Ut.currentTarget.style.background="#f5f5f5",children:[n.jsx("span",{style:{marginRight:"10px",color:"#1976d2"},children:"👤"}),n.jsx("span",{style:{fontWeight:500},children:ke}),n.jsxs("span",{style:{marginLeft:"8px",fontStyle:"italic",color:"#4b5563"},children:["(",Qe,")"]})]},z)})})})})})})]},ae.id||ae._id))})})})})})})]},O.id||O._id)):null,Array.isArray(c)&&c.filter(O=>O.nom.toLowerCase().includes(ce.toLowerCase())).length===0&&n.jsx(ze,{children:n.jsx($,{colSpan:3,align:"center",children:c.length===0?o.t("dashboard.networks.noNetworks"):o.t("dashboard.networks.noSearchResults")})})]})]})}),n.jsxs(Ot,{open:R,onClose:()=>q(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{width:"100%",maxWidth:"450px",margin:"20px"}},children:[n.jsx(Rt,{children:pe?o.t("dashboard.networks.dialog.editTitle"):o.t("dashboard.networks.dialog.createTitle")}),Et&&n.jsx(f,{sx:{px:3,pb:2},children:n.jsx(ot,{severity:"error",onClose:()=>$e(""),children:Et})}),n.jsxs("form",{onSubmit:G,children:[n.jsx(zt,{sx:{display:"flex",justifyContent:"center"},children:n.jsx(f,{sx:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"},children:n.jsxs(te,{container:!0,spacing:2,sx:{display:"flex"},children:[n.jsx(te,{item:!0,xs:12,sx:{display:"flex",justifyContent:"center"},children:n.jsx(Ze,{id:"network-form-nom",name:"nom",sx:{width:400},label:o.t("dashboard.networks.form.networkName"),value:ie.nom,onChange:O=>Q({...ie,nom:O.target.value}),margin:"normal",required:!0,autoComplete:"off"})}),n.jsx(te,{item:!0,xs:12,sx:{display:"flex",justifyContent:"center"},children:n.jsxs(Fe,{sx:{width:400},margin:"normal",children:[n.jsx(Ge,{id:"network-form-responsable1-label",children:o.t("networks.details.responsable1")}),n.jsxs(He,{id:"network-form-responsable1",name:"responsable1",labelId:"network-form-responsable1-label",value:ie.responsable1,label:o.t("networks.details.responsable1"),onChange:O=>Q({...ie,responsable1:O.target.value}),required:!0,autoComplete:"off",children:[n.jsx(we,{value:"",children:n.jsx("em",{children:"Aucun"})}),Me.map(O=>n.jsx(we,{value:O.id||O._id,children:O.username||O.pseudo||O.email},O.id||O._id))]}),n.jsx(y,{variant:"caption",color:"text.secondary",sx:{mt:1,textAlign:"center"},children:o.t("networks.details.responsable1Helper")})]})}),n.jsx(te,{item:!0,xs:12,sx:{display:"flex",justifyContent:"center"},children:n.jsxs(Fe,{sx:{width:400},margin:"normal",children:[n.jsx(Ge,{id:"network-form-responsable2-label",sx:{color:"#757575"},children:o.t("networks.details.responsable2")}),n.jsxs(He,{id:"network-form-responsable2",name:"responsable2",labelId:"network-form-responsable2-label",value:ie.responsable2||"",label:o.t("networks.details.responsable2"),onChange:O=>Q({...ie,responsable2:O.target.value}),disabled:!0,autoComplete:"off",sx:{backgroundColor:"#e0e0e0","& .MuiOutlinedInput-notchedOutline":{borderColor:"#bdbdbd"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"#bdbdbd"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"#bdbdbd"},"& .MuiSelect-icon":{color:"#9e9e9e"}},children:[n.jsx(we,{value:"",children:n.jsx("em",{children:"Aucun"})}),Me.map(O=>n.jsx(we,{value:O.id||O._id,children:O.username||O.pseudo||O.email},O.id||O._id))]}),n.jsx(y,{variant:"caption",color:"text.secondary",sx:{mt:1,textAlign:"center"},children:o.t("networks.details.responsable2Helper")})]})})]})})}),n.jsxs(Nt,{children:[n.jsx(Te,{onClick:()=>q(!1),children:o.t("dashboard.members.roleDialog.cancel")}),n.jsx(Te,{type:"submit",variant:"contained",color:"primary",disabled:!X,children:pe?o.t("dashboard.networks.dialog.editTitle"):o.t("dashboard.networks.dialog.createTitle")})]})]})]}),n.jsx(In,{open:E,title:o.t("dashboard.networks.deleteDialog.title"),content:Y?o.t("dashboard.networks.deleteDialog.content",{networkName:Y.nom}):o.t("dashboard.networks.deleteDialog.contentGeneric"),onClose:Ue,onConfirm:vt}),n.jsx(kn,{open:S.open,autoHideDuration:4e3,onClose:K,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:n.jsx(ot,{onClose:K,severity:S.severity,sx:{width:"100%"},children:S.message})})]})},Ml=({selectedChurch:l,user:u,refreshKey:c})=>{const[p,b]=d.useState([]),[H,w]=d.useState(!0),[B,C]=d.useState(null),P=d.useCallback(async()=>{w(!0),C(null);try{const S=l?{churchId:l.id}:{},k=await de.stats.getNetworks(S),D=k.data?.data||k.data||[];Array.isArray(D)?b(D):b([])}catch(S){const k=jt(S,"networksrecap - erreur:");C(k.message),b([])}finally{w(!1)}},[l]);return d.useEffect(()=>{l&&P()},[l,P]),l?n.jsxs(f,{sx:{width:"100%",overflow:"hidden",overflowX:"auto"},children:[n.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[n.jsx(y,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:o.t("dashboard.networks.recap.title")}),n.jsx(Te,{variant:"outlined",startIcon:n.jsx(Bt,{}),onClick:P,disabled:H,children:H?o.t("common.actions.loading"):o.t("dashboard.networks.recap.refresh")})]}),H?n.jsx(f,{sx:{display:"flex",justifyContent:"center",my:3},children:n.jsx(ht,{})}):B?n.jsx(y,{color:"error",children:B}):p.length===0?n.jsx(f,{sx:{display:"flex",justifyContent:"center",my:4},children:n.jsx(y,{variant:"h6",color:"text.secondary",children:o.t("dashboard.networks.noNetworks")})}):n.jsx(nn,{"data-aos":"fade-up",component:Ee,sx:{mt:2,boxShadow:3,borderRadius:2},children:n.jsxs(Yt,{sx:{minWidth:650},stickyHeader:!0,children:[n.jsx(sn,{children:n.jsxs(ze,{sx:{backgroundColor:"#f5f5f5"},children:[n.jsx($,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:o.t("dashboard.networks.recap.table.networkName")}),n.jsx($,{align:"right",sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:o.t("dashboard.networks.recap.table.totalMembers")}),n.jsx($,{align:"right",sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:o.t("dashboard.networks.recap.table.nb12")}),n.jsx($,{align:"right",sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:o.t("dashboard.networks.recap.table.nb144")}),n.jsx($,{align:"right",sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:o.t("dashboard.networks.recap.table.groupCount")}),n.jsx($,{align:"right",sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:o.t("dashboard.networks.recap.table.groupResponsablesCount")})]})}),n.jsxs(Kt,{children:[p.map((S,k)=>n.jsxs(ze,{sx:{backgroundColor:k%2===0?"#fafafa":"#fff","&:hover":{backgroundColor:"#e3f2fd"},borderBottom:"1px solid #e0e0e0"},children:[n.jsx($,{sx:{py:1,px:2},children:S.nom}),n.jsx($,{align:"right",sx:{py:1,px:2},children:S.memberCount||0}),n.jsx($,{align:"right",sx:{py:1,px:2},children:S.qualifications?.filter(D=>fn(D)==="12").length||0}),n.jsx($,{align:"right",sx:{py:1,px:2},children:S.qualifications?.filter(D=>fn(D)==="144").length||0}),n.jsx($,{align:"right",sx:{py:1,px:2},children:S.groupCount||0}),n.jsx($,{align:"right",sx:{py:1,px:2},children:S.groupResponsablesCount||0})]},S.id||S.nom)),p.length>0&&(()=>{const S=p.reduce((k,D)=>(k.memberCount+=D.memberCount||0,k.nb12+=D.qualifications?.filter(K=>fn(K)==="12").length||0,k.nb144+=D.qualifications?.filter(K=>fn(K)==="144").length||0,k.groupCount+=D.groupCount||0,k.groupResponsablesCount+=D.groupResponsablesCount||0,k),{memberCount:0,nb12:0,nb144:0,groupCount:0,groupResponsablesCount:0});return n.jsxs(ze,{sx:{backgroundColor:"#e3f2fd",fontWeight:"bold"},children:[n.jsx($,{sx:{py:1,px:2,fontWeight:"bold"},children:o.t("dashboard.networks.recap.table.totals")}),n.jsx($,{align:"right",sx:{py:1,px:2,fontWeight:"bold"},children:S.memberCount}),n.jsx($,{align:"right",sx:{py:1,px:2,fontWeight:"bold"},children:S.nb12}),n.jsx($,{align:"right",sx:{py:1,px:2,fontWeight:"bold"},children:S.nb144}),n.jsx($,{align:"right",sx:{py:1,px:2,fontWeight:"bold"},children:S.groupCount}),n.jsx($,{align:"right",sx:{py:1,px:2,fontWeight:"bold"},children:S.groupResponsablesCount})]})})()]})]})})]}):n.jsx(f,{sx:{display:"flex",justifyContent:"center",my:4},children:n.jsx(y,{variant:"h6",color:"text.secondary",children:o.t("dashboard.networks.selectChurchMessage")})})},Al=()=>{const[l,u]=d.useState(!1),[c,p]=d.useState([]),[b,H]=d.useState(!1),[w,B]=d.useState(null),[C,P]=d.useState(null),[S,k]=d.useState(!1),[D,K]=d.useState(null);d.useEffect(()=>{o.init()},[]),Ei();const{notification:X,showSuccess:F,showError:W,hideNotification:oe}=xn(),{canCreateCarousel:ee,canDeleteCarousel:J}=Xt(),x=async()=>{H(!0);try{const N=await de.carousel.getAll();p(N.data?.data||N.data||[]),B(null)}catch(N){B(R.message),p([]);const R=jt(N,"l'opération")}finally{H(!1)}};d.useEffect(()=>{x()},[]);const v=N=>{nt.debug("Fichiers sélectionnés:",N.target.files);const R=N.target.files[0];R&&(nt.debug("Fichier sélectionné:",R.name,R.type,R.size),P(R)),N.target.value=""},_=async N=>{if(N&&N.preventDefault(),!C){W(o.t("dashboard.carousel.noFileSelected")||"Veuillez sélectionner une image");return}try{const R=new FormData;R.append("image",C);const q=await de.carousel.upload(R);F(o.t("dashboard.carousel.uploadSuccess")),await dt(rt.CREATE,ut.CAROUSEL,q?.data?.id||q?.data?._id,C.name,`Image carousel ajoutée: ${C.name}`),u(!1),P(null),await x()}catch(R){W(R.message||o.t("dashboard.carousel.uploadError"))}},V=async()=>{if(D)try{await de.carousel.delete(D.id||D._id),F(o.t("dashboard.carousel.deleteSuccess")),await dt(rt.DELETE,ut.CAROUSEL,D.id||D._id,D.image_url||"Image carousel",`Image carousel supprimée: ${D.image_url||"sans nom"}`),await x()}catch(N){W(N.message||o.t("dashboard.carousel.deleteError"))}finally{k(!1),K(null)}},I=N=>{K(N),k(!0)},A=()=>{k(!1),K(null)};return n.jsx(ki,{allowedRoles:["SUPER_ADMIN"],children:n.jsxs(f,{children:[n.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[n.jsx(y,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:o.t("dashboard.carousel.title")}),n.jsx(Te,{variant:"contained",startIcon:n.jsx(pn,{}),onClick:()=>u(!0),disabled:!ee,children:o.t("dashboard.carousel.newImage")})]}),b?n.jsx(f,{sx:{display:"flex",justifyContent:"center",my:3},children:n.jsx(ht,{})}):w?n.jsx(Mn,{error:w,title:o.t("dashboard.carousel.loadingError")}):n.jsx(nn,{"data-aos":"fade-up",component:Ee,children:n.jsxs(Yt,{children:[n.jsx(sn,{children:n.jsxs(ze,{children:[n.jsx($,{children:o.t("dashboard.carousel.table.image")}),n.jsx($,{children:o.t("dashboard.carousel.table.path")}),n.jsx($,{align:"right",children:o.t("dashboard.carousel.table.actions")})]})}),n.jsxs(Kt,{children:[Array.isArray(c)&&c.map(N=>n.jsxs(ze,{children:[n.jsx($,{children:n.jsx("img",{src:`${nl.replace("/api","")}${N.image_url}`,alt:"Carousel",style:{height:"50px",width:"auto"}})}),n.jsx($,{children:N.image_url}),n.jsx($,{align:"right",children:n.jsx(Ie,{onClick:()=>I(N),color:"error",size:"small",disabled:!J,title:J?"":o.t("dashboard.carousel.readOnlyAdmin"),children:n.jsx(gn,{})})})]},N.id||N._id)),Array.isArray(c)&&c.length===0&&n.jsx(ze,{children:n.jsx($,{colSpan:3,align:"center",children:o.t("dashboard.carousel.noImages")})})]})]})}),n.jsxs(Ot,{open:l,onClose:()=>u(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{width:"100%",maxWidth:"500px",margin:"20px"}},children:[n.jsx(Rt,{children:o.t("dashboard.carousel.dialog.title")}),n.jsxs("form",{onSubmit:_,noValidate:!0,children:[n.jsx(zt,{sx:{display:"flex",justifyContent:"center"},children:n.jsxs(f,{sx:{width:"100%",maxWidth:"450px"},children:[n.jsxs(Te,{variant:"outlined",component:"label",fullWidth:!0,sx:{mt:2,mb:1},children:[o.t("dashboard.carousel.dialog.selectImage"),n.jsx("input",{id:"carousel-image-input",type:"file",name:"carouselImage",hidden:!0,accept:"image/*",onChange:v})]}),C&&n.jsxs(f,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:2},children:[n.jsx(y,{variant:"body2",sx:{mb:1},color:"text.secondary",children:C.name}),n.jsx(f,{sx:{border:"1px solid #eee",borderRadius:2,p:1,bgcolor:"#fafafa"},children:n.jsx("img",{src:URL.createObjectURL(C),alt:"Prévisualisation",style:{maxHeight:120,maxWidth:200,objectFit:"contain"}})})]})]})}),n.jsxs(Nt,{children:[n.jsx(Te,{onClick:()=>u(!1),children:o.t("common.actions.cancel")}),n.jsx(Te,{type:"submit",variant:"contained",color:"primary",disabled:!C,children:o.t("dashboard.carousel.dialog.create")})]})]})]}),n.jsx(In,{open:S,title:o.t("dashboard.carousel.deleteDialog.title"),content:D?o.t("dashboard.carousel.deleteDialog.content",{imageUrl:D.image_url}):o.t("dashboard.carousel.deleteDialog.contentGeneric"),onClose:A,onConfirm:V}),n.jsx(kn,{open:X.open,autoHideDuration:4e3,onClose:oe,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:n.jsx(ot,{onClose:oe,severity:X.severity,sx:{width:"100%"},children:X.message})})]})})},Dl=({selectedChurch:l})=>{const[u,c]=d.useState([]),[p,b]=d.useState(null),[H,w]=d.useState([]),[B,C]=d.useState([]),[P,S]=d.useState(!1),[k,D]=d.useState(null),[K,X]=d.useState(null),{user:F}=il(),W=Xt(),{users:oe,loading:ee,error:J,fetchUsers:x,createUser:v,updateUser:_,deleteUser:V}=vl(l?{churchId:l.id}:{}),{notification:I,showSuccess:A,showError:N,hideNotification:R}=xn(),{canCreateUsers:q,canUpdateUsers:E,canDeleteUsers:j,canAssignAdminRole:Y,canAssignManagerRole:re,canAssignSuperAdminRole:ie,canModifyChurchField:Q}=Xt(),[pe,ne]=d.useState({open:!1,member:null,roles:[]}),[ce,Oe]=d.useState({open:!1,member:null,newPassword:""}),[Me,Ce]=d.useState({open:!1,member:null}),[Se,xe]=d.useState(null),[at,lt]=d.useState([]),[Et,$e]=d.useState(!1),[Xe,M]=d.useState(!1),[U,me]=d.useState(null),[G,_e]=d.useState({username:"",pseudo:"",role:o.t("dashboard.members.form.defaults.role"),genre:o.t("dashboard.members.form.defaults.gender"),tranche_age:o.t("dashboard.members.form.defaults.ageRange"),profession:o.t("dashboard.members.form.defaults.profession"),ville_residence:o.t("dashboard.members.form.defaults.city"),origine:o.t("dashboard.members.form.defaults.origin"),situation_matrimoniale:o.t("dashboard.members.form.defaults.maritalStatus"),niveau_education:o.t("dashboard.members.form.defaults.education"),eglise_locale_id:Q?"":W.isManager&&(F?.eglise_locale?.id||F?.eglise_locale)||"",sert_departement:o.t("dashboard.members.form.no"),departement_id:"",departement_ids:[],qualification:o.t("dashboard.members.form.defaults.qualification"),email:"",telephone:"",adresse:"",image:""}),[Je,Ue]=d.useState(null),[vt,O]=d.useState(null),ae=d.useCallback(()=>{_e({username:"",pseudo:"",role:o.t("dashboard.members.form.defaults.role"),genre:o.t("dashboard.members.form.defaults.gender"),tranche_age:o.t("dashboard.members.form.defaults.ageRange"),profession:o.t("dashboard.members.form.defaults.profession"),ville_residence:o.t("dashboard.members.form.defaults.city"),origine:"",situation_matrimoniale:o.t("dashboard.members.form.defaults.maritalStatus"),niveau_education:o.t("dashboard.members.form.defaults.education"),eglise_locale_id:Q?"":W.isManager&&(F?.eglise_locale?.id||F?.eglise_locale)||"",sert_departement:o.t("dashboard.members.form.no"),departement_id:"",departement_ids:[],qualification:o.t("dashboard.members.form.defaults.qualification"),email:"",telephone:"",adresse:"",image:""}),Ue(null),O(null)},[F,Q]),be=m=>{const ue=m.target.files[0];if(ue){if(!ue.type.startsWith("image/")){vs.error("Veuillez sélectionner un fichier image valide");return}if(ue.size>5*1024*1024){vs.error("L'image ne doit pas dépasser 5MB");return}Ue(ue);const ve=new FileReader;ve.onload=Le=>{O(Le.target.result)},ve.readAsDataURL(ue)}m.target.value=""},De=()=>{_e({...G,image:""}),Ue(null),O(null)},z=d.useCallback(async()=>{try{const m=await de.churches.getAll();w(m.data?.data||m.data||[]),X(null)}catch(m){const ue=jt(m,o.t("dashboard.members.errors.loadingChurches"));w([]),X(ue.message)}},[]),ke=d.useCallback(async()=>{S(!0);try{const m=await de.departments.getAll();C(m.data?.data||m.data||[]),D(null)}catch(m){const ue=jt(m,o.t("dashboard.members.errors.loadingDepartments"));D(ue.message),C([])}finally{S(!1)}},[]),Qe=d.useCallback(async()=>{try{if(!l?.id)return;const m=await de.users.getIsoles({churchId:l.id});lt(m.data?.data||m.data||[])}catch(m){jt(m,o.t("dashboard.members.errors.loadingIsolatedMembers"))}},[l?.id]),Ut=d.useCallback(async()=>{try{const m=await de.groups.getAll(),ue=m.data?.data||m.data||[];c(ue),b(null)}catch(m){const ue=jt(m,o.t("dashboard.members.errors.loadingGroups"));b(ue.message),c([])}},[]);d.useEffect(()=>{x(),z(),Ut(),Qe(),ke()},[x,z,Ut,Qe,ke,l?.id]);const[Jt,Ri]=d.useState(""),Xn=[{label:o.t("dashboard.members.filters.all"),value:""},{label:o.t("dashboard.members.filters.networkResponsible"),value:"Responsable réseau"},{label:o.t("dashboard.members.filters.groupResponsibles"),value:"Responsables de GR"},{label:o.t("dashboard.members.filters.leader"),value:"Leader"},{label:o.t("dashboard.members.filters.allLeaders"),value:"Leaders (tous)"},{label:o.t("dashboard.members.filters.regular"),value:"Régulier"},{label:o.t("dashboard.members.filters.integration"),value:"En intégration"},{label:o.t("dashboard.members.filters.irregular"),value:"Irrégulier"},{label:o.t("dashboard.members.filters.governance"),value:"Gouvernance"},{label:o.t("dashboard.members.filters.ecodim"),value:"Ecodim"},{label:o.t("dashboard.members.filters.ecodimResponsible"),value:"Responsable ecodim"},{label:o.t("dashboard.members.filters.qualification12"),value:"12"},{label:o.t("dashboard.members.filters.qualification144"),value:"144"},{label:o.t("dashboard.members.filters.qualification1728"),value:"1728"},{label:o.t("dashboard.members.filters.isolatedPeople"),value:"Personnes isolées"}],[Pt,zi]=d.useState("");if(!l)return n.jsx(f,{sx:{display:"flex",justifyContent:"center",my:4},children:n.jsx(y,{variant:"h6",color:"text.secondary",children:o.t("dashboard.members.selectChurchMessage")})});const Jn=async m=>{try{const ve=(await Fr.getUserRoles(m.id||m._id)).data.assigned_roles||[];ne({open:!0,member:m,roles:ve})}catch(ue){nt.error("Erreur lors du chargement des rôles:",ue),ne({open:!0,member:m,roles:m.role?[m.role]:[]})}},Dn=m=>{const ue=m.target.value;ne(ve=>({...ve,roles:typeof ue=="string"?ue.split(","):ue}))},Qn=m=>{const ue={SUPER_ADMIN:6,ADMIN:5,MANAGER:4,SUPERVISEUR:3,COLLECTEUR_CULTE:2,COLLECTEUR_RESEAUX:2,MEMBRE:1};return m.sort((ve,Le)=>{const fe=ue[ve.value]||0;return(ue[Le.value]||0)-fe})},ei=()=>{let m;return W.isManager?m=_s.filter(ue=>!["ADMIN","SUPER_ADMIN","MANAGER"].includes(ue.value)):m=_s,Qn(m)},rn=async()=>{try{const m=["ADMIN","SUPER_ADMIN","MANAGER"],ue=pe.roles.some(ve=>m.includes(ve));if(W.isManager&&ue){N(o.t("dashboard.members.errors.cannotAssignRole"));return}await Fr.assignMultipleRoles(pe.member.id||pe.member._id,pe.roles),A(o.t("dashboard.members.success.roleUpdated")),ne({open:!1,member:null,roles:[]})}catch(m){const ue=m.response?.data?.message||m.message||o.t("dashboard.members.errors.roleAssignment");N(ue)}},Ni=async m=>{try{const ve=(await de.users.resetPassword(m.id||m._id)).data?.tempPassword||"N/A";Oe({open:!0,member:m,newPassword:ve}),A(o.t("dashboard.members.success.passwordReset"))}catch(ue){const ve=ue.userMessage||ue.message||o.t("dashboard.members.errors.passwordReset");N(ve),Oe({open:!1,member:null,newPassword:""})}},ti=()=>Oe({open:!1,member:null,newPassword:""}),ni=m=>{Ce({open:!0,member:m})},ii=async()=>{try{const m=Me.member.id||Me.member._id,ue=Me.member.username||Me.member.pseudo;await V(m),dt(rt.DELETE,ut.USER,m,ue,`Utilisateur supprimé: ${ue}`).catch(ve=>nt.warn("Erreur logging:",ve)),A(o.t("dashboard.members.success.memberDeleted")),Ce({open:!1,member:null})}catch(m){const ue=m.userMessage||m.message||o.t("dashboard.members.errors.deletion");N(ue)}},si=()=>Ce({open:!1,member:null}),Bi=()=>{M(!1),me(null),O(null),Ue(null),ae(),$e(!0)},Wi=m=>{M(!0),me(m),O(null),Ue(null);const ve=(m.user_departments||[]).map(Le=>Le.department?.id||Le.department?._id||Le.department_id).filter(Boolean);W.isManager?_e({...m,eglise_locale_id:F?.eglise_locale?.id||F?.eglise_locale||"",role:o.t("dashboard.members.form.defaults.role"),departement_id:m.departement?.id||m.departement?._id||m.departement||"",departement_ids:ve}):_e({...m,eglise_locale_id:m.eglise_locale?.id||m.eglise_locale?._id||m.eglise_locale||"",departement_id:m.departement?.id||m.departement?._id||m.departement||"",departement_ids:ve}),$e(!0)},Zi=async m=>{m.preventDefault();const ve=["username","pseudo","genre","tranche_age","profession","ville_residence","origine","situation_matrimoniale","niveau_education"].filter(Ne=>!G[Ne]||G[Ne].trim()==="");if(ve.length>0){N(o.t("dashboard.members.errors.requiredFields",{fields:ve.join(", ")}));return}let Le=G.image||"";if(!(Je&&!Xe)){if(Je&&Xe&&U)try{const Ne=new FormData;Ne.append("image",Je);const wt=U.id||U._id,et=await de.users.uploadUserImage(wt,Ne);if(Le=et.data?.data?.image||et.data?.image,!Le)throw new Error("URL de l'image non reçue")}catch{vs.error("Erreur lors de l'upload de l'image");return}}const fe={username:G.username,pseudo:G.pseudo,role:G.role,genre:G.genre,tranche_age:G.tranche_age,profession:G.profession,ville_residence:G.ville_residence,origine:G.origine,situation_matrimoniale:G.situation_matrimoniale,niveau_education:G.niveau_education,qualification:G.qualification,email:G.email,telephone:G.telephone,adresse:G.adresse,image:Le,eglise_locale_id:G.eglise_locale_id===""?null:G.eglise_locale_id,departement_id:G.departement_id===""?null:G.departement_id,departement_ids:G.departement_ids||[]};W.isManager&&(fe.eglise_locale_id=F?.eglise_locale?.id||F?.eglise_locale,fe.role=o.t("dashboard.members.form.defaults.role"));try{if(Xe&&U){const Ne=U.id||U._id,wt=fe.username;await _(Ne,fe),dt(rt.UPDATE,ut.USER,Ne,wt,`Utilisateur modifié: ${wt}`).catch(et=>nt.warn("Erreur logging:",et)),A(o.t("dashboard.members.success.updated"))}else{const Ne=await v(fe),wt=Ne?.id||Ne?._id,et=fe.username;if(Je)try{const le=new FormData;le.append("image",Je);const On=await de.users.uploadUserImage(wt,le),Rn=On.data?.data?.image||On.data?.image;Rn&&await _(wt,{image:Rn})}catch(le){nt.warn("Erreur lors de l'upload de l'image:",le)}dt(rt.CREATE,ut.USER,wt,et,`Utilisateur créé: ${et}`).catch(le=>nt.warn("Erreur logging:",le)),A(o.t("dashboard.members.success.created"))}$e(!1),M(!1),me(null),O(null),Ue(null),ae(),await x()}catch(Ne){const wt=Ne.userMessage||Ne.message||o.t("dashboard.members.errors.save");N(wt)}},ri=m=>{if(!Pt)return m;if(Pt===o.t("dashboard.members.filters.allLeaders"))return m.filter(Le=>{const fe=Le.qualification||"";return fe==="LEADER"||fe==="RESPONSABLE_RESEAU"||fe==="QUALIFICATION_12"||fe==="12"||fe==="QUALIFICATION_144"||fe==="144"||fe==="QUALIFICATION_1728"||fe==="1728"});if(Pt===o.t("dashboard.members.filters.ecodimResponsible"))return m.filter(Le=>{const fe=Le.qualification||"";return fe.toLowerCase().includes("ecodim")&&fe.toLowerCase().includes("responsable")});if(Pt===o.t("dashboard.members.filters.isolatedPeople"))return at;if(Pt===o.t("dashboard.members.filters.governance"))return m.filter(Le=>(Le.qualification||"")==="GOUVERNANCE");if(Pt===o.t("dashboard.members.filters.groupResponsibles")){const ve=new Set;return u.forEach(fe=>{if(fe.responsable1){const Ne=fe.responsable1.id||fe.responsable1._id;Ne&&ve.add(Ne)}if(fe.responsable2){const Ne=fe.responsable2.id||fe.responsable2._id;Ne&&ve.add(Ne)}}),m.filter(fe=>ve.has(fe.id||fe._id))}return m.filter(ve=>{const Le=ve.qualification||"",fe=Pt.toLowerCase();return!!(fe===o.t("dashboard.members.filters.leader").toLowerCase()&&(Le==="LEADER"||Le==="Leader")||fe===o.t("dashboard.members.filters.networkResponsible").toLowerCase()&&(Le==="RESPONSABLE_RESEAU"||Le==="Responsable réseau")||fe===o.t("dashboard.members.filters.regular").toLowerCase()&&(Le==="REGULIER"||Le==="Régulier")||fe===o.t("dashboard.members.filters.integration").toLowerCase()&&(Le==="EN_INTEGRATION"||Le==="En intégration")||fe===o.t("dashboard.members.filters.irregular").toLowerCase()&&(Le==="IRREGULIER"||Le==="Irrégulier")||fe===o.t("dashboard.members.filters.governance").toLowerCase()&&Le==="GOUVERNANCE"||fe===o.t("dashboard.members.filters.ecodim").toLowerCase()&&Le.toLowerCase().includes("ecodim")||fe===o.t("dashboard.members.filters.qualification12").toLowerCase()&&fn(Le)==="12"||fe===o.t("dashboard.members.filters.qualification144").toLowerCase()&&fn(Le)==="144"||fe===o.t("dashboard.members.filters.qualification1728").toLowerCase()&&fn(Le)==="1728")})};return n.jsxs(f,{sx:{width:"100%",overflow:"hidden",overflowX:"auto"},children:[n.jsxs(f,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:3},children:[n.jsx(y,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:o.t("dashboard.members.management")}),n.jsxs(Fe,{sx:{minWidth:250,mx:3},children:[n.jsx(Ge,{id:"members-filter-label",children:o.t("dashboard.members.filters.title")}),n.jsx(He,{id:"members-filter",name:"filter",value:Pt,label:o.t("dashboard.members.filters.title"),labelId:"members-filter-label",onChange:m=>zi(m.target.value),autoComplete:"off",children:Xn.map(m=>n.jsx(we,{value:m.value,children:m.label},m.value))})]}),n.jsx(Te,{variant:"contained",startIcon:n.jsx(pn,{}),onClick:Bi,disabled:!q,children:o.t("dashboard.members.newMember")})]}),n.jsx(Ze,{"data-aos":"fade-up",fullWidth:!0,id:"members-search",name:"search",variant:"outlined",placeholder:o.t("dashboard.members.searchPlaceholder"),value:Jt,onChange:m=>Ri(m.target.value),autoComplete:"off",InputProps:{startAdornment:n.jsx(Li,{sx:{mr:1,color:"text.secondary"}})},sx:{mb:3}}),ee?n.jsx(Ti,{titre:o.t("dashboard.members.loading.members")}):J&&J!=="success"?n.jsx(Mn,{error:J,title:o.t("dashboard.members.loading.error")}):n.jsxs(n.Fragment,{children:[n.jsx(y,{"data-aos":"fade-up",sx:{mb:1,fontWeight:"bold"},children:o.t("dashboard.members.foundCount",{count:Array.isArray(oe)?ri(oe).filter(m=>m.username?.toLowerCase().includes(Jt.toLowerCase())||m.email?.toLowerCase().includes(Jt.toLowerCase())).length:0})}),n.jsx(nn,{"data-aos":"fade-up",component:Ee,children:n.jsxs(Yt,{children:[n.jsx(sn,{children:n.jsxs(ze,{children:[n.jsx($,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:o.t("dashboard.members.table.name")}),n.jsx($,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:o.t("dashboard.members.table.email")}),n.jsx($,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:o.t("dashboard.members.table.phone")}),n.jsx($,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:o.t("dashboard.members.table.qualification")}),n.jsx($,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:o.t("dashboard.members.table.role")}),n.jsx($,{align:"right",sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:o.t("dashboard.members.table.actions")})]})}),n.jsx(Kt,{children:Array.isArray(oe)&&ri(oe).filter(m=>m.username?.toLowerCase().includes(Jt.toLowerCase())||m.email?.toLowerCase().includes(Jt.toLowerCase())).map(m=>n.jsxs(ze,{children:[n.jsx($,{children:m.username}),n.jsx($,{children:m.email}),n.jsx($,{children:m.telephone||"-"}),n.jsx($,{children:n.jsx(y,{component:"span",variant:"caption",sx:{fontWeight:"bold",fontSize:"0.75rem"},children:Pi(m.qualification,"-")})}),n.jsx($,{children:sl(m.role)}),n.jsxs($,{align:"right",children:[n.jsx(bt,{title:o.t("dashboard.members.actions.assignRole"),children:n.jsx(Ie,{size:"small",color:"secondary",onClick:()=>Jn(m),disabled:!E,title:E?"":re?o.t("dashboard.members.permissions.managerFullRights"):o.t("dashboard.members.permissions.adminReadOnly"),children:n.jsx(Sa,{})})}),n.jsx(bt,{title:o.t("dashboard.members.actions.resetPassword"),children:n.jsx(Ie,{size:"small",color:"warning",onClick:()=>Ni(m),disabled:!E,title:E?"":re?o.t("dashboard.members.permissions.managerFullRights"):o.t("dashboard.members.permissions.adminReadOnly"),children:n.jsx(fs,{})})}),n.jsx(bt,{title:o.t("dashboard.members.actions.edit"),children:n.jsx(Ie,{size:"small",color:"info",onClick:()=>Wi(m),disabled:!E,title:E?"":re?o.t("dashboard.members.permissions.managerFullRights"):o.t("dashboard.members.permissions.adminReadOnly"),children:n.jsx(Kn,{})})}),n.jsx(bt,{title:o.t("dashboard.members.actions.delete"),children:n.jsx(Ie,{size:"small",color:"error",onClick:()=>ni(m),disabled:!j,title:j?"":re?o.t("dashboard.members.permissions.managerFullRights"):o.t("dashboard.members.permissions.adminReadOnly"),children:n.jsx(gn,{})})})]})]},m.id||m._id))})]})})]}),n.jsxs(Ot,{open:pe.open,onClose:()=>ne({open:!1,member:null,roles:[]}),maxWidth:"sm",fullWidth:!0,children:[n.jsxs(Rt,{children:[o.t("dashboard.members.roleDialog.title")," - ",pe.member?.username]}),n.jsxs(zt,{children:[n.jsxs(Fe,{fullWidth:!0,sx:{mt:2},children:[n.jsx(Ge,{id:"role-select-label",children:"Sélectionner les rôles"}),n.jsx(He,{id:"role-select",name:"roles",labelId:"role-select-label",multiple:!0,value:pe.roles,label:"Sélectionner les rôles",onChange:Dn,autoComplete:"off",renderValue:m=>n.jsx(f,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:m.map(ue=>n.jsx(f,{sx:{backgroundColor:"primary.main",color:"white",padding:"2px 8px",borderRadius:"12px",fontSize:"0.75rem"},children:ei().find(ve=>ve.value===ue)?.label||ue},ue))}),children:ei().map(m=>n.jsx(we,{value:m.value,children:m.label},m.value))})]}),n.jsx(y,{variant:"body2",color:"text.secondary",sx:{mt:2},children:"Vous pouvez sélectionner plusieurs rôles. Le rôle le plus élevé sera défini comme rôle principal."})]}),n.jsxs(Nt,{children:[n.jsx(Te,{onClick:()=>ne({open:!1,member:null,roles:[]}),children:"Annuler"}),n.jsx(Te,{onClick:rn,variant:"contained",children:"Assigner les rôles"})]})]}),n.jsxs(Ot,{open:ce.open,onClose:ti,children:[n.jsxs(Rt,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(fs,{color:"primary",sx:{mr:1}}),o.t("dashboard.members.resetPasswordDialog.title")]}),n.jsxs(zt,{sx:{minWidth:340},children:[n.jsx(y,{sx:{mb:1},children:o.t("dashboard.members.resetPasswordDialog.newPasswordFor",{username:ce.member?.username})}),n.jsxs(f,{sx:{mt:2,p:2,bgcolor:"background.paper",borderRadius:2,boxShadow:2,display:"flex",alignItems:"center",justifyContent:"space-between",gap:2,border:"1px solid #e0e0e0"},children:[n.jsx(y,{variant:"h6",sx:{wordBreak:"break-all",letterSpacing:1,fontWeight:700,color:"primary.main",flex:1},children:ce.newPassword}),n.jsx(bt,{title:o.t("dashboard.members.resetPasswordDialog.copyPassword"),children:n.jsx(Ie,{color:"primary",onClick:()=>{navigator.clipboard.writeText(ce.newPassword)},sx:{ml:1},children:n.jsx(fs,{})})})]}),n.jsx(y,{variant:"caption",color:"text.secondary",sx:{mt:2,display:"block"},children:o.t("dashboard.members.resetPasswordDialog.passwordInfo")})]}),n.jsx(Nt,{children:n.jsx(Te,{onClick:ti,variant:"contained",color:"primary",sx:{fontWeight:600},children:o.t("dashboard.members.resetPasswordDialog.close")})})]}),n.jsxs(Ot,{open:Et,onClose:()=>{$e(!1),M(!1),me(null),_e(re?{username:"",pseudo:"",role:"MEMBRE",genre:"",tranche_age:"",profession:"",ville_residence:"",origine:"",situation_matrimoniale:"",niveau_education:"",eglise_locale_id:F?.eglise_locale?.id||F?.eglise_locale||"",sert_departement:"Non",departement_id:"",departement_ids:[],qualification:"EN_INTEGRATION",email:"",telephone:"",adresse:"",image:""}:{username:"",pseudo:"",role:"MEMBRE",genre:"",tranche_age:"",profession:"",ville_residence:"",origine:"",situation_matrimoniale:"",niveau_education:"",eglise_locale_id:"",sert_departement:"Non",departement_id:"",departement_ids:[],qualification:"EN_INTEGRATION",email:"",telephone:"",adresse:"",image:""}),Ue(null),O(null)},maxWidth:"md",fullWidth:!0,PaperProps:{sx:{width:"100%",maxWidth:"800px",margin:"20px"}},children:[n.jsx(Rt,{children:Xe?o.t("dashboard.members.dialog.editTitle"):o.t("dashboard.members.dialog.createTitle")}),n.jsxs("form",{onSubmit:Zi,children:[n.jsx(zt,{sx:{display:"flex",justifyContent:"center"},children:n.jsx(f,{sx:{display:"flex",flexDirection:"column",gap:2,alignItems:"center",width:"100%",maxWidth:"750px"},children:n.jsxs(te,{container:!0,spacing:2,sx:{margin:0,alignItems:"center"},children:[n.jsx(te,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:n.jsx(Ze,{id:"member-form-username",name:"username",sx:{width:350},label:o.t("dashboard.members.form.username"),value:G.username,onChange:m=>_e({...G,username:m.target.value}),margin:"normal",required:!0,autoComplete:"username"})}),n.jsx(te,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:n.jsx(Ze,{id:"member-form-pseudo",name:"pseudo",sx:{width:350},label:o.t("dashboard.members.form.pseudo"),value:G.pseudo,onChange:m=>_e({...G,pseudo:m.target.value}),margin:"normal",required:!0,autoComplete:"nickname"})}),n.jsx(te,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:n.jsxs(Fe,{sx:{width:350},margin:"normal",required:!0,children:[n.jsx(Ge,{id:"member-form-genre-label",children:o.t("dashboard.members.form.genre")}),n.jsx(He,{id:"member-form-genre",name:"genre",sx:{minWidth:350},value:G.genre,onChange:m=>_e({...G,genre:m.target.value}),labelId:"member-form-genre-label",autoComplete:"sex",children:rl.map(m=>n.jsx(we,{value:m.value,children:m.label},m.value))})]})}),n.jsx(te,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:n.jsxs(Fe,{sx:{width:350},margin:"normal",required:!0,children:[n.jsx(Ge,{id:"member-form-age-range-label",children:o.t("dashboard.members.form.ageRange")}),n.jsx(He,{id:"member-form-age-range",name:"tranche_age",sx:{minWidth:350},value:G.tranche_age,onChange:m=>_e({...G,tranche_age:m.target.value}),labelId:"member-form-age-range-label",autoComplete:"bday",children:ol.map(m=>n.jsx(we,{value:m.value,children:m.label},m.value))})]})}),n.jsx(te,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:n.jsx(Ze,{id:"member-form-profession",name:"profession",sx:{width:350},label:o.t("dashboard.members.form.profession"),value:G.profession,onChange:m=>_e({...G,profession:m.target.value}),margin:"normal",required:!0,autoComplete:"organization-title"})}),n.jsx(te,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:n.jsx(Ze,{id:"member-form-residence-city",name:"ville_residence",sx:{width:350},label:o.t("dashboard.members.form.residenceCity"),value:G.ville_residence,onChange:m=>_e({...G,ville_residence:m.target.value}),margin:"normal",required:!0,autoComplete:"address-level2"})}),n.jsx(te,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:n.jsxs(Fe,{sx:{width:350},margin:"normal",required:!0,children:[n.jsx(Ge,{id:"member-form-origin-label",children:o.t("dashboard.members.form.origin")}),n.jsx(He,{id:"member-form-origin",name:"origine",sx:{minWidth:350},value:G.origine,onChange:m=>_e({...G,origine:m.target.value}),labelId:"member-form-origin-label",autoComplete:"country",children:al.map(m=>n.jsx(we,{value:m.value,children:m.label},m.value))})]})}),n.jsx(te,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:n.jsxs(Fe,{sx:{width:350},margin:"normal",required:!0,children:[n.jsx(Ge,{id:"member-form-marital-status-label",children:o.t("dashboard.members.form.maritalStatus")}),n.jsx(He,{id:"member-form-marital-status",name:"situation_matrimoniale",sx:{minWidth:350},value:G.situation_matrimoniale,onChange:m=>_e({...G,situation_matrimoniale:m.target.value}),labelId:"member-form-marital-status-label",autoComplete:"off",children:ll.map(m=>n.jsx(we,{value:m.value,children:m.label},m.value))})]})}),n.jsx(te,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:n.jsxs(Fe,{sx:{width:350},margin:"normal",required:!0,children:[n.jsx(Ge,{id:"member-form-education-level-label",children:o.t("dashboard.members.form.educationLevel")}),n.jsx(He,{id:"member-form-education-level",name:"niveau_education",sx:{minWidth:350},value:G.niveau_education,onChange:m=>_e({...G,niveau_education:m.target.value}),labelId:"member-form-education-level-label",autoComplete:"off",children:cl.map(m=>n.jsx(we,{value:m.value,children:m.label},m.value))})]})}),Q&&n.jsx(te,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:n.jsxs(Fe,{sx:{width:350},margin:"normal",required:!0,children:[n.jsx(Ge,{id:"member-form-local-church-label",children:o.t("dashboard.members.form.localChurch")}),n.jsx(He,{id:"member-form-local-church",name:"eglise_locale_id",sx:{minWidth:350},value:G.eglise_locale_id,onChange:m=>_e({...G,eglise_locale_id:m.target.value}),labelId:"member-form-local-church-label",autoComplete:"off",children:H.map(m=>n.jsx(we,{value:m.id||m._id,children:m.nom},m.id||m._id))})]})}),!re&&n.jsx(te,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:n.jsxs(Fe,{sx:{width:350},margin:"normal",required:!0,children:[n.jsx(Ge,{id:"member-form-role-label",children:"Rôle"}),n.jsx(He,{id:"member-form-role",name:"role",sx:{minWidth:350},value:G.role,onChange:m=>_e({...G,role:m.target.value}),labelId:"member-form-role-label",autoComplete:"off",children:_s.map(m=>n.jsx(we,{value:m.value,children:m.label},m.value))})]})}),!Xe&&n.jsx(te,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:n.jsxs(Fe,{sx:{width:350},margin:"normal",required:!0,children:[n.jsx(Ge,{id:"member-form-serves-department-label",children:o.t("dashboard.members.form.servesDepartment")}),n.jsxs(He,{id:"member-form-serves-department",name:"sert_departement",sx:{minWidth:350},value:G.sert_departement,onChange:m=>_e({...G,sert_departement:m.target.value,departement_id:m.target.value==="Non"?"":G.departement_id}),labelId:"member-form-serves-department-label",autoComplete:"off",children:[n.jsx(we,{value:o.t("dashboard.members.form.yes"),children:o.t("dashboard.members.form.yes")}),n.jsx(we,{value:o.t("dashboard.members.form.no"),children:o.t("dashboard.members.form.no")})]})]})}),(Xe||G.sert_departement==="Oui")&&n.jsx(te,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:n.jsxs(Fe,{sx:{width:350},margin:"normal",children:[n.jsx(Ge,{id:"member-form-departments-label",children:o.t("dashboard.members.form.departments")}),n.jsxs(He,{id:"member-form-departments",name:"departement_ids",multiple:!0,sx:{minWidth:350},value:G.departement_ids||[],onChange:m=>_e({...G,departement_ids:m.target.value}),labelId:"member-form-departments-label",autoComplete:"off",renderValue:m=>{if(m.length===0)return o.t("dashboard.members.form.noDepartment");if(m.length===1){const ue=B.find(ve=>(ve.id||ve._id)===m[0]);return ue?ue.nom:m[0]}return`${m.length} départements sélectionnés`},children:[k&&n.jsx(ot,{severity:"error",children:k}),B.length===0&&!k&&n.jsx(ot,{severity:"info",children:o.t("dashboard.members.form.noDepartmentsFound")}),Array.isArray(B)&&B.map(m=>n.jsx(we,{value:m.id||m._id,children:m.nom},m.id||m._id))]})]})}),n.jsx(te,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:n.jsxs(Fe,{sx:{width:350},margin:"normal",required:!0,children:[n.jsx(Ge,{id:"member-form-qualification-label",children:o.t("dashboard.members.form.qualification")}),n.jsx(He,{id:"member-form-qualification",name:"qualification",sx:{minWidth:350},value:G.qualification,onChange:m=>_e({...G,qualification:m.target.value}),labelId:"member-form-qualification-label",autoComplete:"off",children:to.map(m=>n.jsx(we,{value:m.value,children:m.label},m.value))})]})}),n.jsx(te,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:n.jsx(Ze,{id:"member-form-email",name:"email",sx:{width:350},type:"email",label:o.t("dashboard.members.form.email"),value:G.email,onChange:m=>_e({...G,email:m.target.value}),margin:"normal",required:!0,autoComplete:"email"})}),n.jsx(te,{item:!0,xs:12,sm:6,sx:{display:"flex",justifyContent:"center"},children:n.jsx(Ze,{id:"member-form-phone",name:"telephone",sx:{width:350},label:o.t("dashboard.members.form.phone"),value:G.telephone,onChange:m=>_e({...G,telephone:m.target.value}),margin:"normal",required:!0,autoComplete:"tel"})}),n.jsx(te,{item:!0,xs:12,sx:{display:"flex",justifyContent:"center"},children:n.jsx(Ze,{id:"member-form-address",name:"adresse",sx:{width:350},label:o.t("dashboard.members.form.address"),value:G.adresse,onChange:m=>_e({...G,adresse:m.target.value}),margin:"normal",required:!0,multiline:!0,rows:3,autoComplete:"street-address"})}),n.jsx(te,{item:!0,xs:12,sx:{display:"flex",justifyContent:"center"},children:n.jsxs(f,{sx:{width:350,mt:2},children:[n.jsx(y,{variant:"body2",sx:{mb:1,fontWeight:"bold"},children:o.t("dashboard.members.form.profileImage")}),(G.image||vt)&&n.jsxs(f,{sx:{mb:2,textAlign:"center"},children:[n.jsx("img",{src:vt||no(G.image),alt:"Aperçu",style:{width:100,height:100,objectFit:"cover",borderRadius:"50%",border:"2px solid #e0e0e0"},onError:m=>{}}),n.jsx(y,{variant:"caption",display:"block",sx:{mt:1},children:vt?"Nouvelle image":"Image actuelle"})]}),n.jsx("input",{accept:"image/*",style:{display:"none"},id:"image-upload",type:"file",onChange:be}),n.jsx("label",{htmlFor:"image-upload",children:n.jsx(Te,{variant:"outlined",component:"span",startIcon:n.jsx(pn,{}),fullWidth:!0,sx:{mb:1},children:G.image?"Changer l'image":"Ajouter une image"})}),G.image&&n.jsx(Te,{variant:"text",color:"error",onClick:De,fullWidth:!0,size:"small",children:"Supprimer l'image"})]})})]})})}),n.jsxs(Nt,{children:[n.jsx(Te,{onClick:()=>$e(!1),children:o.t("dashboard.members.roleDialog.cancel")}),n.jsx(Te,{type:"submit",variant:"contained",color:"primary",children:Xe?o.t("dashboard.members.dialog.update"):o.t("dashboard.members.dialog.create")})]})]})]}),n.jsx(In,{open:Me.open,title:o.t("dashboard.members.deleteDialog.title"),content:Se?`${o.t("dashboard.members.deleteDialog.content",{memberName:Se.username})}`:`${o.t("dashboard.members.deleteDialog.contentGeneric")}`,onClose:si,onConfirm:ii}),n.jsx(kn,{open:I.open,autoHideDuration:4e3,onClose:R,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:n.jsx(ot,{onClose:R,severity:I.severity,sx:{width:"100%"},children:I.message})})]})},Ol=({selectedChurch:l})=>{const[u,c]=d.useState([]),[p,b]=d.useState(!0),[H,w]=d.useState(null),B=d.useCallback(async()=>{b(!0),w(null);try{const C=l?{churchId:l.id}:{},P=await de.users.getRetired(C);c(P.data?.data||P.data||[])}catch(C){w(C.response?.data?.message||C.message)}finally{b(!1)}},[l]);return d.useEffect(()=>{l&&B()},[l,B]),l?n.jsxs(f,{children:[n.jsx(f,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:n.jsx(y,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:"Membres Retirés"})}),p?n.jsx(f,{sx:{textAlign:"center",mt:4},children:n.jsx(ht,{})}):H?n.jsx(ot,{severity:"error",children:H}):u.length===0?n.jsx(y,{children:"Aucun membre retiré trouvé."}):n.jsx(nn,{"data-aos":"fade-up",component:Ee,sx:{mt:2,boxShadow:3,borderRadius:2},children:n.jsxs(Yt,{stickyHeader:!0,children:[n.jsx(sn,{children:n.jsxs(ze,{sx:{backgroundColor:"#f5f5f5"},children:[n.jsx($,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Nom"}),n.jsx($,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Pseudo"}),n.jsx($,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Qualification"}),n.jsx($,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Groupe quitté"}),n.jsx($,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Réseau"}),n.jsx($,{sx:{fontWeight:"bold",backgroundColor:"#f5f5f5"},children:"Date de sortie"})]})}),n.jsx(Kt,{children:u.map((C,P)=>n.jsxs(ze,{sx:{backgroundColor:P%2===0?"#fafafa":"#fff","&:hover":{backgroundColor:"#e3f2fd"}},children:[n.jsx($,{children:C.user.username}),n.jsx($,{children:C.user.pseudo}),n.jsx($,{children:Pi(C.user.qualification,"-")}),n.jsx($,{children:C.group?.nom||"-"}),n.jsx($,{children:C.network?.nom||"-"}),n.jsx($,{children:C.leftAt?new Date(C.leftAt).toLocaleDateString():"-"})]},C.user._id))})]})})]}):n.jsx(f,{sx:{display:"flex",justifyContent:"center",my:4},children:n.jsx(y,{variant:"h6",color:"text.secondary",children:"Veuillez sélectionner une église pour voir les membres retraités"})})},oo=[{name:"Paris",population:2161e3},{name:"Marseille",population:861635},{name:"Lyon",population:513275},{name:"Toulouse",population:479553},{name:"Nice",population:342522},{name:"Nantes",population:309346},{name:"Strasbourg",population:280966},{name:"Montpellier",population:285121},{name:"Bordeaux",population:254436},{name:"Lille",population:232787},{name:"Rennes",population:217728},{name:"Reims",population:180752},{name:"Saint-Étienne",population:172565},{name:"Toulon",population:171953},{name:"Le Havre",population:170147},{name:"Grenoble",population:158454},{name:"Dijon",population:156854},{name:"Angers",population:154508},{name:"Saint-Denis",population:153810},{name:"Villeurbanne",population:150659},{name:"Le Mans",population:143252},{name:"Aix-en-Provence",population:143097},{name:"Brest",population:139456},{name:"Nîmes",population:146709},{name:"Limoges",population:132175},{name:"Clermont-Ferrand",population:143886},{name:"Tours",population:136463},{name:"Villejuif",population:131824},{name:"Amiens",population:133625},{name:"Metz",population:118489},{name:"Besançon",population:117912},{name:"Perpignan",population:119656},{name:"Orléans",population:114782},{name:"Mulhouse",population:108942},{name:"Caen",population:105354},{name:"Boulogne-Billancourt",population:119808},{name:"Rouen",population:110169},{name:"Nancy",population:104260},{name:"Argenteuil",population:107221},{name:"Montreuil",population:104139},{name:"Saint-Paul",population:103916},{name:"Roubaix",population:98712},{name:"Tourcoing",population:97442},{name:"Nanterre",population:94525},{name:"Avignon",population:91343},{name:"Créteil",population:90195},{name:"Poitiers",population:87698},{name:"Versailles",population:85771},{name:"Pau",population:77200},{name:"Colombes",population:85177},{name:"Vitry-sur-Seine",population:92909},{name:"Aulnay-sous-Bois",population:82514},{name:"Asnières-sur-Seine",population:86742},{name:"Courbevoie",population:81603},{name:"Cherbourg-en-Cotentin",population:80076},{name:"Rueil-Malmaison",population:78145},{name:"Bourges",population:64668},{name:"Le Cannet",population:41531},{name:"Dunkerque",population:86865},{name:"Saint-Maur-des-Fossés",population:75214},{name:"Valence",population:63848},{name:"Quimper",population:63532},{name:"Antibes",population:75820},{name:"Troyes",population:61996},{name:"Auxerre",population:34734},{name:"Bourgoin-Jallieu",population:28447},{name:"Cannes",population:73421},{name:"Calais",population:72929},{name:"Saint-Brieuc",population:44472},{name:"Saint-Herblain",population:46352},{name:"Saint-Priest",population:46845},{name:"La Rochelle",population:75736},{name:"Rezé",population:42068},{name:"Saint-André",population:55653},{name:"Montauban",population:60489},{name:"Chambery",population:58753},{name:"Aix-les-Bains",population:30812},{name:"Boulogne-sur-Mer",population:42092},{name:"Châteauroux",population:43442},{name:"Chalon-sur-Saône",population:45166},{name:"Albi",population:49532},{name:"Mâcon",population:34350},{name:"Colmar",population:67714},{name:"Dole",population:23575},{name:"Épinal",population:32006},{name:"Montbéliard",population:25405},{name:"Valenciennes",population:43336},{name:"Thionville",population:40578},{name:"Tarbes",population:43363},{name:"Haguenau",population:35112},{name:"Charleville-Mézières",population:46348},{name:"Évreux",population:47533},{name:"Saint-Étienne-du-Rouvray",population:28408},{name:"Drancy",population:71043},{name:"Noisy-le-Grand",population:66888},{name:"Ivry-sur-Seine",population:63486},{name:"Évry-Courcouronnes",population:67591},{name:"Villeneuve-d'Ascq",population:62408},{name:"Sarcelles",population:58546},{name:"Le Blanc-Mesnil",population:55519},{name:"Alfortville",population:44818},{name:"Saint-Ouen",population:53107},{name:"Neuilly-sur-Seine",population:59940},{name:"Clichy",population:62854},{name:"Pantin",population:57001},{name:"Maisons-Alfort",population:54843},{name:"Malakoff",population:30420},{name:"Bagneux",population:40336},{name:"Fontenay-sous-Bois",population:52424},{name:"Issy-les-Moulineaux",population:67198},{name:"Bondy",population:54866},{name:"Bobigny",population:54787},{name:"Les Lilas",population:23001},{name:"Vincennes",population:49568},{name:"Saint-Mandé",population:22563},{name:"Montrouge",population:50260},{name:"Bagnolet",population:35773},{name:"Rosny-sous-Bois",population:46527},{name:"Noisy-le-Sec",population:45674},{name:"Le Pré-Saint-Gervais",population:17050},{name:"Romainville",population:47028},{name:"L'Île-Saint-Denis",population:8047},{name:"Le Raincy",population:14481},{name:"Neuilly-Plaisance",population:20778},{name:"Neuilly-sur-Marne",population:35608},{name:"Gagny",population:39902},{name:"Gournay-sur-Marne",population:6787},{name:"Villemomble",population:29968},{name:"Le Perreux-sur-Marne",population:33902},{name:"Bry-sur-Marne",population:16888},{name:"Champigny-sur-Marne",population:76818},{name:"Saint-Maurice",population:14568},{name:"Joinville-le-Pont",population:19052},{name:"Nogent-sur-Marne",population:31849},{name:"Sevran",population:51249},{name:"Villepinte",population:37725},{name:"Tremblay-en-France",population:35885},{name:"Gonesse",population:25677},{name:"Garges-lès-Gonesse",population:42528},{name:"Goussainville",population:30991},{name:"Villiers-le-Bel",population:27145},{name:"Bezons",population:28712},{name:"Puteaux",population:44891},{name:"Levallois-Perret",population:64110},{name:"Aubervilliers",population:88625},{name:"La Courneuve",population:43354},{name:"Épinay-sur-Seine",population:54781},{name:"Villetaneuse",population:12312},{name:"Pierrefitte-sur-Seine",population:29561},{name:"Stains",population:38105},{name:"Saint-Gratien",population:20767},{name:"Enghien-les-Bains",population:11325},{name:"Soisy-sous-Montmorency",population:17818},{name:"Ermont",population:28421},{name:"Eaubonne",population:24476},{name:"Saint-Leu-la-Forêt",population:15450},{name:"Taverny",population:26436},{name:"Bessancourt",population:8084},{name:"Frépillon",population:3334},{name:"Butry-sur-Oise",population:2308},{name:"Méry-sur-Oise",population:9875},{name:"Mériel",population:5200},{name:"Valmondois",population:1234},{name:"L'Isle-Adam",population:11815},{name:"Parmain",population:5600},{name:"Nesles-la-Vallée",population:1774},{name:"Nointel",population:823},{name:"Champagne-sur-Oise",population:4756},{name:"Persan",population:12500},{name:"Beaumont-sur-Oise",population:9567},{name:"Bernes-sur-Oise",population:2500},{name:"Bruyères-sur-Oise",population:3500}],Rl=l=>oo.find(u=>u.name.toLowerCase()===l.toLowerCase()),zl=()=>{const[l,u]=d.useState([]),[c,p]=d.useState(!1),[b,H]=d.useState(null),[w,B]=d.useState(!1),[C,P]=d.useState(null),[S,k]=d.useState({nom:"",adresse:"",ville:"",latitude:"",longitude:"",population:"",description:"",responsable:"",type:"EGLISE",image:null}),[D,K]=d.useState(!1),[X,F]=d.useState(null),[W,oe]=d.useState([]),[ee,J]=d.useState(!1),[x,v]=d.useState([]),[_,V]=d.useState(!1),[I,A]=d.useState(null),[N,R]=d.useState(""),[q,E]=d.useState(null);d.useEffect(()=>{o.init()},[]),Ei();const{notification:j,showSuccess:Y,showError:re,hideNotification:ie}=xn(),{canCreateChurches:Q,canUpdateChurches:pe,canDeleteChurches:ne}=Xt(),ce=async()=>{p(!0);try{const M=await de.churches.getAll();u(M.data?.data||M.data||[]),H(null)}catch(M){const U=jt(M,"le chargement des églises");H(U.message),u([])}finally{p(!1)}},Oe=async()=>{try{const M=await de.users.getGovernance(),U=M.data?.data||M.data||[];oe(U)}catch(M){o.t("dashboard.churches.loadResponsablesError"),M.response?.status===500?o.t("dashboard.churches.serverError"):M.response?.status===403?o.t("dashboard.churches.accessDenied"):M.message&&!M.message.includes("Request failed with status code")&&M.message,oe([])}};d.useEffect(()=>{ce(),Oe()},[]);const Me=async M=>{if(!(!M||M.length<2))try{J(!0);const U=Rl(M);if(U){k(me=>({...me,population:U.population.toString(),ville:U.name}));try{const G=(await de.churches.getCityInfo(U.name)).data?.data;G&&G.latitude&&G.longitude&&k(_e=>({..._e,latitude:G.latitude.toString(),longitude:G.longitude.toString()}))}catch{}Y(o.t("dashboard.churches.cityInfoRetrieved",{cityName:U.name}))}else{const G=(await de.churches.getCityInfo(M)).data?.data;G&&(k(_e=>({..._e,latitude:G.latitude?.toString()||"",longitude:G.longitude?.toString()||"",population:G.population?.toString()||"",ville:G.ville||M})),Y(o.t("dashboard.churches.cityInfoRetrieved",{cityName:G.ville})))}}catch{}finally{J(!1)}},Ce=yt.useCallback(Se(Me,1e3),[]);function Se(M,U){let me;return function(..._e){const Je=()=>{clearTimeout(me),M(..._e)};clearTimeout(me),me=setTimeout(Je,U)}}const xe=async M=>{if(!M||M.length<3)return[];V(!0);try{const G=((await bl.get("https://nominatim.openstreetmap.org/search",{params:{q:M,format:"json",addressdetails:1,limit:5,countrycodes:"fr"}})).data||[]).map(_e=>({..._e,id:_e.place_id}));v(G)}catch{v([])}finally{V(!1)}},at=async M=>{M.preventDefault();try{const U=new FormData;if(U.append("nom",S.nom),U.append("adresse",S.adresse),U.append("ville",S.ville),U.append("latitude",S.latitude?parseFloat(S.latitude):""),U.append("longitude",S.longitude?parseFloat(S.longitude):""),U.append("population",S.population?parseInt(S.population):""),U.append("description",S.description),U.append("responsable_id",S.responsable||""),U.append("type",S.type),q&&U.append("image",q),C)await de.churches.update(C,U),Y(o.t("dashboard.churches.updateSuccess")),await dt(rt.UPDATE,ut.CHURCH,C,S.nom,`Église modifiée: ${S.nom}`);else{const me=await de.churches.create(U);Y(o.t("dashboard.churches.createSuccess")),await dt(rt.CREATE,ut.CHURCH,me?.data?.id||me?.data?._id,S.nom,`Église créée: ${S.nom}`)}B(!1),k({nom:"",adresse:"",ville:"",latitude:"",longitude:"",population:"",description:"",responsable:"",type:"EGLISE",image:null}),E(null),P(null),await ce()}catch(U){let me=o.t("dashboard.churches.operationError");U.response?.status===500?me=o.t("dashboard.churches.serverError"):U.response?.status===400?me=U.response?.data?.message||o.t("dashboard.churches.invalidData"):U.response?.status===404?me=o.t("dashboard.churches.notFound"):U.response?.status===403?me=o.t("dashboard.churches.accessDenied"):U.message&&!U.message.includes("Request failed with status code")&&(me=U.message),re(me),jt(U,"erreur détaillée:")}},lt=M=>{k({nom:M.nom,adresse:M.adresse||"",ville:M.ville||"",latitude:M.latitude||"",longitude:M.longitude||"",population:M.population||"",description:M.description||"",responsable:M.responsable?.id||M.responsable?._id||"",type:M.type||"EGLISE",image:null}),E(null),P(M.id||M._id),B(!0)},Et=M=>{F(M),K(!0)},$e=()=>{K(!1),F(null)},Xe=async()=>{if(X)try{await de.churches.delete(X.id||X._id),Y(o.t("dashboard.churches.deleteSuccess")),await dt(rt.DELETE,ut.CHURCH,X.id||X._id,X.nom,`Église supprimée: ${X.nom}`),await ce()}catch(M){let U=o.t("dashboard.churches.deleteError");M.response?.status===500?U=o.t("dashboard.churches.deleteServerError"):M.response?.status===400?U=M.response?.data?.message||o.t("dashboard.churches.deleteConstraintError"):M.response?.status===404?U=o.t("dashboard.churches.notFound"):M.response?.status===403?U=o.t("dashboard.churches.accessDenied"):M.message&&!M.message.includes("Request failed with status code")&&(U=M.message),re(U),jt(M,"erreur de suppression détaillée:")}finally{$e()}};return d.useEffect(()=>{w||(A(null),R(""),E(null))},[w]),n.jsx(ki,{allowedRoles:["SUPER_ADMIN"],children:n.jsxs(f,{children:[n.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[n.jsx(y,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:o.t("dashboard.churches.title")}),n.jsx(Te,{variant:"contained",startIcon:n.jsx(pn,{}),onClick:()=>B(!0),disabled:!Q,children:o.t("dashboard.churches.newChurch")})]}),c?n.jsx(Ti,{titre:o.t("dashboard.churches.loading")}):b?n.jsx(Mn,{error:b,title:o.t("dashboard.churches.loadingError")}):n.jsx(nn,{"data-aos":"fade-up",component:Ee,children:n.jsxs(Yt,{children:[n.jsx(sn,{children:n.jsxs(ze,{children:[n.jsx($,{children:o.t("dashboard.churches.table.name")}),n.jsx($,{children:o.t("dashboard.churches.table.city")}),n.jsx($,{children:o.t("dashboard.churches.table.address")}),n.jsx($,{children:o.t("dashboard.churches.table.members")}),n.jsx($,{children:o.t("dashboard.churches.table.responsible")}),n.jsx($,{align:"right",children:o.t("dashboard.churches.table.actions")})]})}),n.jsxs(Kt,{children:[Array.isArray(l)?l.map(M=>n.jsxs(ze,{children:[n.jsx($,{children:M.nom}),n.jsx($,{children:M.ville||"-"}),n.jsx($,{children:M.adresse||"-"}),n.jsx($,{children:M.nombre_membres||0}),n.jsx($,{children:M.responsable?M.responsable.username||M.responsable.pseudo||M.responsable.email:"-"}),n.jsxs($,{align:"right",children:[n.jsx(Ie,{onClick:()=>lt(M),color:"primary",size:"small",disabled:!pe,title:pe?"":o.t("dashboard.churches.readOnlyAdmin"),children:n.jsx(Kn,{})}),n.jsx(Ie,{color:"error",onClick:()=>Et(M),disabled:!ne,title:ne?"":o.t("dashboard.churches.readOnlyAdmin"),children:n.jsx(gn,{})})]})]},M.id||M._id)):null,Array.isArray(l)&&l.length===0&&n.jsx(ze,{children:n.jsx($,{colSpan:2,align:"center",children:o.t("dashboard.churches.noChurches")})})]})]})}),n.jsxs(Ot,{open:w,onClose:()=>{B(!1),P(null),k({nom:"",adresse:"",ville:"",latitude:"",longitude:"",population:"",description:"",responsable:"",type:"EGLISE",image:null}),E(null)},maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{width:"100%",maxWidth:"500px",margin:"20px"}},children:[n.jsx(Rt,{children:C?o.t("dashboard.churches.dialog.editTitle"):o.t("dashboard.churches.dialog.createTitle")}),n.jsxs("form",{onSubmit:at,children:[n.jsx(zt,{sx:{display:"flex",justifyContent:"center"},children:n.jsxs(f,{sx:{width:"100%",maxWidth:"450px"},children:[n.jsx(Ze,{fullWidth:!0,id:"church-form-nom",name:"nom",label:o.t("dashboard.churches.form.churchName"),value:S.nom,onChange:M=>k({...S,nom:M.target.value}),required:!0,margin:"normal",autoComplete:"organization"}),n.jsx(Or,{fullWidth:!0,id:"church-form-ville",options:oo,getOptionLabel:M=>typeof M=="string"?M:M.name,value:S.ville,onChange:(M,U)=>{const me=typeof U=="string"?U:U?.name||"";k({...S,ville:me}),me&&Ce(me)},renderInput:M=>n.jsx(Ze,{...M,id:"church-form-ville-input",name:"ville",label:o.t("dashboard.churches.form.city"),margin:"normal",autoComplete:"address-level2",InputProps:{...M.InputProps,endAdornment:n.jsxs(n.Fragment,{children:[ee&&n.jsx(ht,{size:20}),M.InputProps.endAdornment]})},helperText:ee?o.t("dashboard.churches.form.retrievingInfo"):o.t("dashboard.churches.form.cityHelper")}),renderOption:(M,U)=>n.jsx(f,{component:"li",...M,children:n.jsxs(f,{children:[n.jsx(y,{variant:"body1",children:U.name}),n.jsxs(y,{variant:"caption",color:"text.secondary",children:[o.t("dashboard.churches.form.population"),": ",U.population.toLocaleString()," ",o.t("dashboard.churches.form.inhabitants")]})]})})}),n.jsx(Or,{fullWidth:!0,id:"church-form-adresse",options:x,value:I,inputValue:N,getOptionLabel:M=>{if(typeof M=="string")return M;const U=M.address||{};return[U.house_number,U.road,U.postcode,U.city||U.town||U.village||""].filter(Boolean).join(", ")},isOptionEqualToValue:(M,U)=>M.id===U.id,filterOptions:M=>M,onInputChange:(M,U,me)=>{R(U),k({...S,adresse:U}),me==="input"&&A(null),U&&U.length>2?xe(U):v([])},onChange:async(M,U)=>{if(A(U),!U)return;const me=typeof U=="string"?U:U.display_name;if(R(me),k(G=>({...G,adresse:me})),typeof U!="string"){const G=U.address.city||U.address.town||U.address.village||U.address.municipality||U.address.county||"",_e=U.lat,Je=U.lon;k(Ue=>({...Ue,ville:G,latitude:_e,longitude:Je}));try{const vt=(await de.churches.getCityInfo(G)).data?.data;vt&&vt.population&&k(O=>({...O,population:vt.population.toString()}))}catch{}}},loading:_,renderInput:M=>n.jsx(Ze,{...M,id:"church-form-adresse-input",name:"adresse",label:o.t("dashboard.churches.form.fullAddress"),margin:"normal",autoComplete:"street-address",InputProps:{...M.InputProps,endAdornment:n.jsxs(n.Fragment,{children:[_&&n.jsx(ht,{size:20}),M.InputProps.endAdornment]})},helperText:o.t("dashboard.churches.form.addressHelper")}),renderOption:(M,U)=>{const me=U.address||{},G=[me.house_number,me.road,me.postcode,me.city||me.town||me.village||""].filter(Boolean);return n.jsx(f,{component:"li",...M,children:n.jsx(y,{variant:"body1",children:G.join(", ")})})}}),n.jsx(f,{sx:{display:"flex",gap:2},children:n.jsx(Ze,{fullWidth:!0,id:"church-form-population",name:"population",label:o.t("dashboard.churches.form.cityPopulation"),type:"number",value:S.population,onChange:M=>k({...S,population:M.target.value}),margin:"normal",autoComplete:"off"})}),n.jsx(Ze,{fullWidth:!0,id:"church-form-description",name:"description",label:o.t("dashboard.churches.form.description"),multiline:!0,rows:3,value:S.description,onChange:M=>k({...S,description:M.target.value}),margin:"normal",autoComplete:"off"}),n.jsxs(Fe,{fullWidth:!0,margin:"normal",children:[n.jsx(Ge,{id:"church-form-responsable-label",children:o.t("dashboard.churches.form.responsible")}),n.jsxs(He,{id:"church-form-responsable",name:"responsable",labelId:"church-form-responsable-label",value:S.responsable,label:o.t("dashboard.churches.form.responsible"),onChange:M=>k({...S,responsable:M.target.value}),autoComplete:"off",children:[n.jsx(we,{value:"",children:n.jsx("em",{children:o.t("dashboard.churches.form.none")})}),W.length>0?W.map(M=>n.jsxs(we,{value:M.id||M._id,children:[M.username||M.pseudo||M.email," - ",M.eglise_locale?.nom||o.t("dashboard.churches.form.noAssignedChurch")]},M.id||M._id)):n.jsx(we,{disabled:!0,children:o.t("dashboard.churches.form.noGovernanceUsers")})]})]}),n.jsxs(Fe,{fullWidth:!0,margin:"normal",children:[n.jsx(Ge,{id:"church-form-type-label",children:o.t("dashboard.churches.form.type")}),n.jsxs(He,{id:"church-form-type",name:"type",labelId:"church-form-type-label",value:S.type,label:o.t("dashboard.churches.form.type"),onChange:M=>k({...S,type:M.target.value}),required:!0,autoComplete:"off",children:[n.jsx(we,{value:"EGLISE",children:o.t("dashboard.churches.form.typeChurch")}),n.jsx(we,{value:"MISSION",children:o.t("dashboard.churches.form.typeMission")})]})]}),n.jsxs(Te,{variant:"outlined",component:"label",fullWidth:!0,sx:{mt:1,mb:2},children:[q?q.name:o.t("dashboard.churches.form.chooseImage"),n.jsx("input",{id:"church-image-input",type:"file",name:"image",accept:"image/*",hidden:!0,onChange:M=>{M.target.files&&M.target.files[0]&&E(M.target.files[0])}})]})]})}),n.jsxs(Nt,{children:[n.jsx(Te,{onClick:()=>{B(!1),P(null),k({nom:"",adresse:"",ville:"",latitude:"",longitude:"",population:"",description:"",responsable:"",type:"EGLISE",image:null}),E(null)},children:o.t("common.actions.cancel")}),n.jsx(Te,{type:"submit",variant:"contained",color:"primary",children:C?o.t("common.actions.update"):o.t("common.actions.create")})]})]})]}),n.jsx(In,{open:D,title:o.t("dashboard.churches.deleteDialog.title"),content:X?o.t("dashboard.churches.deleteDialog.content",{churchName:X.nom}):o.t("dashboard.churches.deleteDialog.contentGeneric"),onClose:$e,onConfirm:Xe}),n.jsx(kn,{open:j.open,autoHideDuration:4e3,onClose:ie,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:n.jsx(ot,{onClose:ie,severity:j.severity,sx:{width:"100%"},children:j.message})})]})})},Nl=()=>{const[l,u]=d.useState([]),[c,p]=d.useState(!1),[b,H]=d.useState(null),[w,B]=d.useState(!1),[C,P]=d.useState(null),[S,k]=d.useState(!1),[D,K]=d.useState(null),[X,F]=d.useState({nom:""}),[W,oe]=d.useState("");d.useEffect(()=>{o.init()},[]),Ei();const{showSuccess:ee,showError:J}=xn(),{canCreateDepartments:x,canUpdateDepartments:v,canDeleteDepartments:_}=Xt(),V=async()=>{p(!0);try{const E=await de.departments.getAll();u(E.data?.data||E.data||[]),H(null)}catch(E){H(j.message),u([]);const j=jt(E,"l'opération")}finally{p(!1)}};d.useEffect(()=>{V()},[]);const I=E=>{F({nom:E.nom}),K(E.id||E._id),k(!0)},A=E=>{P(E),B(!0)},N=()=>{B(!1),P(null)},R=async()=>{if(C)try{await de.departments.delete(C.id||C._id),ee(o.t("dashboard.departments.deleteSuccess")),await dt(rt.DELETE,ut.DEPARTMENT,C.id||C._id,C.nom,`Département supprimé: ${C.nom}`),await V()}catch(E){J(E.message||o.t("dashboard.departments.deleteError"))}finally{N()}},q=async E=>{E.preventDefault();try{if(D)await de.departments.update(D,X),ee(o.t("dashboard.departments.updateSuccess")),await dt(rt.UPDATE,ut.DEPARTMENT,D,X.nom,`Département modifié: ${X.nom}`);else{const j=await de.departments.create(X);ee(o.t("dashboard.departments.createSuccess")),await dt(rt.CREATE,ut.DEPARTMENT,j?.data?.id||j?.data?._id,X.nom,`Département créé: ${X.nom}`)}k(!1),F({nom:""}),K(null),await V()}catch(j){J(j.message||o.t("dashboard.departments.operationError"))}};return n.jsx(ki,{allowedRoles:["SUPER_ADMIN"],children:n.jsxs(f,{children:[n.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[n.jsx(y,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:o.t("dashboard.departments.title")}),n.jsx(Te,{variant:"contained",startIcon:n.jsx(pn,{}),onClick:()=>k(!0),disabled:!x,children:o.t("dashboard.departments.newDepartment")})]}),n.jsx(Ze,{fullWidth:!0,id:"department-search",name:"search",variant:"outlined",placeholder:o.t("dashboard.departments.searchPlaceholder"),value:W,onChange:E=>oe(E.target.value),InputProps:{startAdornment:n.jsx(Li,{sx:{mr:1,color:"text.secondary"}})},sx:{mb:3},autoComplete:"off"}),c?n.jsx(f,{sx:{display:"flex",justifyContent:"center",my:3},children:n.jsx(ht,{})}):b?n.jsx(Mn,{error:b,title:o.t("dashboard.departments.loadingError")}):n.jsx(nn,{"data-aos":"fade-up",component:Ee,children:n.jsxs(Yt,{children:[n.jsx(sn,{children:n.jsxs(ze,{children:[n.jsx($,{children:o.t("dashboard.departments.table.name")}),n.jsx($,{align:"right",children:o.t("dashboard.departments.table.actions")})]})}),n.jsxs(Kt,{children:[Array.isArray(l)?l.filter(E=>{if(!E||!E.nom)return!1;const j=(W||"").toLowerCase();return String(E.nom).toLowerCase().includes(j)}).map(E=>n.jsxs(ze,{children:[n.jsx($,{children:E.nom}),n.jsxs($,{align:"right",children:[n.jsx(Ie,{onClick:()=>I(E),color:"primary",size:"small",disabled:!v,title:v?"":o.t("dashboard.departments.readOnlyAdmin"),children:n.jsx(Kn,{})}),n.jsx(Ie,{color:"error",onClick:()=>A(E),disabled:!_,title:_?"":o.t("dashboard.departments.readOnlyAdmin"),children:n.jsx(gn,{})})]})]},E.id||E._id)):null,Array.isArray(l)&&l.filter(E=>E.nom.toLowerCase().includes(W.toLowerCase())).length===0&&n.jsx(ze,{children:n.jsx($,{colSpan:2,align:"center",children:l.length===0?o.t("dashboard.departments.noDepartments"):o.t("dashboard.departments.noSearchResults")})})]})]})}),n.jsxs(Ot,{open:S,onClose:()=>{k(!1),K(null),F({nom:""})},maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{width:"100%",maxWidth:"500px",margin:"20px"}},children:[n.jsx(Rt,{children:D?o.t("dashboard.departments.dialog.editTitle"):o.t("dashboard.departments.dialog.createTitle")}),n.jsxs("form",{onSubmit:q,children:[n.jsx(zt,{sx:{display:"flex",justifyContent:"center"},children:n.jsx(f,{sx:{width:"100%",maxWidth:"450px"},children:n.jsx(Ze,{fullWidth:!0,id:"department-form-nom",name:"nom",label:o.t("dashboard.departments.form.departmentName"),value:X.nom,onChange:E=>F({...X,nom:E.target.value}),margin:"normal",required:!0,autoComplete:"off"})})}),n.jsxs(Nt,{children:[n.jsx(Te,{onClick:()=>{k(!1),K(null),F({nom:""})},children:o.t("common.actions.cancel")}),n.jsx(Te,{type:"submit",variant:"contained",color:"primary",children:D?o.t("common.actions.update"):o.t("common.actions.create")})]})]})]}),n.jsx(In,{open:w,title:o.t("dashboard.departments.deleteDialog.title"),content:C?o.t("dashboard.departments.deleteDialog.content",{departmentName:C.nom}):o.t("dashboard.departments.deleteDialog.contentGeneric"),onClose:N,onConfirm:R})]})})},qr=["#0088FE","#00C49F","#FFBB28","#FF8042","#B455C6","#FF6666","#82ca9d","#8884d8","#ffc658","#a4de6c","#d0ed57"],Bl=({selectedChurch:l})=>{const{data:u,loading:c,error:p,refresh:b}=Mt(`users-stats-${l?.id||"none"}`,async()=>{if(!l)return[];const{apiService:P}=await dl(async()=>{const{apiService:X}=await import("./index-tM-Ac5N7.js").then(F=>F.H);return{apiService:X}},__vite__mapDeps([0,1,2,3,4,5,6])),S={churchId:l.id},k=await P.users.getAll(S);return(k.data?.data||k.data||[]).filter(X=>X.eglise_locale_id===l.id||X.eglise_locale?.id===l.id)},{ttl:3e5,staleWhileRevalidate:!0});d.useEffect(()=>{if(l){const P=setTimeout(()=>{b()},100);return()=>clearTimeout(P)}},[l]);const H=d.useMemo(()=>{if(!u||u.length===0)return[];const P={};return u.forEach(k=>{const D=k.qualification||"Non définie";let K="Non définie";if(D!=="Non définie"){const X=to.find(F=>F.value===D);K=X?X.label:Pi(D,D)}P[K]||(P[K]={name:K,value:0}),P[K].value++}),Object.values(P).sort((k,D)=>D.value-k.value)},[u]),w=d.useMemo(()=>{if(!u||u.length===0)return[];const P={};return u.forEach(S=>{const k=S.genre||"Non défini";P[k]||(P[k]={name:k,value:0}),P[k].value++}),Object.values(P).sort((S,k)=>k.value-S.value)},[u]),B=d.useMemo(()=>{if(!u||u.length===0)return[];const P={};u.forEach(D=>{const K=D.tranche_age||"Non définie";P[K]||(P[K]={name:K,value:0}),P[K].value++});const S=["0 - 2 ans","2 ans - 6 ans","7 ans - 12 ans","13 ans - 18 ans","19 ans - 25 ans","26 ans - 35 ans","36 ans - 55 ans","56 ans - 85 ans","85 ans et plus","Non définie"];return Object.values(P).sort((D,K)=>{const X=S.indexOf(D.name),F=S.indexOf(K.name);return X===-1?1:F===-1?-1:X-F})},[u]);d.useMemo(()=>{if(!u||u.length===0)return[];const P={};return u.forEach(S=>{const k=S.ville_residence||"Non définie";P[k]||(P[k]={name:k,value:0}),P[k].value++}),Object.values(P).sort((S,k)=>k.value-S.value).slice(0,10)},[u]);const C=d.useMemo(()=>H.map(P=>({qualification:P.name,count:P.value})).sort((P,S)=>S.count-P.count),[H]);return l?n.jsxs(f,{children:[n.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",mb:3,alignItems:"center"},children:[n.jsx(y,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:"Statistiques Membres"}),n.jsx(Ie,{onClick:b,disabled:c,"aria-label":o.t("common.actions.refresh"),children:n.jsx(Bt,{})})]}),c?n.jsx(f,{sx:{display:"flex",justifyContent:"center",my:4},children:n.jsx(ht,{})}):p?n.jsx(y,{color:"error",children:p}):n.jsxs(te,{children:[n.jsx(te,{"data-aos":"fade-up",item:!0,xs:12,md:6,sx:{mt:4},children:n.jsxs(Ee,{sx:{p:3,backgroundColor:"#f9f9f9",overflowX:"auto"},children:[n.jsx(y,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:o.t("home.qualificationDistribution")}),n.jsx(it,{width:"100%",height:350,children:n.jsxs(tn,{data:C,children:[n.jsx(Tt,{strokeDasharray:"3 3"}),n.jsx(ft,{dataKey:"qualification",angle:-30,textAnchor:"end",interval:0,height:80}),n.jsx(pt,{allowDecimals:!1}),n.jsx(st,{}),n.jsx(Ht,{dataKey:"count",fill:"#FFBB28"})]})})]})}),n.jsx(te,{"data-aos":"fade-up",item:!0,xs:12,md:6,sx:{mt:4},children:n.jsxs(Ee,{sx:{p:3,backgroundColor:"#f9f9f9",overflowX:"auto"},children:[n.jsx(y,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:o.t("home.genreDistribution")}),n.jsx(it,{width:"100%",height:500,children:n.jsxs(Rs,{children:[n.jsx(zs,{data:w,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:200,label:({name:P,value:S})=>{const k=w.reduce((K,X)=>K+X.value,0),D=k?(S/k*100).toFixed(1):0;return`${P}: ${S} (${D}%)`},children:w.map((P,S)=>n.jsx(Ns,{fill:qr[S%qr.length]},`cell-${S}`))}),n.jsx(_t,{}),n.jsx(st,{})]})})]})}),n.jsx(te,{"data-aos":"fade-up",item:!0,xs:12,md:6,sx:{mt:4},children:n.jsxs(Ee,{sx:{p:3,backgroundColor:"#f9f9f9",overflowX:"auto"},children:[n.jsx(y,{variant:"h6",gutterBottom:!0,sx:{fontSize:22},children:o.t("home.ageDistribution")}),n.jsx(it,{width:"100%",height:350,children:n.jsxs(tn,{data:B,children:[n.jsx(Tt,{strokeDasharray:"3 3"}),n.jsx(ft,{dataKey:"name"}),n.jsx(pt,{allowDecimals:!1}),n.jsx(st,{}),n.jsx(Ht,{dataKey:"value",fill:"#00C49F"})]})})]})})]})]}):n.jsx(f,{sx:{display:"flex",justifyContent:"center",my:4},children:n.jsx(y,{variant:"h6",color:"text.secondary",children:"Veuillez sélectionner une église pour voir les statistiques"})})};function ao(l,u){const c=d.useRef(u);d.useEffect(function(){u!==c.current&&l.attributionControl!=null&&(c.current!=null&&l.attributionControl.removeAttribution(c.current),u!=null&&l.attributionControl.addAttribution(u)),c.current=u},[l,u])}const Wl=1;function Zl(l){return Object.freeze({__version:Wl,map:l})}function lo(l,u){return Object.freeze({...l,...u})}const Bs=d.createContext(null);function Ii(){const l=d.use(Bs);if(l==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return l}function co(l){function u(c,p){const{instance:b,context:H}=l(c).current;d.useImperativeHandle(p,()=>b);const{children:w}=c;return w==null?null:yt.createElement(Bs,{value:H},w)}return d.forwardRef(u)}function Fl(l){function u(c,p){const[b,H]=d.useState(!1),{instance:w}=l(c,H).current;d.useImperativeHandle(p,()=>w),d.useEffect(function(){b&&w.update()},[w,b,c.children]);const B=w._contentNode;return B?La.createPortal(c.children,B):null}return d.forwardRef(u)}function Hl(l){function u(c,p){const{instance:b}=l(c).current;return d.useImperativeHandle(p,()=>b),null}return d.forwardRef(u)}function Ws(l,u){const c=d.useRef(void 0);d.useEffect(function(){return u!=null&&l.instance.on(u),c.current=u,function(){c.current!=null&&l.instance.off(c.current),c.current=null}},[l,u])}function Mi(l,u){const c=l.pane??u.pane;return c?{...l,pane:c}:l}function Ul(l,u){return function(p,b){const H=Ii(),w=l(Mi(p,H),H);return ao(H.map,p.attribution),Ws(w.current,p.eventHandlers),u(w.current,H,p,b),w}}var Yn={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */var ql=Yn.exports,Gr;function Gl(){return Gr||(Gr=1,(function(l,u){(function(c,p){p(u)})(ql,(function(c){var p="1.9.4";function b(e){var t,i,s,r;for(i=1,s=arguments.length;i<s;i++){r=arguments[i];for(t in r)e[t]=r[t]}return e}var H=Object.create||(function(){function e(){}return function(t){return e.prototype=t,new e}})();function w(e,t){var i=Array.prototype.slice;if(e.bind)return e.bind.apply(e,i.call(arguments,1));var s=i.call(arguments,2);return function(){return e.apply(t,s.length?s.concat(i.call(arguments)):arguments)}}var B=0;function C(e){return"_leaflet_id"in e||(e._leaflet_id=++B),e._leaflet_id}function P(e,t,i){var s,r,a,h;return h=function(){s=!1,r&&(a.apply(i,r),r=!1)},a=function(){s?r=arguments:(e.apply(i,arguments),setTimeout(h,t),s=!0)},a}function S(e,t,i){var s=t[1],r=t[0],a=s-r;return e===s&&i?e:((e-r)%a+a)%a+r}function k(){return!1}function D(e,t){if(t===!1)return e;var i=Math.pow(10,t===void 0?6:t);return Math.round(e*i)/i}function K(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function X(e){return K(e).split(/\s+/)}function F(e,t){Object.prototype.hasOwnProperty.call(e,"options")||(e.options=e.options?H(e.options):{});for(var i in t)e.options[i]=t[i];return e.options}function W(e,t,i){var s=[];for(var r in e)s.push(encodeURIComponent(i?r.toUpperCase():r)+"="+encodeURIComponent(e[r]));return(!t||t.indexOf("?")===-1?"?":"&")+s.join("&")}var oe=/\{ *([\w_ -]+) *\}/g;function ee(e,t){return e.replace(oe,function(i,s){var r=t[s];if(r===void 0)throw new Error("No value provided for variable "+i);return typeof r=="function"&&(r=r(t)),r})}var J=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};function x(e,t){for(var i=0;i<e.length;i++)if(e[i]===t)return i;return-1}var v="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function _(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}var V=0;function I(e){var t=+new Date,i=Math.max(0,16-(t-V));return V=t+i,window.setTimeout(e,i)}var A=window.requestAnimationFrame||_("RequestAnimationFrame")||I,N=window.cancelAnimationFrame||_("CancelAnimationFrame")||_("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)};function R(e,t,i){if(i&&A===I)e.call(t);else return A.call(window,w(e,t))}function q(e){e&&N.call(window,e)}var E={__proto__:null,extend:b,create:H,bind:w,get lastId(){return B},stamp:C,throttle:P,wrapNum:S,falseFn:k,formatNum:D,trim:K,splitWords:X,setOptions:F,getParamString:W,template:ee,isArray:J,indexOf:x,emptyImageUrl:v,requestFn:A,cancelFn:N,requestAnimFrame:R,cancelAnimFrame:q};function j(){}j.extend=function(e){var t=function(){F(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},i=t.__super__=this.prototype,s=H(i);s.constructor=t,t.prototype=s;for(var r in this)Object.prototype.hasOwnProperty.call(this,r)&&r!=="prototype"&&r!=="__super__"&&(t[r]=this[r]);return e.statics&&b(t,e.statics),e.includes&&(Y(e.includes),b.apply(null,[s].concat(e.includes))),b(s,e),delete s.statics,delete s.includes,s.options&&(s.options=i.options?H(i.options):{},b(s.options,e.options)),s._initHooks=[],s.callInitHooks=function(){if(!this._initHooksCalled){i.callInitHooks&&i.callInitHooks.call(this),this._initHooksCalled=!0;for(var a=0,h=s._initHooks.length;a<h;a++)s._initHooks[a].call(this)}},t},j.include=function(e){var t=this.prototype.options;return b(this.prototype,e),e.options&&(this.prototype.options=t,this.mergeOptions(e.options)),this},j.mergeOptions=function(e){return b(this.prototype.options,e),this},j.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),i=typeof e=="function"?e:function(){this[e].apply(this,t)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i),this};function Y(e){if(!(typeof L>"u"||!L||!L.Mixin)){e=J(e)?e:[e];for(var t=0;t<e.length;t++)e[t]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var re={on:function(e,t,i){if(typeof e=="object")for(var s in e)this._on(s,e[s],t);else{e=X(e);for(var r=0,a=e.length;r<a;r++)this._on(e[r],t,i)}return this},off:function(e,t,i){if(!arguments.length)delete this._events;else if(typeof e=="object")for(var s in e)this._off(s,e[s],t);else{e=X(e);for(var r=arguments.length===1,a=0,h=e.length;a<h;a++)r?this._off(e[a]):this._off(e[a],t,i)}return this},_on:function(e,t,i,s){if(typeof t!="function"){console.warn("wrong listener type: "+typeof t);return}if(this._listens(e,t,i)===!1){i===this&&(i=void 0);var r={fn:t,ctx:i};s&&(r.once=!0),this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(r)}},_off:function(e,t,i){var s,r,a;if(this._events&&(s=this._events[e],!!s)){if(arguments.length===1){if(this._firingCount)for(r=0,a=s.length;r<a;r++)s[r].fn=k;delete this._events[e];return}if(typeof t!="function"){console.warn("wrong listener type: "+typeof t);return}var h=this._listens(e,t,i);if(h!==!1){var g=s[h];this._firingCount&&(g.fn=k,this._events[e]=s=s.slice()),s.splice(h,1)}}},fire:function(e,t,i){if(!this.listens(e,i))return this;var s=b({},t,{type:e,target:this,sourceTarget:t&&t.sourceTarget||this});if(this._events){var r=this._events[e];if(r){this._firingCount=this._firingCount+1||1;for(var a=0,h=r.length;a<h;a++){var g=r[a],T=g.fn;g.once&&this.off(e,T,g.ctx),T.call(g.ctx||this,s)}this._firingCount--}}return i&&this._propagateEvent(s),this},listens:function(e,t,i,s){typeof e!="string"&&console.warn('"string" type argument expected');var r=t;typeof t!="function"&&(s=!!t,r=void 0,i=void 0);var a=this._events&&this._events[e];if(a&&a.length&&this._listens(e,r,i)!==!1)return!0;if(s){for(var h in this._eventParents)if(this._eventParents[h].listens(e,t,i,s))return!0}return!1},_listens:function(e,t,i){if(!this._events)return!1;var s=this._events[e]||[];if(!t)return!!s.length;i===this&&(i=void 0);for(var r=0,a=s.length;r<a;r++)if(s[r].fn===t&&s[r].ctx===i)return r;return!1},once:function(e,t,i){if(typeof e=="object")for(var s in e)this._on(s,e[s],t,!0);else{e=X(e);for(var r=0,a=e.length;r<a;r++)this._on(e[r],t,i,!0)}return this},addEventParent:function(e){return this._eventParents=this._eventParents||{},this._eventParents[C(e)]=e,this},removeEventParent:function(e){return this._eventParents&&delete this._eventParents[C(e)],this},_propagateEvent:function(e){for(var t in this._eventParents)this._eventParents[t].fire(e.type,b({layer:e.target,propagatedFrom:e.target},e),!0)}};re.addEventListener=re.on,re.removeEventListener=re.clearAllEventListeners=re.off,re.addOneTimeEventListener=re.once,re.fireEvent=re.fire,re.hasEventListeners=re.listens;var ie=j.extend(re);function Q(e,t,i){this.x=i?Math.round(e):e,this.y=i?Math.round(t):t}var pe=Math.trunc||function(e){return e>0?Math.floor(e):Math.ceil(e)};Q.prototype={clone:function(){return new Q(this.x,this.y)},add:function(e){return this.clone()._add(ne(e))},_add:function(e){return this.x+=e.x,this.y+=e.y,this},subtract:function(e){return this.clone()._subtract(ne(e))},_subtract:function(e){return this.x-=e.x,this.y-=e.y,this},divideBy:function(e){return this.clone()._divideBy(e)},_divideBy:function(e){return this.x/=e,this.y/=e,this},multiplyBy:function(e){return this.clone()._multiplyBy(e)},_multiplyBy:function(e){return this.x*=e,this.y*=e,this},scaleBy:function(e){return new Q(this.x*e.x,this.y*e.y)},unscaleBy:function(e){return new Q(this.x/e.x,this.y/e.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=pe(this.x),this.y=pe(this.y),this},distanceTo:function(e){e=ne(e);var t=e.x-this.x,i=e.y-this.y;return Math.sqrt(t*t+i*i)},equals:function(e){return e=ne(e),e.x===this.x&&e.y===this.y},contains:function(e){return e=ne(e),Math.abs(e.x)<=Math.abs(this.x)&&Math.abs(e.y)<=Math.abs(this.y)},toString:function(){return"Point("+D(this.x)+", "+D(this.y)+")"}};function ne(e,t,i){return e instanceof Q?e:J(e)?new Q(e[0],e[1]):e==null?e:typeof e=="object"&&"x"in e&&"y"in e?new Q(e.x,e.y):new Q(e,t,i)}function ce(e,t){if(e)for(var i=t?[e,t]:e,s=0,r=i.length;s<r;s++)this.extend(i[s])}ce.prototype={extend:function(e){var t,i;if(!e)return this;if(e instanceof Q||typeof e[0]=="number"||"x"in e)t=i=ne(e);else if(e=Oe(e),t=e.min,i=e.max,!t||!i)return this;return!this.min&&!this.max?(this.min=t.clone(),this.max=i.clone()):(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(i.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(i.y,this.max.y)),this},getCenter:function(e){return ne((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},getBottomLeft:function(){return ne(this.min.x,this.max.y)},getTopRight:function(){return ne(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(e){var t,i;return typeof e[0]=="number"||e instanceof Q?e=ne(e):e=Oe(e),e instanceof ce?(t=e.min,i=e.max):t=i=e,t.x>=this.min.x&&i.x<=this.max.x&&t.y>=this.min.y&&i.y<=this.max.y},intersects:function(e){e=Oe(e);var t=this.min,i=this.max,s=e.min,r=e.max,a=r.x>=t.x&&s.x<=i.x,h=r.y>=t.y&&s.y<=i.y;return a&&h},overlaps:function(e){e=Oe(e);var t=this.min,i=this.max,s=e.min,r=e.max,a=r.x>t.x&&s.x<i.x,h=r.y>t.y&&s.y<i.y;return a&&h},isValid:function(){return!!(this.min&&this.max)},pad:function(e){var t=this.min,i=this.max,s=Math.abs(t.x-i.x)*e,r=Math.abs(t.y-i.y)*e;return Oe(ne(t.x-s,t.y-r),ne(i.x+s,i.y+r))},equals:function(e){return e?(e=Oe(e),this.min.equals(e.getTopLeft())&&this.max.equals(e.getBottomRight())):!1}};function Oe(e,t){return!e||e instanceof ce?e:new ce(e,t)}function Me(e,t){if(e)for(var i=t?[e,t]:e,s=0,r=i.length;s<r;s++)this.extend(i[s])}Me.prototype={extend:function(e){var t=this._southWest,i=this._northEast,s,r;if(e instanceof Se)s=e,r=e;else if(e instanceof Me){if(s=e._southWest,r=e._northEast,!s||!r)return this}else return e?this.extend(xe(e)||Ce(e)):this;return!t&&!i?(this._southWest=new Se(s.lat,s.lng),this._northEast=new Se(r.lat,r.lng)):(t.lat=Math.min(s.lat,t.lat),t.lng=Math.min(s.lng,t.lng),i.lat=Math.max(r.lat,i.lat),i.lng=Math.max(r.lng,i.lng)),this},pad:function(e){var t=this._southWest,i=this._northEast,s=Math.abs(t.lat-i.lat)*e,r=Math.abs(t.lng-i.lng)*e;return new Me(new Se(t.lat-s,t.lng-r),new Se(i.lat+s,i.lng+r))},getCenter:function(){return new Se((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Se(this.getNorth(),this.getWest())},getSouthEast:function(){return new Se(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(e){typeof e[0]=="number"||e instanceof Se||"lat"in e?e=xe(e):e=Ce(e);var t=this._southWest,i=this._northEast,s,r;return e instanceof Me?(s=e.getSouthWest(),r=e.getNorthEast()):s=r=e,s.lat>=t.lat&&r.lat<=i.lat&&s.lng>=t.lng&&r.lng<=i.lng},intersects:function(e){e=Ce(e);var t=this._southWest,i=this._northEast,s=e.getSouthWest(),r=e.getNorthEast(),a=r.lat>=t.lat&&s.lat<=i.lat,h=r.lng>=t.lng&&s.lng<=i.lng;return a&&h},overlaps:function(e){e=Ce(e);var t=this._southWest,i=this._northEast,s=e.getSouthWest(),r=e.getNorthEast(),a=r.lat>t.lat&&s.lat<i.lat,h=r.lng>t.lng&&s.lng<i.lng;return a&&h},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(e,t){return e?(e=Ce(e),this._southWest.equals(e.getSouthWest(),t)&&this._northEast.equals(e.getNorthEast(),t)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function Ce(e,t){return e instanceof Me?e:new Me(e,t)}function Se(e,t,i){if(isNaN(e)||isNaN(t))throw new Error("Invalid LatLng object: ("+e+", "+t+")");this.lat=+e,this.lng=+t,i!==void 0&&(this.alt=+i)}Se.prototype={equals:function(e,t){if(!e)return!1;e=xe(e);var i=Math.max(Math.abs(this.lat-e.lat),Math.abs(this.lng-e.lng));return i<=(t===void 0?1e-9:t)},toString:function(e){return"LatLng("+D(this.lat,e)+", "+D(this.lng,e)+")"},distanceTo:function(e){return lt.distance(this,xe(e))},wrap:function(){return lt.wrapLatLng(this)},toBounds:function(e){var t=180*e/40075017,i=t/Math.cos(Math.PI/180*this.lat);return Ce([this.lat-t,this.lng-i],[this.lat+t,this.lng+i])},clone:function(){return new Se(this.lat,this.lng,this.alt)}};function xe(e,t,i){return e instanceof Se?e:J(e)&&typeof e[0]!="object"?e.length===3?new Se(e[0],e[1],e[2]):e.length===2?new Se(e[0],e[1]):null:e==null?e:typeof e=="object"&&"lat"in e?new Se(e.lat,"lng"in e?e.lng:e.lon,e.alt):t===void 0?null:new Se(e,t,i)}var at={latLngToPoint:function(e,t){var i=this.projection.project(e),s=this.scale(t);return this.transformation._transform(i,s)},pointToLatLng:function(e,t){var i=this.scale(t),s=this.transformation.untransform(e,i);return this.projection.unproject(s)},project:function(e){return this.projection.project(e)},unproject:function(e){return this.projection.unproject(e)},scale:function(e){return 256*Math.pow(2,e)},zoom:function(e){return Math.log(e/256)/Math.LN2},getProjectedBounds:function(e){if(this.infinite)return null;var t=this.projection.bounds,i=this.scale(e),s=this.transformation.transform(t.min,i),r=this.transformation.transform(t.max,i);return new ce(s,r)},infinite:!1,wrapLatLng:function(e){var t=this.wrapLng?S(e.lng,this.wrapLng,!0):e.lng,i=this.wrapLat?S(e.lat,this.wrapLat,!0):e.lat,s=e.alt;return new Se(i,t,s)},wrapLatLngBounds:function(e){var t=e.getCenter(),i=this.wrapLatLng(t),s=t.lat-i.lat,r=t.lng-i.lng;if(s===0&&r===0)return e;var a=e.getSouthWest(),h=e.getNorthEast(),g=new Se(a.lat-s,a.lng-r),T=new Se(h.lat-s,h.lng-r);return new Me(g,T)}},lt=b({},at,{wrapLng:[-180,180],R:6371e3,distance:function(e,t){var i=Math.PI/180,s=e.lat*i,r=t.lat*i,a=Math.sin((t.lat-e.lat)*i/2),h=Math.sin((t.lng-e.lng)*i/2),g=a*a+Math.cos(s)*Math.cos(r)*h*h,T=2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g));return this.R*T}}),Et=6378137,$e={R:Et,MAX_LATITUDE:85.0511287798,project:function(e){var t=Math.PI/180,i=this.MAX_LATITUDE,s=Math.max(Math.min(i,e.lat),-i),r=Math.sin(s*t);return new Q(this.R*e.lng*t,this.R*Math.log((1+r)/(1-r))/2)},unproject:function(e){var t=180/Math.PI;return new Se((2*Math.atan(Math.exp(e.y/this.R))-Math.PI/2)*t,e.x*t/this.R)},bounds:(function(){var e=Et*Math.PI;return new ce([-e,-e],[e,e])})()};function Xe(e,t,i,s){if(J(e)){this._a=e[0],this._b=e[1],this._c=e[2],this._d=e[3];return}this._a=e,this._b=t,this._c=i,this._d=s}Xe.prototype={transform:function(e,t){return this._transform(e.clone(),t)},_transform:function(e,t){return t=t||1,e.x=t*(this._a*e.x+this._b),e.y=t*(this._c*e.y+this._d),e},untransform:function(e,t){return t=t||1,new Q((e.x/t-this._b)/this._a,(e.y/t-this._d)/this._c)}};function M(e,t,i,s){return new Xe(e,t,i,s)}var U=b({},lt,{code:"EPSG:3857",projection:$e,transformation:(function(){var e=.5/(Math.PI*$e.R);return M(e,.5,-e,.5)})()}),me=b({},U,{code:"EPSG:900913"});function G(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function _e(e,t){var i="",s,r,a,h,g,T;for(s=0,a=e.length;s<a;s++){for(g=e[s],r=0,h=g.length;r<h;r++)T=g[r],i+=(r?"L":"M")+T.x+" "+T.y;i+=t?le.svg?"z":"x":""}return i||"M0 0"}var Je=document.documentElement.style,Ue="ActiveXObject"in window,vt=Ue&&!document.addEventListener,O="msLaunchUri"in navigator&&!("documentMode"in document),ae=et("webkit"),be=et("android"),De=et("android 2")||et("android 3"),z=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),ke=be&&et("Google")&&z<537&&!("AudioNode"in window),Qe=!!window.opera,Ut=!O&&et("chrome"),Jt=et("gecko")&&!ae&&!Qe&&!Ue,Ri=!Ut&&et("safari"),Xn=et("phantom"),Pt="OTransition"in Je,zi=navigator.platform.indexOf("Win")===0,Jn=Ue&&"transition"in Je,Dn="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!De,Qn="MozPerspective"in Je,ei=!window.L_DISABLE_3D&&(Jn||Dn||Qn)&&!Pt&&!Xn,rn=typeof orientation<"u"||et("mobile"),Ni=rn&&ae,ti=rn&&Dn,ni=!window.PointerEvent&&window.MSPointerEvent,ii=!!(window.PointerEvent||ni),si="ontouchstart"in window||!!window.TouchEvent,Bi=!window.L_NO_TOUCH&&(si||ii),Wi=rn&&Qe,Zi=rn&&Jt,ri=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,m=(function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("testPassiveEventSupport",k,t),window.removeEventListener("testPassiveEventSupport",k,t)}catch{}return e})(),ue=(function(){return!!document.createElement("canvas").getContext})(),ve=!!(document.createElementNS&&G("svg").createSVGRect),Le=!!ve&&(function(){var e=document.createElement("div");return e.innerHTML="<svg/>",(e.firstChild&&e.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),fe=!ve&&(function(){try{var e=document.createElement("div");e.innerHTML='<v:shape adj="1"/>';var t=e.firstChild;return t.style.behavior="url(#default#VML)",t&&typeof t.adj=="object"}catch{return!1}})(),Ne=navigator.platform.indexOf("Mac")===0,wt=navigator.platform.indexOf("Linux")===0;function et(e){return navigator.userAgent.toLowerCase().indexOf(e)>=0}var le={ie:Ue,ielt9:vt,edge:O,webkit:ae,android:be,android23:De,androidStock:ke,opera:Qe,chrome:Ut,gecko:Jt,safari:Ri,phantom:Xn,opera12:Pt,win:zi,ie3d:Jn,webkit3d:Dn,gecko3d:Qn,any3d:ei,mobile:rn,mobileWebkit:Ni,mobileWebkit3d:ti,msPointer:ni,pointer:ii,touch:Bi,touchNative:si,mobileOpera:Wi,mobileGecko:Zi,retina:ri,passiveEvents:m,canvas:ue,svg:ve,vml:fe,inlineSvg:Le,mac:Ne,linux:wt},On=le.msPointer?"MSPointerDown":"pointerdown",Rn=le.msPointer?"MSPointerMove":"pointermove",Zs=le.msPointer?"MSPointerUp":"pointerup",Fs=le.msPointer?"MSPointerCancel":"pointercancel",Fi={touchstart:On,touchmove:Rn,touchend:Zs,touchcancel:Fs},Hs={touchstart:bo,touchmove:oi,touchend:oi,touchcancel:oi},_n={},Us=!1;function go(e,t,i){return t==="touchstart"&&yo(),Hs[t]?(i=Hs[t].bind(this,i),e.addEventListener(Fi[t],i,!1),i):(console.warn("wrong event specified:",t),k)}function xo(e,t,i){if(!Fi[t]){console.warn("wrong event specified:",t);return}e.removeEventListener(Fi[t],i,!1)}function _o(e){_n[e.pointerId]=e}function vo(e){_n[e.pointerId]&&(_n[e.pointerId]=e)}function qs(e){delete _n[e.pointerId]}function yo(){Us||(document.addEventListener(On,_o,!0),document.addEventListener(Rn,vo,!0),document.addEventListener(Zs,qs,!0),document.addEventListener(Fs,qs,!0),Us=!0)}function oi(e,t){if(t.pointerType!==(t.MSPOINTER_TYPE_MOUSE||"mouse")){t.touches=[];for(var i in _n)t.touches.push(_n[i]);t.changedTouches=[t],e(t)}}function bo(e,t){t.MSPOINTER_TYPE_TOUCH&&t.pointerType===t.MSPOINTER_TYPE_TOUCH&&ct(t),oi(e,t)}function jo(e){var t={},i,s;for(s in e)i=e[s],t[s]=i&&i.bind?i.bind(e):i;return e=t,t.type="dblclick",t.detail=2,t.isTrusted=!1,t._simulated=!0,t}var wo=200;function Co(e,t){e.addEventListener("dblclick",t);var i=0,s;function r(a){if(a.detail!==1){s=a.detail;return}if(!(a.pointerType==="mouse"||a.sourceCapabilities&&!a.sourceCapabilities.firesTouchEvents)){var h=Ks(a);if(!(h.some(function(T){return T instanceof HTMLLabelElement&&T.attributes.for})&&!h.some(function(T){return T instanceof HTMLInputElement||T instanceof HTMLSelectElement}))){var g=Date.now();g-i<=wo?(s++,s===2&&t(jo(a))):s=1,i=g}}}return e.addEventListener("click",r),{dblclick:t,simDblclick:r}}function So(e,t){e.removeEventListener("dblclick",t.dblclick),e.removeEventListener("click",t.simDblclick)}var Hi=ci(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),zn=ci(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Gs=zn==="webkitTransition"||zn==="OTransition"?zn+"End":"transitionend";function $s(e){return typeof e=="string"?document.getElementById(e):e}function Nn(e,t){var i=e.style[t]||e.currentStyle&&e.currentStyle[t];if((!i||i==="auto")&&document.defaultView){var s=document.defaultView.getComputedStyle(e,null);i=s?s[t]:null}return i==="auto"?null:i}function Ae(e,t,i){var s=document.createElement(e);return s.className=t||"",i&&i.appendChild(s),s}function We(e){var t=e.parentNode;t&&t.removeChild(e)}function ai(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function vn(e){var t=e.parentNode;t&&t.lastChild!==e&&t.appendChild(e)}function yn(e){var t=e.parentNode;t&&t.firstChild!==e&&t.insertBefore(e,t.firstChild)}function Ui(e,t){if(e.classList!==void 0)return e.classList.contains(t);var i=li(e);return i.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(i)}function ye(e,t){if(e.classList!==void 0)for(var i=X(t),s=0,r=i.length;s<r;s++)e.classList.add(i[s]);else if(!Ui(e,t)){var a=li(e);qi(e,(a?a+" ":"")+t)}}function qe(e,t){e.classList!==void 0?e.classList.remove(t):qi(e,K((" "+li(e)+" ").replace(" "+t+" "," ")))}function qi(e,t){e.className.baseVal===void 0?e.className=t:e.className.baseVal=t}function li(e){return e.correspondingElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Ct(e,t){"opacity"in e.style?e.style.opacity=t:"filter"in e.style&&Lo(e,t)}function Lo(e,t){var i=!1,s="DXImageTransform.Microsoft.Alpha";try{i=e.filters.item(s)}catch{if(t===1)return}t=Math.round(t*100),i?(i.Enabled=t!==100,i.Opacity=t):e.style.filter+=" progid:"+s+"(opacity="+t+")"}function ci(e){for(var t=document.documentElement.style,i=0;i<e.length;i++)if(e[i]in t)return e[i];return!1}function on(e,t,i){var s=t||new Q(0,0);e.style[Hi]=(le.ie3d?"translate("+s.x+"px,"+s.y+"px)":"translate3d("+s.x+"px,"+s.y+"px,0)")+(i?" scale("+i+")":"")}function Ve(e,t){e._leaflet_pos=t,le.any3d?on(e,t):(e.style.left=t.x+"px",e.style.top=t.y+"px")}function an(e){return e._leaflet_pos||new Q(0,0)}var Bn,Wn,Gi;if("onselectstart"in document)Bn=function(){ge(window,"selectstart",ct)},Wn=function(){Re(window,"selectstart",ct)};else{var Zn=ci(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Bn=function(){if(Zn){var e=document.documentElement.style;Gi=e[Zn],e[Zn]="none"}},Wn=function(){Zn&&(document.documentElement.style[Zn]=Gi,Gi=void 0)}}function $i(){ge(window,"dragstart",ct)}function Vi(){Re(window,"dragstart",ct)}var di,Yi;function Ki(e){for(;e.tabIndex===-1;)e=e.parentNode;e.style&&(ui(),di=e,Yi=e.style.outlineStyle,e.style.outlineStyle="none",ge(window,"keydown",ui))}function ui(){di&&(di.style.outlineStyle=Yi,di=void 0,Yi=void 0,Re(window,"keydown",ui))}function Vs(e){do e=e.parentNode;while((!e.offsetWidth||!e.offsetHeight)&&e!==document.body);return e}function Xi(e){var t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth||1,y:t.height/e.offsetHeight||1,boundingClientRect:t}}var To={__proto__:null,TRANSFORM:Hi,TRANSITION:zn,TRANSITION_END:Gs,get:$s,getStyle:Nn,create:Ae,remove:We,empty:ai,toFront:vn,toBack:yn,hasClass:Ui,addClass:ye,removeClass:qe,setClass:qi,getClass:li,setOpacity:Ct,testProp:ci,setTransform:on,setPosition:Ve,getPosition:an,get disableTextSelection(){return Bn},get enableTextSelection(){return Wn},disableImageDrag:$i,enableImageDrag:Vi,preventOutline:Ki,restoreOutline:ui,getSizedParentNode:Vs,getScale:Xi};function ge(e,t,i,s){if(t&&typeof t=="object")for(var r in t)Qi(e,r,t[r],i);else{t=X(t);for(var a=0,h=t.length;a<h;a++)Qi(e,t[a],i,s)}return this}var Wt="_leaflet_events";function Re(e,t,i,s){if(arguments.length===1)Ys(e),delete e[Wt];else if(t&&typeof t=="object")for(var r in t)es(e,r,t[r],i);else if(t=X(t),arguments.length===2)Ys(e,function(g){return x(t,g)!==-1});else for(var a=0,h=t.length;a<h;a++)es(e,t[a],i,s);return this}function Ys(e,t){for(var i in e[Wt]){var s=i.split(/\d/)[0];(!t||t(s))&&es(e,s,null,null,i)}}var Ji={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Qi(e,t,i,s){var r=t+C(i)+(s?"_"+C(s):"");if(e[Wt]&&e[Wt][r])return this;var a=function(g){return i.call(s||e,g||window.event)},h=a;!le.touchNative&&le.pointer&&t.indexOf("touch")===0?a=go(e,t,a):le.touch&&t==="dblclick"?a=Co(e,a):"addEventListener"in e?t==="touchstart"||t==="touchmove"||t==="wheel"||t==="mousewheel"?e.addEventListener(Ji[t]||t,a,le.passiveEvents?{passive:!1}:!1):t==="mouseenter"||t==="mouseleave"?(a=function(g){g=g||window.event,ns(e,g)&&h(g)},e.addEventListener(Ji[t],a,!1)):e.addEventListener(t,h,!1):e.attachEvent("on"+t,a),e[Wt]=e[Wt]||{},e[Wt][r]=a}function es(e,t,i,s,r){r=r||t+C(i)+(s?"_"+C(s):"");var a=e[Wt]&&e[Wt][r];if(!a)return this;!le.touchNative&&le.pointer&&t.indexOf("touch")===0?xo(e,t,a):le.touch&&t==="dblclick"?So(e,a):"removeEventListener"in e?e.removeEventListener(Ji[t]||t,a,!1):e.detachEvent("on"+t,a),e[Wt][r]=null}function ln(e){return e.stopPropagation?e.stopPropagation():e.originalEvent?e.originalEvent._stopped=!0:e.cancelBubble=!0,this}function ts(e){return Qi(e,"wheel",ln),this}function Fn(e){return ge(e,"mousedown touchstart dblclick contextmenu",ln),e._leaflet_disable_click=!0,this}function ct(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this}function cn(e){return ct(e),ln(e),this}function Ks(e){if(e.composedPath)return e.composedPath();for(var t=[],i=e.target;i;)t.push(i),i=i.parentNode;return t}function Xs(e,t){if(!t)return new Q(e.clientX,e.clientY);var i=Xi(t),s=i.boundingClientRect;return new Q((e.clientX-s.left)/i.x-t.clientLeft,(e.clientY-s.top)/i.y-t.clientTop)}var Eo=le.linux&&le.chrome?window.devicePixelRatio:le.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Js(e){return le.edge?e.wheelDeltaY/2:e.deltaY&&e.deltaMode===0?-e.deltaY/Eo:e.deltaY&&e.deltaMode===1?-e.deltaY*20:e.deltaY&&e.deltaMode===2?-e.deltaY*60:e.deltaX||e.deltaZ?0:e.wheelDelta?(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&Math.abs(e.detail)<32765?-e.detail*20:e.detail?e.detail/-32765*60:0}function ns(e,t){var i=t.relatedTarget;if(!i)return!0;try{for(;i&&i!==e;)i=i.parentNode}catch{return!1}return i!==e}var Po={__proto__:null,on:ge,off:Re,stopPropagation:ln,disableScrollPropagation:ts,disableClickPropagation:Fn,preventDefault:ct,stop:cn,getPropagationPath:Ks,getMousePosition:Xs,getWheelDelta:Js,isExternalTarget:ns,addListener:ge,removeListener:Re},Qs=ie.extend({run:function(e,t,i,s){this.stop(),this._el=e,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(s||.5,.2),this._startPos=an(e),this._offset=t.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=R(this._animate,this),this._step()},_step:function(e){var t=+new Date-this._startTime,i=this._duration*1e3;t<i?this._runFrame(this._easeOut(t/i),e):(this._runFrame(1),this._complete())},_runFrame:function(e,t){var i=this._startPos.add(this._offset.multiplyBy(e));t&&i._round(),Ve(this._el,i),this.fire("step")},_complete:function(){q(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(e){return 1-Math.pow(1-e,this._easeOutPower)}}),Pe=ie.extend({options:{crs:U,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(e,t){t=F(this,t),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(e),this._initLayout(),this._onResize=w(this._onResize,this),this._initEvents(),t.maxBounds&&this.setMaxBounds(t.maxBounds),t.zoom!==void 0&&(this._zoom=this._limitZoom(t.zoom)),t.center&&t.zoom!==void 0&&this.setView(xe(t.center),t.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=zn&&le.any3d&&!le.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),ge(this._proxy,Gs,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(e,t,i){if(t=t===void 0?this._zoom:this._limitZoom(t),e=this._limitCenter(xe(e),t,this.options.maxBounds),i=i||{},this._stop(),this._loaded&&!i.reset&&i!==!0){i.animate!==void 0&&(i.zoom=b({animate:i.animate},i.zoom),i.pan=b({animate:i.animate,duration:i.duration},i.pan));var s=this._zoom!==t?this._tryAnimatedZoom&&this._tryAnimatedZoom(e,t,i.zoom):this._tryAnimatedPan(e,i.pan);if(s)return clearTimeout(this._sizeTimer),this}return this._resetView(e,t,i.pan&&i.pan.noMoveStart),this},setZoom:function(e,t){return this._loaded?this.setView(this.getCenter(),e,{zoom:t}):(this._zoom=e,this)},zoomIn:function(e,t){return e=e||(le.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+e,t)},zoomOut:function(e,t){return e=e||(le.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-e,t)},setZoomAround:function(e,t,i){var s=this.getZoomScale(t),r=this.getSize().divideBy(2),a=e instanceof Q?e:this.latLngToContainerPoint(e),h=a.subtract(r).multiplyBy(1-1/s),g=this.containerPointToLatLng(r.add(h));return this.setView(g,t,{zoom:i})},_getBoundsCenterZoom:function(e,t){t=t||{},e=e.getBounds?e.getBounds():Ce(e);var i=ne(t.paddingTopLeft||t.padding||[0,0]),s=ne(t.paddingBottomRight||t.padding||[0,0]),r=this.getBoundsZoom(e,!1,i.add(s));if(r=typeof t.maxZoom=="number"?Math.min(t.maxZoom,r):r,r===1/0)return{center:e.getCenter(),zoom:r};var a=s.subtract(i).divideBy(2),h=this.project(e.getSouthWest(),r),g=this.project(e.getNorthEast(),r),T=this.unproject(h.add(g).divideBy(2).add(a),r);return{center:T,zoom:r}},fitBounds:function(e,t){if(e=Ce(e),!e.isValid())throw new Error("Bounds are not valid.");var i=this._getBoundsCenterZoom(e,t);return this.setView(i.center,i.zoom,t)},fitWorld:function(e){return this.fitBounds([[-90,-180],[90,180]],e)},panTo:function(e,t){return this.setView(e,this._zoom,{pan:t})},panBy:function(e,t){if(e=ne(e).round(),t=t||{},!e.x&&!e.y)return this.fire("moveend");if(t.animate!==!0&&!this.getSize().contains(e))return this._resetView(this.unproject(this.project(this.getCenter()).add(e)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Qs,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),t.noMoveStart||this.fire("movestart"),t.animate!==!1){ye(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(e).round();this._panAnim.run(this._mapPane,i,t.duration||.25,t.easeLinearity)}else this._rawPanBy(e),this.fire("move").fire("moveend");return this},flyTo:function(e,t,i){if(i=i||{},i.animate===!1||!le.any3d)return this.setView(e,t,i);this._stop();var s=this.project(this.getCenter()),r=this.project(e),a=this.getSize(),h=this._zoom;e=xe(e),t=t===void 0?h:t;var g=Math.max(a.x,a.y),T=g*this.getZoomScale(h,t),Z=r.distanceTo(s)||1,se=1.42,he=se*se;function je(Ye){var wi=Ye?-1:1,xa=Ye?T:g,_a=T*T-g*g+wi*he*he*Z*Z,va=2*xa*he*Z,ms=_a/va,Ar=Math.sqrt(ms*ms+1)-ms,ya=Ar<1e-9?-18:Math.log(Ar);return ya}function mt(Ye){return(Math.exp(Ye)-Math.exp(-Ye))/2}function tt(Ye){return(Math.exp(Ye)+Math.exp(-Ye))/2}function Lt(Ye){return mt(Ye)/tt(Ye)}var gt=je(0);function Ln(Ye){return g*(tt(gt)/tt(gt+se*Ye))}function ma(Ye){return g*(tt(gt)*Lt(gt+se*Ye)-mt(gt))/he}function fa(Ye){return 1-Math.pow(1-Ye,1.5)}var pa=Date.now(),Ir=(je(1)-gt)/se,ga=i.duration?1e3*i.duration:1e3*Ir*.8;function Mr(){var Ye=(Date.now()-pa)/ga,wi=fa(Ye)*Ir;Ye<=1?(this._flyToFrame=R(Mr,this),this._move(this.unproject(s.add(r.subtract(s).multiplyBy(ma(wi)/Z)),h),this.getScaleZoom(g/Ln(wi),h),{flyTo:!0})):this._move(e,t)._moveEnd(!0)}return this._moveStart(!0,i.noMoveStart),Mr.call(this),this},flyToBounds:function(e,t){var i=this._getBoundsCenterZoom(e,t);return this.flyTo(i.center,i.zoom,t)},setMaxBounds:function(e){return e=Ce(e),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),e.isValid()?(this.options.maxBounds=e,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(e){var t=this.options.minZoom;return this.options.minZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(e):this},setMaxZoom:function(e){var t=this.options.maxZoom;return this.options.maxZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(e):this},panInsideBounds:function(e,t){this._enforcingBounds=!0;var i=this.getCenter(),s=this._limitCenter(i,this._zoom,Ce(e));return i.equals(s)||this.panTo(s,t),this._enforcingBounds=!1,this},panInside:function(e,t){t=t||{};var i=ne(t.paddingTopLeft||t.padding||[0,0]),s=ne(t.paddingBottomRight||t.padding||[0,0]),r=this.project(this.getCenter()),a=this.project(e),h=this.getPixelBounds(),g=Oe([h.min.add(i),h.max.subtract(s)]),T=g.getSize();if(!g.contains(a)){this._enforcingBounds=!0;var Z=a.subtract(g.getCenter()),se=g.extend(a).getSize().subtract(T);r.x+=Z.x<0?-se.x:se.x,r.y+=Z.y<0?-se.y:se.y,this.panTo(this.unproject(r),t),this._enforcingBounds=!1}return this},invalidateSize:function(e){if(!this._loaded)return this;e=b({animate:!1,pan:!0},e===!0?{animate:!0}:e);var t=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var i=this.getSize(),s=t.divideBy(2).round(),r=i.divideBy(2).round(),a=s.subtract(r);return!a.x&&!a.y?this:(e.animate&&e.pan?this.panBy(a):(e.pan&&this._rawPanBy(a),this.fire("move"),e.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(w(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:t,newSize:i}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(e){if(e=this._locateOptions=b({timeout:1e4,watch:!1},e),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var t=w(this._handleGeolocationResponse,this),i=w(this._handleGeolocationError,this);return e.watch?this._locationWatchId=navigator.geolocation.watchPosition(t,i,e):navigator.geolocation.getCurrentPosition(t,i,e),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(e){if(this._container._leaflet_id){var t=e.code,i=e.message||(t===1?"permission denied":t===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:t,message:"Geolocation error: "+i+"."})}},_handleGeolocationResponse:function(e){if(this._container._leaflet_id){var t=e.coords.latitude,i=e.coords.longitude,s=new Se(t,i),r=s.toBounds(e.coords.accuracy*2),a=this._locateOptions;if(a.setView){var h=this.getBoundsZoom(r);this.setView(s,a.maxZoom?Math.min(h,a.maxZoom):h)}var g={latlng:s,bounds:r,timestamp:e.timestamp};for(var T in e.coords)typeof e.coords[T]=="number"&&(g[T]=e.coords[T]);this.fire("locationfound",g)}},addHandler:function(e,t){if(!t)return this;var i=this[e]=new t(this);return this._handlers.push(i),this.options[e]&&i.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),We(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(q(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var e;for(e in this._layers)this._layers[e].remove();for(e in this._panes)We(this._panes[e]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(e,t){var i="leaflet-pane"+(e?" leaflet-"+e.replace("Pane","")+"-pane":""),s=Ae("div",i,t||this._mapPane);return e&&(this._panes[e]=s),s},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var e=this.getPixelBounds(),t=this.unproject(e.getBottomLeft()),i=this.unproject(e.getTopRight());return new Me(t,i)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(e,t,i){e=Ce(e),i=ne(i||[0,0]);var s=this.getZoom()||0,r=this.getMinZoom(),a=this.getMaxZoom(),h=e.getNorthWest(),g=e.getSouthEast(),T=this.getSize().subtract(i),Z=Oe(this.project(g,s),this.project(h,s)).getSize(),se=le.any3d?this.options.zoomSnap:1,he=T.x/Z.x,je=T.y/Z.y,mt=t?Math.max(he,je):Math.min(he,je);return s=this.getScaleZoom(mt,s),se&&(s=Math.round(s/(se/100))*(se/100),s=t?Math.ceil(s/se)*se:Math.floor(s/se)*se),Math.max(r,Math.min(a,s))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new Q(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(e,t){var i=this._getTopLeftPoint(e,t);return new ce(i,i.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(e){return this.options.crs.getProjectedBounds(e===void 0?this.getZoom():e)},getPane:function(e){return typeof e=="string"?this._panes[e]:e},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(e,t){var i=this.options.crs;return t=t===void 0?this._zoom:t,i.scale(e)/i.scale(t)},getScaleZoom:function(e,t){var i=this.options.crs;t=t===void 0?this._zoom:t;var s=i.zoom(e*i.scale(t));return isNaN(s)?1/0:s},project:function(e,t){return t=t===void 0?this._zoom:t,this.options.crs.latLngToPoint(xe(e),t)},unproject:function(e,t){return t=t===void 0?this._zoom:t,this.options.crs.pointToLatLng(ne(e),t)},layerPointToLatLng:function(e){var t=ne(e).add(this.getPixelOrigin());return this.unproject(t)},latLngToLayerPoint:function(e){var t=this.project(xe(e))._round();return t._subtract(this.getPixelOrigin())},wrapLatLng:function(e){return this.options.crs.wrapLatLng(xe(e))},wrapLatLngBounds:function(e){return this.options.crs.wrapLatLngBounds(Ce(e))},distance:function(e,t){return this.options.crs.distance(xe(e),xe(t))},containerPointToLayerPoint:function(e){return ne(e).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(e){return ne(e).add(this._getMapPanePos())},containerPointToLatLng:function(e){var t=this.containerPointToLayerPoint(ne(e));return this.layerPointToLatLng(t)},latLngToContainerPoint:function(e){return this.layerPointToContainerPoint(this.latLngToLayerPoint(xe(e)))},mouseEventToContainerPoint:function(e){return Xs(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(e){var t=this._container=$s(e);if(t){if(t._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");ge(t,"scroll",this._onScroll,this),this._containerId=C(t)},_initLayout:function(){var e=this._container;this._fadeAnimated=this.options.fadeAnimation&&le.any3d,ye(e,"leaflet-container"+(le.touch?" leaflet-touch":"")+(le.retina?" leaflet-retina":"")+(le.ielt9?" leaflet-oldie":"")+(le.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var t=Nn(e,"position");t!=="absolute"&&t!=="relative"&&t!=="fixed"&&t!=="sticky"&&(e.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var e=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Ve(this._mapPane,new Q(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(ye(e.markerPane,"leaflet-zoom-hide"),ye(e.shadowPane,"leaflet-zoom-hide"))},_resetView:function(e,t,i){Ve(this._mapPane,new Q(0,0));var s=!this._loaded;this._loaded=!0,t=this._limitZoom(t),this.fire("viewprereset");var r=this._zoom!==t;this._moveStart(r,i)._move(e,t)._moveEnd(r),this.fire("viewreset"),s&&this.fire("load")},_moveStart:function(e,t){return e&&this.fire("zoomstart"),t||this.fire("movestart"),this},_move:function(e,t,i,s){t===void 0&&(t=this._zoom);var r=this._zoom!==t;return this._zoom=t,this._lastCenter=e,this._pixelOrigin=this._getNewPixelOrigin(e),s?i&&i.pinch&&this.fire("zoom",i):((r||i&&i.pinch)&&this.fire("zoom",i),this.fire("move",i)),this},_moveEnd:function(e){return e&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return q(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(e){Ve(this._mapPane,this._getMapPanePos().subtract(e))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){this._targets={},this._targets[C(this._container)]=this;var t=e?Re:ge;t(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&t(window,"resize",this._onResize,this),le.any3d&&this.options.transform3DLimit&&(e?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){q(this._resizeRequest),this._resizeRequest=R(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var e=this._getMapPanePos();Math.max(Math.abs(e.x),Math.abs(e.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(e,t){for(var i=[],s,r=t==="mouseout"||t==="mouseover",a=e.target||e.srcElement,h=!1;a;){if(s=this._targets[C(a)],s&&(t==="click"||t==="preclick")&&this._draggableMoved(s)){h=!0;break}if(s&&s.listens(t,!0)&&(r&&!ns(a,e)||(i.push(s),r))||a===this._container)break;a=a.parentNode}return!i.length&&!h&&!r&&this.listens(t,!0)&&(i=[this]),i},_isClickDisabled:function(e){for(;e&&e!==this._container;){if(e._leaflet_disable_click)return!0;e=e.parentNode}},_handleDOMEvent:function(e){var t=e.target||e.srcElement;if(!(!this._loaded||t._leaflet_disable_events||e.type==="click"&&this._isClickDisabled(t))){var i=e.type;i==="mousedown"&&Ki(t),this._fireDOMEvent(e,i)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(e,t,i){if(e.type==="click"){var s=b({},e);s.type="preclick",this._fireDOMEvent(s,s.type,i)}var r=this._findEventTargets(e,t);if(i){for(var a=[],h=0;h<i.length;h++)i[h].listens(t,!0)&&a.push(i[h]);r=a.concat(r)}if(r.length){t==="contextmenu"&&ct(e);var g=r[0],T={originalEvent:e};if(e.type!=="keypress"&&e.type!=="keydown"&&e.type!=="keyup"){var Z=g.getLatLng&&(!g._radius||g._radius<=10);T.containerPoint=Z?this.latLngToContainerPoint(g.getLatLng()):this.mouseEventToContainerPoint(e),T.layerPoint=this.containerPointToLayerPoint(T.containerPoint),T.latlng=Z?g.getLatLng():this.layerPointToLatLng(T.layerPoint)}for(h=0;h<r.length;h++)if(r[h].fire(t,T,!0),T.originalEvent._stopped||r[h].options.bubblingMouseEvents===!1&&x(this._mouseEvents,t)!==-1)return}},_draggableMoved:function(e){return e=e.dragging&&e.dragging.enabled()?e:this,e.dragging&&e.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var e=0,t=this._handlers.length;e<t;e++)this._handlers[e].disable()},whenReady:function(e,t){return this._loaded?e.call(t||this,{target:this}):this.on("load",e,t),this},_getMapPanePos:function(){return an(this._mapPane)||new Q(0,0)},_moved:function(){var e=this._getMapPanePos();return e&&!e.equals([0,0])},_getTopLeftPoint:function(e,t){var i=e&&t!==void 0?this._getNewPixelOrigin(e,t):this.getPixelOrigin();return i.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(e,t){var i=this.getSize()._divideBy(2);return this.project(e,t)._subtract(i)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(e,t,i){var s=this._getNewPixelOrigin(i,t);return this.project(e,t)._subtract(s)},_latLngBoundsToNewLayerBounds:function(e,t,i){var s=this._getNewPixelOrigin(i,t);return Oe([this.project(e.getSouthWest(),t)._subtract(s),this.project(e.getNorthWest(),t)._subtract(s),this.project(e.getSouthEast(),t)._subtract(s),this.project(e.getNorthEast(),t)._subtract(s)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(e){return this.latLngToLayerPoint(e).subtract(this._getCenterLayerPoint())},_limitCenter:function(e,t,i){if(!i)return e;var s=this.project(e,t),r=this.getSize().divideBy(2),a=new ce(s.subtract(r),s.add(r)),h=this._getBoundsOffset(a,i,t);return Math.abs(h.x)<=1&&Math.abs(h.y)<=1?e:this.unproject(s.add(h),t)},_limitOffset:function(e,t){if(!t)return e;var i=this.getPixelBounds(),s=new ce(i.min.add(e),i.max.add(e));return e.add(this._getBoundsOffset(s,t))},_getBoundsOffset:function(e,t,i){var s=Oe(this.project(t.getNorthEast(),i),this.project(t.getSouthWest(),i)),r=s.min.subtract(e.min),a=s.max.subtract(e.max),h=this._rebound(r.x,-a.x),g=this._rebound(r.y,-a.y);return new Q(h,g)},_rebound:function(e,t){return e+t>0?Math.round(e-t)/2:Math.max(0,Math.ceil(e))-Math.max(0,Math.floor(t))},_limitZoom:function(e){var t=this.getMinZoom(),i=this.getMaxZoom(),s=le.any3d?this.options.zoomSnap:1;return s&&(e=Math.round(e/s)*s),Math.max(t,Math.min(i,e))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){qe(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(e,t){var i=this._getCenterOffset(e)._trunc();return(t&&t.animate)!==!0&&!this.getSize().contains(i)?!1:(this.panBy(i,t),!0)},_createAnimProxy:function(){var e=this._proxy=Ae("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(e),this.on("zoomanim",function(t){var i=Hi,s=this._proxy.style[i];on(this._proxy,this.project(t.center,t.zoom),this.getZoomScale(t.zoom,1)),s===this._proxy.style[i]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){We(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var e=this.getCenter(),t=this.getZoom();on(this._proxy,this.project(e,t),this.getZoomScale(t,1))},_catchTransitionEnd:function(e){this._animatingZoom&&e.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(e,t,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||i.animate===!1||this._nothingToAnimate()||Math.abs(t-this._zoom)>this.options.zoomAnimationThreshold)return!1;var s=this.getZoomScale(t),r=this._getCenterOffset(e)._divideBy(1-1/s);return i.animate!==!0&&!this.getSize().contains(r)?!1:(R(function(){this._moveStart(!0,i.noMoveStart||!1)._animateZoom(e,t,!0)},this),!0)},_animateZoom:function(e,t,i,s){this._mapPane&&(i&&(this._animatingZoom=!0,this._animateToCenter=e,this._animateToZoom=t,ye(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:e,zoom:t,noUpdate:s}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(w(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&qe(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function ko(e,t){return new Pe(e,t)}var kt=j.extend({options:{position:"topright"},initialize:function(e){F(this,e)},getPosition:function(){return this.options.position},setPosition:function(e){var t=this._map;return t&&t.removeControl(this),this.options.position=e,t&&t.addControl(this),this},getContainer:function(){return this._container},addTo:function(e){this.remove(),this._map=e;var t=this._container=this.onAdd(e),i=this.getPosition(),s=e._controlCorners[i];return ye(t,"leaflet-control"),i.indexOf("bottom")!==-1?s.insertBefore(t,s.firstChild):s.appendChild(t),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(We(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(e){this._map&&e&&e.screenX>0&&e.screenY>0&&this._map.getContainer().focus()}}),Hn=function(e){return new kt(e)};Pe.include({addControl:function(e){return e.addTo(this),this},removeControl:function(e){return e.remove(),this},_initControlPos:function(){var e=this._controlCorners={},t="leaflet-",i=this._controlContainer=Ae("div",t+"control-container",this._container);function s(r,a){var h=t+r+" "+t+a;e[r+a]=Ae("div",h,i)}s("top","left"),s("top","right"),s("bottom","left"),s("bottom","right")},_clearControlPos:function(){for(var e in this._controlCorners)We(this._controlCorners[e]);We(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var er=kt.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(e,t,i,s){return i<s?-1:s<i?1:0}},initialize:function(e,t,i){F(this,i),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var s in e)this._addLayer(e[s],s);for(s in t)this._addLayer(t[s],s,!0)},onAdd:function(e){this._initLayout(),this._update(),this._map=e,e.on("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(e){return kt.prototype.addTo.call(this,e),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(e,t){return this._addLayer(e,t),this._map?this._update():this},addOverlay:function(e,t){return this._addLayer(e,t,!0),this._map?this._update():this},removeLayer:function(e){e.off("add remove",this._onLayerChange,this);var t=this._getLayer(C(e));return t&&this._layers.splice(this._layers.indexOf(t),1),this._map?this._update():this},expand:function(){ye(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var e=this._map.getSize().y-(this._container.offsetTop+50);return e<this._section.clientHeight?(ye(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=e+"px"):qe(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return qe(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var e="leaflet-control-layers",t=this._container=Ae("div",e),i=this.options.collapsed;t.setAttribute("aria-haspopup",!0),Fn(t),ts(t);var s=this._section=Ae("section",e+"-list");i&&(this._map.on("click",this.collapse,this),ge(t,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var r=this._layersLink=Ae("a",e+"-toggle",t);r.href="#",r.title="Layers",r.setAttribute("role","button"),ge(r,{keydown:function(a){a.keyCode===13&&this._expandSafely()},click:function(a){ct(a),this._expandSafely()}},this),i||this.expand(),this._baseLayersList=Ae("div",e+"-base",s),this._separator=Ae("div",e+"-separator",s),this._overlaysList=Ae("div",e+"-overlays",s),t.appendChild(s)},_getLayer:function(e){for(var t=0;t<this._layers.length;t++)if(this._layers[t]&&C(this._layers[t].layer)===e)return this._layers[t]},_addLayer:function(e,t,i){this._map&&e.on("add remove",this._onLayerChange,this),this._layers.push({layer:e,name:t,overlay:i}),this.options.sortLayers&&this._layers.sort(w(function(s,r){return this.options.sortFunction(s.layer,r.layer,s.name,r.name)},this)),this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;ai(this._baseLayersList),ai(this._overlaysList),this._layerControlInputs=[];var e,t,i,s,r=0;for(i=0;i<this._layers.length;i++)s=this._layers[i],this._addItem(s),t=t||s.overlay,e=e||!s.overlay,r+=s.overlay?0:1;return this.options.hideSingleBase&&(e=e&&r>1,this._baseLayersList.style.display=e?"":"none"),this._separator.style.display=t&&e?"":"none",this},_onLayerChange:function(e){this._handlingClick||this._update();var t=this._getLayer(C(e.target)),i=t.overlay?e.type==="add"?"overlayadd":"overlayremove":e.type==="add"?"baselayerchange":null;i&&this._map.fire(i,t)},_createRadioElement:function(e,t){var i='<input type="radio" class="leaflet-control-layers-selector" name="'+e+'"'+(t?' checked="checked"':"")+"/>",s=document.createElement("div");return s.innerHTML=i,s.firstChild},_addItem:function(e){var t=document.createElement("label"),i=this._map.hasLayer(e.layer),s;e.overlay?(s=document.createElement("input"),s.type="checkbox",s.className="leaflet-control-layers-selector",s.defaultChecked=i):s=this._createRadioElement("leaflet-base-layers_"+C(this),i),this._layerControlInputs.push(s),s.layerId=C(e.layer),ge(s,"click",this._onInputClick,this);var r=document.createElement("span");r.innerHTML=" "+e.name;var a=document.createElement("span");t.appendChild(a),a.appendChild(s),a.appendChild(r);var h=e.overlay?this._overlaysList:this._baseLayersList;return h.appendChild(t),this._checkDisabledLayers(),t},_onInputClick:function(){if(!this._preventClick){var e=this._layerControlInputs,t,i,s=[],r=[];this._handlingClick=!0;for(var a=e.length-1;a>=0;a--)t=e[a],i=this._getLayer(t.layerId).layer,t.checked?s.push(i):t.checked||r.push(i);for(a=0;a<r.length;a++)this._map.hasLayer(r[a])&&this._map.removeLayer(r[a]);for(a=0;a<s.length;a++)this._map.hasLayer(s[a])||this._map.addLayer(s[a]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var e=this._layerControlInputs,t,i,s=this._map.getZoom(),r=e.length-1;r>=0;r--)t=e[r],i=this._getLayer(t.layerId).layer,t.disabled=i.options.minZoom!==void 0&&s<i.options.minZoom||i.options.maxZoom!==void 0&&s>i.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var e=this._section;this._preventClick=!0,ge(e,"click",ct),this.expand();var t=this;setTimeout(function(){Re(e,"click",ct),t._preventClick=!1})}}),Io=function(e,t,i){return new er(e,t,i)},is=kt.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(e){var t="leaflet-control-zoom",i=Ae("div",t+" leaflet-bar"),s=this.options;return this._zoomInButton=this._createButton(s.zoomInText,s.zoomInTitle,t+"-in",i,this._zoomIn),this._zoomOutButton=this._createButton(s.zoomOutText,s.zoomOutTitle,t+"-out",i,this._zoomOut),this._updateDisabled(),e.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(e){e.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(e){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(e.shiftKey?3:1))},_zoomOut:function(e){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(e.shiftKey?3:1))},_createButton:function(e,t,i,s,r){var a=Ae("a",i,s);return a.innerHTML=e,a.href="#",a.title=t,a.setAttribute("role","button"),a.setAttribute("aria-label",t),Fn(a),ge(a,"click",cn),ge(a,"click",r,this),ge(a,"click",this._refocusOnMap,this),a},_updateDisabled:function(){var e=this._map,t="leaflet-disabled";qe(this._zoomInButton,t),qe(this._zoomOutButton,t),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||e._zoom===e.getMinZoom())&&(ye(this._zoomOutButton,t),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||e._zoom===e.getMaxZoom())&&(ye(this._zoomInButton,t),this._zoomInButton.setAttribute("aria-disabled","true"))}});Pe.mergeOptions({zoomControl:!0}),Pe.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new is,this.addControl(this.zoomControl))});var Mo=function(e){return new is(e)},tr=kt.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(e){var t="leaflet-control-scale",i=Ae("div",t),s=this.options;return this._addScales(s,t+"-line",i),e.on(s.updateWhenIdle?"moveend":"move",this._update,this),e.whenReady(this._update,this),i},onRemove:function(e){e.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(e,t,i){e.metric&&(this._mScale=Ae("div",t,i)),e.imperial&&(this._iScale=Ae("div",t,i))},_update:function(){var e=this._map,t=e.getSize().y/2,i=e.distance(e.containerPointToLatLng([0,t]),e.containerPointToLatLng([this.options.maxWidth,t]));this._updateScales(i)},_updateScales:function(e){this.options.metric&&e&&this._updateMetric(e),this.options.imperial&&e&&this._updateImperial(e)},_updateMetric:function(e){var t=this._getRoundNum(e),i=t<1e3?t+" m":t/1e3+" km";this._updateScale(this._mScale,i,t/e)},_updateImperial:function(e){var t=e*3.2808399,i,s,r;t>5280?(i=t/5280,s=this._getRoundNum(i),this._updateScale(this._iScale,s+" mi",s/i)):(r=this._getRoundNum(t),this._updateScale(this._iScale,r+" ft",r/t))},_updateScale:function(e,t,i){e.style.width=Math.round(this.options.maxWidth*i)+"px",e.innerHTML=t},_getRoundNum:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),i=e/t;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,t*i}}),Ao=function(e){return new tr(e)},Do='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',ss=kt.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(le.inlineSvg?Do+" ":"")+"Leaflet</a>"},initialize:function(e){F(this,e),this._attributions={}},onAdd:function(e){e.attributionControl=this,this._container=Ae("div","leaflet-control-attribution"),Fn(this._container);for(var t in e._layers)e._layers[t].getAttribution&&this.addAttribution(e._layers[t].getAttribution());return this._update(),e.on("layeradd",this._addAttribution,this),this._container},onRemove:function(e){e.off("layeradd",this._addAttribution,this)},_addAttribution:function(e){e.layer.getAttribution&&(this.addAttribution(e.layer.getAttribution()),e.layer.once("remove",function(){this.removeAttribution(e.layer.getAttribution())},this))},setPrefix:function(e){return this.options.prefix=e,this._update(),this},addAttribution:function(e){return e?(this._attributions[e]||(this._attributions[e]=0),this._attributions[e]++,this._update(),this):this},removeAttribution:function(e){return e?(this._attributions[e]&&(this._attributions[e]--,this._update()),this):this},_update:function(){if(this._map){var e=[];for(var t in this._attributions)this._attributions[t]&&e.push(t);var i=[];this.options.prefix&&i.push(this.options.prefix),e.length&&i.push(e.join(", ")),this._container.innerHTML=i.join(' <span aria-hidden="true">|</span> ')}}});Pe.mergeOptions({attributionControl:!0}),Pe.addInitHook(function(){this.options.attributionControl&&new ss().addTo(this)});var Oo=function(e){return new ss(e)};kt.Layers=er,kt.Zoom=is,kt.Scale=tr,kt.Attribution=ss,Hn.layers=Io,Hn.zoom=Mo,Hn.scale=Ao,Hn.attribution=Oo;var Zt=j.extend({initialize:function(e){this._map=e},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Zt.addTo=function(e,t){return e.addHandler(t,this),this};var Ro={Events:re},nr=le.touch?"touchstart mousedown":"mousedown",Qt=ie.extend({options:{clickTolerance:3},initialize:function(e,t,i,s){F(this,s),this._element=e,this._dragStartTarget=t||e,this._preventOutline=i},enable:function(){this._enabled||(ge(this._dragStartTarget,nr,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Qt._dragging===this&&this.finishDrag(!0),Re(this._dragStartTarget,nr,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(e){if(this._enabled&&(this._moved=!1,!Ui(this._element,"leaflet-zoom-anim"))){if(e.touches&&e.touches.length!==1){Qt._dragging===this&&this.finishDrag();return}if(!(Qt._dragging||e.shiftKey||e.which!==1&&e.button!==1&&!e.touches)&&(Qt._dragging=this,this._preventOutline&&Ki(this._element),$i(),Bn(),!this._moving)){this.fire("down");var t=e.touches?e.touches[0]:e,i=Vs(this._element);this._startPoint=new Q(t.clientX,t.clientY),this._startPos=an(this._element),this._parentScale=Xi(i);var s=e.type==="mousedown";ge(document,s?"mousemove":"touchmove",this._onMove,this),ge(document,s?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(e){if(this._enabled){if(e.touches&&e.touches.length>1){this._moved=!0;return}var t=e.touches&&e.touches.length===1?e.touches[0]:e,i=new Q(t.clientX,t.clientY)._subtract(this._startPoint);!i.x&&!i.y||Math.abs(i.x)+Math.abs(i.y)<this.options.clickTolerance||(i.x/=this._parentScale.x,i.y/=this._parentScale.y,ct(e),this._moved||(this.fire("dragstart"),this._moved=!0,ye(document.body,"leaflet-dragging"),this._lastTarget=e.target||e.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),ye(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(i),this._moving=!0,this._lastEvent=e,this._updatePosition())}},_updatePosition:function(){var e={originalEvent:this._lastEvent};this.fire("predrag",e),Ve(this._element,this._newPos),this.fire("drag",e)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(e){qe(document.body,"leaflet-dragging"),this._lastTarget&&(qe(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Re(document,"mousemove touchmove",this._onMove,this),Re(document,"mouseup touchend touchcancel",this._onUp,this),Vi(),Wn();var t=this._moved&&this._moving;this._moving=!1,Qt._dragging=!1,t&&this.fire("dragend",{noInertia:e,distance:this._newPos.distanceTo(this._startPos)})}});function ir(e,t,i){var s,r=[1,4,2,8],a,h,g,T,Z,se,he,je;for(a=0,se=e.length;a<se;a++)e[a]._code=dn(e[a],t);for(g=0;g<4;g++){for(he=r[g],s=[],a=0,se=e.length,h=se-1;a<se;h=a++)T=e[a],Z=e[h],T._code&he?Z._code&he||(je=hi(Z,T,he,t,i),je._code=dn(je,t),s.push(je)):(Z._code&he&&(je=hi(Z,T,he,t,i),je._code=dn(je,t),s.push(je)),s.push(T));e=s}return e}function sr(e,t){var i,s,r,a,h,g,T,Z,se;if(!e||e.length===0)throw new Error("latlngs not passed");St(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var he=xe([0,0]),je=Ce(e),mt=je.getNorthWest().distanceTo(je.getSouthWest())*je.getNorthEast().distanceTo(je.getNorthWest());mt<1700&&(he=rs(e));var tt=e.length,Lt=[];for(i=0;i<tt;i++){var gt=xe(e[i]);Lt.push(t.project(xe([gt.lat-he.lat,gt.lng-he.lng])))}for(g=T=Z=0,i=0,s=tt-1;i<tt;s=i++)r=Lt[i],a=Lt[s],h=r.y*a.x-a.y*r.x,T+=(r.x+a.x)*h,Z+=(r.y+a.y)*h,g+=h*3;g===0?se=Lt[0]:se=[T/g,Z/g];var Ln=t.unproject(ne(se));return xe([Ln.lat+he.lat,Ln.lng+he.lng])}function rs(e){for(var t=0,i=0,s=0,r=0;r<e.length;r++){var a=xe(e[r]);t+=a.lat,i+=a.lng,s++}return xe([t/s,i/s])}var zo={__proto__:null,clipPolygon:ir,polygonCenter:sr,centroid:rs};function rr(e,t){if(!t||!e.length)return e.slice();var i=t*t;return e=Wo(e,i),e=Bo(e,i),e}function or(e,t,i){return Math.sqrt(Un(e,t,i,!0))}function No(e,t,i){return Un(e,t,i)}function Bo(e,t){var i=e.length,s=typeof Uint8Array<"u"?Uint8Array:Array,r=new s(i);r[0]=r[i-1]=1,os(e,r,t,0,i-1);var a,h=[];for(a=0;a<i;a++)r[a]&&h.push(e[a]);return h}function os(e,t,i,s,r){var a=0,h,g,T;for(g=s+1;g<=r-1;g++)T=Un(e[g],e[s],e[r],!0),T>a&&(h=g,a=T);a>i&&(t[h]=1,os(e,t,i,s,h),os(e,t,i,h,r))}function Wo(e,t){for(var i=[e[0]],s=1,r=0,a=e.length;s<a;s++)Zo(e[s],e[r])>t&&(i.push(e[s]),r=s);return r<a-1&&i.push(e[a-1]),i}var ar;function lr(e,t,i,s,r){var a=s?ar:dn(e,i),h=dn(t,i),g,T,Z;for(ar=h;;){if(!(a|h))return[e,t];if(a&h)return!1;g=a||h,T=hi(e,t,g,i,r),Z=dn(T,i),g===a?(e=T,a=Z):(t=T,h=Z)}}function hi(e,t,i,s,r){var a=t.x-e.x,h=t.y-e.y,g=s.min,T=s.max,Z,se;return i&8?(Z=e.x+a*(T.y-e.y)/h,se=T.y):i&4?(Z=e.x+a*(g.y-e.y)/h,se=g.y):i&2?(Z=T.x,se=e.y+h*(T.x-e.x)/a):i&1&&(Z=g.x,se=e.y+h*(g.x-e.x)/a),new Q(Z,se,r)}function dn(e,t){var i=0;return e.x<t.min.x?i|=1:e.x>t.max.x&&(i|=2),e.y<t.min.y?i|=4:e.y>t.max.y&&(i|=8),i}function Zo(e,t){var i=t.x-e.x,s=t.y-e.y;return i*i+s*s}function Un(e,t,i,s){var r=t.x,a=t.y,h=i.x-r,g=i.y-a,T=h*h+g*g,Z;return T>0&&(Z=((e.x-r)*h+(e.y-a)*g)/T,Z>1?(r=i.x,a=i.y):Z>0&&(r+=h*Z,a+=g*Z)),h=e.x-r,g=e.y-a,s?h*h+g*g:new Q(r,a)}function St(e){return!J(e[0])||typeof e[0][0]!="object"&&typeof e[0][0]<"u"}function cr(e){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),St(e)}function dr(e,t){var i,s,r,a,h,g,T,Z;if(!e||e.length===0)throw new Error("latlngs not passed");St(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var se=xe([0,0]),he=Ce(e),je=he.getNorthWest().distanceTo(he.getSouthWest())*he.getNorthEast().distanceTo(he.getNorthWest());je<1700&&(se=rs(e));var mt=e.length,tt=[];for(i=0;i<mt;i++){var Lt=xe(e[i]);tt.push(t.project(xe([Lt.lat-se.lat,Lt.lng-se.lng])))}for(i=0,s=0;i<mt-1;i++)s+=tt[i].distanceTo(tt[i+1])/2;if(s===0)Z=tt[0];else for(i=0,a=0;i<mt-1;i++)if(h=tt[i],g=tt[i+1],r=h.distanceTo(g),a+=r,a>s){T=(a-s)/r,Z=[g.x-T*(g.x-h.x),g.y-T*(g.y-h.y)];break}var gt=t.unproject(ne(Z));return xe([gt.lat+se.lat,gt.lng+se.lng])}var Fo={__proto__:null,simplify:rr,pointToSegmentDistance:or,closestPointOnSegment:No,clipSegment:lr,_getEdgeIntersection:hi,_getBitCode:dn,_sqClosestPointOnSegment:Un,isFlat:St,_flat:cr,polylineCenter:dr},as={project:function(e){return new Q(e.lng,e.lat)},unproject:function(e){return new Se(e.y,e.x)},bounds:new ce([-180,-90],[180,90])},ls={R:6378137,R_MINOR:6356752314245179e-9,bounds:new ce([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(e){var t=Math.PI/180,i=this.R,s=e.lat*t,r=this.R_MINOR/i,a=Math.sqrt(1-r*r),h=a*Math.sin(s),g=Math.tan(Math.PI/4-s/2)/Math.pow((1-h)/(1+h),a/2);return s=-i*Math.log(Math.max(g,1e-10)),new Q(e.lng*t*i,s)},unproject:function(e){for(var t=180/Math.PI,i=this.R,s=this.R_MINOR/i,r=Math.sqrt(1-s*s),a=Math.exp(-e.y/i),h=Math.PI/2-2*Math.atan(a),g=0,T=.1,Z;g<15&&Math.abs(T)>1e-7;g++)Z=r*Math.sin(h),Z=Math.pow((1-Z)/(1+Z),r/2),T=Math.PI/2-2*Math.atan(a*Z)-h,h+=T;return new Se(h*t,e.x*t/i)}},Ho={__proto__:null,LonLat:as,Mercator:ls,SphericalMercator:$e},Uo=b({},lt,{code:"EPSG:3395",projection:ls,transformation:(function(){var e=.5/(Math.PI*ls.R);return M(e,.5,-e,.5)})()}),ur=b({},lt,{code:"EPSG:4326",projection:as,transformation:M(1/180,1,-1/180,.5)}),qo=b({},at,{projection:as,transformation:M(1,0,-1,0),scale:function(e){return Math.pow(2,e)},zoom:function(e){return Math.log(e)/Math.LN2},distance:function(e,t){var i=t.lng-e.lng,s=t.lat-e.lat;return Math.sqrt(i*i+s*s)},infinite:!0});at.Earth=lt,at.EPSG3395=Uo,at.EPSG3857=U,at.EPSG900913=me,at.EPSG4326=ur,at.Simple=qo;var It=ie.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(e){return e.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(e){return e&&e.removeLayer(this),this},getPane:function(e){return this._map.getPane(e?this.options[e]||e:this.options.pane)},addInteractiveTarget:function(e){return this._map._targets[C(e)]=this,this},removeInteractiveTarget:function(e){return delete this._map._targets[C(e)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(e){var t=e.target;if(t.hasLayer(this)){if(this._map=t,this._zoomAnimated=t._zoomAnimated,this.getEvents){var i=this.getEvents();t.on(i,this),this.once("remove",function(){t.off(i,this)},this)}this.onAdd(t),this.fire("add"),t.fire("layeradd",{layer:this})}}});Pe.include({addLayer:function(e){if(!e._layerAdd)throw new Error("The provided object is not a Layer.");var t=C(e);return this._layers[t]?this:(this._layers[t]=e,e._mapToAdd=this,e.beforeAdd&&e.beforeAdd(this),this.whenReady(e._layerAdd,e),this)},removeLayer:function(e){var t=C(e);return this._layers[t]?(this._loaded&&e.onRemove(this),delete this._layers[t],this._loaded&&(this.fire("layerremove",{layer:e}),e.fire("remove")),e._map=e._mapToAdd=null,this):this},hasLayer:function(e){return C(e)in this._layers},eachLayer:function(e,t){for(var i in this._layers)e.call(t,this._layers[i]);return this},_addLayers:function(e){e=e?J(e)?e:[e]:[];for(var t=0,i=e.length;t<i;t++)this.addLayer(e[t])},_addZoomLimit:function(e){(!isNaN(e.options.maxZoom)||!isNaN(e.options.minZoom))&&(this._zoomBoundLayers[C(e)]=e,this._updateZoomLevels())},_removeZoomLimit:function(e){var t=C(e);this._zoomBoundLayers[t]&&(delete this._zoomBoundLayers[t],this._updateZoomLevels())},_updateZoomLevels:function(){var e=1/0,t=-1/0,i=this._getZoomSpan();for(var s in this._zoomBoundLayers){var r=this._zoomBoundLayers[s].options;e=r.minZoom===void 0?e:Math.min(e,r.minZoom),t=r.maxZoom===void 0?t:Math.max(t,r.maxZoom)}this._layersMaxZoom=t===-1/0?void 0:t,this._layersMinZoom=e===1/0?void 0:e,i!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var bn=It.extend({initialize:function(e,t){F(this,t),this._layers={};var i,s;if(e)for(i=0,s=e.length;i<s;i++)this.addLayer(e[i])},addLayer:function(e){var t=this.getLayerId(e);return this._layers[t]=e,this._map&&this._map.addLayer(e),this},removeLayer:function(e){var t=e in this._layers?e:this.getLayerId(e);return this._map&&this._layers[t]&&this._map.removeLayer(this._layers[t]),delete this._layers[t],this},hasLayer:function(e){var t=typeof e=="number"?e:this.getLayerId(e);return t in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(e){var t=Array.prototype.slice.call(arguments,1),i,s;for(i in this._layers)s=this._layers[i],s[e]&&s[e].apply(s,t);return this},onAdd:function(e){this.eachLayer(e.addLayer,e)},onRemove:function(e){this.eachLayer(e.removeLayer,e)},eachLayer:function(e,t){for(var i in this._layers)e.call(t,this._layers[i]);return this},getLayer:function(e){return this._layers[e]},getLayers:function(){var e=[];return this.eachLayer(e.push,e),e},setZIndex:function(e){return this.invoke("setZIndex",e)},getLayerId:function(e){return C(e)}}),Go=function(e,t){return new bn(e,t)},qt=bn.extend({addLayer:function(e){return this.hasLayer(e)?this:(e.addEventParent(this),bn.prototype.addLayer.call(this,e),this.fire("layeradd",{layer:e}))},removeLayer:function(e){return this.hasLayer(e)?(e in this._layers&&(e=this._layers[e]),e.removeEventParent(this),bn.prototype.removeLayer.call(this,e),this.fire("layerremove",{layer:e})):this},setStyle:function(e){return this.invoke("setStyle",e)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var e=new Me;for(var t in this._layers){var i=this._layers[t];e.extend(i.getBounds?i.getBounds():i.getLatLng())}return e}}),$o=function(e,t){return new qt(e,t)},jn=j.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(e){F(this,e)},createIcon:function(e){return this._createIcon("icon",e)},createShadow:function(e){return this._createIcon("shadow",e)},_createIcon:function(e,t){var i=this._getIconUrl(e);if(!i){if(e==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var s=this._createImg(i,t&&t.tagName==="IMG"?t:null);return this._setIconStyles(s,e),(this.options.crossOrigin||this.options.crossOrigin==="")&&(s.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),s},_setIconStyles:function(e,t){var i=this.options,s=i[t+"Size"];typeof s=="number"&&(s=[s,s]);var r=ne(s),a=ne(t==="shadow"&&i.shadowAnchor||i.iconAnchor||r&&r.divideBy(2,!0));e.className="leaflet-marker-"+t+" "+(i.className||""),a&&(e.style.marginLeft=-a.x+"px",e.style.marginTop=-a.y+"px"),r&&(e.style.width=r.x+"px",e.style.height=r.y+"px")},_createImg:function(e,t){return t=t||document.createElement("img"),t.src=e,t},_getIconUrl:function(e){return le.retina&&this.options[e+"RetinaUrl"]||this.options[e+"Url"]}});function Vo(e){return new jn(e)}var qn=jn.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(e){return typeof qn.imagePath!="string"&&(qn.imagePath=this._detectIconPath()),(this.options.imagePath||qn.imagePath)+jn.prototype._getIconUrl.call(this,e)},_stripUrl:function(e){var t=function(i,s,r){var a=s.exec(i);return a&&a[r]};return e=t(e,/^url\((['"])?(.+)\1\)$/,2),e&&t(e,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var e=Ae("div","leaflet-default-icon-path",document.body),t=Nn(e,"background-image")||Nn(e,"backgroundImage");if(document.body.removeChild(e),t=this._stripUrl(t),t)return t;var i=document.querySelector('link[href$="leaflet.css"]');return i?i.href.substring(0,i.href.length-11-1):""}}),hr=Zt.extend({initialize:function(e){this._marker=e},addHooks:function(){var e=this._marker._icon;this._draggable||(this._draggable=new Qt(e,e,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),ye(e,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&qe(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(e){var t=this._marker,i=t._map,s=this._marker.options.autoPanSpeed,r=this._marker.options.autoPanPadding,a=an(t._icon),h=i.getPixelBounds(),g=i.getPixelOrigin(),T=Oe(h.min._subtract(g).add(r),h.max._subtract(g).subtract(r));if(!T.contains(a)){var Z=ne((Math.max(T.max.x,a.x)-T.max.x)/(h.max.x-T.max.x)-(Math.min(T.min.x,a.x)-T.min.x)/(h.min.x-T.min.x),(Math.max(T.max.y,a.y)-T.max.y)/(h.max.y-T.max.y)-(Math.min(T.min.y,a.y)-T.min.y)/(h.min.y-T.min.y)).multiplyBy(s);i.panBy(Z,{animate:!1}),this._draggable._newPos._add(Z),this._draggable._startPos._add(Z),Ve(t._icon,this._draggable._newPos),this._onDrag(e),this._panRequest=R(this._adjustPan.bind(this,e))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(e){this._marker.options.autoPan&&(q(this._panRequest),this._panRequest=R(this._adjustPan.bind(this,e)))},_onDrag:function(e){var t=this._marker,i=t._shadow,s=an(t._icon),r=t._map.layerPointToLatLng(s);i&&Ve(i,s),t._latlng=r,e.latlng=r,e.oldLatLng=this._oldLatLng,t.fire("move",e).fire("drag",e)},_onDragEnd:function(e){q(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",e)}}),mi=It.extend({options:{icon:new qn,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(e,t){F(this,t),this._latlng=xe(e)},onAdd:function(e){this._zoomAnimated=this._zoomAnimated&&e.options.markerZoomAnimation,this._zoomAnimated&&e.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(e){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&e.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(e){var t=this._latlng;return this._latlng=xe(e),this.update(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},setZIndexOffset:function(e){return this.options.zIndexOffset=e,this.update()},getIcon:function(){return this.options.icon},setIcon:function(e){return this.options.icon=e,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var e=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(e)}return this},_initIcon:function(){var e=this.options,t="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),i=e.icon.createIcon(this._icon),s=!1;i!==this._icon&&(this._icon&&this._removeIcon(),s=!0,e.title&&(i.title=e.title),i.tagName==="IMG"&&(i.alt=e.alt||"")),ye(i,t),e.keyboard&&(i.tabIndex="0",i.setAttribute("role","button")),this._icon=i,e.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&ge(i,"focus",this._panOnFocus,this);var r=e.icon.createShadow(this._shadow),a=!1;r!==this._shadow&&(this._removeShadow(),a=!0),r&&(ye(r,t),r.alt=""),this._shadow=r,e.opacity<1&&this._updateOpacity(),s&&this.getPane().appendChild(this._icon),this._initInteraction(),r&&a&&this.getPane(e.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Re(this._icon,"focus",this._panOnFocus,this),We(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&We(this._shadow),this._shadow=null},_setPos:function(e){this._icon&&Ve(this._icon,e),this._shadow&&Ve(this._shadow,e),this._zIndex=e.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(e){this._icon&&(this._icon.style.zIndex=this._zIndex+e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center).round();this._setPos(t)},_initInteraction:function(){if(this.options.interactive&&(ye(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),hr)){var e=this.options.draggable;this.dragging&&(e=this.dragging.enabled(),this.dragging.disable()),this.dragging=new hr(this),e&&this.dragging.enable()}},setOpacity:function(e){return this.options.opacity=e,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var e=this.options.opacity;this._icon&&Ct(this._icon,e),this._shadow&&Ct(this._shadow,e)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var e=this._map;if(e){var t=this.options.icon.options,i=t.iconSize?ne(t.iconSize):ne(0,0),s=t.iconAnchor?ne(t.iconAnchor):ne(0,0);e.panInside(this._latlng,{paddingTopLeft:s,paddingBottomRight:i.subtract(s)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Yo(e,t){return new mi(e,t)}var en=It.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(e){this._renderer=e.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(e){return F(this,e),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&e&&Object.prototype.hasOwnProperty.call(e,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),fi=en.extend({options:{fill:!0,radius:10},initialize:function(e,t){F(this,t),this._latlng=xe(e),this._radius=this.options.radius},setLatLng:function(e){var t=this._latlng;return this._latlng=xe(e),this.redraw(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(e){return this.options.radius=this._radius=e,this.redraw()},getRadius:function(){return this._radius},setStyle:function(e){var t=e&&e.radius||this._radius;return en.prototype.setStyle.call(this,e),this.setRadius(t),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var e=this._radius,t=this._radiusY||e,i=this._clickTolerance(),s=[e+i,t+i];this._pxBounds=new ce(this._point.subtract(s),this._point.add(s))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(e){return e.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Ko(e,t){return new fi(e,t)}var cs=fi.extend({initialize:function(e,t,i){if(typeof t=="number"&&(t=b({},i,{radius:t})),F(this,t),this._latlng=xe(e),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(e){return this._mRadius=e,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var e=[this._radius,this._radiusY||this._radius];return new Me(this._map.layerPointToLatLng(this._point.subtract(e)),this._map.layerPointToLatLng(this._point.add(e)))},setStyle:en.prototype.setStyle,_project:function(){var e=this._latlng.lng,t=this._latlng.lat,i=this._map,s=i.options.crs;if(s.distance===lt.distance){var r=Math.PI/180,a=this._mRadius/lt.R/r,h=i.project([t+a,e]),g=i.project([t-a,e]),T=h.add(g).divideBy(2),Z=i.unproject(T).lat,se=Math.acos((Math.cos(a*r)-Math.sin(t*r)*Math.sin(Z*r))/(Math.cos(t*r)*Math.cos(Z*r)))/r;(isNaN(se)||se===0)&&(se=a/Math.cos(Math.PI/180*t)),this._point=T.subtract(i.getPixelOrigin()),this._radius=isNaN(se)?0:T.x-i.project([Z,e-se]).x,this._radiusY=T.y-h.y}else{var he=s.unproject(s.project(this._latlng).subtract([this._mRadius,0]));this._point=i.latLngToLayerPoint(this._latlng),this._radius=this._point.x-i.latLngToLayerPoint(he).x}this._updateBounds()}});function Xo(e,t,i){return new cs(e,t,i)}var Gt=en.extend({options:{smoothFactor:1,noClip:!1},initialize:function(e,t){F(this,t),this._setLatLngs(e)},getLatLngs:function(){return this._latlngs},setLatLngs:function(e){return this._setLatLngs(e),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(e){for(var t=1/0,i=null,s=Un,r,a,h=0,g=this._parts.length;h<g;h++)for(var T=this._parts[h],Z=1,se=T.length;Z<se;Z++){r=T[Z-1],a=T[Z];var he=s(e,r,a,!0);he<t&&(t=he,i=s(e,r,a))}return i&&(i.distance=Math.sqrt(t)),i},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return dr(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(e,t){return t=t||this._defaultShape(),e=xe(e),t.push(e),this._bounds.extend(e),this.redraw()},_setLatLngs:function(e){this._bounds=new Me,this._latlngs=this._convertLatLngs(e)},_defaultShape:function(){return St(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(e){for(var t=[],i=St(e),s=0,r=e.length;s<r;s++)i?(t[s]=xe(e[s]),this._bounds.extend(t[s])):t[s]=this._convertLatLngs(e[s]);return t},_project:function(){var e=new ce;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,e),this._bounds.isValid()&&e.isValid()&&(this._rawPxBounds=e,this._updateBounds())},_updateBounds:function(){var e=this._clickTolerance(),t=new Q(e,e);this._rawPxBounds&&(this._pxBounds=new ce([this._rawPxBounds.min.subtract(t),this._rawPxBounds.max.add(t)]))},_projectLatlngs:function(e,t,i){var s=e[0]instanceof Se,r=e.length,a,h;if(s){for(h=[],a=0;a<r;a++)h[a]=this._map.latLngToLayerPoint(e[a]),i.extend(h[a]);t.push(h)}else for(a=0;a<r;a++)this._projectLatlngs(e[a],t,i)},_clipPoints:function(){var e=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(e))){if(this.options.noClip){this._parts=this._rings;return}var t=this._parts,i,s,r,a,h,g,T;for(i=0,r=0,a=this._rings.length;i<a;i++)for(T=this._rings[i],s=0,h=T.length;s<h-1;s++)g=lr(T[s],T[s+1],e,s,!0),g&&(t[r]=t[r]||[],t[r].push(g[0]),(g[1]!==T[s+1]||s===h-2)&&(t[r].push(g[1]),r++))}},_simplifyPoints:function(){for(var e=this._parts,t=this.options.smoothFactor,i=0,s=e.length;i<s;i++)e[i]=rr(e[i],t)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(e,t){var i,s,r,a,h,g,T=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(i=0,a=this._parts.length;i<a;i++)for(g=this._parts[i],s=0,h=g.length,r=h-1;s<h;r=s++)if(!(!t&&s===0)&&or(e,g[r],g[s])<=T)return!0;return!1}});function Jo(e,t){return new Gt(e,t)}Gt._flat=cr;var wn=Gt.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return sr(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(e){var t=Gt.prototype._convertLatLngs.call(this,e),i=t.length;return i>=2&&t[0]instanceof Se&&t[0].equals(t[i-1])&&t.pop(),t},_setLatLngs:function(e){Gt.prototype._setLatLngs.call(this,e),St(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return St(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var e=this._renderer._bounds,t=this.options.weight,i=new Q(t,t);if(e=new ce(e.min.subtract(i),e.max.add(i)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(e))){if(this.options.noClip){this._parts=this._rings;return}for(var s=0,r=this._rings.length,a;s<r;s++)a=ir(this._rings[s],e,!0),a.length&&this._parts.push(a)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(e){var t=!1,i,s,r,a,h,g,T,Z;if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(a=0,T=this._parts.length;a<T;a++)for(i=this._parts[a],h=0,Z=i.length,g=Z-1;h<Z;g=h++)s=i[h],r=i[g],s.y>e.y!=r.y>e.y&&e.x<(r.x-s.x)*(e.y-s.y)/(r.y-s.y)+s.x&&(t=!t);return t||Gt.prototype._containsPoint.call(this,e,!0)}});function Qo(e,t){return new wn(e,t)}var $t=qt.extend({initialize:function(e,t){F(this,t),this._layers={},e&&this.addData(e)},addData:function(e){var t=J(e)?e:e.features,i,s,r;if(t){for(i=0,s=t.length;i<s;i++)r=t[i],(r.geometries||r.geometry||r.features||r.coordinates)&&this.addData(r);return this}var a=this.options;if(a.filter&&!a.filter(e))return this;var h=pi(e,a);return h?(h.feature=_i(e),h.defaultOptions=h.options,this.resetStyle(h),a.onEachFeature&&a.onEachFeature(e,h),this.addLayer(h)):this},resetStyle:function(e){return e===void 0?this.eachLayer(this.resetStyle,this):(e.options=b({},e.defaultOptions),this._setLayerStyle(e,this.options.style),this)},setStyle:function(e){return this.eachLayer(function(t){this._setLayerStyle(t,e)},this)},_setLayerStyle:function(e,t){e.setStyle&&(typeof t=="function"&&(t=t(e.feature)),e.setStyle(t))}});function pi(e,t){var i=e.type==="Feature"?e.geometry:e,s=i?i.coordinates:null,r=[],a=t&&t.pointToLayer,h=t&&t.coordsToLatLng||ds,g,T,Z,se;if(!s&&!i)return null;switch(i.type){case"Point":return g=h(s),mr(a,e,g,t);case"MultiPoint":for(Z=0,se=s.length;Z<se;Z++)g=h(s[Z]),r.push(mr(a,e,g,t));return new qt(r);case"LineString":case"MultiLineString":return T=gi(s,i.type==="LineString"?0:1,h),new Gt(T,t);case"Polygon":case"MultiPolygon":return T=gi(s,i.type==="Polygon"?1:2,h),new wn(T,t);case"GeometryCollection":for(Z=0,se=i.geometries.length;Z<se;Z++){var he=pi({geometry:i.geometries[Z],type:"Feature",properties:e.properties},t);he&&r.push(he)}return new qt(r);case"FeatureCollection":for(Z=0,se=i.features.length;Z<se;Z++){var je=pi(i.features[Z],t);je&&r.push(je)}return new qt(r);default:throw new Error("Invalid GeoJSON object.")}}function mr(e,t,i,s){return e?e(t,i):new mi(i,s&&s.markersInheritOptions&&s)}function ds(e){return new Se(e[1],e[0],e[2])}function gi(e,t,i){for(var s=[],r=0,a=e.length,h;r<a;r++)h=t?gi(e[r],t-1,i):(i||ds)(e[r]),s.push(h);return s}function us(e,t){return e=xe(e),e.alt!==void 0?[D(e.lng,t),D(e.lat,t),D(e.alt,t)]:[D(e.lng,t),D(e.lat,t)]}function xi(e,t,i,s){for(var r=[],a=0,h=e.length;a<h;a++)r.push(t?xi(e[a],St(e[a])?0:t-1,i,s):us(e[a],s));return!t&&i&&r.length>0&&r.push(r[0].slice()),r}function Cn(e,t){return e.feature?b({},e.feature,{geometry:t}):_i(t)}function _i(e){return e.type==="Feature"||e.type==="FeatureCollection"?e:{type:"Feature",properties:{},geometry:e}}var hs={toGeoJSON:function(e){return Cn(this,{type:"Point",coordinates:us(this.getLatLng(),e)})}};mi.include(hs),cs.include(hs),fi.include(hs),Gt.include({toGeoJSON:function(e){var t=!St(this._latlngs),i=xi(this._latlngs,t?1:0,!1,e);return Cn(this,{type:(t?"Multi":"")+"LineString",coordinates:i})}}),wn.include({toGeoJSON:function(e){var t=!St(this._latlngs),i=t&&!St(this._latlngs[0]),s=xi(this._latlngs,i?2:t?1:0,!0,e);return t||(s=[s]),Cn(this,{type:(i?"Multi":"")+"Polygon",coordinates:s})}}),bn.include({toMultiPoint:function(e){var t=[];return this.eachLayer(function(i){t.push(i.toGeoJSON(e).geometry.coordinates)}),Cn(this,{type:"MultiPoint",coordinates:t})},toGeoJSON:function(e){var t=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(t==="MultiPoint")return this.toMultiPoint(e);var i=t==="GeometryCollection",s=[];return this.eachLayer(function(r){if(r.toGeoJSON){var a=r.toGeoJSON(e);if(i)s.push(a.geometry);else{var h=_i(a);h.type==="FeatureCollection"?s.push.apply(s,h.features):s.push(h)}}}),i?Cn(this,{geometries:s,type:"GeometryCollection"}):{type:"FeatureCollection",features:s}}});function fr(e,t){return new $t(e,t)}var ea=fr,vi=It.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(e,t,i){this._url=e,this._bounds=Ce(t),F(this,i)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(ye(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){We(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(e){return this.options.opacity=e,this._image&&this._updateOpacity(),this},setStyle:function(e){return e.opacity&&this.setOpacity(e.opacity),this},bringToFront:function(){return this._map&&vn(this._image),this},bringToBack:function(){return this._map&&yn(this._image),this},setUrl:function(e){return this._url=e,this._image&&(this._image.src=e),this},setBounds:function(e){return this._bounds=Ce(e),this._map&&this._reset(),this},getEvents:function(){var e={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var e=this._url.tagName==="IMG",t=this._image=e?this._url:Ae("img");if(ye(t,"leaflet-image-layer"),this._zoomAnimated&&ye(t,"leaflet-zoom-animated"),this.options.className&&ye(t,this.options.className),t.onselectstart=k,t.onmousemove=k,t.onload=w(this.fire,this,"load"),t.onerror=w(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(t.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),e){this._url=t.src;return}t.src=this._url,t.alt=this.options.alt},_animateZoom:function(e){var t=this._map.getZoomScale(e.zoom),i=this._map._latLngBoundsToNewLayerBounds(this._bounds,e.zoom,e.center).min;on(this._image,i,t)},_reset:function(){var e=this._image,t=new ce(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),i=t.getSize();Ve(e,t.min),e.style.width=i.x+"px",e.style.height=i.y+"px"},_updateOpacity:function(){Ct(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var e=this.options.errorOverlayUrl;e&&this._url!==e&&(this._url=e,this._image.src=e)},getCenter:function(){return this._bounds.getCenter()}}),ta=function(e,t,i){return new vi(e,t,i)},pr=vi.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var e=this._url.tagName==="VIDEO",t=this._image=e?this._url:Ae("video");if(ye(t,"leaflet-image-layer"),this._zoomAnimated&&ye(t,"leaflet-zoom-animated"),this.options.className&&ye(t,this.options.className),t.onselectstart=k,t.onmousemove=k,t.onloadeddata=w(this.fire,this,"load"),e){for(var i=t.getElementsByTagName("source"),s=[],r=0;r<i.length;r++)s.push(i[r].src);this._url=i.length>0?s:[t.src];return}J(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(t.style,"objectFit")&&(t.style.objectFit="fill"),t.autoplay=!!this.options.autoplay,t.loop=!!this.options.loop,t.muted=!!this.options.muted,t.playsInline=!!this.options.playsInline;for(var a=0;a<this._url.length;a++){var h=Ae("source");h.src=this._url[a],t.appendChild(h)}}});function na(e,t,i){return new pr(e,t,i)}var gr=vi.extend({_initImage:function(){var e=this._image=this._url;ye(e,"leaflet-image-layer"),this._zoomAnimated&&ye(e,"leaflet-zoom-animated"),this.options.className&&ye(e,this.options.className),e.onselectstart=k,e.onmousemove=k}});function ia(e,t,i){return new gr(e,t,i)}var Ft=It.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(e,t){e&&(e instanceof Se||J(e))?(this._latlng=xe(e),F(this,t)):(F(this,e),this._source=t),this.options.content&&(this._content=this.options.content)},openOn:function(e){return e=arguments.length?e:this._source._map,e.hasLayer(this)||e.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(e){return this._map?this.close():(arguments.length?this._source=e:e=this._source,this._prepareOpen(),this.openOn(e._map)),this},onAdd:function(e){this._zoomAnimated=e._zoomAnimated,this._container||this._initLayout(),e._fadeAnimated&&Ct(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),e._fadeAnimated&&Ct(this._container,1),this.bringToFront(),this.options.interactive&&(ye(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(e){e._fadeAnimated?(Ct(this._container,0),this._removeTimeout=setTimeout(w(We,void 0,this._container),200)):We(this._container),this.options.interactive&&(qe(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(e){return this._latlng=xe(e),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(e){return this._content=e,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var e={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&vn(this._container),this},bringToBack:function(){return this._map&&yn(this._container),this},_prepareOpen:function(e){var t=this._source;if(!t._map)return!1;if(t instanceof qt){t=null;var i=this._source._layers;for(var s in i)if(i[s]._map){t=i[s];break}if(!t)return!1;this._source=t}if(!e)if(t.getCenter)e=t.getCenter();else if(t.getLatLng)e=t.getLatLng();else if(t.getBounds)e=t.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(e),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var e=this._contentNode,t=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof t=="string")e.innerHTML=t;else{for(;e.hasChildNodes();)e.removeChild(e.firstChild);e.appendChild(t)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var e=this._map.latLngToLayerPoint(this._latlng),t=ne(this.options.offset),i=this._getAnchor();this._zoomAnimated?Ve(this._container,e.add(i)):t=t.add(e).add(i);var s=this._containerBottom=-t.y,r=this._containerLeft=-Math.round(this._containerWidth/2)+t.x;this._container.style.bottom=s+"px",this._container.style.left=r+"px"}},_getAnchor:function(){return[0,0]}});Pe.include({_initOverlay:function(e,t,i,s){var r=t;return r instanceof e||(r=new e(s).setContent(t)),i&&r.setLatLng(i),r}}),It.include({_initOverlay:function(e,t,i,s){var r=i;return r instanceof e?(F(r,s),r._source=this):(r=t&&!s?t:new e(s,this),r.setContent(i)),r}});var yi=Ft.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(e){return e=arguments.length?e:this._source._map,!e.hasLayer(this)&&e._popup&&e._popup.options.autoClose&&e.removeLayer(e._popup),e._popup=this,Ft.prototype.openOn.call(this,e)},onAdd:function(e){Ft.prototype.onAdd.call(this,e),e.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof en||this._source.on("preclick",ln))},onRemove:function(e){Ft.prototype.onRemove.call(this,e),e.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof en||this._source.off("preclick",ln))},getEvents:function(){var e=Ft.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(e.preclick=this.close),this.options.keepInView&&(e.moveend=this._adjustPan),e},_initLayout:function(){var e="leaflet-popup",t=this._container=Ae("div",e+" "+(this.options.className||"")+" leaflet-zoom-animated"),i=this._wrapper=Ae("div",e+"-content-wrapper",t);if(this._contentNode=Ae("div",e+"-content",i),Fn(t),ts(this._contentNode),ge(t,"contextmenu",ln),this._tipContainer=Ae("div",e+"-tip-container",t),this._tip=Ae("div",e+"-tip",this._tipContainer),this.options.closeButton){var s=this._closeButton=Ae("a",e+"-close-button",t);s.setAttribute("role","button"),s.setAttribute("aria-label","Close popup"),s.href="#close",s.innerHTML='<span aria-hidden="true">&#215;</span>',ge(s,"click",function(r){ct(r),this.close()},this)}},_updateLayout:function(){var e=this._contentNode,t=e.style;t.width="",t.whiteSpace="nowrap";var i=e.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),t.width=i+1+"px",t.whiteSpace="",t.height="";var s=e.offsetHeight,r=this.options.maxHeight,a="leaflet-popup-scrolled";r&&s>r?(t.height=r+"px",ye(e,a)):qe(e,a),this._containerWidth=this._container.offsetWidth},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center),i=this._getAnchor();Ve(this._container,t.add(i))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var e=this._map,t=parseInt(Nn(this._container,"marginBottom"),10)||0,i=this._container.offsetHeight+t,s=this._containerWidth,r=new Q(this._containerLeft,-i-this._containerBottom);r._add(an(this._container));var a=e.layerPointToContainerPoint(r),h=ne(this.options.autoPanPadding),g=ne(this.options.autoPanPaddingTopLeft||h),T=ne(this.options.autoPanPaddingBottomRight||h),Z=e.getSize(),se=0,he=0;a.x+s+T.x>Z.x&&(se=a.x+s-Z.x+T.x),a.x-se-g.x<0&&(se=a.x-g.x),a.y+i+T.y>Z.y&&(he=a.y+i-Z.y+T.y),a.y-he-g.y<0&&(he=a.y-g.y),(se||he)&&(this.options.keepInView&&(this._autopanning=!0),e.fire("autopanstart").panBy([se,he]))}},_getAnchor:function(){return ne(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),sa=function(e,t){return new yi(e,t)};Pe.mergeOptions({closePopupOnClick:!0}),Pe.include({openPopup:function(e,t,i){return this._initOverlay(yi,e,t,i).openOn(this),this},closePopup:function(e){return e=arguments.length?e:this._popup,e&&e.close(),this}}),It.include({bindPopup:function(e,t){return this._popup=this._initOverlay(yi,this._popup,e,t),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(e){return this._popup&&(this instanceof qt||(this._popup._source=this),this._popup._prepareOpen(e||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(e){return this._popup&&this._popup.setContent(e),this},getPopup:function(){return this._popup},_openPopup:function(e){if(!(!this._popup||!this._map)){cn(e);var t=e.layer||e.target;if(this._popup._source===t&&!(t instanceof en)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(e.latlng);return}this._popup._source=t,this.openPopup(e.latlng)}},_movePopup:function(e){this._popup.setLatLng(e.latlng)},_onKeyPress:function(e){e.originalEvent.keyCode===13&&this._openPopup(e)}});var bi=Ft.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(e){Ft.prototype.onAdd.call(this,e),this.setOpacity(this.options.opacity),e.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(e){Ft.prototype.onRemove.call(this,e),e.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var e=Ft.prototype.getEvents.call(this);return this.options.permanent||(e.preclick=this.close),e},_initLayout:function(){var e="leaflet-tooltip",t=e+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Ae("div",t),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+C(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(e){var t,i,s=this._map,r=this._container,a=s.latLngToContainerPoint(s.getCenter()),h=s.layerPointToContainerPoint(e),g=this.options.direction,T=r.offsetWidth,Z=r.offsetHeight,se=ne(this.options.offset),he=this._getAnchor();g==="top"?(t=T/2,i=Z):g==="bottom"?(t=T/2,i=0):g==="center"?(t=T/2,i=Z/2):g==="right"?(t=0,i=Z/2):g==="left"?(t=T,i=Z/2):h.x<a.x?(g="right",t=0,i=Z/2):(g="left",t=T+(se.x+he.x)*2,i=Z/2),e=e.subtract(ne(t,i,!0)).add(se).add(he),qe(r,"leaflet-tooltip-right"),qe(r,"leaflet-tooltip-left"),qe(r,"leaflet-tooltip-top"),qe(r,"leaflet-tooltip-bottom"),ye(r,"leaflet-tooltip-"+g),Ve(r,e)},_updatePosition:function(){var e=this._map.latLngToLayerPoint(this._latlng);this._setPosition(e)},setOpacity:function(e){this.options.opacity=e,this._container&&Ct(this._container,e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);this._setPosition(t)},_getAnchor:function(){return ne(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),ra=function(e,t){return new bi(e,t)};Pe.include({openTooltip:function(e,t,i){return this._initOverlay(bi,e,t,i).openOn(this),this},closeTooltip:function(e){return e.close(),this}}),It.include({bindTooltip:function(e,t){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(bi,this._tooltip,e,t),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(e){if(!(!e&&this._tooltipHandlersAdded)){var t=e?"off":"on",i={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?i.add=this._openTooltip:(i.mouseover=this._openTooltip,i.mouseout=this.closeTooltip,i.click=this._openTooltip,this._map?this._addFocusListeners():i.add=this._addFocusListeners),this._tooltip.options.sticky&&(i.mousemove=this._moveTooltip),this[t](i),this._tooltipHandlersAdded=!e}},openTooltip:function(e){return this._tooltip&&(this instanceof qt||(this._tooltip._source=this),this._tooltip._prepareOpen(e)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(e){return this._tooltip&&this._tooltip.setContent(e),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(e){var t=typeof e.getElement=="function"&&e.getElement();t&&(ge(t,"focus",function(){this._tooltip._source=e,this.openTooltip()},this),ge(t,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(e){var t=typeof e.getElement=="function"&&e.getElement();t&&t.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(e){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var t=this;this._map.once("moveend",function(){t._openOnceFlag=!1,t._openTooltip(e)});return}this._tooltip._source=e.layer||e.target,this.openTooltip(this._tooltip.options.sticky?e.latlng:void 0)}},_moveTooltip:function(e){var t=e.latlng,i,s;this._tooltip.options.sticky&&e.originalEvent&&(i=this._map.mouseEventToContainerPoint(e.originalEvent),s=this._map.containerPointToLayerPoint(i),t=this._map.layerPointToLatLng(s)),this._tooltip.setLatLng(t)}});var xr=jn.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(e){var t=e&&e.tagName==="DIV"?e:document.createElement("div"),i=this.options;if(i.html instanceof Element?(ai(t),t.appendChild(i.html)):t.innerHTML=i.html!==!1?i.html:"",i.bgPos){var s=ne(i.bgPos);t.style.backgroundPosition=-s.x+"px "+-s.y+"px"}return this._setIconStyles(t,"icon"),t},createShadow:function(){return null}});function oa(e){return new xr(e)}jn.Default=qn;var Gn=It.extend({options:{tileSize:256,opacity:1,updateWhenIdle:le.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(e){F(this,e)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(e){e._addZoomLimit(this)},onRemove:function(e){this._removeAllTiles(),We(this._container),e._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(vn(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(yn(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(e){return this.options.opacity=e,this._updateOpacity(),this},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var e=this._clampZoom(this._map.getZoom());e!==this._tileZoom&&(this._tileZoom=e,this._updateLevels()),this._update()}return this},getEvents:function(){var e={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=P(this._onMoveEnd,this.options.updateInterval,this)),e.move=this._onMove),this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},createTile:function(){return document.createElement("div")},getTileSize:function(){var e=this.options.tileSize;return e instanceof Q?e:new Q(e,e)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(e){for(var t=this.getPane().children,i=-e(-1/0,1/0),s=0,r=t.length,a;s<r;s++)a=t[s].style.zIndex,t[s]!==this._container&&a&&(i=e(i,+a));isFinite(i)&&(this.options.zIndex=i+e(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!le.ielt9){Ct(this._container,this.options.opacity);var e=+new Date,t=!1,i=!1;for(var s in this._tiles){var r=this._tiles[s];if(!(!r.current||!r.loaded)){var a=Math.min(1,(e-r.loaded)/200);Ct(r.el,a),a<1?t=!0:(r.active?i=!0:this._onOpaqueTile(r),r.active=!0)}}i&&!this._noPrune&&this._pruneTiles(),t&&(q(this._fadeFrame),this._fadeFrame=R(this._updateOpacity,this))}},_onOpaqueTile:k,_initContainer:function(){this._container||(this._container=Ae("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var e=this._tileZoom,t=this.options.maxZoom;if(e!==void 0){for(var i in this._levels)i=Number(i),this._levels[i].el.children.length||i===e?(this._levels[i].el.style.zIndex=t-Math.abs(e-i),this._onUpdateLevel(i)):(We(this._levels[i].el),this._removeTilesAtZoom(i),this._onRemoveLevel(i),delete this._levels[i]);var s=this._levels[e],r=this._map;return s||(s=this._levels[e]={},s.el=Ae("div","leaflet-tile-container leaflet-zoom-animated",this._container),s.el.style.zIndex=t,s.origin=r.project(r.unproject(r.getPixelOrigin()),e).round(),s.zoom=e,this._setZoomTransform(s,r.getCenter(),r.getZoom()),k(s.el.offsetWidth),this._onCreateLevel(s)),this._level=s,s}},_onUpdateLevel:k,_onRemoveLevel:k,_onCreateLevel:k,_pruneTiles:function(){if(this._map){var e,t,i=this._map.getZoom();if(i>this.options.maxZoom||i<this.options.minZoom){this._removeAllTiles();return}for(e in this._tiles)t=this._tiles[e],t.retain=t.current;for(e in this._tiles)if(t=this._tiles[e],t.current&&!t.active){var s=t.coords;this._retainParent(s.x,s.y,s.z,s.z-5)||this._retainChildren(s.x,s.y,s.z,s.z+2)}for(e in this._tiles)this._tiles[e].retain||this._removeTile(e)}},_removeTilesAtZoom:function(e){for(var t in this._tiles)this._tiles[t].coords.z===e&&this._removeTile(t)},_removeAllTiles:function(){for(var e in this._tiles)this._removeTile(e)},_invalidateAll:function(){for(var e in this._levels)We(this._levels[e].el),this._onRemoveLevel(Number(e)),delete this._levels[e];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(e,t,i,s){var r=Math.floor(e/2),a=Math.floor(t/2),h=i-1,g=new Q(+r,+a);g.z=+h;var T=this._tileCoordsToKey(g),Z=this._tiles[T];return Z&&Z.active?(Z.retain=!0,!0):(Z&&Z.loaded&&(Z.retain=!0),h>s?this._retainParent(r,a,h,s):!1)},_retainChildren:function(e,t,i,s){for(var r=2*e;r<2*e+2;r++)for(var a=2*t;a<2*t+2;a++){var h=new Q(r,a);h.z=i+1;var g=this._tileCoordsToKey(h),T=this._tiles[g];if(T&&T.active){T.retain=!0;continue}else T&&T.loaded&&(T.retain=!0);i+1<s&&this._retainChildren(r,a,i+1,s)}},_resetView:function(e){var t=e&&(e.pinch||e.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),t,t)},_animateZoom:function(e){this._setView(e.center,e.zoom,!0,e.noUpdate)},_clampZoom:function(e){var t=this.options;return t.minNativeZoom!==void 0&&e<t.minNativeZoom?t.minNativeZoom:t.maxNativeZoom!==void 0&&t.maxNativeZoom<e?t.maxNativeZoom:e},_setView:function(e,t,i,s){var r=Math.round(t);this.options.maxZoom!==void 0&&r>this.options.maxZoom||this.options.minZoom!==void 0&&r<this.options.minZoom?r=void 0:r=this._clampZoom(r);var a=this.options.updateWhenZooming&&r!==this._tileZoom;(!s||a)&&(this._tileZoom=r,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),r!==void 0&&this._update(e),i||this._pruneTiles(),this._noPrune=!!i),this._setZoomTransforms(e,t)},_setZoomTransforms:function(e,t){for(var i in this._levels)this._setZoomTransform(this._levels[i],e,t)},_setZoomTransform:function(e,t,i){var s=this._map.getZoomScale(i,e.zoom),r=e.origin.multiplyBy(s).subtract(this._map._getNewPixelOrigin(t,i)).round();le.any3d?on(e.el,r,s):Ve(e.el,r)},_resetGrid:function(){var e=this._map,t=e.options.crs,i=this._tileSize=this.getTileSize(),s=this._tileZoom,r=this._map.getPixelWorldBounds(this._tileZoom);r&&(this._globalTileRange=this._pxBoundsToTileRange(r)),this._wrapX=t.wrapLng&&!this.options.noWrap&&[Math.floor(e.project([0,t.wrapLng[0]],s).x/i.x),Math.ceil(e.project([0,t.wrapLng[1]],s).x/i.y)],this._wrapY=t.wrapLat&&!this.options.noWrap&&[Math.floor(e.project([t.wrapLat[0],0],s).y/i.x),Math.ceil(e.project([t.wrapLat[1],0],s).y/i.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(e){var t=this._map,i=t._animatingZoom?Math.max(t._animateToZoom,t.getZoom()):t.getZoom(),s=t.getZoomScale(i,this._tileZoom),r=t.project(e,this._tileZoom).floor(),a=t.getSize().divideBy(s*2);return new ce(r.subtract(a),r.add(a))},_update:function(e){var t=this._map;if(t){var i=this._clampZoom(t.getZoom());if(e===void 0&&(e=t.getCenter()),this._tileZoom!==void 0){var s=this._getTiledPixelBounds(e),r=this._pxBoundsToTileRange(s),a=r.getCenter(),h=[],g=this.options.keepBuffer,T=new ce(r.getBottomLeft().subtract([g,-g]),r.getTopRight().add([g,-g]));if(!(isFinite(r.min.x)&&isFinite(r.min.y)&&isFinite(r.max.x)&&isFinite(r.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Z in this._tiles){var se=this._tiles[Z].coords;(se.z!==this._tileZoom||!T.contains(new Q(se.x,se.y)))&&(this._tiles[Z].current=!1)}if(Math.abs(i-this._tileZoom)>1){this._setView(e,i);return}for(var he=r.min.y;he<=r.max.y;he++)for(var je=r.min.x;je<=r.max.x;je++){var mt=new Q(je,he);if(mt.z=this._tileZoom,!!this._isValidTile(mt)){var tt=this._tiles[this._tileCoordsToKey(mt)];tt?tt.current=!0:h.push(mt)}}if(h.sort(function(gt,Ln){return gt.distanceTo(a)-Ln.distanceTo(a)}),h.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Lt=document.createDocumentFragment();for(je=0;je<h.length;je++)this._addTile(h[je],Lt);this._level.el.appendChild(Lt)}}}},_isValidTile:function(e){var t=this._map.options.crs;if(!t.infinite){var i=this._globalTileRange;if(!t.wrapLng&&(e.x<i.min.x||e.x>i.max.x)||!t.wrapLat&&(e.y<i.min.y||e.y>i.max.y))return!1}if(!this.options.bounds)return!0;var s=this._tileCoordsToBounds(e);return Ce(this.options.bounds).overlaps(s)},_keyToBounds:function(e){return this._tileCoordsToBounds(this._keyToTileCoords(e))},_tileCoordsToNwSe:function(e){var t=this._map,i=this.getTileSize(),s=e.scaleBy(i),r=s.add(i),a=t.unproject(s,e.z),h=t.unproject(r,e.z);return[a,h]},_tileCoordsToBounds:function(e){var t=this._tileCoordsToNwSe(e),i=new Me(t[0],t[1]);return this.options.noWrap||(i=this._map.wrapLatLngBounds(i)),i},_tileCoordsToKey:function(e){return e.x+":"+e.y+":"+e.z},_keyToTileCoords:function(e){var t=e.split(":"),i=new Q(+t[0],+t[1]);return i.z=+t[2],i},_removeTile:function(e){var t=this._tiles[e];t&&(We(t.el),delete this._tiles[e],this.fire("tileunload",{tile:t.el,coords:this._keyToTileCoords(e)}))},_initTile:function(e){ye(e,"leaflet-tile");var t=this.getTileSize();e.style.width=t.x+"px",e.style.height=t.y+"px",e.onselectstart=k,e.onmousemove=k,le.ielt9&&this.options.opacity<1&&Ct(e,this.options.opacity)},_addTile:function(e,t){var i=this._getTilePos(e),s=this._tileCoordsToKey(e),r=this.createTile(this._wrapCoords(e),w(this._tileReady,this,e));this._initTile(r),this.createTile.length<2&&R(w(this._tileReady,this,e,null,r)),Ve(r,i),this._tiles[s]={el:r,coords:e,current:!0},t.appendChild(r),this.fire("tileloadstart",{tile:r,coords:e})},_tileReady:function(e,t,i){t&&this.fire("tileerror",{error:t,tile:i,coords:e});var s=this._tileCoordsToKey(e);i=this._tiles[s],i&&(i.loaded=+new Date,this._map._fadeAnimated?(Ct(i.el,0),q(this._fadeFrame),this._fadeFrame=R(this._updateOpacity,this)):(i.active=!0,this._pruneTiles()),t||(ye(i.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:i.el,coords:e})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),le.ielt9||!this._map._fadeAnimated?R(this._pruneTiles,this):setTimeout(w(this._pruneTiles,this),250)))},_getTilePos:function(e){return e.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(e){var t=new Q(this._wrapX?S(e.x,this._wrapX):e.x,this._wrapY?S(e.y,this._wrapY):e.y);return t.z=e.z,t},_pxBoundsToTileRange:function(e){var t=this.getTileSize();return new ce(e.min.unscaleBy(t).floor(),e.max.unscaleBy(t).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var e in this._tiles)if(!this._tiles[e].loaded)return!1;return!0}});function aa(e){return new Gn(e)}var Sn=Gn.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(e,t){this._url=e,t=F(this,t),t.detectRetina&&le.retina&&t.maxZoom>0?(t.tileSize=Math.floor(t.tileSize/2),t.zoomReverse?(t.zoomOffset--,t.minZoom=Math.min(t.maxZoom,t.minZoom+1)):(t.zoomOffset++,t.maxZoom=Math.max(t.minZoom,t.maxZoom-1)),t.minZoom=Math.max(0,t.minZoom)):t.zoomReverse?t.minZoom=Math.min(t.maxZoom,t.minZoom):t.maxZoom=Math.max(t.minZoom,t.maxZoom),typeof t.subdomains=="string"&&(t.subdomains=t.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(e,t){return this._url===e&&t===void 0&&(t=!0),this._url=e,t||this.redraw(),this},createTile:function(e,t){var i=document.createElement("img");return ge(i,"load",w(this._tileOnLoad,this,t,i)),ge(i,"error",w(this._tileOnError,this,t,i)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(i.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(i.referrerPolicy=this.options.referrerPolicy),i.alt="",i.src=this.getTileUrl(e),i},getTileUrl:function(e){var t={r:le.retina?"@2x":"",s:this._getSubdomain(e),x:e.x,y:e.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var i=this._globalTileRange.max.y-e.y;this.options.tms&&(t.y=i),t["-y"]=i}return ee(this._url,b(t,this.options))},_tileOnLoad:function(e,t){le.ielt9?setTimeout(w(e,this,null,t),0):e(null,t)},_tileOnError:function(e,t,i){var s=this.options.errorTileUrl;s&&t.getAttribute("src")!==s&&(t.src=s),e(i,t)},_onTileRemove:function(e){e.tile.onload=null},_getZoomForUrl:function(){var e=this._tileZoom,t=this.options.maxZoom,i=this.options.zoomReverse,s=this.options.zoomOffset;return i&&(e=t-e),e+s},_getSubdomain:function(e){var t=Math.abs(e.x+e.y)%this.options.subdomains.length;return this.options.subdomains[t]},_abortLoading:function(){var e,t;for(e in this._tiles)if(this._tiles[e].coords.z!==this._tileZoom&&(t=this._tiles[e].el,t.onload=k,t.onerror=k,!t.complete)){t.src=v;var i=this._tiles[e].coords;We(t),delete this._tiles[e],this.fire("tileabort",{tile:t,coords:i})}},_removeTile:function(e){var t=this._tiles[e];if(t)return t.el.setAttribute("src",v),Gn.prototype._removeTile.call(this,e)},_tileReady:function(e,t,i){if(!(!this._map||i&&i.getAttribute("src")===v))return Gn.prototype._tileReady.call(this,e,t,i)}});function _r(e,t){return new Sn(e,t)}var vr=Sn.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(e,t){this._url=e;var i=b({},this.defaultWmsParams);for(var s in t)s in this.options||(i[s]=t[s]);t=F(this,t);var r=t.detectRetina&&le.retina?2:1,a=this.getTileSize();i.width=a.x*r,i.height=a.y*r,this.wmsParams=i},onAdd:function(e){this._crs=this.options.crs||e.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var t=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[t]=this._crs.code,Sn.prototype.onAdd.call(this,e)},getTileUrl:function(e){var t=this._tileCoordsToNwSe(e),i=this._crs,s=Oe(i.project(t[0]),i.project(t[1])),r=s.min,a=s.max,h=(this._wmsVersion>=1.3&&this._crs===ur?[r.y,r.x,a.y,a.x]:[r.x,r.y,a.x,a.y]).join(","),g=Sn.prototype.getTileUrl.call(this,e);return g+W(this.wmsParams,g,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+h},setParams:function(e,t){return b(this.wmsParams,e),t||this.redraw(),this}});function la(e,t){return new vr(e,t)}Sn.WMS=vr,_r.wms=la;var Vt=It.extend({options:{padding:.1},initialize:function(e){F(this,e),C(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),ye(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var e={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(e.zoomanim=this._onAnimZoom),e},_onAnimZoom:function(e){this._updateTransform(e.center,e.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(e,t){var i=this._map.getZoomScale(t,this._zoom),s=this._map.getSize().multiplyBy(.5+this.options.padding),r=this._map.project(this._center,t),a=s.multiplyBy(-i).add(r).subtract(this._map._getNewPixelOrigin(e,t));le.any3d?on(this._container,a,i):Ve(this._container,a)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var e in this._layers)this._layers[e]._reset()},_onZoomEnd:function(){for(var e in this._layers)this._layers[e]._project()},_updatePaths:function(){for(var e in this._layers)this._layers[e]._update()},_update:function(){var e=this.options.padding,t=this._map.getSize(),i=this._map.containerPointToLayerPoint(t.multiplyBy(-e)).round();this._bounds=new ce(i,i.add(t.multiplyBy(1+e*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),yr=Vt.extend({options:{tolerance:0},getEvents:function(){var e=Vt.prototype.getEvents.call(this);return e.viewprereset=this._onViewPreReset,e},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Vt.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var e=this._container=document.createElement("canvas");ge(e,"mousemove",this._onMouseMove,this),ge(e,"click dblclick mousedown mouseup contextmenu",this._onClick,this),ge(e,"mouseout",this._handleMouseOut,this),e._leaflet_disable_events=!0,this._ctx=e.getContext("2d")},_destroyContainer:function(){q(this._redrawRequest),delete this._ctx,We(this._container),Re(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var e;this._redrawBounds=null;for(var t in this._layers)e=this._layers[t],e._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Vt.prototype._update.call(this);var e=this._bounds,t=this._container,i=e.getSize(),s=le.retina?2:1;Ve(t,e.min),t.width=s*i.x,t.height=s*i.y,t.style.width=i.x+"px",t.style.height=i.y+"px",le.retina&&this._ctx.scale(2,2),this._ctx.translate(-e.min.x,-e.min.y),this.fire("update")}},_reset:function(){Vt.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(e){this._updateDashArray(e),this._layers[C(e)]=e;var t=e._order={layer:e,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=t),this._drawLast=t,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(e){this._requestRedraw(e)},_removePath:function(e){var t=e._order,i=t.next,s=t.prev;i?i.prev=s:this._drawLast=s,s?s.next=i:this._drawFirst=i,delete e._order,delete this._layers[C(e)],this._requestRedraw(e)},_updatePath:function(e){this._extendRedrawBounds(e),e._project(),e._update(),this._requestRedraw(e)},_updateStyle:function(e){this._updateDashArray(e),this._requestRedraw(e)},_updateDashArray:function(e){if(typeof e.options.dashArray=="string"){var t=e.options.dashArray.split(/[, ]+/),i=[],s,r;for(r=0;r<t.length;r++){if(s=Number(t[r]),isNaN(s))return;i.push(s)}e.options._dashArray=i}else e.options._dashArray=e.options.dashArray},_requestRedraw:function(e){this._map&&(this._extendRedrawBounds(e),this._redrawRequest=this._redrawRequest||R(this._redraw,this))},_extendRedrawBounds:function(e){if(e._pxBounds){var t=(e.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new ce,this._redrawBounds.extend(e._pxBounds.min.subtract([t,t])),this._redrawBounds.extend(e._pxBounds.max.add([t,t]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var e=this._redrawBounds;if(e){var t=e.getSize();this._ctx.clearRect(e.min.x,e.min.y,t.x,t.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var e,t=this._redrawBounds;if(this._ctx.save(),t){var i=t.getSize();this._ctx.beginPath(),this._ctx.rect(t.min.x,t.min.y,i.x,i.y),this._ctx.clip()}this._drawing=!0;for(var s=this._drawFirst;s;s=s.next)e=s.layer,(!t||e._pxBounds&&e._pxBounds.intersects(t))&&e._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(e,t){if(this._drawing){var i,s,r,a,h=e._parts,g=h.length,T=this._ctx;if(g){for(T.beginPath(),i=0;i<g;i++){for(s=0,r=h[i].length;s<r;s++)a=h[i][s],T[s?"lineTo":"moveTo"](a.x,a.y);t&&T.closePath()}this._fillStroke(T,e)}}},_updateCircle:function(e){if(!(!this._drawing||e._empty())){var t=e._point,i=this._ctx,s=Math.max(Math.round(e._radius),1),r=(Math.max(Math.round(e._radiusY),1)||s)/s;r!==1&&(i.save(),i.scale(1,r)),i.beginPath(),i.arc(t.x,t.y/r,s,0,Math.PI*2,!1),r!==1&&i.restore(),this._fillStroke(i,e)}},_fillStroke:function(e,t){var i=t.options;i.fill&&(e.globalAlpha=i.fillOpacity,e.fillStyle=i.fillColor||i.color,e.fill(i.fillRule||"evenodd")),i.stroke&&i.weight!==0&&(e.setLineDash&&e.setLineDash(t.options&&t.options._dashArray||[]),e.globalAlpha=i.opacity,e.lineWidth=i.weight,e.strokeStyle=i.color,e.lineCap=i.lineCap,e.lineJoin=i.lineJoin,e.stroke())},_onClick:function(e){for(var t=this._map.mouseEventToLayerPoint(e),i,s,r=this._drawFirst;r;r=r.next)i=r.layer,i.options.interactive&&i._containsPoint(t)&&(!(e.type==="click"||e.type==="preclick")||!this._map._draggableMoved(i))&&(s=i);this._fireEvent(s?[s]:!1,e)},_onMouseMove:function(e){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var t=this._map.mouseEventToLayerPoint(e);this._handleMouseHover(e,t)}},_handleMouseOut:function(e){var t=this._hoveredLayer;t&&(qe(this._container,"leaflet-interactive"),this._fireEvent([t],e,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(e,t){if(!this._mouseHoverThrottled){for(var i,s,r=this._drawFirst;r;r=r.next)i=r.layer,i.options.interactive&&i._containsPoint(t)&&(s=i);s!==this._hoveredLayer&&(this._handleMouseOut(e),s&&(ye(this._container,"leaflet-interactive"),this._fireEvent([s],e,"mouseover"),this._hoveredLayer=s)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,e),this._mouseHoverThrottled=!0,setTimeout(w(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(e,t,i){this._map._fireDOMEvent(t,i||t.type,e)},_bringToFront:function(e){var t=e._order;if(t){var i=t.next,s=t.prev;if(i)i.prev=s;else return;s?s.next=i:i&&(this._drawFirst=i),t.prev=this._drawLast,this._drawLast.next=t,t.next=null,this._drawLast=t,this._requestRedraw(e)}},_bringToBack:function(e){var t=e._order;if(t){var i=t.next,s=t.prev;if(s)s.next=i;else return;i?i.prev=s:s&&(this._drawLast=s),t.prev=null,t.next=this._drawFirst,this._drawFirst.prev=t,this._drawFirst=t,this._requestRedraw(e)}}});function br(e){return le.canvas?new yr(e):null}var $n=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(e){return document.createElement("<lvml:"+e+' class="lvml">')}}catch{}return function(e){return document.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),ca={_initContainer:function(){this._container=Ae("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Vt.prototype._update.call(this),this.fire("update"))},_initPath:function(e){var t=e._container=$n("shape");ye(t,"leaflet-vml-shape "+(this.options.className||"")),t.coordsize="1 1",e._path=$n("path"),t.appendChild(e._path),this._updateStyle(e),this._layers[C(e)]=e},_addPath:function(e){var t=e._container;this._container.appendChild(t),e.options.interactive&&e.addInteractiveTarget(t)},_removePath:function(e){var t=e._container;We(t),e.removeInteractiveTarget(t),delete this._layers[C(e)]},_updateStyle:function(e){var t=e._stroke,i=e._fill,s=e.options,r=e._container;r.stroked=!!s.stroke,r.filled=!!s.fill,s.stroke?(t||(t=e._stroke=$n("stroke")),r.appendChild(t),t.weight=s.weight+"px",t.color=s.color,t.opacity=s.opacity,s.dashArray?t.dashStyle=J(s.dashArray)?s.dashArray.join(" "):s.dashArray.replace(/( *, *)/g," "):t.dashStyle="",t.endcap=s.lineCap.replace("butt","flat"),t.joinstyle=s.lineJoin):t&&(r.removeChild(t),e._stroke=null),s.fill?(i||(i=e._fill=$n("fill")),r.appendChild(i),i.color=s.fillColor||s.color,i.opacity=s.fillOpacity):i&&(r.removeChild(i),e._fill=null)},_updateCircle:function(e){var t=e._point.round(),i=Math.round(e._radius),s=Math.round(e._radiusY||i);this._setPath(e,e._empty()?"M0 0":"AL "+t.x+","+t.y+" "+i+","+s+" 0,"+65535*360)},_setPath:function(e,t){e._path.v=t},_bringToFront:function(e){vn(e._container)},_bringToBack:function(e){yn(e._container)}},ji=le.vml?$n:G,Vn=Vt.extend({_initContainer:function(){this._container=ji("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=ji("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){We(this._container),Re(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Vt.prototype._update.call(this);var e=this._bounds,t=e.getSize(),i=this._container;(!this._svgSize||!this._svgSize.equals(t))&&(this._svgSize=t,i.setAttribute("width",t.x),i.setAttribute("height",t.y)),Ve(i,e.min),i.setAttribute("viewBox",[e.min.x,e.min.y,t.x,t.y].join(" ")),this.fire("update")}},_initPath:function(e){var t=e._path=ji("path");e.options.className&&ye(t,e.options.className),e.options.interactive&&ye(t,"leaflet-interactive"),this._updateStyle(e),this._layers[C(e)]=e},_addPath:function(e){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(e._path),e.addInteractiveTarget(e._path)},_removePath:function(e){We(e._path),e.removeInteractiveTarget(e._path),delete this._layers[C(e)]},_updatePath:function(e){e._project(),e._update()},_updateStyle:function(e){var t=e._path,i=e.options;t&&(i.stroke?(t.setAttribute("stroke",i.color),t.setAttribute("stroke-opacity",i.opacity),t.setAttribute("stroke-width",i.weight),t.setAttribute("stroke-linecap",i.lineCap),t.setAttribute("stroke-linejoin",i.lineJoin),i.dashArray?t.setAttribute("stroke-dasharray",i.dashArray):t.removeAttribute("stroke-dasharray"),i.dashOffset?t.setAttribute("stroke-dashoffset",i.dashOffset):t.removeAttribute("stroke-dashoffset")):t.setAttribute("stroke","none"),i.fill?(t.setAttribute("fill",i.fillColor||i.color),t.setAttribute("fill-opacity",i.fillOpacity),t.setAttribute("fill-rule",i.fillRule||"evenodd")):t.setAttribute("fill","none"))},_updatePoly:function(e,t){this._setPath(e,_e(e._parts,t))},_updateCircle:function(e){var t=e._point,i=Math.max(Math.round(e._radius),1),s=Math.max(Math.round(e._radiusY),1)||i,r="a"+i+","+s+" 0 1,0 ",a=e._empty()?"M0 0":"M"+(t.x-i)+","+t.y+r+i*2+",0 "+r+-i*2+",0 ";this._setPath(e,a)},_setPath:function(e,t){e._path.setAttribute("d",t)},_bringToFront:function(e){vn(e._path)},_bringToBack:function(e){yn(e._path)}});le.vml&&Vn.include(ca);function jr(e){return le.svg||le.vml?new Vn(e):null}Pe.include({getRenderer:function(e){var t=e.options.renderer||this._getPaneRenderer(e.options.pane)||this.options.renderer||this._renderer;return t||(t=this._renderer=this._createRenderer()),this.hasLayer(t)||this.addLayer(t),t},_getPaneRenderer:function(e){if(e==="overlayPane"||e===void 0)return!1;var t=this._paneRenderers[e];return t===void 0&&(t=this._createRenderer({pane:e}),this._paneRenderers[e]=t),t},_createRenderer:function(e){return this.options.preferCanvas&&br(e)||jr(e)}});var wr=wn.extend({initialize:function(e,t){wn.prototype.initialize.call(this,this._boundsToLatLngs(e),t)},setBounds:function(e){return this.setLatLngs(this._boundsToLatLngs(e))},_boundsToLatLngs:function(e){return e=Ce(e),[e.getSouthWest(),e.getNorthWest(),e.getNorthEast(),e.getSouthEast()]}});function da(e,t){return new wr(e,t)}Vn.create=ji,Vn.pointsToPath=_e,$t.geometryToLayer=pi,$t.coordsToLatLng=ds,$t.coordsToLatLngs=gi,$t.latLngToCoords=us,$t.latLngsToCoords=xi,$t.getFeature=Cn,$t.asFeature=_i,Pe.mergeOptions({boxZoom:!0});var Cr=Zt.extend({initialize:function(e){this._map=e,this._container=e._container,this._pane=e._panes.overlayPane,this._resetStateTimeout=0,e.on("unload",this._destroy,this)},addHooks:function(){ge(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Re(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){We(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(e){if(!e.shiftKey||e.which!==1&&e.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),Bn(),$i(),this._startPoint=this._map.mouseEventToContainerPoint(e),ge(document,{contextmenu:cn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(e){this._moved||(this._moved=!0,this._box=Ae("div","leaflet-zoom-box",this._container),ye(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(e);var t=new ce(this._point,this._startPoint),i=t.getSize();Ve(this._box,t.min),this._box.style.width=i.x+"px",this._box.style.height=i.y+"px"},_finish:function(){this._moved&&(We(this._box),qe(this._container,"leaflet-crosshair")),Wn(),Vi(),Re(document,{contextmenu:cn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(e){if(!(e.which!==1&&e.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(w(this._resetState,this),0);var t=new Me(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(t).fire("boxzoomend",{boxZoomBounds:t})}},_onKeyDown:function(e){e.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});Pe.addInitHook("addHandler","boxZoom",Cr),Pe.mergeOptions({doubleClickZoom:!0});var Sr=Zt.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(e){var t=this._map,i=t.getZoom(),s=t.options.zoomDelta,r=e.originalEvent.shiftKey?i-s:i+s;t.options.doubleClickZoom==="center"?t.setZoom(r):t.setZoomAround(e.containerPoint,r)}});Pe.addInitHook("addHandler","doubleClickZoom",Sr),Pe.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Lr=Zt.extend({addHooks:function(){if(!this._draggable){var e=this._map;this._draggable=new Qt(e._mapPane,e._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),e.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),e.on("zoomend",this._onZoomEnd,this),e.whenReady(this._onZoomEnd,this))}ye(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){qe(this._map._container,"leaflet-grab"),qe(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var e=this._map;if(e._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var t=Ce(this._map.options.maxBounds);this._offsetLimit=Oe(this._map.latLngToContainerPoint(t.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(t.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;e.fire("movestart").fire("dragstart"),e.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(e){if(this._map.options.inertia){var t=this._lastTime=+new Date,i=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(i),this._times.push(t),this._prunePositions(t)}this._map.fire("move",e).fire("drag",e)},_prunePositions:function(e){for(;this._positions.length>1&&e-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var e=this._map.getSize().divideBy(2),t=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=t.subtract(e).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(e,t){return e-(e-t)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var e=this._draggable._newPos.subtract(this._draggable._startPos),t=this._offsetLimit;e.x<t.min.x&&(e.x=this._viscousLimit(e.x,t.min.x)),e.y<t.min.y&&(e.y=this._viscousLimit(e.y,t.min.y)),e.x>t.max.x&&(e.x=this._viscousLimit(e.x,t.max.x)),e.y>t.max.y&&(e.y=this._viscousLimit(e.y,t.max.y)),this._draggable._newPos=this._draggable._startPos.add(e)}},_onPreDragWrap:function(){var e=this._worldWidth,t=Math.round(e/2),i=this._initialWorldOffset,s=this._draggable._newPos.x,r=(s-t+i)%e+t-i,a=(s+t+i)%e-t-i,h=Math.abs(r+i)<Math.abs(a+i)?r:a;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=h},_onDragEnd:function(e){var t=this._map,i=t.options,s=!i.inertia||e.noInertia||this._times.length<2;if(t.fire("dragend",e),s)t.fire("moveend");else{this._prunePositions(+new Date);var r=this._lastPos.subtract(this._positions[0]),a=(this._lastTime-this._times[0])/1e3,h=i.easeLinearity,g=r.multiplyBy(h/a),T=g.distanceTo([0,0]),Z=Math.min(i.inertiaMaxSpeed,T),se=g.multiplyBy(Z/T),he=Z/(i.inertiaDeceleration*h),je=se.multiplyBy(-he/2).round();!je.x&&!je.y?t.fire("moveend"):(je=t._limitOffset(je,t.options.maxBounds),R(function(){t.panBy(je,{duration:he,easeLinearity:h,noMoveStart:!0,animate:!0})}))}}});Pe.addInitHook("addHandler","dragging",Lr),Pe.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Tr=Zt.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(e){this._map=e,this._setPanDelta(e.options.keyboardPanDelta),this._setZoomDelta(e.options.zoomDelta)},addHooks:function(){var e=this._map._container;e.tabIndex<=0&&(e.tabIndex="0"),ge(e,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Re(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var e=document.body,t=document.documentElement,i=e.scrollTop||t.scrollTop,s=e.scrollLeft||t.scrollLeft;this._map._container.focus(),window.scrollTo(s,i)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(e){var t=this._panKeys={},i=this.keyCodes,s,r;for(s=0,r=i.left.length;s<r;s++)t[i.left[s]]=[-1*e,0];for(s=0,r=i.right.length;s<r;s++)t[i.right[s]]=[e,0];for(s=0,r=i.down.length;s<r;s++)t[i.down[s]]=[0,e];for(s=0,r=i.up.length;s<r;s++)t[i.up[s]]=[0,-1*e]},_setZoomDelta:function(e){var t=this._zoomKeys={},i=this.keyCodes,s,r;for(s=0,r=i.zoomIn.length;s<r;s++)t[i.zoomIn[s]]=e;for(s=0,r=i.zoomOut.length;s<r;s++)t[i.zoomOut[s]]=-e},_addHooks:function(){ge(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Re(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(e){if(!(e.altKey||e.ctrlKey||e.metaKey)){var t=e.keyCode,i=this._map,s;if(t in this._panKeys){if(!i._panAnim||!i._panAnim._inProgress)if(s=this._panKeys[t],e.shiftKey&&(s=ne(s).multiplyBy(3)),i.options.maxBounds&&(s=i._limitOffset(ne(s),i.options.maxBounds)),i.options.worldCopyJump){var r=i.wrapLatLng(i.unproject(i.project(i.getCenter()).add(s)));i.panTo(r)}else i.panBy(s)}else if(t in this._zoomKeys)i.setZoom(i.getZoom()+(e.shiftKey?3:1)*this._zoomKeys[t]);else if(t===27&&i._popup&&i._popup.options.closeOnEscapeKey)i.closePopup();else return;cn(e)}}});Pe.addInitHook("addHandler","keyboard",Tr),Pe.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Er=Zt.extend({addHooks:function(){ge(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Re(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(e){var t=Js(e),i=this._map.options.wheelDebounceTime;this._delta+=t,this._lastMousePos=this._map.mouseEventToContainerPoint(e),this._startTime||(this._startTime=+new Date);var s=Math.max(i-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(w(this._performZoom,this),s),cn(e)},_performZoom:function(){var e=this._map,t=e.getZoom(),i=this._map.options.zoomSnap||0;e._stop();var s=this._delta/(this._map.options.wheelPxPerZoomLevel*4),r=4*Math.log(2/(1+Math.exp(-Math.abs(s))))/Math.LN2,a=i?Math.ceil(r/i)*i:r,h=e._limitZoom(t+(this._delta>0?a:-a))-t;this._delta=0,this._startTime=null,h&&(e.options.scrollWheelZoom==="center"?e.setZoom(t+h):e.setZoomAround(this._lastMousePos,t+h))}});Pe.addInitHook("addHandler","scrollWheelZoom",Er);var ua=600;Pe.mergeOptions({tapHold:le.touchNative&&le.safari&&le.mobile,tapTolerance:15});var Pr=Zt.extend({addHooks:function(){ge(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Re(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(clearTimeout(this._holdTimeout),e.touches.length===1){var t=e.touches[0];this._startPos=this._newPos=new Q(t.clientX,t.clientY),this._holdTimeout=setTimeout(w(function(){this._cancel(),this._isTapValid()&&(ge(document,"touchend",ct),ge(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",t))},this),ua),ge(document,"touchend touchcancel contextmenu",this._cancel,this),ge(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function e(){Re(document,"touchend",ct),Re(document,"touchend touchcancel",e)},_cancel:function(){clearTimeout(this._holdTimeout),Re(document,"touchend touchcancel contextmenu",this._cancel,this),Re(document,"touchmove",this._onMove,this)},_onMove:function(e){var t=e.touches[0];this._newPos=new Q(t.clientX,t.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(e,t){var i=new MouseEvent(e,{bubbles:!0,cancelable:!0,view:window,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY});i._simulated=!0,t.target.dispatchEvent(i)}});Pe.addInitHook("addHandler","tapHold",Pr),Pe.mergeOptions({touchZoom:le.touch,bounceAtZoomLimits:!0});var kr=Zt.extend({addHooks:function(){ye(this._map._container,"leaflet-touch-zoom"),ge(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){qe(this._map._container,"leaflet-touch-zoom"),Re(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var t=this._map;if(!(!e.touches||e.touches.length!==2||t._animatingZoom||this._zooming)){var i=t.mouseEventToContainerPoint(e.touches[0]),s=t.mouseEventToContainerPoint(e.touches[1]);this._centerPoint=t.getSize()._divideBy(2),this._startLatLng=t.containerPointToLatLng(this._centerPoint),t.options.touchZoom!=="center"&&(this._pinchStartLatLng=t.containerPointToLatLng(i.add(s)._divideBy(2))),this._startDist=i.distanceTo(s),this._startZoom=t.getZoom(),this._moved=!1,this._zooming=!0,t._stop(),ge(document,"touchmove",this._onTouchMove,this),ge(document,"touchend touchcancel",this._onTouchEnd,this),ct(e)}},_onTouchMove:function(e){if(!(!e.touches||e.touches.length!==2||!this._zooming)){var t=this._map,i=t.mouseEventToContainerPoint(e.touches[0]),s=t.mouseEventToContainerPoint(e.touches[1]),r=i.distanceTo(s)/this._startDist;if(this._zoom=t.getScaleZoom(r,this._startZoom),!t.options.bounceAtZoomLimits&&(this._zoom<t.getMinZoom()&&r<1||this._zoom>t.getMaxZoom()&&r>1)&&(this._zoom=t._limitZoom(this._zoom)),t.options.touchZoom==="center"){if(this._center=this._startLatLng,r===1)return}else{var a=i._add(s)._divideBy(2)._subtract(this._centerPoint);if(r===1&&a.x===0&&a.y===0)return;this._center=t.unproject(t.project(this._pinchStartLatLng,this._zoom).subtract(a),this._zoom)}this._moved||(t._moveStart(!0,!1),this._moved=!0),q(this._animRequest);var h=w(t._move,t,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=R(h,this,!0),ct(e)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,q(this._animRequest),Re(document,"touchmove",this._onTouchMove,this),Re(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});Pe.addInitHook("addHandler","touchZoom",kr),Pe.BoxZoom=Cr,Pe.DoubleClickZoom=Sr,Pe.Drag=Lr,Pe.Keyboard=Tr,Pe.ScrollWheelZoom=Er,Pe.TapHold=Pr,Pe.TouchZoom=kr,c.Bounds=ce,c.Browser=le,c.CRS=at,c.Canvas=yr,c.Circle=cs,c.CircleMarker=fi,c.Class=j,c.Control=kt,c.DivIcon=xr,c.DivOverlay=Ft,c.DomEvent=Po,c.DomUtil=To,c.Draggable=Qt,c.Evented=ie,c.FeatureGroup=qt,c.GeoJSON=$t,c.GridLayer=Gn,c.Handler=Zt,c.Icon=jn,c.ImageOverlay=vi,c.LatLng=Se,c.LatLngBounds=Me,c.Layer=It,c.LayerGroup=bn,c.LineUtil=Fo,c.Map=Pe,c.Marker=mi,c.Mixin=Ro,c.Path=en,c.Point=Q,c.PolyUtil=zo,c.Polygon=wn,c.Polyline=Gt,c.Popup=yi,c.PosAnimation=Qs,c.Projection=Ho,c.Rectangle=wr,c.Renderer=Vt,c.SVG=Vn,c.SVGOverlay=gr,c.TileLayer=Sn,c.Tooltip=bi,c.Transformation=Xe,c.Util=E,c.VideoOverlay=pr,c.bind=w,c.bounds=Oe,c.canvas=br,c.circle=Xo,c.circleMarker=Ko,c.control=Hn,c.divIcon=oa,c.extend=b,c.featureGroup=$o,c.geoJSON=fr,c.geoJson=ea,c.gridLayer=aa,c.icon=Vo,c.imageOverlay=ta,c.latLng=xe,c.latLngBounds=Ce,c.layerGroup=Go,c.map=ko,c.marker=Yo,c.point=ne,c.polygon=Qo,c.polyline=Jo,c.popup=sa,c.rectangle=da,c.setOptions=F,c.stamp=C,c.svg=jr,c.svgOverlay=ia,c.tileLayer=_r,c.tooltip=ra,c.transformation=M,c.version=p,c.videoOverlay=na;var ha=window.L;c.noConflict=function(){return window.L=ha,this},window.L=c}))})(Yn,Yn.exports)),Yn.exports}var An=Gl();const Ai=jl(An);function Di(l,u,c){return Object.freeze({instance:l,context:u,container:c})}function Oi(l,u){return u==null?function(p,b){const H=d.useRef(void 0);return H.current||(H.current=l(p,b)),H}:function(p,b){const H=d.useRef(void 0);H.current||(H.current=l(p,b));const w=d.useRef(p),{instance:B}=H.current;return d.useEffect(function(){w.current!==p&&(u(B,p,w.current),w.current=p)},[B,p,u]),H}}function uo(l,u){d.useEffect(function(){return(u.layerContainer??u.map).addLayer(l.instance),function(){u.layerContainer?.removeLayer(l.instance),u.map.removeLayer(l.instance)}},[u,l])}function ho(l){return function(c){const p=Ii(),b=l(Mi(c,p),p);return ao(p.map,c.attribution),Ws(b.current,c.eventHandlers),uo(b.current,p),b}}function $l(l,u){const c=d.useRef(void 0);d.useEffect(function(){if(u.pathOptions!==c.current){const b=u.pathOptions??{};l.instance.setStyle(b),c.current=b}},[l,u])}function Vl(l){return function(c){const p=Ii(),b=l(Mi(c,p),p);return Ws(b.current,c.eventHandlers),uo(b.current,p),$l(b.current,c),b}}function Yl(l,u){const c=Oi(l,u),p=ho(c);return co(p)}function Kl(l,u){const c=Oi(l),p=Ul(c,u);return Fl(p)}function Xl(l,u){const c=Oi(l,u),p=Vl(c);return co(p)}function Jl(l,u){const c=Oi(l,u),p=ho(c);return Hl(p)}function Ql(l,u,c){const{opacity:p,zIndex:b}=u;p!=null&&p!==c.opacity&&l.setOpacity(p),b!=null&&b!==c.zIndex&&l.setZIndex(b)}function mo(){return Ii().map}function ec(l){const u=mo();return d.useEffect(function(){return u.on(l),function(){u.off(l)}},[u,l]),u}const ws=Xl(function({data:u,...c},p){const b=new An.GeoJSON(u,c);return Di(b,lo(p,{overlayContainer:b}))},function(u,c,p){c.style!==p.style&&(c.style==null?u.resetStyle():u.setStyle(c.style))});function tc({bounds:l,boundsOptions:u,center:c,children:p,className:b,id:H,placeholder:w,style:B,whenReady:C,zoom:P,...S},k){const[D]=d.useState({className:b,id:H,style:B}),[K,X]=d.useState(null),F=d.useRef(void 0);d.useImperativeHandle(k,()=>K?.map??null,[K]);const W=d.useCallback(ee=>{if(ee!==null&&!F.current){const J=new An.Map(ee,S);F.current=J,c!=null&&P!=null?J.setView(c,P):l!=null&&J.fitBounds(l,u),C!=null&&J.whenReady(C),X(Zl(J))}},[]);d.useEffect(()=>()=>{K?.map.remove()},[K]);const oe=K?yt.createElement(Bs,{value:K},p):w??null;return yt.createElement("div",{...D,ref:W},oe)}const nc=d.forwardRef(tc),ic=Yl(function({position:u,...c},p){const b=new An.Marker(u,c);return Di(b,lo(p,{overlayContainer:b}))},function(u,c,p){c.position!==p.position&&u.setLatLng(c.position),c.icon!=null&&c.icon!==p.icon&&u.setIcon(c.icon),c.zIndexOffset!=null&&c.zIndexOffset!==p.zIndexOffset&&u.setZIndexOffset(c.zIndexOffset),c.opacity!=null&&c.opacity!==p.opacity&&u.setOpacity(c.opacity),u.dragging!=null&&c.draggable!==p.draggable&&(c.draggable===!0?u.dragging.enable():u.dragging.disable())}),sc=Kl(function(u,c){const p=new An.Popup(u,c.overlayContainer);return Di(p,c)},function(u,c,{position:p},b){d.useEffect(function(){const{instance:w}=u;function B(P){P.popup===w&&(w.update(),b(!0))}function C(P){P.popup===w&&b(!1)}return c.map.on({popupopen:B,popupclose:C}),c.overlayContainer==null?(p!=null&&w.setLatLng(p),w.openOn(c.map)):c.overlayContainer.bindPopup(w),function(){c.map.off({popupopen:B,popupclose:C}),c.overlayContainer?.unbindPopup(),c.map.removeLayer(w)}},[u,c,b,p])}),rc=Jl(function({url:u,...c},p){const b=new An.TileLayer(u,Mi(c,p));return Di(b,p)},function(u,c,p){Ql(u,c,p);const{url:b}=c;b!=null&&b!==p.url&&u.setUrl(b)}),$r={Ain:"Auvergne-Rhône-Alpes",Aisne:"Hauts-de-France",Allier:"Auvergne-Rhône-Alpes","Alpes-de-Haute-Provence":"Provence-Alpes-Côte d'Azur","Hautes-Alpes":"Provence-Alpes-Côte d'Azur","Alpes-Maritimes":"Provence-Alpes-Côte d'Azur",Ardèche:"Auvergne-Rhône-Alpes",Ardennes:"Grand Est",Ariège:"Occitanie",Aube:"Grand Est",Aude:"Occitanie",Aveyron:"Occitanie","Bouches-du-Rhône":"Provence-Alpes-Côte d'Azur",Calvados:"Normandie",Cantal:"Auvergne-Rhône-Alpes",Charente:"Nouvelle-Aquitaine","Charente-Maritime":"Nouvelle-Aquitaine",Cher:"Centre-Val de Loire",Corrèze:"Nouvelle-Aquitaine","Côte-d'Or":"Bourgogne-Franche-Comté","Côtes-d'Armor":"Bretagne",Creuse:"Nouvelle-Aquitaine",Dordogne:"Nouvelle-Aquitaine",Doubs:"Bourgogne-Franche-Comté",Drôme:"Auvergne-Rhône-Alpes",Eure:"Normandie","Eure-et-Loir":"Centre-Val de Loire",Finistère:"Bretagne","Corse-du-Sud":"Corse","Haute-Corse":"Corse",Gard:"Occitanie","Haute-Garonne":"Occitanie",Gers:"Occitanie",Gironde:"Nouvelle-Aquitaine",Hérault:"Occitanie","Ille-et-Vilaine":"Bretagne",Indre:"Centre-Val de Loire","Indre-et-Loire":"Centre-Val de Loire",Isère:"Auvergne-Rhône-Alpes",Jura:"Bourgogne-Franche-Comté",Landes:"Nouvelle-Aquitaine","Loir-et-Cher":"Centre-Val de Loire",Loire:"Auvergne-Rhône-Alpes","Haute-Loire":"Auvergne-Rhône-Alpes","Loire-Atlantique":"Pays de la Loire",Loiret:"Centre-Val de Loire",Lot:"Occitanie","Lot-et-Garonne":"Nouvelle-Aquitaine",Lozère:"Occitanie","Maine-et-Loire":"Pays de la Loire",Manche:"Normandie",Marne:"Grand Est","Haute-Marne":"Grand Est",Mayenne:"Pays de la Loire","Meurthe-et-Moselle":"Grand Est",Meuse:"Grand Est",Morbihan:"Bretagne",Moselle:"Grand Est",Nièvre:"Bourgogne-Franche-Comté",Nord:"Hauts-de-France",Oise:"Hauts-de-France",Orne:"Normandie","Pas-de-Calais":"Hauts-de-France","Puy-de-Dôme":"Auvergne-Rhône-Alpes","Pyrénées-Atlantiques":"Nouvelle-Aquitaine","Hautes-Pyrénées":"Occitanie","Pyrénées-Orientales":"Occitanie","Bas-Rhin":"Grand Est","Haut-Rhin":"Grand Est",Rhône:"Auvergne-Rhône-Alpes","Haute-Saône":"Bourgogne-Franche-Comté","Saône-et-Loire":"Bourgogne-Franche-Comté",Sarthe:"Pays de la Loire",Savoie:"Auvergne-Rhône-Alpes","Haute-Savoie":"Auvergne-Rhône-Alpes",Paris:"Île-de-France","Seine-Maritime":"Normandie","Seine-et-Marne":"Île-de-France",Yvelines:"Île-de-France","Deux-Sèvres":"Nouvelle-Aquitaine",Somme:"Hauts-de-France",Tarn:"Occitanie","Tarn-et-Garonne":"Occitanie",Var:"Provence-Alpes-Côte d'Azur",Vaucluse:"Provence-Alpes-Côte d'Azur",Vendée:"Pays de la Loire",Vienne:"Nouvelle-Aquitaine","Haute-Vienne":"Nouvelle-Aquitaine",Vosges:"Grand Est",Yonne:"Bourgogne-Franche-Comté","Territoire de Belfort":"Bourgogne-Franche-Comté",Essonne:"Île-de-France","Hauts-de-Seine":"Île-de-France","Seine-Saint-Denis":"Île-de-France","Val-de-Marne":"Île-de-France","Val-d'Oise":"Île-de-France"};delete Ai.Icon.Default.prototype._getIconUrl;Ai.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const oc=new Ai.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-violet.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),ac=new Ai.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});function lc(){const l=mo();return d.useEffect(()=>{l.setView([46.603354,1.888334],6)},[l]),null}function un(l){switch(l){case"Zone Nord-Ouest":return"#4791db";case"Zone Nord-Est":return"#e57373";case"Zone Sud-Ouest":return"#ffeb3b";case"Zone Sud-Est":return"#66bb6a";case"Zone Centre":return"#9e9e9e";default:return"#e0e0e0"}}function Vr(l,u){let c=parseInt(l.replace("#",""),16),p=Math.floor((c>>16)*u),b=Math.floor((c>>8&255)*u),H=Math.floor((c&255)*u);return"#"+(p<<16|b<<8|H).toString(16).padStart(6,"0")}function cc({setZoom:l}){return ec({zoomend:u=>{l(u.target.getZoom())}}),null}const dc=({active:l=!0})=>{const{canCreateChurches:u}=Xt(),[c,p]=d.useState([]),[b,H]=d.useState(!0),[w,B]=d.useState(null),C=d.useRef(null),[P,S]=d.useState([]),[k,D]=d.useState(null),[K,X]=d.useState(null),[F,W]=d.useState(8),[oe,ee]=d.useState(null),[J,x]=d.useState(null),v=d.useRef(null),[_,V]=d.useState(!1),I=[46.603354,1.888334],A=[48.5,-1.7],N=7,R=async()=>{try{H(!0);const E=await de.churches.getAll(),j=E.data?.data||E.data||[];j.forEach(re=>{});const Y=j.filter(re=>re.latitude&&re.longitude&&!isNaN(parseFloat(re.latitude))&&!isNaN(parseFloat(re.longitude)));p(Y),B(null)}catch(E){const j=jt(E,"erreur lors du chargement des églises:");B(j.message),p([])}finally{H(!1)}};d.useEffect(()=>{l&&R()},[l]),d.useEffect(()=>{fetch("/zones.json").then(E=>E.json()).then(S),fetch("/regions.geojson").then(E=>E.json()).then(D),fetch("/departements.geojson").then(E=>E.json()).then(X)},[]),d.useEffect(()=>{J&&W(J.getZoom())},[J]),d.useEffect(()=>{window.dispatchEvent(new Event("resize"))},[]),d.useEffect(()=>{if(!v.current||!J)return;const E=setTimeout(()=>J.invalidateSize(),100),j=setTimeout(()=>J.invalidateSize(),500),Y=new window.ResizeObserver(()=>{J.invalidateSize()});return Y.observe(v.current),()=>{Y.disconnect(),clearTimeout(E),clearTimeout(j)}},[J]),d.useEffect(()=>{const E=setTimeout(()=>V(!0),100);return()=>clearTimeout(E)},[]);const q=()=>{C.current&&C.current.setView([46.603354,1.888334],6)};return b?n.jsx(Ti,{titre:"Chargement de la carte..."}):w?n.jsx(Mn,{error:w,title:"Erreur de chargement"}):n.jsxs(f,{children:[n.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[n.jsx(y,{variant:"h4",sx:{mb:2,fontWeight:"bold",color:"primary.main"},children:"Mission et Implantation"}),n.jsxs(f,{sx:{display:"flex",gap:2},children:[n.jsx(Te,{variant:"outlined",onClick:q,sx:{minWidth:120},children:"Centrer sur la France"}),n.jsx(Te,{variant:"outlined",onClick:()=>{C.current&&C.current.setView(A,N)},sx:{minWidth:120},children:"Zone Nord-Ouest"}),n.jsx(Te,{variant:"contained",startIcon:n.jsx(Bt,{}),onClick:R,disabled:b,children:"Actualiser"})]})]}),n.jsxs(f,{ref:v,sx:{height:"600px",width:"100%",minWidth:"300px",minHeight:"300px",mb:3,border:"2px solid #ccc",borderRadius:"8px",overflow:"hidden",position:"relative",boxSizing:"border-box"},children:[_&&n.jsxs(nc,{center:I,zoom:8,minZoom:5,maxZoom:12,style:{height:"600px",width:"100%"},zoomControl:!0,scrollWheelZoom:!0,whenCreated:E=>{C.current=E,x(E)},ref:C,children:[n.jsx(cc,{setZoom:W}),n.jsx(lc,{}),n.jsx(rc,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),F<=6&&k&&P.length>0&&n.jsx(ws,{data:k,style:E=>{const j=P.find(re=>re.regions.includes(E.properties.nom)),Y=j?un(j.nom):"#EEE";return{fillColor:oe===E.properties.nom?Vr(Y,.6):Y,weight:2,color:"#333",fillOpacity:.5,cursor:"pointer"}},onEachFeature:(E,j)=>{j.on({mouseover:()=>ee(E.properties.nom),mouseout:()=>ee(null)});const Y=P.find(re=>re.regions.includes(E.properties.nom));j.bindTooltip(`${E.properties.nom} (${Y?Y.nom:""})`,{sticky:!0})}}),k&&n.jsx(ws,{data:k,style:()=>({fillOpacity:0,weight:5,color:"#000",dashArray:"6,4",pointerEvents:"none",zIndex:1200})}),F>=7&&K&&P.length>0&&n.jsxs(n.Fragment,{children:[n.jsx(ws,{data:K,style:E=>{const j=$r[E.properties.nom],Y=P.find(ie=>ie.regions.includes(j)),re=Y?un(Y.nom):"#EEE";return{fillColor:oe===E.properties.nom?Vr(re,.6):re,weight:1,color:"#333",fillOpacity:.5,cursor:"pointer"}},onEachFeature:(E,j)=>{j.on({mouseover:()=>ee(E.properties.nom),mouseout:()=>ee(null)});const Y=$r[E.properties.nom];j.bindTooltip(`${E.properties.nom} (${Y})`,{sticky:!0})}}),K.features.length===0&&n.jsx(y,{color:"error",children:"Aucun polygone de département n'est visible (features vides)"})]}),c.length>0&&c.map(E=>n.jsx(ic,{position:[parseFloat(E.latitude),parseFloat(E.longitude)],icon:E.type==="MISSION"?ac:oc,children:n.jsx(sc,{maxWidth:300,children:n.jsxs(f,{sx:{minWidth:250,maxWidth:300},children:[n.jsx(f,{sx:{width:"100%",mb:1,display:"flex",justifyContent:"center"},children:E.image?n.jsx("img",{src:no(E.image),alt:E.nom,style:{maxWidth:"100%",maxHeight:200,borderRadius:8,objectFit:"cover",border:"1px solid #ccc"},onError:j=>{j.target.onerror=null,j.target.style.display="none"}}):n.jsx(f,{sx:{width:"100%",height:150,bgcolor:"grey.200",borderRadius:2,display:"flex",alignItems:"center",justifyContent:"center",border:"1px dashed #ccc"},children:n.jsx(y,{variant:"body2",color:"text.secondary",children:"Aucune image"})})}),n.jsx(y,{variant:"h6",gutterBottom:!0,sx:{fontWeight:"bold",color:E.type==="MISSION"?"#2e7d32":"primary.main"},children:E.nom}),n.jsxs(f,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:1},children:[n.jsx(Be,{label:`Ville: ${E.ville||"Non spécifiée"}`,color:(E.type==="MISSION","primary"),size:"small",sx:{fontSize:"0.72rem",backgroundColor:E.type==="MISSION"?"#2e7d32":void 0,color:E.type==="MISSION"?"white":void 0}}),n.jsx(Be,{label:`Population: ${E.population?.toLocaleString()||"Non spécifiée"}`,color:(E.type==="MISSION","secondary"),size:"small",sx:{fontSize:"0.72rem",backgroundColor:E.type==="MISSION"?"#35BB3B":void 0,color:E.type==="MISSION"?"white":void 0}})]}),n.jsxs(y,{variant:"body2",paragraph:!0,sx:{mb:1},children:[n.jsx("strong",{children:"Adresse : "}),E.adresse||"Non spécifiée"]}),E.responsable&&n.jsxs(y,{variant:"body2",paragraph:!0,sx:{mb:1},children:[n.jsx("strong",{children:"Responsable : "}),E.responsable.username]}),n.jsxs(y,{variant:"body2",paragraph:!0,sx:{mb:1},children:[n.jsx("strong",{children:"Nombre de membres : "}),E.nombre_membres||"Non spécifié"]}),E.description&&n.jsxs(y,{variant:"body2",sx:{mb:1},children:[n.jsx("strong",{children:"Description : "}),E.description]})]})})},E.id||E._id))]}),n.jsxs(f,{sx:{position:"absolute",bottom:16,right:16,background:"rgba(255,255,255,0.95)",borderRadius:2,boxShadow:3,p:2,minWidth:180,zIndex:1200},children:[n.jsx(y,{variant:"subtitle2",sx:{fontWeight:"bold",mb:1},children:"Légende des zones"}),[{nom:"Zone Nord-Ouest",color:un("Zone Nord-Ouest")},{nom:"Zone Nord-Est",color:un("Zone Nord-Est")},{nom:"Zone Sud-Ouest",color:un("Zone Sud-Ouest")},{nom:"Zone Sud-Est",color:un("Zone Sud-Est")},{nom:"Zone Centre",color:un("Zone Centre")}].map(E=>n.jsxs(f,{sx:{display:"flex",alignItems:"center",mb:.5},children:[n.jsx(f,{sx:{width:20,height:20,background:E.color,borderRadius:"4px",border:"1px solid #888",mr:1}}),n.jsx(y,{variant:"body2",children:E.nom})]},E.nom)),n.jsx(Xr,{sx:{my:1}}),n.jsx(y,{variant:"subtitle2",sx:{fontWeight:"bold",mb:1},children:"Marqueurs"}),n.jsxs(f,{sx:{display:"flex",alignItems:"center",mb:.5},children:[n.jsx("img",{src:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-violet.png",alt:"Église",style:{width:20,height:32,marginRight:8}}),n.jsx(y,{variant:"body2",children:"Église"})]}),n.jsxs(f,{sx:{display:"flex",alignItems:"center",mb:.5},children:[n.jsx("img",{src:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",alt:"Mission",style:{width:20,height:32,marginRight:8}}),n.jsx(y,{variant:"body2",children:"Mission"})]})]})]}),c.length===0&&!b&&n.jsxs(Ee,{sx:{p:3,textAlign:"center"},children:[n.jsx(y,{variant:"h6",color:"text.secondary",children:"Aucune église avec coordonnées géographiques trouvée"}),n.jsx(y,{variant:"body2",color:"text.secondary",children:"Ajoutez des coordonnées (latitude/longitude) aux églises pour les afficher sur la carte"})]})]})},Is=l=>{if(!l)return"";const u=new Date(l);if(isNaN(u.getTime()))return"";const c={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"};return u.toLocaleDateString("fr-FR",c)},uc=()=>{const{selectedChurch:l}=Os(),{notification:u,showSuccess:c,showError:p,hideNotification:b}=xn(),[H,w]=d.useState([]),[B,C]=d.useState(!1),[P,S]=d.useState(1),[k,D]=d.useState(1),[K,X]=d.useState(""),[F,W]=d.useState(""),[oe,ee]=d.useState(!1),[J,x]=d.useState(!1),[v,_]=d.useState(null),[V,I]=d.useState(!1),[A,N]=d.useState(!1),[R,q]=d.useState(null),[E,j]=d.useState(!1),[Y,re]=d.useState(null),[ie,Q]=d.useState(""),[pe,ne]=d.useState(!1),[ce,Oe]=d.useState(null),Me=[{value:"",label:"Toutes les catégories"},{value:"INTIMACY",label:"Intimité avec Dieu"},{value:"LEADERSHIP",label:"Leadership"},{value:"HEALING",label:"Guérison/Santé"},{value:"PROFESSIONAL",label:"Professionnel"},{value:"BUSINESS",label:"Entreprises/Affaires"},{value:"FINANCES",label:"Finances"},{value:"DELIVERANCE",label:"Délivrance"},{value:"FAMILY",label:"Famille"}],Ce=async()=>{if(l?.id){C(!0);try{const z={page:P.toString(),limit:"10",churchId:l.id};K&&(z.search=K),F&&(z.category=F),oe&&(z.isRead="false"),J&&(z.wantsToTestify="true");const Qe=(await de.testimonies.getAll(z)).data;Qe.success?(w(Qe.data.testimonies||[]),D(Qe.data.totalPages||1)):p(Qe.message||"Erreur lors du chargement des témoignages")}catch(z){p("Erreur de connexion lors du chargement des témoignages"),nt.error("Erreur:",z)}finally{C(!1)}}};d.useEffect(()=>{Ce()},[l,P,K,F,oe,J]);const Se=(z,ke)=>{S(ke)},xe=z=>{X(z.target.value),S(1)},at=z=>{W(z.target.value),S(1)},lt=z=>{ee(z.target.checked),S(1)},Et=z=>{x(z.target.checked),S(1)},$e=async z=>{if(_(z),I(!0),!z.isRead)try{await de.testimonies.markAsRead(z.id),Ce()}catch(ke){nt.error("Erreur lors du marquage automatique comme lu:",ke)}},Xe=z=>{q(z),N(!0)},M=()=>{N(!1),q(null)},U=async()=>{if(R)try{const ke=(await de.testimonies.delete(R.id)).data;ke.success?(c("Témoignage supprimé avec succès"),await dt(rt.DELETE,ut.TESTIMONY,R.id,R.title||"Témoignage sans titre",`Témoignage supprimé: ${R.title||"sans titre"}`),Ce()):p(ke.message||"Erreur lors de la suppression")}catch(z){p("Erreur de connexion lors de la suppression"),nt.error("Erreur:",z)}finally{M()}},me=()=>{Ce()},G=z=>{Oe(z),ne(!0)},_e=z=>{Oe(z),ne(!0)},Je=()=>{ne(!1),Oe(null)},Ue=async()=>{if(!ce)return;const z=!ce.isConfirmedToTestify;try{const Qe=(await de.testimonies.confirmForCulte(ce.id,{confirmed:z})).data;Qe.success?(c(z?"Témoignage confirmé pour le culte":"Confirmation annulée"),await dt(rt.UPDATE,ut.TESTIMONY,ce.id,ce.title||"Témoignage sans titre",z?"Témoignage confirmé pour le culte":"Confirmation de culte annulée"),Ce()):p(Qe.message||"Erreur lors de la confirmation")}catch(ke){p("Erreur de connexion lors de la confirmation"),nt.error("Erreur:",ke)}finally{Je()}},vt=z=>{re(z),Q(z.note||""),j(!0)},O=()=>{j(!1),re(null),Q("")},ae=async()=>{if(Y)try{const ke=(await de.testimonies.addNote(Y.id,ie)).data;ke.success?(c(ke.message),await dt(rt.UPDATE,ut.TESTIMONY,Y.id,Y.title||"Témoignage sans titre",`Note ajoutée au témoignage: ${Y.title||"sans titre"}`),Ce(),O()):p(ke.message||"Erreur lors de l'ajout de la note")}catch(z){p("Erreur de connexion lors de l'ajout de la note"),nt.error("Erreur:",z)}},be=z=>z?z.isAnonymous?"Anonyme":`${z.firstName??""} ${z.lastName??""}`.trim()||"—":"—",De=z=>{if(!z)return"—";const ke=Me.find(Qe=>Qe.value===z);return ke?ke.label:String(z)};return l?n.jsxs(f,{children:[n.jsxs(f,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[n.jsx(y,{variant:"h4",component:"h1",gutterBottom:!0,children:"Gestion des témoignages"}),n.jsx(Te,{variant:"outlined",startIcon:n.jsx(Bt,{}),onClick:me,disabled:B,children:"Actualiser"})]}),n.jsx(At,{sx:{mb:3},children:n.jsxs(Dt,{children:[n.jsxs(y,{variant:"h6",gutterBottom:!0,children:[n.jsx(As,{sx:{mr:1,verticalAlign:"middle"}}),"Filtres"]}),n.jsxs(te,{container:!0,spacing:2,alignItems:"center",children:[n.jsx(te,{item:!0,xs:12,md:6,sx:{width:"35%"},children:n.jsx(Ze,{fullWidth:!0,id:"testimonies-search",name:"search",placeholder:"Rechercher dans les témoignages...",value:K,onChange:xe,autoComplete:"off",InputProps:{startAdornment:n.jsx(Ta,{position:"start",children:n.jsx(Li,{})})}})}),n.jsx(te,{item:!0,xs:12,md:6,sx:{width:"35%"},children:n.jsxs(Fe,{fullWidth:!0,children:[n.jsx(Ge,{id:"testimonies-category-label",children:"Catégorie"}),n.jsx(He,{id:"testimonies-category",name:"category",value:F,onChange:at,label:"Catégorie",labelId:"testimonies-category-label",autoComplete:"off",children:Me.map(z=>n.jsx(we,{value:z.value,children:z.label},z.value))})]})}),n.jsx(te,{item:!0,xs:12,md:4,children:n.jsx(Ts,{control:n.jsx(Es,{id:"testimonies-unread-only",name:"unreadOnly",checked:oe,onChange:lt,color:"primary"}),label:"Non lus uniquement"})}),n.jsx(te,{item:!0,xs:12,md:4,children:n.jsx(Ts,{control:n.jsx(Es,{id:"testimonies-wants-to-testify",name:"wantsToTestify",checked:J,onChange:Et,color:"primary"}),label:"Veut témoigner au culte"})}),n.jsx(te,{item:!0,xs:12,md:4,children:n.jsx(f,{display:"flex",justifyContent:"center",children:n.jsx(Be,{label:`${H.length} témoignage(s)`,color:"primary",variant:"outlined"})})})]})]})}),B?n.jsx(f,{display:"flex",justifyContent:"center",py:4,children:n.jsx(ht,{})}):H.length===0?n.jsx(ot,{severity:"info",children:"Aucun témoignage trouvé pour cette église."}):n.jsxs(n.Fragment,{children:[n.jsx(te,{container:!0,spacing:2,children:H.map(z=>n.jsx(te,{item:!0,xs:12,md:6,lg:4,sx:{width:"100%"},children:n.jsxs(At,{sx:{height:"100%",display:"flex",flexDirection:"column",opacity:z.isRead?.7:1,border:z.isRead?"1px solid var(--testimony-border-read)":"1px solid var(--testimony-border-unread)",boxShadow:z.isRead?"none":"0 2px 8px var(--testimony-shadow-unread)"},children:[n.jsxs(Dt,{sx:{flexGrow:1},children:[n.jsxs(f,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[n.jsx(f,{display:"flex",gap:1,alignItems:"center",children:n.jsx(Be,{label:De(z.category),color:"primary",size:"small"})}),n.jsx(y,{variant:"body2",color:"text.primary",sx:{fontSize:"0.75rem",fontWeight:500},children:Is(z.createdAt)})]}),n.jsx(y,{variant:"h6",gutterBottom:!0,children:be(z)}),n.jsx(y,{variant:"body2",color:"text.primary",sx:{display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden",mb:2},children:z.content}),z.note&&n.jsxs(f,{sx:{bgcolor:"var(--testimony-accent-bg)",p:2,borderRadius:2,mb:2,border:"1px solid",borderColor:"var(--testimony-accent-border)",position:"relative"},children:[n.jsxs(f,{display:"flex",alignItems:"center",gap:1,mb:1,children:[n.jsx(f,{sx:{width:20,height:20,borderRadius:"50%",bgcolor:"primary.main",display:"flex",alignItems:"center",justifyContent:"center"},children:n.jsx(Ea,{sx:{color:"white",fontSize:"16px"}})}),n.jsx(y,{variant:"subtitle2",color:"primary.dark",sx:{fontWeight:600},children:"Note"})]}),n.jsx(y,{variant:"body2",color:"text.primary",sx:{lineHeight:1.6,fontStyle:"italic",pl:3},children:z.note})]}),n.jsxs(f,{display:"flex",gap:1,flexWrap:"wrap",sx:{mb:2},children:[z.network?.nom&&n.jsx(Be,{icon:n.jsx(Pn,{}),label:`Réseau : ${z.network.nom}`,size:"small",color:"primary",variant:"outlined",sx:{fontSize:"0.75rem"}}),z.illustrations?.length>0&&n.jsx(Be,{icon:n.jsx(Rr,{}),label:`${z.illustrations.length} fichier(s)`,size:"small",color:"secondary",variant:"outlined",sx:{fontSize:"0.75rem"}}),z.wantsToTestify&&n.jsx(Be,{label:"Veut témoigner au culte",size:"small",color:"warning",variant:"outlined",sx:{fontSize:"0.75rem",fontWeight:600}}),z.isConfirmedToTestify&&n.jsx(Be,{label:"Confirmé pour culte",size:"small",color:"success",variant:"outlined",sx:{fontSize:"0.75rem",fontWeight:600}}),z.hasTestified&&n.jsx(Be,{label:"A témoigné",size:"small",color:"info",variant:"outlined",sx:{fontSize:"0.75rem",fontWeight:600}})]})]}),n.jsx(f,{sx:{p:2,pt:0},children:n.jsxs(f,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[n.jsxs(f,{display:"flex",gap:1,children:[n.jsx(bt,{title:"Voir le témoignage",children:n.jsx(Ie,{size:"small",onClick:()=>$e(z),sx:{color:z.isRead?"var(--testimony-read)":"var(--testimony-unread)","&:hover":{backgroundColor:z.isRead?"var(--testimony-read-bg)":"var(--testimony-unread-bg)"}},children:n.jsx(Jr,{})})}),!z.isAnonymous&&!z.isConfirmedToTestify&&n.jsx(bt,{title:"Confirmer pour le culte",children:n.jsx(Ie,{size:"small",color:"success",onClick:()=>G(z),children:n.jsx(Pa,{})})}),z.isConfirmedToTestify&&n.jsx(bt,{title:"Annuler la confirmation",children:n.jsx(Ie,{size:"small",color:"error",onClick:()=>_e(z),children:n.jsx(ka,{})})}),n.jsx(bt,{title:z.note?"Modifier la note":"Ajouter une note",children:n.jsx(Ie,{size:"small",color:z.note?"primary":"default",onClick:()=>vt(z),children:n.jsx(Ia,{})})})]}),n.jsx(bt,{title:"Supprimer",children:n.jsx(Ie,{size:"small",color:"error",onClick:()=>Xe(z),children:n.jsx(gn,{})})})]})})]})},z.id))}),k>1&&n.jsx(f,{display:"flex",justifyContent:"center",mt:4,children:n.jsx(Ma,{count:k,page:P,onChange:Se,color:"primary",size:"large"})})]}),n.jsxs(Ot,{open:V,onClose:()=>I(!1),maxWidth:"md",fullWidth:!0,children:[n.jsxs(Rt,{children:["Témoignage de ",v&&be(v)]}),n.jsx(zt,{children:n.jsx(f,{sx:{pt:2},children:v&&n.jsxs(f,{children:[n.jsx(f,{display:"flex",gap:1,mb:2,children:n.jsx(Be,{label:De(v.category),color:"primary",size:"small"})}),n.jsx(y,{variant:"body1",paragraph:!0,children:v.content}),(v.phone||v.email)&&n.jsxs(f,{sx:{mt:2,mb:2},children:[n.jsx(y,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:600},children:"Informations de contact :"}),v.phone&&n.jsxs(f,{display:"flex",alignItems:"center",gap:1,mb:1,children:[n.jsx(Ps,{sx:{fontSize:16,color:"text.secondary"}}),n.jsx(y,{variant:"body2",children:v.phone})]}),v.email&&n.jsxs(f,{display:"flex",alignItems:"center",gap:1,children:[n.jsx(ks,{sx:{fontSize:16,color:"text.secondary"}}),n.jsx(y,{variant:"body2",children:v.email})]})]}),v.network?.nom&&n.jsx(Be,{icon:n.jsx(Pn,{}),label:`Réseau : ${v.network.nom}`,size:"small",color:"primary",variant:"outlined",sx:{mb:2,fontSize:"0.75rem"}}),v.illustrations?.length>0&&n.jsxs(f,{sx:{mb:2},children:[n.jsx(Be,{icon:n.jsx(Rr,{}),label:`${v.illustrations.length} fichier(s) joint(s)`,size:"small",color:"secondary",variant:"outlined",sx:{mb:1,fontSize:"0.75rem"}}),n.jsx(f,{sx:{mt:1},children:v.illustrations.map((z,ke)=>n.jsx(Be,{label:z.originalName,icon:n.jsx(Aa,{}),clickable:!0,onClick:()=>window.open(`${eo}/uploads/testimonies/${z.fileName}`,"_blank"),sx:{mr:1,mb:1}},ke))})]})]})})}),n.jsx(Nt,{children:n.jsx(Te,{onClick:()=>I(!1),children:"Fermer"})})]}),n.jsx(In,{open:A,title:"Supprimer le témoignage",content:R?`Êtes-vous sûr de vouloir supprimer le témoignage "${R.title||"sans titre"}" ?`:"Êtes-vous sûr de vouloir supprimer ce témoignage ?",onClose:M,onConfirm:U}),n.jsxs(Ot,{open:E,onClose:O,maxWidth:"md",fullWidth:!0,children:[n.jsx(Rt,{children:Y?.note?"Modifier la note":"Ajouter une note"}),n.jsx(zt,{children:n.jsxs(f,{sx:{pt:2},children:[Y&&n.jsxs(y,{variant:"body2",color:"text.primary",gutterBottom:!0,children:["Témoignage de ",be(Y)," - ",De(Y.category)]}),n.jsx(Ze,{fullWidth:!0,multiline:!0,rows:6,value:ie,onChange:z=>Q(z.target.value),placeholder:"Ajoutez votre note sur ce témoignage...",variant:"outlined",sx:{mt:2}})]})}),n.jsxs(Nt,{children:[n.jsx(Te,{onClick:O,children:"Annuler"}),Y?.note&&n.jsx(Te,{onClick:async()=>{Q("");try{const ke=(await de.testimonies.addNote(Y.id,"")).data;ke.success?(c(ke.message),Ce(),O()):p(ke.message||"Erreur lors de la suppression de la note")}catch(z){p("Erreur de connexion lors de la suppression de la note"),nt.error("Erreur:",z)}},color:"error",children:"Supprimer la note"}),n.jsx(Te,{onClick:ae,variant:"contained",disabled:!ie.trim(),children:Y?.note?"Modifier":"Ajouter"})]})]}),n.jsxs(Ot,{open:pe,onClose:Je,children:[n.jsx(Rt,{children:ce?.isConfirmedToTestify?"Annuler la confirmation":"Confirmer pour le culte"}),n.jsxs(zt,{children:[n.jsx(y,{children:ce?.isConfirmedToTestify?"Êtes-vous sûr de vouloir annuler la confirmation de ce témoignage pour le culte ?":"Êtes-vous sûr de vouloir confirmer ce témoignage pour le culte ?"}),ce&&n.jsxs(y,{variant:"body2",color:"text.secondary",sx:{mt:2},children:[be(ce)," - ",De(ce.category)]})]}),n.jsxs(Nt,{children:[n.jsx(Te,{onClick:Je,children:"Annuler"}),n.jsx(Te,{onClick:Ue,variant:"contained",color:ce?.isConfirmedToTestify?"error":"primary",children:ce?.isConfirmedToTestify?"Annuler la confirmation":"Confirmer"})]})]}),n.jsx(kn,{open:u.open,autoHideDuration:4e3,onClose:b,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:n.jsx(ot,{onClose:b,severity:u.severity,sx:{width:"100%"},children:u.message})})]}):n.jsx(ot,{severity:"warning",children:"Veuillez sélectionner une église pour voir les témoignages"})},hc=()=>{const{selectedChurch:l}=Os(),{notification:u,showSuccess:c,showError:p,hideNotification:b}=xn(),[H,w]=d.useState([]),[B,C]=d.useState(!1),[P,S]=d.useState(null),[k,D]=d.useState(!1),[K,X]=d.useState(!1),F=async()=>{if(l?.id){C(!0);try{const _={churchId:l.id,isConfirmed:"true"};K&&(_.hasTestified="false");const I=(await de.testimonies.getForCulte(_)).data;I.success?w(I.data||[]):p(I.message||"Erreur lors du chargement des témoignages")}catch(_){p("Erreur de connexion lors du chargement des témoignages"),nt.error("Erreur:",_)}finally{C(!1)}}};d.useEffect(()=>{F()},[l,K]);const W=_=>{X(_.target.checked)},oe=_=>{S(_),D(!0)},ee=async _=>{try{const I=(await de.testimonies.markAsTestified(_.id)).data;I.success?(c("Témoignage marqué comme effectué"),F()):p(I.message||"Erreur lors du marquage")}catch(V){p("Erreur de connexion lors du marquage"),nt.error("Erreur:",V)}},J=()=>{F()},x=_=>_?_.isAnonymous?"Anonyme":`${_.firstName??""} ${_.lastName??""}`.trim()||"—":"—",v=_=>({GOUVERNANCE:"Gouvernance",ECODIM:"ECODIM",SECTION:"Section",VISITOR:"Visiteur",NETWORK_MEMBER:"Membre réseau"})[_]||_||"—";return l?n.jsxs(f,{children:[n.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[n.jsx(y,{variant:"h4",sx:{fontWeight:"bold",color:"primary.main"},children:"Témoignages de culte"}),n.jsx(Te,{variant:"outlined",startIcon:n.jsx(Bt,{}),onClick:J,disabled:B,children:"Actualiser"})]}),n.jsx(At,{sx:{mb:3},children:n.jsxs(Dt,{children:[n.jsxs(y,{variant:"h6",gutterBottom:!0,children:[n.jsx(As,{sx:{mr:1,verticalAlign:"middle"}}),"Filtres"]}),n.jsxs(te,{container:!0,spacing:2,alignItems:"center",children:[n.jsx(te,{item:!0,xs:12,md:6,children:n.jsx(Ts,{control:n.jsx(Es,{checked:K,onChange:W,color:"primary"}),label:"Pas encore témoigné"})}),n.jsx(te,{item:!0,xs:12,md:6,children:n.jsx(f,{display:"flex",justifyContent:"center",children:n.jsx(Be,{label:`${H.length} témoignage(s) confirmé(s)`,color:"primary",variant:"outlined"})})})]})]})}),B?n.jsx(f,{display:"flex",justifyContent:"center",py:4,children:n.jsx(ht,{})}):H.length===0?n.jsx(ot,{severity:"info",children:"Aucun témoignage trouvé pour le culte."}):n.jsx(n.Fragment,{children:n.jsx(te,{container:!0,spacing:2,children:H.map(_=>n.jsx(te,{item:!0,xs:12,md:6,lg:4,children:n.jsxs(At,{sx:{height:"100%",display:"flex",flexDirection:"column",border:_.isConfirmedToTestify?"2px solid var(--success-confirmed)":"1px solid var(--network-border)",boxShadow:_.isConfirmedToTestify?"0 4px 12px var(--success-confirmed-shadow)":"none"},children:[n.jsxs(Dt,{sx:{flexGrow:1},children:[n.jsxs(f,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:2,children:[n.jsxs(f,{display:"flex",gap:1,alignItems:"center",children:[n.jsx(Be,{label:v(_.testimonyType),color:"primary",size:"small"}),_.section&&_.unit&&n.jsx(Be,{label:`${_.section} - ${_.unit}`,color:"secondary",size:"small",variant:"outlined"})]}),n.jsx(y,{variant:"body2",color:"text.primary",sx:{fontSize:"0.75rem",fontWeight:500},children:Is(_.createdAt)})]}),n.jsx(y,{variant:"h6",gutterBottom:!0,children:x(_)}),n.jsxs(f,{sx:{mb:2},children:[_.phone&&n.jsxs(f,{display:"flex",alignItems:"center",gap:1,mb:1,children:[n.jsx(Ps,{sx:{fontSize:16,color:"text.secondary"}}),n.jsx(y,{variant:"body2",color:"text.secondary",children:_.phone})]}),_.email&&n.jsxs(f,{display:"flex",alignItems:"center",gap:1,mb:1,children:[n.jsx(ks,{sx:{fontSize:16,color:"text.secondary"}}),n.jsx(y,{variant:"body2",color:"text.secondary",children:_.email})]}),_.network?.nom&&n.jsxs(f,{display:"flex",alignItems:"center",gap:1,children:[n.jsx(Pn,{sx:{fontSize:16,color:"text.secondary"}}),n.jsx(y,{variant:"body2",color:"text.secondary",children:_.network.nom})]})]}),n.jsx(y,{variant:"body2",color:"text.primary",sx:{display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden",mb:2},children:_.content}),n.jsxs(f,{display:"flex",gap:1,flexWrap:"wrap",children:[_.isConfirmedToTestify&&n.jsx(Be,{label:"Confirmé",size:"small",color:"success"}),_.hasTestified&&n.jsx(Be,{label:"A témoigné",size:"small",color:"info",icon:n.jsx(zr,{})}),_.confirmedAt&&n.jsx(Be,{label:`Confirmé le ${Is(_.confirmedAt)}`,size:"small",color:"primary",variant:"outlined"})]})]}),n.jsx(f,{sx:{p:2,pt:0},children:n.jsx(f,{display:"flex",justifyContent:"space-between",alignItems:"center",children:n.jsxs(f,{display:"flex",gap:1,children:[n.jsx(bt,{title:"Voir le témoignage",children:n.jsx(Ie,{size:"small",onClick:()=>oe(_),color:"primary",children:n.jsx(Jr,{})})}),!_.hasTestified&&n.jsx(bt,{title:"Marquer comme témoigné",children:n.jsx(Ie,{size:"small",color:"info",onClick:()=>ee(_),children:n.jsx(zr,{})})})]})})})]})},_.id))})}),n.jsxs(Ot,{open:k,onClose:()=>D(!1),maxWidth:"md",fullWidth:!0,children:[n.jsxs(Rt,{children:["Témoignage de ",P&&x(P)]}),n.jsx(zt,{children:n.jsx(f,{sx:{pt:2},children:P&&n.jsxs(f,{children:[n.jsx(y,{variant:"body1",paragraph:!0,children:P.content}),n.jsxs(f,{sx:{mt:2},children:[n.jsx(y,{variant:"subtitle2",gutterBottom:!0,children:"Informations de contact :"}),P.phone&&n.jsxs(f,{display:"flex",alignItems:"center",gap:1,mb:1,children:[n.jsx(Ps,{sx:{fontSize:16}}),n.jsx(y,{variant:"body2",children:P.phone})]}),P.email&&n.jsxs(f,{display:"flex",alignItems:"center",gap:1,mb:1,children:[n.jsx(ks,{sx:{fontSize:16}}),n.jsx(y,{variant:"body2",children:P.email})]}),P.network?.nom&&n.jsxs(f,{display:"flex",alignItems:"center",gap:1,children:[n.jsx(Pn,{sx:{fontSize:16}}),n.jsxs(y,{variant:"body2",children:["Réseau : ",P.network.nom]})]})]})]})})}),n.jsx(Nt,{children:n.jsx(Te,{onClick:()=>D(!1),children:"Fermer"})})]}),n.jsx(kn,{open:u.open,autoHideDuration:4e3,onClose:b,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:n.jsx(ot,{onClose:b,severity:u.severity,sx:{width:"100%"},children:u.message})})]}):n.jsx(ot,{severity:"warning",children:"Veuillez sélectionner une église pour voir les témoignages de culte"})},mc=()=>{const[l,u]=d.useState([]),[c,p]=d.useState(!0),[b,H]=d.useState(null),[w,B]=d.useState({action:"",entity:""}),C=[{value:"CREATE",label:o.t("historys.add"),color:"success"},{value:"UPDATE",label:o.t("historys.edit"),color:"info"},{value:"DELETE",label:o.t("historys.delete"),color:"error"},{value:"LOGIN",label:"Connexion",color:"primary"},{value:"LOGOUT",label:"Déconnexion",color:"warning"},{value:"VIEW",label:"Consultation",color:"default"},{value:"EXPORT",label:"Export",color:"secondary"},{value:"IMPORT",label:"Import",color:"secondary"}],P=[{value:"USER",label:"Utilisateur"},{value:"NETWORK",label:"Réseau"},{value:"GROUP",label:"Groupe"},{value:"SERVICE",label:"Culte"},{value:"CHURCH",label:"Église"},{value:"DEPARTMENT",label:"Département"},{value:"TESTIMONY",label:"Témoignage"},{value:"CAROUSEL",label:"Carousel"},{value:"PREVISIONNEL",label:"Prévisionnel"},{value:"ASSISTANCE",label:"Assistance"},{value:"MESSAGE",label:"Message"}],S=async()=>{try{p(!0),H(null);const W=await so.getHistory({page:1,limit:100,action:w.action||void 0,entity_type:w.entity||void 0});W.success?u(W.data):H("Erreur lors du chargement des activités")}catch(W){H("Erreur lors du chargement des activités"),nt.error("Erreur chargement historique:",W)}finally{p(!1)}};d.useEffect(()=>{S()},[]),d.useEffect(()=>{S()},[w]);const k=l,D=W=>{switch(W){case"CREATE":return n.jsx(pn,{});case"UPDATE":return n.jsx(Kn,{});case"DELETE":return n.jsx(gn,{});default:return null}},K=W=>{switch(W){case"CREATE":return"success";case"UPDATE":return"info";case"DELETE":return"error";case"LOGIN":return"primary";case"LOGOUT":return"warning";case"VIEW":return"default";case"EXPORT":return"secondary";case"IMPORT":return"secondary";default:return"default"}},X=W=>{if(!W)return"Date inconnue";try{const oe=new Date(W);return isNaN(oe.getTime())?"Date invalide":new Intl.DateTimeFormat("fr-FR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(oe)}catch{return"Date invalide"}},F=()=>{B({action:"",entity:""})};return c?n.jsxs(f,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:[n.jsx(ht,{}),n.jsx(y,{variant:"body1",sx:{ml:2},children:o.t("historys.loading")})]}):b?n.jsx(ot,{severity:"error",sx:{m:2},children:b}):n.jsxs(f,{sx:{p:3},children:[n.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[n.jsx(y,{variant:"h4",sx:{fontWeight:"bold",color:"primary.main"},children:o.t("historys.title")}),n.jsx(bt,{title:"Actualiser les données",children:n.jsx(Ie,{onClick:S,disabled:c,color:"primary",children:n.jsx(Bt,{})})})]}),n.jsx(At,{sx:{mb:3},children:n.jsxs(Dt,{children:[n.jsxs(y,{variant:"h6",gutterBottom:!0,children:[n.jsx(As,{sx:{mr:1,verticalAlign:"middle"}}),"Filtres"]}),n.jsxs(te,{container:!0,spacing:2,alignItems:"center",children:[n.jsx(te,{item:!0,xs:12,sm:3,sx:{width:"25%"},children:n.jsxs(Ze,{select:!0,fullWidth:!0,id:"history-filter-action",name:"action",label:o.t("historys.filterByAction"),value:w.action,onChange:W=>B({...w,action:W.target.value}),size:"small",autoComplete:"off",children:[n.jsx(we,{value:"",children:"Toutes les actions"}),C.map(W=>n.jsx(we,{value:W.value,children:W.label},W.value))]})}),n.jsx(te,{item:!0,xs:12,sm:6,sx:{width:"30%"},children:n.jsxs(Ze,{select:!0,fullWidth:!0,id:"history-filter-entity",name:"entity",label:o.t("historys.filterByEntity"),value:w.entity,onChange:W=>B({...w,entity:W.target.value}),size:"small",autoComplete:"off",children:[n.jsx(we,{value:"",children:"Toutes les entités"}),P.map(W=>n.jsx(we,{value:W.value,children:W.label},W.value))]})}),n.jsx(te,{item:!0,xs:12,sm:3,children:n.jsx(Te,{variant:"outlined",startIcon:n.jsx(Da,{}),onClick:F,fullWidth:!0,size:"small",children:o.t("historys.clearFilters")})})]})]})}),n.jsx(Ee,{children:n.jsx(nn,{children:n.jsxs(Yt,{children:[n.jsx(sn,{children:n.jsxs(ze,{children:[n.jsx($,{children:o.t("historys.user")}),n.jsx($,{children:o.t("historys.action")}),n.jsx($,{children:o.t("historys.entity")}),n.jsx($,{children:"Nom de l'entité"}),n.jsx($,{children:o.t("historys.timestamp")}),n.jsx($,{children:o.t("historys.details")})]})}),n.jsx(Kt,{children:k.length===0?n.jsx(ze,{children:n.jsx($,{colSpan:6,align:"center",children:n.jsx(y,{variant:"body1",color:"text.secondary",children:o.t("historys.noActivities")})})}):k.map(W=>n.jsxs(ze,{hover:!0,children:[n.jsx($,{children:n.jsx(y,{variant:"body2",fontWeight:"medium",children:W.user})}),n.jsx($,{children:n.jsx(Be,{icon:D(W.action),label:C.find(oe=>oe.value===W.action)?.label||W.action,color:K(W.action),size:"small",variant:"outlined"})}),n.jsx($,{children:n.jsx(y,{variant:"body2",textTransform:"capitalize",children:P.find(oe=>oe.value===W.entityType)?.label||W.entityType||"N/A"})}),n.jsx($,{children:n.jsx(y,{variant:"body2",fontWeight:"medium",children:W.entityName})}),n.jsx($,{children:n.jsx(y,{variant:"body2",color:"text.secondary",children:X(W.timestamp)})}),n.jsx($,{children:n.jsx(y,{variant:"body2",children:W.details})})]},W.id))})]})})})]})},fo=yt.memo(({activeSection:l,selectedChurch:u,user:c,permissions:p,refreshKey:b})=>{d.useEffect(()=>{o.init()},[]);const w=d.useMemo(()=>({stats:Sl,statsReseaux:Ll,statsCultes:Tl,statsMembres:Bl,statsPrevisionnel:El,statsAssistance:Pl,chaineImpact:kl,networks:Il,networksRecap:Ml,carousel:Al,users:Dl,usersRetired:Ol,churches:zl,departments:Nl,missionImplantation:dc,testimonies:uc,testimoniesCulte:hc,history:mc}),[])[l];return d.useMemo(()=>{if(!w)return n.jsx(f,{sx:{p:3,textAlign:"center"},children:n.jsx(y,{variant:"h6",color:"error",children:o.t("dashboard.menu.sectionNotFound")})});const C={active:l==="missionImplantation",selectedChurch:u,user:c,refreshKey:b};return n.jsx(f,{sx:{display:"block",width:"100%",overflow:"hidden"},children:n.jsx(w,{...C})})},[w,l,u,c])});fo.displayName="DashboardContent";const po=[{text:"Statistiques",icon:n.jsx(Ba,{}),children:[{id:"stats",text:o.t("menu.overview"),icon:n.jsx(Oa,{})},{id:"statsReseaux",text:o.t("menu.networks"),icon:n.jsx(Ra,{})},{id:"statsCultes",text:o.t("menu.services"),icon:n.jsx(za,{})},{id:"statsMembres",text:o.t("menu.members"),icon:n.jsx(Ci,{})},{id:"statsPrevisionnel",text:o.t("menu.forecasts"),icon:n.jsx(Na,{})},{id:"statsAssistance",text:o.t("menu.attendance"),icon:n.jsx(Ci,{})}]},{text:"Réseaux",icon:n.jsx(ps,{}),children:[{id:"networks",text:"Gestion des réseaux",icon:n.jsx(ps,{})},{id:"networksRecap",text:"Récapitulatif des effectifs",icon:n.jsx(Nr,{})},{id:"chaineImpact",text:"Chaine d'impact",icon:n.jsx(ps,{})}]},{text:"Membres",icon:n.jsx(Ci,{}),children:[{id:"users",text:"Gestion des membres",icon:n.jsx(Ci,{})},{id:"usersRetired",text:"Membres retirés",icon:n.jsx(Nr,{})}]},{text:"Mission et Implantation",icon:n.jsx(Br,{}),children:[{id:"missionImplantation",text:"Carte interactive",icon:n.jsx(Br,{})}]},{text:"Témoignages",icon:n.jsx(Wr,{}),children:[{id:"testimonies",text:"Gestion des témoignages",icon:n.jsx(Wa,{})},{id:"testimoniesCulte",text:"Témoignages de culte",icon:n.jsx(Wr,{})}]},{text:"Historique",icon:n.jsx(Fa,{}),children:[{id:"history",text:"Activités",icon:n.jsx(Za,{})}]},{text:"Configuration",icon:n.jsx(Ga,{}),children:[{id:"churches",text:"Églises",icon:n.jsx(Ha,{})},{id:"departments",text:"Départements",icon:n.jsx(Ua,{})},{id:"carousel",text:"Carousel",icon:n.jsx(qa,{})}]}],Ms=320,Yr=Ds(Ya)(({theme:l})=>({width:Ms,flexShrink:0,overflowX:"hidden","& .MuiDrawer-paper":{width:Ms,boxSizing:"border-box",backgroundColor:l.palette.primary.main,color:l.palette.primary.contrastText,overflowX:"hidden"}})),Cs=Ds(({active:l,...u})=>n.jsx(Va,{...u}))(({theme:l,active:u})=>({margin:"8px 16px",borderRadius:l.shape.borderRadius,backgroundColor:u?"rgba(255, 255, 255, 0.2)":"transparent",cursor:"pointer","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"},"& .MuiListItemIcon-root":{color:l.palette.primary.contrastText}})),fc=({activeSection:l,expandedItems:u,onSectionChange:c,onToggleExpanded:p,onLogout:b,mobileOpen:H,setMobileOpen:w,selectedChurch:B,setSelectedChurch:C,showChurchFilter:P,user:S,permissions:k})=>{d.useEffect(()=>{o.init()},[]),Ei();const{isManager:D,canAccessConfig:K}=Xt(),X=io(),F=x=>{x.children?p(x.text):c(x.id)},W=x=>{c(x.id)},oe=x=>{const v={Statistiques:o.t("dashboard.menu.statistics"),Réseaux:o.t("dashboard.menu.networks"),Membres:o.t("dashboard.menu.members"),"Mission et Implantation":o.t("dashboard.menu.mission"),Configuration:o.t("dashboard.menu.configuration"),"Vue d'ensemble":o.t("dashboard.menu.overview"),Cultes:o.t("dashboard.menu.services"),"Gestion des réseaux":o.t("dashboard.menu.networkManagement"),"Récapitulatif des effectifs":o.t("dashboard.menu.networkRecap"),"Gestion des membres":o.t("dashboard.menu.memberManagement"),"Membres retirés":o.t("dashboard.menu.retiredMembers"),"Carte interactive":o.t("dashboard.menu.interactiveMap"),Églises:o.t("dashboard.menu.churches"),Départements:o.t("dashboard.menu.departments"),Carousel:o.t("dashboard.menu.carousel"),Historique:o.t("dashboard.menu.history"),Activités:o.t("dashboard.menu.activities")};return{...x,text:v[x.text]||x.text,children:x.children?x.children.map(_=>({..._,text:v[_.text]||_.text})):void 0}},ee=po.filter(x=>!(x.text==="Configuration"&&!K)).map(oe),J=n.jsxs("div",{children:[n.jsx(Qr,{children:n.jsx(y,{variant:"h4",noWrap:!0,sx:{color:"white",fontWeight:"bold",letterSpacing:2,py:2,cursor:"pointer"},onClick:()=>window.location.reload(),children:D?o.t("dashboard.menu.management"):o.t("dashboard.menu.administration")})}),n.jsx(Xr,{sx:{bgcolor:"rgba(255,255,255,0.12)"}}),n.jsxs(Zr,{children:[ee.map(x=>n.jsxs(yt.Fragment,{children:[n.jsxs(Cs,{active:l===x.id?1:0,onClick:()=>F(x),children:[n.jsx(gs,{children:x.icon}),n.jsx(xs,{primary:x.text,sx:{"& .MuiListItemText-primary":{color:"white",fontWeight:"bold"}}}),x.children&&n.jsx(Ss,{sx:{color:"white",marginLeft:"auto",marginRight:"9px",transition:"transform 0.2s",transform:u.includes(x.text)?"rotate(0deg)":"rotate(-90deg)"}})]}),x.children&&n.jsx(Ls,{in:u.includes(x.text),timeout:"auto",unmountOnExit:!0,children:n.jsx(Zr,{component:"div",disablePadding:!0,children:x.children.map(v=>n.jsxs(Cs,{sx:{pl:4,background:l===v.id?"rgba(255,255,255,0.15)":"transparent"},active:l===v.id?1:0,onClick:()=>W(v),children:[n.jsx(gs,{children:v.icon}),n.jsx(xs,{primary:v.text,sx:{"& .MuiListItemText-primary":{color:"white"}}})]},v.id))})})]},x.text||x.id)),n.jsxs(Cs,{onClick:()=>X("/"),children:[n.jsx(gs,{children:n.jsx($a,{})}),n.jsx(xs,{primary:o.t("dashboard.menu.backToSite"),sx:{"& .MuiListItemText-primary":{color:"white",fontWeight:"bold"}}})]})]})]});return n.jsxs(f,{component:"nav",sx:{width:{sm:Ms},flexShrink:{sm:0}},children:[n.jsx(Yr,{variant:"temporary",open:H,onClose:()=>w(!1),ModalProps:{keepMounted:!0},sx:{display:{xs:"block",sm:"none"}},children:J}),n.jsx(Yr,{variant:"permanent",sx:{display:{xs:"none",sm:"block"}},open:!0,children:J})]})},Kr=320,pc=Ds(f)(({theme:l})=>({flexGrow:1,padding:l.spacing(3),marginTop:64,backgroundColor:"#f5f5f5",minHeight:"100vh",width:"100%",overflow:"hidden",overflowY:"hidden",boxSizing:"border-box"})),kc=()=>{const{user:l}=el(ie=>ie.auth),u=Xt(),{churches:c}=yl(),{selectedChurch:p,changeSelectedChurch:b}=Os(),H=io(),w=tl(),[B,C]=d.useState("stats"),[P,S]=d.useState([o.t("dashboard.expandedItems")]),[k,D]=d.useState(!1),[K,X]=d.useState(0),[F,W]=d.useState(!1),[oe,ee]=d.useState({unread_count:0}),[J,x]=d.useState(!1),[v,_]=d.useState(null),V=ie=>{C(ie),window.location.hash=ie;const Q=po.find(pe=>pe.children&&pe.children.some(ne=>ne.id===ie));if(Q){const ne={Statistiques:o.t("dashboard.menu.statistics"),Réseaux:o.t("dashboard.menu.networks"),Membres:o.t("dashboard.menu.members"),"Mission et Implantation":o.t("dashboard.menu.mission"),Configuration:o.t("dashboard.menu.configuration")}[Q.text]||Q.text;S(ce=>[ne])}},I=ie=>{S(Q=>Q.includes(ie)?Q.filter(pe=>pe!==ie):[ie])},A=()=>{w(pl()),H("/login")},N=ie=>{_(ie.currentTarget)},R=()=>{_(null)},q=ie=>{b(ie),X(Q=>Q+1)},E=()=>{W(!0)},j=()=>{W(!1)},Y=async()=>{if(l){x(!0);try{const ie=await fl.getMessageStats();ie.success&&ee(ie.data||{unread_count:0})}catch{}finally{x(!1)}}};return d.useEffect(()=>{Y()},[l]),u.canAccessDashboard?n.jsx(ki,{allowedRoles:["SUPER_ADMIN","ADMIN","MANAGER"],children:n.jsxs(f,{sx:{display:"flex",width:"100%",overflow:"hidden",overflowY:"hidden"},children:[n.jsx(Ka,{position:"fixed",sx:{width:{sm:`calc(100% - ${Kr}px)`},ml:{sm:`${Kr}px`}},children:n.jsxs(Qr,{children:[n.jsx(Ie,{color:"inherit",edge:"start",onClick:()=>D(!k),sx:{mr:2,display:{sm:"none"}},children:n.jsx(Xa,{})}),n.jsx(y,{sx:{color:"white",flexGrow:1},variant:"h6",noWrap:!0,children:o.t("dashboard.title")}),!u.isManager&&c.length>0&&n.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:2,mr:2},children:[n.jsxs(y,{variant:"body2",sx:{color:"white"},children:[o.t("dashboard.church")," :"]}),n.jsx(Fe,{size:"small",sx:{minWidth:200},children:n.jsxs(He,{id:"dashboard-church-select",name:"church",value:p?.id||p?._id||"",onChange:ie=>q(ie.target.value),displayEmpty:!0,autoComplete:"off",renderValue:ie=>{if(!ie){const pe=typeof l?.eglise_locale=="object"?l.eglise_locale.id||l.eglise_locale._id:l?.eglise_locale,ne=c.find(ce=>(ce.id||ce._id)===pe);return ne?ne.nom:o.t("dashboard.selectChurch")}const Q=c.find(pe=>(pe.id||pe._id)===ie);return Q?Q.nom:o.t("dashboard.selectChurch")},sx:{backgroundColor:"rgba(255, 255, 255, 0.37)",color:"text.primary",backdropFilter:"blur(10px)","& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.11)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.39)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.49)"}},children:[n.jsx(we,{value:"",disabled:!0,children:n.jsx(y,{sx:{color:"rgba(0, 0, 0, 0.5)",fontStyle:"italic"},children:o.t("dashboard.selectChurch")})}),c.map(ie=>n.jsx(we,{value:ie.id||ie._id,children:ie.nom},ie.id||ie._id))]})})]}),n.jsx(Be,{label:ul(l?.current_role||l?.role)||o.t("dashboard.defaultRole"),sx:{backgroundColor:"rgba(255,255,255,0.2)",color:"white",border:"1px solid rgba(255,255,255,0.3)",mr:2},size:"small"}),n.jsx(Ie,{color:"inherit",onClick:E,sx:{ml:1},title:o.t("navigation.messaging"),children:n.jsx(Ja,{badgeContent:oe.unread_count,color:"error",invisible:oe.unread_count===0,children:n.jsx(Qa,{})})}),n.jsx(hl,{anchorEl:v,onMenuOpen:N,onMenuClose:R})]})}),n.jsx(fc,{activeSection:B,expandedItems:P,onSectionChange:V,onToggleExpanded:I,onLogout:A,mobileOpen:k,setMobileOpen:D,selectedChurch:p,setSelectedChurch:b,showChurchFilter:!u.isManager,user:l,permissions:u}),n.jsx(pc,{children:n.jsx(fo,{activeSection:B,selectedChurch:p,user:l,permissions:u,showChurchFilter:!1,refreshKey:K})}),n.jsx(ml,{open:F,onClose:j})]})}):n.jsx(f,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:n.jsx(y,{variant:"h4",color:"error",children:o.t("dashboard.unauthorized")})})};export{kc as default};
