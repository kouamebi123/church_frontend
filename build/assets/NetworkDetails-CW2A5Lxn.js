import{r as d,j as e,u as ee,v as se,T as l,w as te,B as c,G as E,i as v,M as I,al as de,A as xe,aT as re,aU as he,x as ae,n as R,C as ne,aV as ys,U as Fe,I as J,aW as _s,a2 as lt,a3 as ts,aX as rs,X as as,S as Cs,z as ot,aY as is,D as oe,g as dt,h as ze,aZ as ct,a_ as ut,l as we,O as ws,a$ as mt,aS as ns,b0 as pt,ag as xt,aP as ht,F as ls,s as os,t as ds}from"./mui-mRVmBbre.js";import{n as ks,i as t,l as Ue,o as bt,b as gt,c as ft,L as vt,N as jt,p as cs,G as us,T as ms,C as ps,S as xs,g as hs,Q as bs,a as P,h as yt,m as _t,y as pe}from"./index-D-mMtbrf.js";import{A as Ct}from"./AccessControl-Bo8DCupw.js";import{S as wt}from"./SecureErrorMessage-Cj_XzH0g.js";import{D as gs}from"./DeleteConfirmDialog-BMl_w2SS.js";import{p as Se,a as Le,f as ke}from"./themeService-CEWGMAly.js";import{f as fs}from"./utils-DP_tgNw_.js";import{f as vs}from"./fr-CiOJZWTq.js";import"./preferencesService-CpvhBlZK.js";import{d as kt}from"./router-BwhLjOj0.js";import"./vendor-Bzgz95E1.js";import"./redux-DbjaNwcH.js";const Ft=({open:p,onClose:$,onSave:k,networkData:_,isLoading:C=!1})=>{const[n,z]=d.useState({date:new Date,type_culte:"",groupes_previsions:{}}),[g,K]=d.useState(0),[G,Q]=d.useState({});d.useEffect(()=>{if(_?.grs&&Array.isArray(_.grs)){const x={};_.grs.forEach(F=>{const D=F.members?.length||0,U=F.nom||`GR ${F.responsable1?.username?.split(" ")[0]||"Sans nom"}${F.responsable2?.username?` & ${F.responsable2?.username?.split(" ")[0]}`:""}`;x[F.id]={id:F.id,nom:U,effectif_actuel:D,valeur_previsionnelle:D}}),z(F=>({...F,groupes_previsions:x}))}},[_]),d.useEffect(()=>{const x=Object.values(n.groupes_previsions).reduce((F,D)=>F+(parseInt(D.valeur_previsionnelle)||0),0);K(x)},[n.groupes_previsions]);const H=(x,F)=>{const D=parseInt(F)||0;z(U=>({...U,groupes_previsions:{...U.groupes_previsions,[x]:{...U.groupes_previsions[x],valeur_previsionnelle:D}}}))},A=()=>{const x={};return n.date||(x.date=t.t("errors.validation.dateRequired")),n.type_culte||(x.type_culte=t.t("errors.validation.typeCulteRequired")),Object.values(n.groupes_previsions).some(D=>(parseInt(D.valeur_previsionnelle)||0)>0)||(x.previsions=t.t("previsionnel.errors.noPrevision")),Q(x),Object.keys(x).length===0},u=()=>{if(!A())return;const x=g+(n.invites||0),F={date:n.date.toISOString(),type_culte:n.type_culte,total_prevu:x,invites:n.invites||0,network_id:_.reseau.id,church_id:_.reseau.church_id||_.reseau.eglise_id,groupes_previsions:Object.values(n.groupes_previsions).map(D=>({group_id:D.id,effectif_actuel:D.effectif_actuel,valeur_previsionnelle:D.valeur_previsionnelle}))};k(F)},Y=()=>{Q({}),$()},V=ks.filter(x=>x.value!=="Tous");return e.jsxs(ee,{open:p,onClose:Y,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{height:"90vh",borderRadius:"24px",boxShadow:"0 20px 60px rgba(102, 45, 145, 0.15)",background:"rgba(255, 255, 255, 0.98)",backdropFilter:"blur(20px)",border:"2px solid rgba(102, 45, 145, 0.1)"}},children:[e.jsxs(se,{sx:{borderBottom:"2px solid rgba(102, 45, 145, 0.1)",background:"linear-gradient(145deg, #FFFFFF 0%, #F5F3FF 100%)"},children:[e.jsx(l,{variant:"h5",component:"div",sx:{fontWeight:700,background:"linear-gradient(135deg, rgb(59, 20, 100) 0%, #662d91 50%, #9e005d 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",mb:.5},children:t.t("previsionnel.modal.title")}),e.jsxs(l,{variant:"body2",color:"text.secondary",sx:{fontWeight:500},children:[t.t("previsionnel.modal.subtitle")," - ",_?.reseau?.nom]})]}),e.jsxs(te,{dividers:!0,sx:{p:3},children:[e.jsx(c,{component:"form",sx:{mb:3},children:e.jsxs(E,{container:!0,spacing:3,children:[e.jsx(E,{item:!0,xs:12,md:6,children:e.jsx(v,{fullWidth:!0,id:"previsionnel-form-date",name:"date",type:"date",label:t.t("previsionnel.form.date"),value:n.date?n.date.toISOString().split("T")[0]:"",onChange:x=>z(F=>({...F,date:new Date(x.target.value)})),error:!!G.date,helperText:G.date,required:!0,InputLabelProps:{shrink:!0},sx:{minWidth:200},autoComplete:"off"})}),e.jsx(E,{item:!0,xs:12,md:6,children:e.jsx(v,{select:!0,fullWidth:!0,id:"previsionnel-form-type-culte",name:"type_culte",label:t.t("previsionnel.form.typeCulte"),value:n.type_culte,onChange:x=>z(F=>({...F,type_culte:x.target.value})),error:!!G.type_culte,helperText:G.type_culte,required:!0,sx:{minWidth:200},autoComplete:"off",children:V.map(x=>e.jsx(I,{value:x.value,children:x.label},x.value))})})]})}),e.jsx(de,{sx:{my:3}}),G.previsions&&e.jsx(xe,{severity:"error",sx:{mb:3},children:G.previsions}),e.jsxs(c,{sx:{mb:3},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:t.t("previsionnel.form.groupes")}),e.jsx(l,{variant:"body2",color:"text.secondary",sx:{mb:2},children:t.t("previsionnel.form.groupesDescription")}),e.jsx(E,{container:!0,spacing:2,children:Object.values(n.groupes_previsions).map(x=>e.jsx(E,{item:!0,xs:12,sm:6,md:4,children:e.jsx(re,{variant:"outlined",sx:{height:"100%",borderRadius:"16px",border:"2px solid rgba(102, 45, 145, 0.1)",background:"linear-gradient(145deg, #FFFFFF 0%, #F5F3FF 100%)",boxShadow:"0 4px 12px rgba(102, 45, 145, 0.08)",transition:"all 0.3s ease","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 24px rgba(102, 45, 145, 0.15)",borderColor:"primary.main"}},children:e.jsxs(he,{children:[e.jsx(l,{variant:"subtitle1",gutterBottom:!0,children:x.nom}),e.jsx(c,{sx:{mb:2},children:e.jsxs(l,{variant:"body2",color:"text.secondary",children:[t.t("previsionnel.form.totalMembres")," : ",e.jsx("strong",{children:x.effectif_actuel})]})}),e.jsx(v,{fullWidth:!0,id:`previsionnel-form-groupe-${x.id}`,name:`groupe_${x.id}`,type:"number",variant:"outlined",label:t.t("previsionnel.form.valeurPrevisionnelle"),value:x.valeur_previsionnelle,onChange:F=>H(x.id,F.target.value),inputProps:{min:0},size:"small",autoComplete:"off"})]})})},x.id))})]}),e.jsx(de,{sx:{my:3}}),e.jsxs(c,{sx:{mb:3},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:t.t("previsionnel.form.invites")}),e.jsx(l,{variant:"body2",color:"text.secondary",sx:{mb:2},children:t.t("previsionnel.form.invitesDescription")}),e.jsx(v,{fullWidth:!0,id:"previsionnel-form-invites",name:"invites",type:"number",label:t.t("previsionnel.form.nombreInvites"),value:n.invites||0,onChange:x=>z(F=>({...F,invites:parseInt(x.target.value)||0})),inputProps:{min:0},sx:{maxWidth:300},autoComplete:"off"})]}),e.jsx(de,{sx:{my:3}})]}),e.jsxs(ae,{sx:{p:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(l,{variant:"h6",sx:{fontWeight:"bold"},children:[t.t("previsionnel.form.totalPrevisionnel")," : ",e.jsx("strong",{children:g+(n.invites||0)})]}),e.jsxs(c,{children:[e.jsx(R,{onClick:Y,disabled:C,sx:{mr:1},children:t.t("common.actions.cancel")}),e.jsx(R,{variant:"contained",onClick:u,disabled:C||g+(n.invites||0)===0,children:C?t.t("common.actions.loading"):t.t("previsionnel.form.save")})]})]})]})},St=({open:p,onClose:$,networkData:k,onSave:_,isLoading:C=!1})=>{const[n,z]=d.useState({date:new Date().toISOString().split("T")[0],type_culte:"",groupes_assistance:{},invites:0}),[g,K]=d.useState(!1),[G,Q]=d.useState(null),[H,A]=d.useState(null),[u,Y]=d.useState(0);d.useEffect(()=>{if(p&&k?.grs&&Array.isArray(k.grs)){const h={};k.grs.forEach(f=>{const O=f.members?.length||0,T=f.nom||`GR ${f.responsable1?.username?.split(" ")[0]||"Sans nom"}${f.responsable2?.username?` & ${f.responsable2?.username?.split(" ")[0]}`:""}`;h[f.id]={id:f.id,nom:T,effectif_actuel:O,nombre_presents:O}}),z(f=>({...f,groupes_assistance:h}))}},[p,k]),d.useEffect(()=>{(async()=>{if(n.date&&n.type_culte&&k?.reseau?.id)try{const f=await Se.getStats({network_id:k.reseau.id,date_from:n.date,date_to:n.date,type_culte:n.type_culte});f.data&&f.data.details&&f.data.details.length>0?A(f.data.details[0]):A(null)}catch{A(null)}})()},[n.date,n.type_culte,k?.reseau?.id]),d.useEffect(()=>{const h=Object.values(n.groupes_assistance).reduce((f,O)=>f+(O.nombre_presents||0),0);Y(h)},[n.groupes_assistance]);const V=(h,f)=>{z(O=>({...O,[h]:f}))},x=(h,f,O)=>{z(T=>({...T,groupes_assistance:{...T.groupes_assistance,[h]:{...T.groupes_assistance[h],[f]:O}}}))},F=async()=>{K(!0),Q(null);try{if(!n.date||!n.type_culte)throw new Error("Veuillez remplir tous les champs obligatoires");if(u===0)throw new Error("Veuillez saisir au moins un présent");const h={date:new Date(n.date).toISOString(),type_culte:n.type_culte,total_presents:u+(n.invites||0),invites:n.invites||0,network_id:k.reseau.id,church_id:k.reseau.church_id||k.reseau.eglise_id,groupes_assistance:Object.values(n.groupes_assistance).map(f=>({group_id:f.id,effectif_actuel:f.effectif_actuel,nombre_presents:f.nombre_presents}))};_(h)}catch(h){Q(h.response?.data?.message||h.message||"Erreur lors de l'enregistrement")}finally{K(!1)}},D=()=>{Q(null),A(null),$()},U=H?u-H.previsionnel:null,L=ks.filter(h=>h.value!=="Tous");return e.jsxs(ee,{open:p,onClose:D,maxWidth:"lg",fullWidth:!0,PaperProps:{sx:{height:"90vh",borderRadius:"24px",boxShadow:"0 20px 60px rgba(102, 45, 145, 0.15)",background:"rgba(255, 255, 255, 0.98)",backdropFilter:"blur(20px)",border:"2px solid rgba(102, 45, 145, 0.1)"}},children:[e.jsxs(se,{sx:{borderBottom:"2px solid rgba(102, 45, 145, 0.1)",background:"linear-gradient(145deg, #FFFFFF 0%, #F5F3FF 100%)"},children:[e.jsx(l,{variant:"h5",component:"div",sx:{fontWeight:700,background:"linear-gradient(135deg, rgb(59, 20, 100) 0%, #662d91 50%, #9e005d 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",mb:.5},children:t.t("assistance.form.title")}),e.jsxs(l,{variant:"body2",color:"text.secondary",sx:{fontWeight:500},children:[t.t("assistance.form.subtitle")," - ",k?.reseau?.nom]})]}),e.jsxs(te,{dividers:!0,sx:{p:3},children:[e.jsx(c,{component:"form",sx:{mb:3},children:e.jsxs(E,{container:!0,spacing:3,children:[e.jsx(E,{item:!0,xs:12,md:6,children:e.jsx(v,{fullWidth:!0,id:"assistance-form-date",name:"date",type:"date",label:t.t("assistance.form.date"),value:n.date,onChange:h=>V("date",h.target.value),InputLabelProps:{shrink:!0},sx:{minWidth:200},autoComplete:"off"})}),e.jsx(E,{item:!0,xs:12,md:6,children:e.jsx(v,{select:!0,fullWidth:!0,id:"assistance-form-type-culte",name:"type_culte",label:t.t("assistance.form.typeCulte"),value:n.type_culte,onChange:h=>V("type_culte",h.target.value),sx:{minWidth:200},autoComplete:"off",children:L.map(h=>e.jsx(I,{value:h.value,children:h.label},h.value))})})]})}),e.jsx(de,{sx:{my:3}}),G&&e.jsx(xe,{severity:"error",sx:{mb:3},children:G}),e.jsxs(c,{sx:{mb:3},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:t.t("assistance.form.groupes")}),e.jsx(l,{variant:"body2",color:"text.secondary",sx:{mb:2},children:t.t("assistance.form.groupesDescription")}),e.jsx(E,{container:!0,spacing:2,children:Object.values(n.groupes_assistance).map(h=>e.jsx(E,{item:!0,xs:12,sm:6,md:4,children:e.jsx(re,{variant:"outlined",sx:{height:"100%",borderRadius:"16px",border:"2px solid rgba(102, 45, 145, 0.1)",background:"linear-gradient(145deg, #FFFFFF 0%, #F5F3FF 100%)",boxShadow:"0 4px 12px rgba(102, 45, 145, 0.08)",transition:"all 0.3s ease","&:hover":{transform:"translateY(-4px)",boxShadow:"0 8px 24px rgba(102, 45, 145, 0.15)",borderColor:"primary.main"}},children:e.jsxs(he,{children:[e.jsx(l,{variant:"subtitle1",gutterBottom:!0,children:h.nom}),e.jsx(c,{sx:{mb:2},children:e.jsxs(l,{variant:"body2",color:"text.secondary",children:[t.t("assistance.form.totalMembres")," : ",e.jsx("strong",{children:h.effectif_actuel})]})}),e.jsx(v,{fullWidth:!0,id:`assistance-form-groupe-${h.id}`,name:`groupe_${h.id}`,type:"number",variant:"outlined",label:t.t("assistance.form.nombrePresents"),value:h.nombre_presents||"",onChange:f=>x(h.id,"nombre_presents",parseInt(f.target.value)||0),inputProps:{min:0,max:h.effectif_actuel},size:"small",autoComplete:"off"})]})})},h.id))})]}),e.jsx(de,{sx:{my:3}}),e.jsxs(c,{sx:{mb:3},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:t.t("assistance.form.invites")}),e.jsx(l,{variant:"body2",color:"text.secondary",sx:{mb:2},children:t.t("assistance.form.invitesDescription")}),e.jsx(v,{fullWidth:!0,id:"assistance-form-invites",name:"invites",type:"number",label:t.t("assistance.form.nombreInvites"),value:n.invites||0,onChange:h=>z(f=>({...f,invites:parseInt(h.target.value)||0})),inputProps:{min:0},sx:{maxWidth:300},autoComplete:"off"})]}),e.jsx(de,{sx:{my:3}}),H&&e.jsxs(c,{sx:{mb:3},children:[e.jsx(l,{variant:"h6",gutterBottom:!0,children:t.t("assistance.form.comparisonTitle")}),e.jsx(l,{variant:"body2",color:"text.secondary",sx:{mb:2},children:t.t("assistance.form.comparisonDescription")}),e.jsxs(E,{container:!0,spacing:2,children:[e.jsx(E,{item:!0,xs:12,sm:4,children:e.jsxs(re,{variant:"outlined",sx:{p:2.5,textAlign:"center",borderRadius:"16px",border:"2px solid rgba(102, 45, 145, 0.2)",background:"linear-gradient(145deg, #FFFFFF 0%, #F5F3FF 100%)",boxShadow:"0 4px 12px rgba(102, 45, 145, 0.08)"},children:[e.jsx(l,{variant:"body2",color:"text.secondary",sx:{fontWeight:600},children:t.t("assistance.form.previsionnel")}),e.jsx(l,{variant:"h6",color:"primary",children:H.previsionnel})]})}),e.jsx(E,{item:!0,xs:12,sm:4,children:e.jsxs(re,{variant:"outlined",sx:{p:2.5,textAlign:"center",borderRadius:"16px",border:"2px solid rgba(16, 185, 129, 0.2)",background:"linear-gradient(145deg, #FFFFFF 0%, #ECFDF5 100%)",boxShadow:"0 4px 12px rgba(16, 185, 129, 0.08)"},children:[e.jsx(l,{variant:"body2",color:"text.secondary",sx:{fontWeight:600},children:t.t("assistance.form.presents")}),e.jsx(l,{variant:"h6",color:"success.main",children:u})]})}),e.jsx(E,{item:!0,xs:12,sm:4,children:e.jsxs(re,{variant:"outlined",sx:{p:2.5,textAlign:"center",borderRadius:"16px",border:"2px solid rgba(59, 130, 246, 0.2)",background:"linear-gradient(145deg, #FFFFFF 0%, #EFF6FF 100%)",boxShadow:"0 4px 12px rgba(59, 130, 246, 0.08)"},children:[e.jsx(l,{variant:"body2",color:"text.secondary",sx:{fontWeight:600},children:t.t("assistance.form.ecart")}),e.jsx(ne,{label:U>=0?`+${U}`:U,color:U>=0?"success":"error",size:"medium"})]})})]})]})]}),e.jsxs(ae,{sx:{p:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(l,{variant:"h6",sx:{fontWeight:"bold"},children:[t.t("assistance.form.totalPresents")," : ",e.jsx("strong",{children:u+(n.invites||0)}),n.invites>0&&e.jsxs(l,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:["(",u," membres + ",n.invites," invités)"]})]}),e.jsxs(c,{children:[e.jsx(R,{onClick:D,disabled:C,sx:{mr:1},children:t.t("common.actions.cancel")}),e.jsx(R,{variant:"contained",onClick:F,disabled:C||u===0,children:C?t.t("common.actions.loading"):t.t("assistance.form.save")})]})]})]})},It=({open:p,onClose:$,networkData:k})=>{const[_,C]=d.useState(0),[n,z]=d.useState(!1),[g,K]=d.useState([]),[G,Q]=d.useState([]),[H,A]=d.useState(null),[u,Y]=d.useState({open:!1,type:null,item:null,title:"",content:""}),[V,x]=d.useState({open:!1,message:"",severity:"success"});d.useEffect(()=>{p&&k?.reseau?.id&&F()},[p,k]),d.useEffect(()=>{if(p){const m=setTimeout(()=>{const M=document.querySelector('[role="dialog"]');M&&M.focus()},100);return()=>clearTimeout(m)}},[p]);const F=async()=>{if(k?.reseau?.id){z(!0),A(null);try{const m=await Se.getStats({network_id:k.reseau.id,limit:50}),M=await Le.getStats({network_id:k.reseau.id,limit:50}),B=m.data?.details||m.data?.data||[],ie=M.data?.details||M.data?.data||[];K(B),Q(ie)}catch(m){Ue.error("Erreur lors du chargement de l'historique:",m),A(t.t("history.loadingError"))}finally{z(!1)}}},D=async()=>{if(u.item)try{if(u.type==="previsionnel"){const m=u.item.id;if(!m){x({open:!0,message:"ID du prévisionnel manquant",severity:"error"});return}await Se.delete(m),K(M=>M.filter(B=>B.id!==m)),x({open:!0,message:t.t("history.deletePrevisionnelSuccess"),severity:"success"})}else if(u.type==="assistance"){const m=u.item.id;if(!m){x({open:!0,message:"ID de l'assistance manquant",severity:"error"});return}await Le.delete(m),Q(M=>M.filter(B=>B.id!==m)),x({open:!0,message:t.t("history.deleteAssistanceSuccess"),severity:"success"})}Y({open:!1,type:null,item:null,title:"",content:""})}catch(m){Ue.error("❌ Erreur lors de la suppression:",m),x({open:!0,message:t.t("history.deleteError"),severity:"error"})}},U=(m,M)=>{const B=m==="previsionnel",ie=fs(new Date(M.date),"dd/MM/yyyy",{locale:vs}),Ie=M.type_culte||t.t("history.defaultCulteType");Y({open:!0,type:m,item:M,title:`Supprimer ${B?"le prévisionnel":"l'assistance"}`,content:`Êtes-vous sûr de vouloir supprimer ${B?"le prévisionnel":"l'assistance"} du ${ie} (${Ie}) ?`})},L=()=>{x(m=>({...m,open:!1}))},h=m=>{try{return fs(new Date(m),"dd/MM/yyyy",{locale:vs})}catch{return m}},f=m=>({CULTE_DIMANCHE:t.t("previsionnel.form.typeCulte.dimanche"),CULTE_MERCREDI:t.t("previsionnel.form.typeCulte.mercredi"),CULTE_VENDREDI:t.t("previsionnel.form.typeCulte.vendredi"),CULTE_SPECIAL:t.t("previsionnel.form.typeCulte.special"),REUNION_PRIERE:t.t("previsionnel.form.typeCulte.reunionPriere"),ETUDE_BIBLIQUE:t.t("previsionnel.form.typeCulte.etudeBiblique")})[m]||m,O=m=>e.jsx(re,{sx:{mb:1.5,borderRadius:"16px",border:"2px solid rgba(102, 45, 145, 0.1)",background:"linear-gradient(145deg, #FFFFFF 0%, #F5F3FF 100%)",boxShadow:"0 4px 12px rgba(102, 45, 145, 0.08)",transition:"all 0.3s ease","&:hover":{boxShadow:"0 8px 24px rgba(102, 45, 145, 0.15)",transform:"translateY(-2px)"}},children:e.jsx(he,{sx:{p:2},children:e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(is,{color:"primary",sx:{fontSize:"1.2rem"}}),e.jsxs(c,{children:[e.jsx(l,{variant:"subtitle1",color:"primary",sx:{fontSize:"1rem"},children:h(m.date)}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2,mt:.5},children:[e.jsx(ne,{label:f(m.type_culte),color:"primary",variant:"outlined",size:"small",sx:{fontSize:"0.8rem",fontWeight:"bold"}}),e.jsx(ne,{label:`${t.t("previsionnel.form.totalMembres")} : ${m.previsionnel||m.total_previsionnel||0}`,color:"primary",variant:"outlined",size:"small",sx:{fontSize:"0.8rem",fontWeight:"bold"}})]})]})]}),e.jsx(c,{sx:{display:"flex",gap:1},children:e.jsx(Fe,{title:t.t("common.actions.delete"),children:e.jsx(J,{color:"error",size:"small",onClick:()=>U("previsionnel",m),children:e.jsx(oe,{})})})})]})})}),T=m=>e.jsx(re,{sx:{mb:1.5,borderRadius:"16px",border:"2px solid rgba(16, 185, 129, 0.1)",background:"linear-gradient(145deg, #FFFFFF 0%, #ECFDF5 100%)",boxShadow:"0 4px 12px rgba(16, 185, 129, 0.08)",transition:"all 0.3s ease","&:hover":{boxShadow:"0 8px 24px rgba(16, 185, 129, 0.15)",transform:"translateY(-2px)"}},children:e.jsx(he,{sx:{p:2},children:e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(is,{color:"success",sx:{fontSize:"1.2rem"}}),e.jsxs(c,{children:[e.jsx(l,{variant:"subtitle1",color:"success.main",sx:{fontSize:"1rem"},children:h(m.date)}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2,mt:.5},children:[e.jsx(ne,{label:f(m.type_culte),color:"success",variant:"outlined",size:"small",sx:{fontSize:"0.8rem",fontWeight:"bold"}}),e.jsx(ne,{label:`${t.t("previsionnel.form.totalMembres")} : ${m.effectif_reel||m.total_presents||0}`,color:"success",variant:"outlined",size:"small",sx:{fontSize:"0.8rem",fontWeight:"bold"}})]})]})]}),e.jsx(c,{sx:{display:"flex",gap:1},children:e.jsx(Fe,{title:t.t("common.actions.delete"),children:e.jsx(J,{color:"error",size:"small",onClick:()=>U("assistance",m),children:e.jsx(oe,{})})})})]})})},m.id),be=()=>n?e.jsx(c,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(ot,{})}):H?e.jsx(xe,{severity:"error",sx:{m:2},children:H}):_===0?!Array.isArray(g)||g.length===0?e.jsxs(c,{sx:{textAlign:"center",p:4},children:[e.jsx(rs,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(l,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:t.t("previsionnel.dashboard.noData")}),e.jsx(l,{variant:"body2",color:"text.secondary",children:t.t("previsionnel.dashboard.noDataDescription")})]}):e.jsx(c,{sx:{p:2},children:g.map((m,M)=>e.jsx("div",{children:O(m)},m.id||`${m.date}-${m.type_culte}-${M}`))}):!Array.isArray(G)||G.length===0?e.jsxs(c,{sx:{textAlign:"center",p:4},children:[e.jsx(as,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(l,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:t.t("assistance.dashboard.noData")}),e.jsx(l,{variant:"body2",color:"text.secondary",children:t.t("assistance.dashboard.noDataDescription")})]}):e.jsx(c,{sx:{p:2},children:G.map((m,M)=>e.jsx("div",{children:T(m)},m.id||`${m.date}-${m.type_culte}-${M}`))});return e.jsxs(e.Fragment,{children:[e.jsxs(ee,{open:p,onClose:$,maxWidth:"lg",fullWidth:!0,disableEscapeKeyDown:!1,disableRestoreFocus:!1,keepMounted:!1,PaperProps:{sx:{minHeight:"70vh",borderRadius:"24px",boxShadow:"0 20px 60px rgba(102, 45, 145, 0.15)",background:"rgba(255, 255, 255, 0.98)",backdropFilter:"blur(20px)",border:"2px solid rgba(102, 45, 145, 0.1)"}},children:[e.jsx(se,{sx:{borderBottom:"2px solid rgba(102, 45, 145, 0.1)",background:"linear-gradient(145deg, #FFFFFF 0%, #F5F3FF 100%)"},children:e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(l,{variant:"h5",sx:{display:"flex",alignItems:"center",gap:1,fontWeight:700,background:"linear-gradient(135deg, rgb(59, 20, 100) 0%, #662d91 50%, #9e005d 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:[e.jsx(ys,{sx:{color:"#662d91"}}),t.t("home.historyOfCultes")]}),e.jsx(c,{sx:{display:"flex",gap:1},children:e.jsx(Fe,{title:t.t("common.actions.refresh"),children:e.jsx(J,{onClick:F,disabled:n,children:e.jsx(_s,{})})})})]})}),e.jsxs(te,{children:[e.jsx(c,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:e.jsxs(lt,{value:_,onChange:(m,M)=>C(M),sx:{mb:-1},children:[e.jsx(ts,{label:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(rs,{fontSize:"small"}),t.t("home.previsions")," (",Array.isArray(g)?g.length:0,")"]})}),e.jsx(ts,{label:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(as,{fontSize:"small"}),t.t("home.assistance")," (",Array.isArray(G)?G.length:0,")"]})})]})}),be()]}),e.jsx(ae,{children:e.jsx(R,{onClick:$,color:"primary",children:t.t("common.close")})})]}),e.jsxs(ee,{open:u.open,onClose:()=>Y({open:!1,type:null,item:null,title:"",content:""}),disableEscapeKeyDown:!1,disableRestoreFocus:!1,keepMounted:!1,children:[e.jsx(se,{children:u.title}),e.jsx(te,{children:e.jsx(l,{children:u.content})}),e.jsxs(ae,{children:[e.jsx(R,{onClick:()=>Y({open:!1,type:null,item:null,title:"",content:""}),children:t.t("common.actions.cancel")}),e.jsx(R,{onClick:D,color:"error",variant:"contained",children:t.t("common.actions.delete")})]})]}),e.jsx(Cs,{open:V.open,autoHideDuration:4e3,onClose:L,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(xe,{onClose:L,severity:V.severity,sx:{width:"100%"},children:V.message})})]})},At=ws(re)(({theme:p})=>({height:"100%",display:"flex",flexDirection:"column",background:"linear-gradient(145deg, #FFFFFF 0%, #F5F3FF 100%)",borderRadius:"20px",border:"1px solid rgba(102, 45, 145, 0.1)",boxShadow:"0 4px 20px rgba(102, 45, 145, 0.08)",transition:"all 0.4s cubic-bezier(0.4, 0, 0.2, 1)",overflow:"hidden","&:hover":{transform:"translateY(-8px) scale(1.02)",boxShadow:"0 15px 50px rgba(102, 45, 145, 0.18)"}})),Ne=ws(ze)(({theme:p})=>({padding:p.spacing(2),textAlign:"center",height:"100%",minWidth:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:p.spacing(1),background:"linear-gradient(145deg, #FFFFFF 0%, #F5F3FF 100%)",borderRadius:"16px",border:"1px solid rgba(102, 45, 145, 0.1)",boxShadow:"0 4px 16px rgba(102, 45, 145, 0.08)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)","&:hover":{transform:"translateY(-6px)",boxShadow:"0 12px 32px rgba(102, 45, 145, 0.15)"}})),Mt=p=>[{key:"12",label:"12",value:p[12]||0},{key:"144",label:"144",value:p[144]||0},{key:"1728",label:"1728",value:p[1728]||0},{key:"totalGroups",label:t.t("networks.details.stats.totalGroups"),value:p.totalGroups||0},{key:"Responsables de GR",label:t.t("networks.details.stats.groupResponsibles"),value:p["Responsables de GR"]||0},{key:"Leader",label:t.t("networks.details.stats.leaders"),value:p.Leader||0},{key:"Leader (Tous)",label:t.t("networks.details.stats.allLeaders"),value:p["Leader (Tous)"]||0},{key:"Membre simple",label:t.t("networks.details.stats.simpleMembers"),value:p["Membre simple"]||0}].filter($=>$.value>0),js=p=>{if(!p)return"";const $=_t.map(n=>n.value),k=p.split(" "),_=k[0];return $.includes(_)?k.length>=2?k[1]:_:k[0]},$t=()=>{const{user:p,isAuthenticated:$}=bt(),{id:k}=kt(),{selectedChurch:_}=gt();d.useEffect(()=>{t.init()},[]);const{canCreateGroups:C,canUpdateGroups:n,canDeleteGroups:z,canUpdateUsers:g,isAdmin:K,isManager:G,isSuperAdmin:Q,isCollecteurReseaux:H}=ft(),A={isAdmin:K,isManager:G,isSuperAdmin:Q,isCollecteurReseaux:H},u=s=>!s&&A.isAdmin?t.t("dashboard.members.permissions.adminReadOnly"):!s&&A.isManager?t.t("dashboard.members.permissions.managerFullRights"):"",[Y,V]=d.useState([]),[x,F]=d.useState([]),[D,U]=d.useState(null);d.useEffect(()=>{(async()=>{try{const[r,a]=await Promise.all([P.churches.getAll(),P.departments.getAll()]),i=r.data?.data||r.data||[],b=a.data?.data||a.data||[];V(Array.isArray(i)?i:[]),F(Array.isArray(b)?b:[])}catch{V([]),F([])}})()},[]);const[L,h]=d.useState(""),[f,O]=d.useState(""),[T,be]=d.useState(""),[m,M]=d.useState(""),[B,ie]=d.useState([]),[Ie,Ae]=d.useState(""),Fs=s=>{if(!s||!j)return[];const r=[],a=parseInt(s.replace("QUALIFICATION_",""));if(a===12)j.reseau?.responsable1&&r.push({id:j.reseau.responsable1.id||j.reseau.responsable1._id,username:j.reseau.responsable1.username,type:"network_responsible",label:`${j.reseau.responsable1.username} - ${t.t("networks.details.networkResponsible")}`}),j.reseau?.responsable2&&r.push({id:j.reseau.responsable2.id||j.reseau.responsable2._id,username:j.reseau.responsable2.username,type:"network_responsible",label:`${j.reseau.responsable2.username} - ${t.t("networks.details.networkResponsible")}`});else{const b=`QUALIFICATION_${a/12}`;(j.grs?.filter(o=>{const _e=o.responsable1?.qualification,Ce=o.responsable2?.qualification;return _e===b||Ce===b})||[]).forEach(o=>{o.responsable1&&o.responsable1.qualification===b&&r.push({id:o.responsable1.id||o.responsable1._id,username:o.responsable1.username,type:"group_responsible",qualification:o.responsable1.qualification,label:`${o.responsable1.username} - ${o.responsable1.qualification?.replace("QUALIFICATION_","")||t.t("networks.details.group")}`}),o.responsable2&&o.responsable2.qualification===b&&r.push({id:o.responsable2.id||o.responsable2._id,username:o.responsable2.username,type:"group_responsible",qualification:o.responsable2.qualification,label:`${o.responsable2.username} - ${o.responsable2.qualification?.replace("QUALIFICATION_","")||t.t("networks.details.group")}`})})}return r},ge=()=>{h(""),O(""),be(""),M(""),ie([]),Ae("")},[Ss,fe]=d.useState(!1),[Is,ve]=d.useState(!1),[As,je]=d.useState(!1),[le,ce]=d.useState(!1),[Z,Me]=d.useState(null),[ue,We]=d.useState(null),[Ms,Re]=d.useState(!1),[Ws,Ee]=d.useState(!1),[Rs,Be]=d.useState(!1),[Es,$e]=d.useState(!1),[Ds,Qe]=d.useState(!1),[me,S]=d.useState({open:!1,message:"",severity:"info"}),[y,q]=d.useState({username:"",pseudo:"",email:"",password:"",role:"MEMBRE",genre:"",tranche_age:"",profession:"",ville_residence:"",origine:"",situation_matrimoniale:"",niveau_education:"",departement:"",departement_ids:[],qualification:"",telephone:"",adresse:"",image:""}),[Ts,ye]=d.useState(!1),[w,N]=d.useState({username:"",pseudo:"",genre:"",tranche_age:"",profession:"",ville_residence:"",origine:"",situation_matrimoniale:"",niveau_education:"",departement:"",departement_ids:[],qualification:"",email:"",telephone:"",adresse:"",image:""}),[He,Ve]=d.useState(!1),[Ye,Xe]=d.useState(null),[De,Je]=d.useState(null),[Ke,Ze]=d.useState(null),[Te,es]=d.useState(null);d.useEffect(()=>{},[w]);const qs=s=>{const r=s.target.files[0];if(s.target.value="",r){if(!r.type.startsWith("image/")){pe.error(t.t("errors.validation.invalidImageType"));return}if(r.size>5*1024*1024){pe.error(t.t("errors.validation.imageTooLarge"));return}Xe(r);const a=new FileReader;a.onload=i=>{Je(i.target.result)},a.readAsDataURL(r)}},Ps=()=>{Xe(null),Je(null),q(s=>({...s,image:""}))},Gs=s=>{const r=s.target.files[0];if(s.target.value="",r){if(!r.type.startsWith("image/")){pe.error(t.t("errors.validation.invalidImageType"));return}if(r.size>5*1024*1024){pe.error(t.t("errors.validation.imageTooLarge"));return}Ze(r);const a=new FileReader;a.onload=i=>{es(i.target.result)},a.readAsDataURL(r)}},Os=()=>{Ze(null),es(null),N(s=>({...s,image:""}))},[j,Ns]=d.useState({reseau:{},stats:[],grs:[],members:{},available_users:[]}),[zs,Us]=d.useState(!0),[Wt,Rt]=d.useState([]),X=async()=>{try{if(!k){U(t.t("networks.details.missingNetworkId"));return}let s={};if(_?.id||_?._id)s={churchId:_.id||_._id};else if(p?.eglise_locale){let o;typeof p.eglise_locale=="object"?o=p.eglise_locale.id||p.eglise_locale._id:typeof p.eglise_locale=="string"&&(o=p.eglise_locale),o&&o!=="undefined"&&o!=="null"&&(s={churchId:o})}Object.keys(s).length===0&&A.isSuperAdmin&&(s={});let r={},a={},i=[],b=[],W=[];try{const o=await P.networks.getById(k);r=o.data?.data||o.data||{}}catch{}try{const o=await P.networks.getStatsById(k);a=o.data?.data||o.data||{}}catch{}try{const o=await P.networks.getGroups(k);i=o.data?.data||o.data||[]}catch{}try{const o=await P.networks.getMembers(k);b=o.data?.data||o.data||[]}catch{}if(Object.keys(s).length>0)try{const o=await P.users.getAvailable(s);W=o.data?.data||o.data||[]}catch{}Ns({reseau:r,stats:a,grs:Array.isArray(i)?i:[],members:Array.isArray(b)?b:[],available_users:Array.isArray(W)?W:[]})}catch(s){const r=yt(s,"erreur fetchdata:");U(r.message)}finally{Us(!1)}};d.useEffect(()=>{X()},[k]),d.useEffect(()=>{if((p?.current_role||p?.role)!=="SUPER_ADMIN"){let s="";_?.id||_?._id?s=_.id||_._id:p?.eglise_locale&&(s=typeof p.eglise_locale=="object"?p.eglise_locale.id||p.eglise_locale._id:p.eglise_locale),s&&q(r=>({...r,eglise_locale:s}))}},[p,_]),d.useEffect(()=>{if(L||f){const s=Ls(L,f);Ae(s)}else Ae("")},[L,f,j.available_users]);const Ls=(s,r)=>{if(!s)return"";const a=j.available_users.find(o=>(o.id||o._id)===s),i=j.available_users.find(o=>(o.id||o._id)===r);let b="";return a?a.username?b=js(a.username):b=a.pseudo||"":i&&(i.username?b=js(i.username):b=i.pseudo||""),b?`GR_${b.replace(/[^a-zA-ZÀ-ÿ0-9\s]/g,"").replace(/\s+/g,"_").trim()}`:""},Bs=async s=>{$e(!0);try{await Se.create(s),S({open:!0,message:t.t("previsionnel.success.created"),severity:"success"}),Re(!1),await X()}catch(r){const a=r.response?.data?.message||t.t("errors.api.operation");S({open:!0,message:a,severity:"error"})}finally{$e(!1)}},$s=async s=>{Qe(!0);try{await Le.create(s),S({open:!0,message:t.t("assistance.success.created"),severity:"success"}),Ee(!1),await X()}catch(r){const a=r.response?.data?.message||t.t("errors.api.operation");S({open:!0,message:a,severity:"error"})}finally{Qe(!1)}},Qs=()=>{Re(!1)},Hs=()=>{Ee(!1)},Vs=async s=>{try{const r=s.id||s._id;if(!r){S({open:!0,message:t.t("networks.details.invalidGroupId"),severity:"error"});return}await P.groups.update(r,s),ve(!1),Me(null),S({open:!0,message:t.t("success.groupUpdated"),severity:"success"}),await X()}catch{S({open:!0,message:t.t("errors.api.updateGroup"),severity:"error"})}},[Ys,qe]=d.useState(!1),[Xs,Pe]=d.useState(null),Js=s=>{Pe(s),qe(!0)},Ks=async()=>{try{await P.groups.delete(Xs),await X(),S({open:!0,message:t.t("success.groupDeleted"),severity:"success"})}catch{S({open:!0,message:t.t("errors.api.deleteGroup"),severity:"error"})}finally{qe(!1),Pe(null)}},Zs=()=>{qe(!1),Pe(null)},et=async s=>{try{const r={...s,network_id:k,responsable1_id:L,qualification:T,superieur_hierarchique_id:m||null};f&&(r.responsable2_id=f),await P.groups.create(r),fe(!1),S({open:!0,message:t.t("success.groupCreated"),severity:"success"}),await X(),ge()}catch(r){if(r.response?.status===401){const a=r.response?.data?.message||"";a.includes("droits")||a.includes("autorisé")||a.includes("église")?S({open:!0,message:t.t("errors.permissions.insufficient"),severity:"warning"}):a.includes("token")||a.includes("expiré")||a.includes("Non autorisé")?S({open:!0,message:t.t("errors.session.expired"),severity:"warning"}):S({open:!0,message:a||t.t("errors.authorization"),severity:"warning"})}else r.response?.status===403?S({open:!0,message:r.response?.data?.message||t.t("errors.accessDenied"),severity:"warning"}):S({open:!0,message:r.response?.data?.message||t.t("errors.api.createGroup"),severity:"error"})}},ss=async s=>{try{if(!Z){S({open:!0,message:t.t("networks.details.noGroupSelected"),severity:"error"});return}const r=Z.id||Z._id;if(!r){S({open:!0,message:t.t("networks.details.invalidGroupId"),severity:"error"});return}if(le){let a=s.image||"";const i={...s,password:s.password||t.t("auth.register.defaultPassword"),role:"MEMBRE",image:a};if((p?.current_role||p?.role)!=="SUPER_ADMIN"){let o="";_?.id||_?._id?o=_.id||_._id:p?.eglise_locale&&(o=typeof p.eglise_locale=="object"?p.eglise_locale.id||p.eglise_locale._id:p.eglise_locale),o&&(i.eglise_locale_id=o)}s.departement_ids&&s.departement_ids.length>0&&(i.departement_ids=s.departement_ids),delete i.eglise_locale,delete i.departement,Object.keys(i).forEach(o=>{i[o]===""&&(i[o]=null)});const b=await P.users.create(i),W=b.data?.data?.id||b.data?.data?._id||b.data?.id||b.data?._id;if(Ye)try{const o=new FormData;o.append("image",Ye);const _e=await P.users.uploadUserImage(W,o),Ce=_e.data?.data?.image||_e.data?.image;Ce&&await P.users.update(W,{image:Ce})}catch(o){Ue.warn("Erreur lors de l'upload de l'image:",o)}await P.groups.addMember(r,W)}else{if(!s.user_id){S({open:!0,message:t.t("networks.details.missingMemberId"),severity:"error"});return}await P.groups.addMember(r,s.user_id)}je(!1),ce(!1),We(null),q({username:"",pseudo:"",email:"",password:"",role:"MEMBRE",genre:"",tranche_age:"",profession:"",ville_residence:"",origine:"",situation_matrimoniale:"",niveau_education:"",departement:"",departement_ids:[],qualification:"",telephone:"",adresse:"",image:""}),S({open:!0,message:t.t("success.memberAdded"),severity:"success"}),await X()}catch(r){let a=t.t("errors.api.addMember");if(r.response?.status===400){const i=r.response?.data?.message;i?a=i:r.response?.data?.error?a=r.response.data.error:a=t.t("errors.validation.invalidData")}else if(r.response?.status===409)a=t.t("errors.user.alreadyExists");else if(r.response?.status===401){const i=r.response?.data?.message||"";i.includes("droits")||i.includes("autorisé")||i.includes("église")?a=t.t("errors.permissions.addMember"):i.includes("token")||i.includes("expiré")||i.includes("Non autorisé")?a=t.t("errors.session.expired"):a=i||t.t("errors.authorization")}else if(r.response?.status===403)a=t.t("errors.permissions.addMember");else if(r.response?.status===500){const i=r.response?.data?.error||r.response?.data?.message;i?a=`Erreur serveur: ${i}`:a=t.t("errors.server.internal")}else r.message&&!r.message.includes("Request failed with status code")&&(a=r.message);S({open:!0,message:a,severity:"error"})}},st=async s=>{try{const r=ue;if(!r){S({open:!0,message:t.t("networks.details.userIdNotFound"),severity:"error"});return}let a=s.image||"";if(Ke)try{const b=new FormData;b.append("image",Ke);const W=await P.users.uploadUserImage(r,b);if(a=W.data?.data?.image||W.data?.image,!a)throw new Error("URL de l'image non reçue")}catch{pe.error(t.t("errors.imageUploadFailed"));return}const i=Object.keys(s).reduce((b,W)=>((W==="user_id"||W==="_id"||W==="id"||s[W]!==""&&s[W]!==void 0&&s[W]!==null)&&(b[W]=s[W]),b),{});a&&(i.image=a),await P.users.update(r,i),ye(!1),N({username:"",pseudo:"",email:"",password:"",genre:"",tranche_age:"",profession:"",ville_residence:"",origine:"",situation_matrimoniale:"",niveau_education:"",departement:"",departement_ids:[],qualification:"",telephone:"",adresse:"",image:""}),S({open:!0,message:t.t("success.memberUpdated"),severity:"success"}),await X()}catch(r){let a=t.t("errors.api.updateMember");if(r.response?.status===400){const i=r.response?.data?.message;i?a=i:r.response?.data?.error?a=r.response.data.error:a=t.t("errors.validation.invalidData")}else if(r.response?.status===404)a=t.t("errors.member.notFound");else if(r.response?.status===403)a=t.t("errors.permissions.updateMember");else if(r.response?.status===500){const i=r.response?.data?.error||r.response?.data?.message;i?a=`Erreur serveur: ${i}`:a=t.t("errors.server.internal")}else r.message&&!r.message.includes("Request failed with status code")&&(a=r.message);S({open:!0,message:a,severity:"error"})}},[tt,Ge]=d.useState(!1),[rt,Oe]=d.useState({grId:null,userId:null});d.useEffect(()=>{if(T&&j){const s=Fs(T);ie(s),m&&(s.some(a=>a.id===m)||M(""))}else ie([]),M("")},[T,j]);const at=(s,r)=>{Oe({grId:s,userId:r}),Ge(!0)},it=async()=>{const{grId:s,userId:r}=rt;try{await P.groups.removeMember(s,r),S({open:!0,message:t.t("success.memberDeleted"),severity:"success"}),await X()}catch(a){let i=t.t("errors.api.deleteMember");if(a.response?.status===400){const b=a.response?.data?.message;b?i=b:a.response?.data?.error?i=a.response.data.error:i=t.t("errors.member.cannotDelete")}else if(a.response?.status===404)i=t.t("errors.memberOrGroup.notFound");else if(a.response?.status===403)i=t.t("errors.permissions.deleteMember");else if(a.response?.status===500){const b=a.response?.data?.error||a.response?.data?.message;b?i=`Erreur serveur: ${b}`:i=t.t("errors.server.internal")}else a.message&&!a.message.includes("Request failed with status code")&&(i=a.message);S({open:!0,message:i,severity:"error"})}finally{Ge(!1),Oe({grId:null,userId:null})}},nt=()=>{Ge(!1),Oe({grId:null,userId:null})};return zs?e.jsx(vt,{titre:t.t("networks.details.loading")}):D?e.jsx(wt,{error:D,title:t.t("errors.loading")}):$?e.jsx(Ct,{allowedRoles:["SUPER_ADMIN","ADMIN","MANAGER","COLLECTEUR_RESEAUX"],children:e.jsxs(c,{sx:{minHeight:"100vh"},children:[e.jsx(jt,{}),e.jsxs(dt,{maxWidth:"lg",sx:{mt:4,mb:4,py:4},children:[e.jsxs(c,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4,children:[e.jsxs(c,{children:[e.jsx(l,{variant:"h3",sx:{fontWeight:800,background:"linear-gradient(135deg, #662d91, #9e005d, #9e005d)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",letterSpacing:"-0.5px",mb:1},children:t.t("networks.details.title")}),e.jsx(l,{variant:"h5",sx:{color:"text.secondary",fontWeight:600},children:j.reseau.nom})]}),e.jsx(Fe,{title:t.t("common.actions.refresh"),children:e.jsx(J,{onClick:X,sx:{background:"linear-gradient(135deg, rgb(59, 20, 100) 0%, #662d91 50%, #9e005d 100%)",color:"white",boxShadow:"0 4px 12px rgba(102, 45, 145, 0.25)",transition:"all 0.3s ease","&:hover":{background:"linear-gradient(135deg, #1b1464, #662d91)",boxShadow:"0 8px 20px rgba(102, 45, 145, 0.35)",transform:"scale(1.1) rotate(180deg)"}},children:e.jsx(_s,{})})})]}),e.jsxs(ze,{"data-aos":"fade-up",sx:{p:4,mb:4,background:"linear-gradient(145deg, #FFFFFF 0%, #F5F3FF 100%)",borderRadius:"20px",border:"1px solid rgba(102, 45, 145, 0.1)",boxShadow:"0 4px 20px rgba(102, 45, 145, 0.08)"},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(l,{variant:"h5",sx:{fontWeight:700,color:"primary.main"},children:t.t("networks.details.networkResponsibles")}),(A.isAdmin||A.isSuperAdmin||A.isCollecteurReseaux||A.isManager)&&e.jsxs(c,{sx:{display:"flex",gap:2},children:[e.jsx(R,{variant:"contained",startIcon:e.jsx(ct,{}),onClick:()=>Re(!0),sx:{backgroundColor:"#2E7D32","&:hover":{backgroundColor:"#1B5E20"}},children:t.t("previsionnel.button.create")}),e.jsx(R,{variant:"contained",startIcon:e.jsx(ut,{}),onClick:()=>Ee(!0),sx:{backgroundColor:"#1976d2","&:hover":{backgroundColor:"#1565c0"}},children:t.t("assistance.form.save")}),e.jsx(R,{variant:"outlined",startIcon:e.jsx(ys,{}),onClick:()=>Be(!0),sx:{borderColor:"#FF9800",color:"#FF9800","&:hover":{borderColor:"#F57C00",backgroundColor:"#FFF3E0"}},children:t.t("common.history")})]})]}),e.jsxs(E,{container:!0,spacing:2,children:[e.jsx(E,{item:!0,xs:12,md:6,children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(we,{}),e.jsxs(c,{children:[e.jsx(l,{variant:"subtitle2",children:t.t("networks.details.responsable1")}),e.jsx(l,{children:j.reseau.responsable1?.username})]})]})}),j.reseau.responsable2?.username&&e.jsx(E,{item:!0,xs:12,md:6,children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(we,{}),e.jsxs(c,{children:[e.jsx(l,{variant:"subtitle2",children:t.t("networks.details.responsable2")}),e.jsx(l,{children:j.reseau.responsable2?.username})]})]})})]})]}),e.jsxs(ze,{"data-aos":"fade-up",sx:{p:4,mb:4,background:"linear-gradient(145deg, #FFFFFF 0%, #F5F3FF 100%)",borderRadius:"20px",border:"1px solid rgba(102, 45, 145, 0.1)",boxShadow:"0 4px 20px rgba(102, 45, 145, 0.08)"},children:[e.jsx(l,{variant:"h5",gutterBottom:!0,sx:{fontWeight:700,color:"primary.main",mb:3},children:t.t("networks.details.statistics")}),e.jsxs(E,{container:!0,spacing:2,children:[Mt(j.stats||{}).map((s,r)=>e.jsx(E,{item:!0,xs:6,sm:4,md:2,children:e.jsxs(Ne,{children:[e.jsx(l,{variant:"body2",sx:{mb:1},children:s.label}),e.jsx(l,{variant:"h4",color:"primary",children:s.value})]})},r)),e.jsx(E,{item:!0,xs:6,sm:4,md:2,children:e.jsxs(Ne,{children:[e.jsx(l,{variant:"body2",sx:{mb:1},children:t.t("networks.details.groupesReveil")}),e.jsx(l,{variant:"h4",color:"primary",children:j.grs.length})]})}),e.jsx(E,{item:!0,xs:6,sm:4,md:2,children:e.jsxs(Ne,{children:[e.jsx(l,{variant:"body2",sx:{mb:1},children:t.t("networks.details.effectifTotal")}),e.jsx(l,{variant:"h4",color:"primary",children:(()=>{const s=new Set;j.grs?.forEach(i=>{i.members?.forEach(b=>{const W=b?.id||b?._id||b?.user?.id||b?.user?._id;W&&s.add(W)})});const r=j.reseau?.responsable1?.id||j.reseau?.responsable1?._id,a=j.reseau?.responsable2?.id||j.reseau?.responsable2?._id;return r&&s.add(r),a&&s.add(a),s.size})()})]})})]})]}),e.jsxs(c,{"data-aos":"fade-up",sx:{mb:4},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(l,{variant:"h5",children:t.t("networks.details.groupesReveil")}),(A.isAdmin||A.isSuperAdmin||A.isCollecteurReseaux)&&e.jsx(R,{variant:"contained",startIcon:e.jsx(mt,{}),onClick:()=>{fe(!0),ge()},disabled:!C,title:u(C),children:t.t("networks.details.addGR")})]}),e.jsx(E,{container:!0,sx:{mx:"auto"},alignItems:"stretch",children:(Array.isArray(j.grs)?j.grs:[]).map(s=>e.jsx(E,{"data-aos":"fade-up",sx:{width:"100%",padding:"10px 10px 10px 10px","@media (min-width:500px) and (max-width:849px)":{width:"50%"},"@media (min-width:850px) and (max-width:1199px)":{width:"33.33%"},"@media (min-width:1200px) and (max-width:1599px)":{width:"25%"},"@media (min-width:1600px)":{width:"20%"}},children:e.jsxs(At,{children:[e.jsxs(he,{children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(l,{variant:"h6",children:s.nom}),(A.isAdmin||A.isSuperAdmin||A.isCollecteurReseaux)&&e.jsxs(c,{children:[e.jsx(J,{color:"primary",onClick:()=>{Me(s),ve(!0)},disabled:!n,title:u(n),children:e.jsx(ns,{})}),e.jsx(J,{color:"error",onClick:()=>Js(s.id),disabled:!z,title:u(z),children:e.jsx(oe,{})})]})]}),e.jsxs(c,{sx:{mb:2},children:[e.jsx(l,{variant:"subtitle2",children:t.t("networks.details.responsable1")}),e.jsx(l,{children:s.responsable1?.username}),s.responsable2?.username&&e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"subtitle2",sx:{mt:1},children:t.t("networks.details.responsable2")}),e.jsx(l,{children:s.responsable2?.username})]}),e.jsxs(l,{sx:{mt:1},children:[e.jsx("strong",{children:t.t("networks.details.nombreMembres")})," ",s.members?.length]})]}),s.members?.map(r=>{const i=j.members?.find(b=>(b.user?.id||b.user?._id)===(r.user?.id||r.user?._id))?.user||r.user||{};return e.jsxs(c,{sx:{p:1,mb:1,borderRadius:1,bgcolor:"background.default",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(l,{children:[i.username||t.t("common_text.unknownName")," (",e.jsx(l,{component:"span",variant:"caption",sx:{fontWeight:"bold",fontSize:"0.9rem"},children:ke(i.qualification,t.t("common.unknown"))}),")"]}),(A.isAdmin||A.isCollecteurReseaux||A.isSuperAdmin)&&e.jsxs(c,{children:[e.jsx(J,{size:"small",onClick:()=>{We(i.id||i._id),N({username:i.username||"",pseudo:i.pseudo||"",genre:i.genre||"",tranche_age:i.tranche_age||"",profession:i.profession||"",ville_residence:i.ville_residence||"",origine:i.origine||"",situation_matrimoniale:i.situation_matrimoniale||"",niveau_education:i.niveau_education||"",departement:i.departement||"",departement_ids:i.user_departments?.map(b=>b.department_id)||[],qualification:i.qualification||"",email:i.email||"",telephone:i.telephone||"",adresse:i.adresse||"",image:i.image||""}),setTimeout(()=>{},100),ye(!0)},disabled:!g,title:u(g),children:e.jsx(ns,{})}),e.jsx(J,{size:"small",color:"error",onClick:()=>at(s.id,i.id||i._id),disabled:!n,title:u(n),children:e.jsx(oe,{})})]})]},r.user?.id||r.user?._id||r._id||`member-${Math.random()}`)})]}),e.jsx(pt,{sx:{mt:"auto",p:2},children:(A.isAdmin||A.isCollecteurReseaux||A.isSuperAdmin)&&e.jsx(R,{fullWidth:!0,variant:"contained",onClick:()=>{Me(s),je(!0)},disabled:!n,title:u(n),children:t.t("networks.details.addMember")})})]})},s.id))})]}),e.jsxs(ee,{open:Ss,onClose:()=>{fe(!1),ge()},PaperProps:{sx:{borderRadius:"24px",boxShadow:"0 20px 60px rgba(102, 45, 145, 0.15)",background:"rgba(255, 255, 255, 0.98)",backdropFilter:"blur(20px)",border:"2px solid rgba(102, 45, 145, 0.1)"}},children:[e.jsx(se,{sx:{fontWeight:700,background:"linear-gradient(135deg, rgb(59, 20, 100) 0%, #662d91 50%, #9e005d 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:t.t("networks.details.addGroupDialog")}),e.jsx(te,{children:e.jsxs(c,{component:"form",sx:{pt:2},children:[e.jsx(v,{select:!0,fullWidth:!0,id:"network-details-responsable1",name:"responsable1",label:t.t("networks.details.responsable1"),sx:{mb:2},required:!0,value:L||"",onChange:s=>h(s.target.value),autoComplete:"off",children:j.available_users.map(s=>e.jsx(I,{value:s.id||s._id,children:s.username},s.id||s._id))}),e.jsxs(v,{select:!0,fullWidth:!0,id:"network-details-responsable2",name:"responsable2",label:t.t("networks.details.responsable2Disabled"),sx:{mb:2},value:f||"",onChange:s=>O(s.target.value),disabled:!0,InputProps:{style:{backgroundColor:"#f5f5f5",color:"#666"}},helperText:t.t("common.actions.fieldTemporarilyDisabled"),children:[e.jsx(I,{value:"",children:t.t("common.actions.none")}),j.available_users.filter(s=>s._id!==L).map(s=>e.jsx(I,{value:s.id||s._id,children:s.username},s.id||s._id))]}),e.jsxs(v,{select:!0,fullWidth:!0,id:"network-details-qualification",name:"qualification",label:t.t("networks.details.responsibleQualification"),sx:{mb:2},required:!0,value:T||"",onChange:s=>be(s.target.value),helperText:t.t("networks.details.qualificationAutoAssigned"),autoComplete:"off",children:[e.jsx(I,{value:"QUALIFICATION_12",children:"12"}),e.jsx(I,{value:"QUALIFICATION_144",children:"144"}),e.jsx(I,{value:"QUALIFICATION_1728",children:"1728"}),e.jsx(I,{value:"QUALIFICATION_20738",children:"20738"}),e.jsx(I,{value:"QUALIFICATION_248832",children:"248832"})]}),e.jsxs(v,{select:!0,fullWidth:!0,id:"network-details-superior",name:"superior",required:!0,label:t.t("networks.details.superior"),sx:{mb:2},value:m||"",onChange:s=>M(s.target.value),helperText:T?t.t("networks.details.selectSuperiorBasedOnQualification",{qualification:T.replace("QUALIFICATION_",""),count:B.length,plural:B.length>1?"s":""}):t.t("networks.details.selectQualificationFirst"),disabled:!T,autoComplete:"off",children:[B.map(s=>e.jsx(I,{value:s.id,children:s.label},s.id)),B.length===0&&T&&e.jsx(I,{disabled:!0,children:t.t("networks.details.noAvailableSuperiors")})]}),e.jsx(v,{fullWidth:!0,id:"network-details-group-name",name:"groupName",label:t.t("networks.details.nomGroupe"),sx:{mb:2},value:Ie||"",InputProps:{readOnly:!0},placeholder:t.t("networks.details.nameAutoGenerated"),helperText:t.t("networks.details.nameGeneratedFromResponsible"),autoComplete:"off"})]})}),e.jsxs(ae,{children:[e.jsx(R,{onClick:()=>{fe(!1),ge()},children:t.t("networks.details.cancel")}),e.jsx(R,{variant:"contained",onClick:()=>et({responsable1:L,responsable2:f,qualification:T,superieur_hierarchique:m}),disabled:!C||!L||!T||!m,title:u(C),children:t.t("common.actions.add")})]})]}),e.jsxs(ee,{open:As,onClose:()=>{je(!1),ce(!1),Ve(!1),q({username:"",pseudo:"",email:"",password:"",role:"MEMBRE",genre:"",tranche_age:"",profession:"",ville_residence:"",origine:"",situation_matrimoniale:"",niveau_education:"",departement:"",departement_ids:[],qualification:"",telephone:"",adresse:"",image:""})},maxWidth:"sm",fullWidth:!0,children:[e.jsx(se,{sx:{fontWeight:700,background:"linear-gradient(135deg, rgb(59, 20, 100) 0%, #662d91 50%, #9e005d 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:t.t("networks.details.addMember")}),e.jsxs(te,{children:[e.jsxs(c,{sx:{pt:2,mb:2},children:[e.jsx(R,{variant:le?"outlined":"contained",onClick:()=>ce(!1),sx:{mr:1},disabled:!n,title:u(C),children:t.t("networks.details.selectExistingMember")}),e.jsx(R,{variant:le?"contained":"outlined",onClick:()=>ce(!0),disabled:!n,title:u(C),children:t.t("networks.details.createNewMember")})]}),e.jsx(c,{component:"form",sx:{pt:2},children:le?e.jsxs(e.Fragment,{children:[e.jsxs(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:3,p:2,border:"2px dashed var(--upload-dashed)",borderRadius:2,backgroundColor:"#fafafa",transition:"all 0.3s ease","&:hover":{borderColor:"#1976d2",backgroundColor:"#f5f5f5"}},children:[e.jsx(l,{variant:"subtitle1",sx:{mb:1.5,color:"primary.main",fontWeight:"bold",textAlign:"center"},children:t.t("auth.register.profileImage")}),y.image||De?e.jsxs(c,{sx:{position:"relative",display:"flex",flexDirection:"column",alignItems:"center",mb:1.5},children:[e.jsx("img",{src:De||cs(y.image),alt:"Aperçu de la photo de profil",style:{width:90,height:90,borderRadius:"50%",objectFit:"cover",border:"3px solid var(--white-border)",boxShadow:"0 2px 8px var(--network-shadow)",marginBottom:12}}),e.jsx(J,{size:"small",color:"error",onClick:Ps,disabled:!n,sx:{position:"absolute",top:-8,left:-8,bgcolor:"white",border:"2px solid",borderColor:"error.main","&:hover":{bgcolor:"error.light",color:"white"}},children:e.jsx(oe,{sx:{fontSize:14}})})]}):e.jsxs(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:1.5},children:[e.jsx(c,{sx:{width:90,height:90,borderRadius:"50%",backgroundColor:"#e0e0e0",display:"flex",alignItems:"center",justifyContent:"center",mb:1,border:"2px dashed #bdbdbd"},children:e.jsx(we,{sx:{fontSize:32,color:"#9e9e9e"}})}),e.jsx(l,{variant:"caption",color:"text.secondary",sx:{mb:1,textAlign:"center"},children:"Aucune photo sélectionnée"})]}),e.jsxs(R,{variant:"contained",component:"label",disabled:!n,size:"small",sx:{borderRadius:1.5,textTransform:"none",fontWeight:"bold",px:2,py:1,fontSize:"0.875rem",boxShadow:"0 2px 6px var(--network-blue-shadow)","&:hover":{boxShadow:"0 3px 8px var(--network-blue-hover-shadow)",transform:"translateY(-1px)"}},children:[y.image||De?t.t("auth.register.changeImage"):t.t("auth.register.selectImage"),e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:qs})]}),e.jsx(l,{variant:"caption",color:"text.secondary",sx:{mt:.5,textAlign:"center",fontSize:"0.7rem"},children:"JPG, PNG, GIF (max 5MB)"})]}),e.jsx(v,{fullWidth:!0,id:"network-details-member-username",name:"username",label:t.t("auth.register.username"),value:y.username,onChange:s=>q({...y,username:s.target.value}),sx:{mb:2},required:!0,disabled:!n,title:u(C),autoComplete:"username"}),e.jsx(v,{fullWidth:!0,id:"network-details-member-pseudo",name:"pseudo",label:t.t("auth.register.pseudo"),value:y.pseudo,onChange:s=>q({...y,pseudo:s.target.value}),sx:{mb:2},required:!0,disabled:!n,title:u(C),autoComplete:"nickname"}),e.jsx(v,{fullWidth:!0,id:"network-details-member-email",name:"email",label:t.t("auth.register.email"),type:"email",value:y.email,onChange:s=>q({...y,email:s.target.value}),sx:{mb:2},required:!0,disabled:!n,title:u(C),autoComplete:"email"}),e.jsx(v,{fullWidth:!0,id:"network-details-member-telephone",name:"telephone",label:t.t("auth.register.telephone"),value:y.telephone,onChange:s=>q({...y,telephone:s.target.value}),sx:{mb:2},required:!0,disabled:!n,title:u(C),autoComplete:"tel"}),e.jsx(v,{fullWidth:!0,id:"network-details-member-adresse",name:"adresse",label:t.t("auth.register.adresse"),value:y.adresse,onChange:s=>q({...y,adresse:s.target.value}),sx:{mb:2},disabled:!n,title:u(C),autoComplete:"street-address"}),e.jsx(v,{select:!0,fullWidth:!0,id:"network-details-member-genre",name:"genre",label:t.t("auth.register.genre"),value:y.genre,onChange:s=>q({...y,genre:s.target.value}),sx:{mb:2},required:!0,disabled:!n,title:u(C),autoComplete:"sex",children:us.map(s=>e.jsx(I,{value:s.value,children:s.label},s.value))}),e.jsx(v,{select:!0,fullWidth:!0,id:"network-details-member-tranche-age",name:"tranche_age",label:t.t("auth.register.ageRange"),value:y.tranche_age,onChange:s=>q({...y,tranche_age:s.target.value}),sx:{mb:2},required:!0,disabled:!n,title:u(C),autoComplete:"bday",children:ms.map(s=>e.jsx(I,{value:s.value,children:s.label},s.value))}),e.jsx(v,{fullWidth:!0,id:"network-details-member-profession",name:"profession",label:t.t("auth.register.profession"),value:y.profession,onChange:s=>q({...y,profession:s.target.value}),sx:{mb:2},required:!0,disabled:!n,title:u(C),autoComplete:"organization-title"}),e.jsx(v,{fullWidth:!0,id:"network-details-member-ville-residence",name:"ville_residence",label:t.t("auth.register.villeResidence"),value:y.ville_residence,onChange:s=>q({...y,ville_residence:s.target.value}),sx:{mb:2},required:!0,disabled:!n,title:u(C),autoComplete:"address-level2"}),e.jsx(v,{select:!0,fullWidth:!0,id:"network-details-member-origine",name:"origine",label:t.t("auth.register.originCountry"),value:y.origine,onChange:s=>q({...y,origine:s.target.value}),sx:{mb:2},required:!0,disabled:!n,title:u(C),autoComplete:"country",children:ps.map(s=>e.jsx(I,{value:s.value,children:s.label},s.value))}),e.jsx(v,{select:!0,fullWidth:!0,id:"network-details-member-situation-matrimoniale",name:"situation_matrimoniale",label:t.t("auth.register.situationMatrimoniale"),value:y.situation_matrimoniale,onChange:s=>q({...y,situation_matrimoniale:s.target.value}),sx:{mb:2},required:!0,disabled:!n,title:u(C),autoComplete:"off",children:xs.map(s=>e.jsx(I,{value:s.value,children:s.label},s.value))}),e.jsx(v,{select:!0,fullWidth:!0,id:"network-details-member-niveau-education",name:"niveau_education",label:t.t("auth.register.educationLevel"),value:y.niveau_education,onChange:s=>q({...y,niveau_education:s.target.value}),sx:{mb:2},required:!0,disabled:!n,title:u(C),autoComplete:"off",children:hs.map(s=>e.jsx(I,{value:s.value,children:s.label},s.value))}),e.jsx(v,{select:!0,fullWidth:!0,id:"network-details-member-qualification",name:"qualification",label:t.t("auth.register.qualification"),value:y.qualification,onChange:s=>q({...y,qualification:s.target.value}),required:!0,disabled:!n,title:u(C),autoComplete:"off",children:bs.filter(s=>![t.t("qualifications.governance"),t.t("qualifications.networkResponsible"),t.t("qualifications.ecodim"),t.t("qualifications.ecodimResponsible")].includes(s.value)).map(s=>e.jsx(I,{value:s.value,children:s.label},s.value))}),e.jsx(xt,{control:e.jsx(ht,{id:"network-details-member-sert-departement",name:"sert_departement",checked:He,onChange:s=>Ve(s.target.checked),disabled:!n,title:u(C)}),label:t.t("networks.details.sertDepartement"),sx:{mb:2}}),He&&e.jsxs(ls,{fullWidth:!0,sx:{mb:2},disabled:!n,children:[e.jsx(os,{id:"network-details-member-departments-label",children:t.t("auth.register.departments")}),e.jsx(ds,{id:"network-details-member-departments",name:"departement_ids",multiple:!0,value:y.departement_ids||[],onChange:s=>q({...y,departement_ids:s.target.value}),labelId:"network-details-member-departments-label",autoComplete:"off",renderValue:s=>e.jsx(c,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:s.map(r=>{const a=x.find(i=>(i.id||i._id)===r);return e.jsx(ne,{label:a?a.nom:r,size:"small"},r)})}),children:x.map(s=>e.jsx(I,{value:s.id||s._id,children:s.nom},s.id||s._id))})]})]}):e.jsx(v,{select:!0,fullWidth:!0,id:"network-details-select-member",name:"selectedMember",label:t.t("networks.details.selectMember"),value:ue||"",onChange:s=>{We(s.target.value)},required:!0,disabled:!n,title:u(C),autoComplete:"off",children:j.available_users.filter(s=>![t.t("qualifications.governance"),t.t("qualifications.networkResponsible"),t.t("qualifications.ecodim"),t.t("qualifications.ecodimResponsible")].includes(s.qualification)).map(s=>e.jsxs(I,{value:s.id||s._id,children:[s.username," (",e.jsx(l,{component:"span",variant:"caption",sx:{fontWeight:"bold",fontSize:"0.75rem"},children:ke(s.qualification)}),")"]},s.id||s._id))})})]}),e.jsxs(ae,{children:[e.jsx(R,{onClick:()=>{let s="";(p?.current_role||p?.role)!=="SUPER_ADMIN"&&(_?.id||_?._id?s=_.id||_._id:p?.eglise_locale&&(s=typeof p.eglise_locale=="object"?p.eglise_locale.id||p.eglise_locale._id:p.eglise_locale)),je(!1),ce(!1),q({username:"",pseudo:"",email:"",password:"",role:"MEMBRE",genre:"",tranche_age:"",profession:"",ville_residence:"",origine:"",situation_matrimoniale:"",niveau_education:"",eglise_locale:s,departement:"",departement_ids:[],qualification:"",telephone:"",adresse:"",image:""})},children:t.t("networks.details.cancel")}),e.jsx(R,{variant:"contained",onClick:s=>{if(le)ss(y);else{if(!ue){S({open:!0,message:t.t("networks.details.selectMember"),severity:"error"});return}ss({user_id:ue})}},disabled:!n||(le?!y.username||!y.email||!y.qualification:!ue),title:u(C),children:t.t("networks.details.addMember")})]})]}),e.jsxs(ee,{open:Is,onClose:()=>ve(!1),PaperProps:{sx:{borderRadius:"24px",boxShadow:"0 20px 60px rgba(102, 45, 145, 0.15)",background:"rgba(255, 255, 255, 0.98)",backdropFilter:"blur(20px)",border:"2px solid rgba(102, 45, 145, 0.1)"}},onEnter:async()=>{if(Z)try{const s=Z.id||Z._id;if(!s){S({open:!0,message:t.t("networks.details.invalidGroupId"),severity:"error"});return}const r=await P.groups.getById(s),a=r.data?.data||r.data||{};h(a.responsable1?typeof a.responsable1=="object"?a.responsable1.id||a.responsable1._id:a.responsable1:""),O(a.responsable2?typeof a.responsable2=="object"?a.responsable2.id||a.responsable2._id:a.responsable2:"")}catch{h(""),O(""),S({open:!0,message:t.t("errors.api.getGroup"),severity:"error"})}},children:[e.jsx(se,{sx:{fontWeight:700,background:"linear-gradient(135deg, rgb(59, 20, 100) 0%, #662d91 50%, #9e005d 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:t.t("networks.details.editGR")}),e.jsx(te,{children:e.jsxs(c,{component:"form",sx:{pt:2},children:[e.jsx(v,{select:!0,fullWidth:!0,label:t.t("networks.details.responsable1"),value:L,onChange:s=>h(s.target.value),sx:{mb:2,minWidth:250},required:!0,children:j.available_users.map(s=>e.jsxs(I,{value:s.id||s._id,children:[s.username," (",e.jsx(l,{component:"span",variant:"caption",sx:{fontWeight:"bold",fontSize:"0.75rem"},children:ke(s.qualification)}),")"]},s.id||s._id))}),e.jsxs(v,{select:!0,fullWidth:!0,label:t.t("networks.details.responsable2"),value:f,onChange:s=>O(s.target.value),sx:{mb:2,minWidth:250},disabled:!0,InputProps:{style:{backgroundColor:"#f5f5f5",color:"#666"}},helperText:t.t("common.actions.fieldTemporarilyDisabled"),children:[e.jsx(I,{value:"",children:t.t("common.actions.none")}),j.available_users.map(s=>e.jsxs(I,{value:s.id||s._id,children:[s.username," (",e.jsx(l,{component:"span",variant:"caption",sx:{fontWeight:"bold",fontSize:"0.75rem"},children:ke(s.qualification)}),")"]},s.id||s._id))]})]})}),e.jsxs(ae,{children:[e.jsx(R,{onClick:()=>{ve(!1),h(""),O("")},children:t.t("networks.details.cancel")}),e.jsx(R,{variant:"contained",onClick:()=>{const s=Z?.id||Z?._id;if(!s){S({open:!0,message:t.t("networks.details.invalidGroupId"),severity:"error"});return}Vs({id:s,responsable1_id:L,responsable2_id:f||null})},color:"primary",disabled:!n||!L,title:u(n),children:t.t("common.actions.edit")})]})]}),e.jsxs(ee,{open:Ts,onClose:()=>ye(!1),maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:"24px",boxShadow:"0 20px 60px rgba(102, 45, 145, 0.15)",background:"rgba(255, 255, 255, 0.98)",backdropFilter:"blur(20px)",border:"2px solid rgba(102, 45, 145, 0.1)"}},children:[e.jsx(se,{sx:{fontWeight:700,background:"linear-gradient(135deg, rgb(59, 20, 100) 0%, #662d91 50%, #9e005d 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:t.t("networks.details.editMember")}),e.jsx(te,{children:e.jsxs(c,{component:"form",sx:{pt:2},children:[e.jsxs(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:3,p:2,backgroundColor:"#f8f9fa",borderRadius:1,border:"2px dashed var(--upload-dashed)",boxShadow:"0 1px 8px var(--upload-shadow-light)"},children:[e.jsx(l,{variant:"subtitle1",sx:{mb:2,fontWeight:"bold",color:"primary.main",textAlign:"center"},children:t.t("auth.register.profileImage")}),w.image||Te?e.jsxs(c,{sx:{position:"relative",display:"flex",flexDirection:"column",alignItems:"center",mb:1.5},children:[e.jsx("img",{src:Te||cs(w.image),alt:"Aperçu de la photo de profil",style:{width:90,height:90,borderRadius:"50%",objectFit:"cover",border:"3px solid #fff",boxShadow:"0 1px 8px rgba(0,0,0,0.15)",marginBottom:12}}),e.jsx(J,{size:"small",color:"error",onClick:Os,disabled:!g,sx:{position:"absolute",top:-8,left:-8,bgcolor:"white",border:"2px solid",borderColor:"error.main","&:hover":{bgcolor:"error.light",color:"white"}},children:e.jsx(oe,{sx:{fontSize:14}})})]}):e.jsxs(c,{sx:{display:"flex",flexDirection:"column",alignItems:"center",mb:1.5},children:[e.jsx(c,{sx:{width:90,height:90,borderRadius:"50%",backgroundColor:"#e0e0e0",display:"flex",alignItems:"center",justifyContent:"center",mb:1,border:"2px dashed #ccc"},children:e.jsx(we,{sx:{fontSize:32,color:"#999"}})}),e.jsx(l,{variant:"body2",color:"text.secondary",sx:{mb:1},children:"Aucune image sélectionnée"})]}),e.jsxs(R,{variant:"outlined",component:"label",size:"small",disabled:!g,sx:{borderRadius:1.5,textTransform:"none",fontWeight:"bold",fontSize:"0.75rem",py:.5,px:1.5,borderColor:"primary.main",color:"primary.main","&:hover":{backgroundColor:"primary.light",color:"white",boxShadow:"0 3px 8px rgba(25, 118, 210, 0.4)",transform:"translateY(-1px)"}},children:[w.image||Te?t.t("auth.register.changeImage"):t.t("auth.register.selectImage"),e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:Gs})]}),e.jsx(l,{variant:"caption",color:"text.secondary",sx:{mt:.5,fontSize:"0.7rem",textAlign:"center"},children:"Formats acceptés: JPG, PNG, GIF (max 5MB)"})]}),e.jsx(v,{fullWidth:!0,label:t.t("networks.details.username"),value:w.username,onChange:s=>N({...w,username:s.target.value}),sx:{mb:2},required:!0,disabled:!g,title:u(g)}),e.jsx(v,{fullWidth:!0,label:t.t("networks.details.pseudo"),value:w.pseudo,onChange:s=>N({...w,pseudo:s.target.value}),sx:{mb:2},disabled:!g,title:u(g)}),e.jsx(v,{fullWidth:!0,label:t.t("networks.details.email"),value:w.email,onChange:s=>N({...w,email:s.target.value}),sx:{mb:2},disabled:!g,title:u(g)}),e.jsx(v,{fullWidth:!0,label:t.t("networks.details.telephone"),value:w.telephone,onChange:s=>N({...w,telephone:s.target.value}),sx:{mb:2},disabled:!g,title:u(g)}),e.jsx(v,{fullWidth:!0,label:t.t("networks.details.address"),value:w.adresse,onChange:s=>N({...w,adresse:s.target.value}),sx:{mb:2},disabled:!g,title:u(g)}),e.jsx(v,{select:!0,fullWidth:!0,label:t.t("networks.details.genre"),value:w.genre,onChange:s=>N({...w,genre:s.target.value}),sx:{mb:2},disabled:!g,title:u(g),children:us.map(s=>e.jsx(I,{value:s.value,children:s.label},s.value))}),e.jsx(v,{select:!0,fullWidth:!0,label:t.t("networks.details.ageRange"),value:w.tranche_age,onChange:s=>N({...w,tranche_age:s.target.value}),sx:{mb:2},disabled:!g,title:u(g),children:ms.map(s=>e.jsx(I,{value:s.value,children:s.label},s.value))}),e.jsx(v,{fullWidth:!0,label:t.t("networks.details.profession"),value:w.profession,onChange:s=>N({...w,profession:s.target.value}),sx:{mb:2},disabled:!g,title:u(g)}),e.jsx(v,{fullWidth:!0,label:t.t("networks.details.residenceCity"),value:w.ville_residence,onChange:s=>N({...w,ville_residence:s.target.value}),sx:{mb:2},disabled:!g,title:u(g)}),e.jsx(v,{select:!0,fullWidth:!0,label:t.t("networks.details.origin"),value:w.origine,onChange:s=>N({...w,origine:s.target.value}),sx:{mb:2},disabled:!g,title:u(g),children:ps.map(s=>e.jsx(I,{value:s.value,children:s.label},s.value))}),e.jsx(v,{select:!0,fullWidth:!0,label:t.t("networks.details.maritalStatus"),value:w.situation_matrimoniale,onChange:s=>N({...w,situation_matrimoniale:s.target.value}),sx:{mb:2},disabled:!g,title:u(g),children:xs.map(s=>e.jsx(I,{value:s.value,children:s.label},s.value))}),e.jsx(v,{select:!0,fullWidth:!0,label:t.t("networks.details.educationLevel"),value:w.niveau_education,onChange:s=>N({...w,niveau_education:s.target.value}),sx:{mb:2},disabled:!g,title:u(g),children:hs.map(s=>e.jsx(I,{value:s.value,children:s.label},s.value))}),e.jsxs(ls,{fullWidth:!0,sx:{mb:2},disabled:!g,children:[e.jsx(os,{children:t.t("auth.register.departments")}),e.jsx(ds,{multiple:!0,value:w.departement_ids||[],onChange:s=>N({...w,departement_ids:s.target.value}),renderValue:s=>e.jsx(c,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:s.map(r=>{const a=x.find(i=>(i.id||i._id)===r);return e.jsx(ne,{label:a?a.nom:r,size:"small"},r)})}),children:x.map(s=>e.jsx(I,{value:s.id||s._id,children:s.nom},s.id||s._id))})]}),e.jsx(v,{select:!0,fullWidth:!0,label:t.t("networks.details.qualification"),value:w.qualification,onChange:s=>N({...w,qualification:s.target.value}),sx:{mb:2},disabled:!g,title:u(g),children:bs.map(s=>e.jsx(I,{value:s.value,children:s.label},s.value))})]})}),e.jsxs(ae,{children:[e.jsx(R,{onClick:()=>ye(!1),children:t.t("networks.details.cancel")}),e.jsx(R,{variant:"contained",onClick:()=>st(w),disabled:!g,title:u(g),children:t.t("common.actions.edit")})]})]})]}),e.jsx(gs,{open:Ys,title:t.t("networks.details.deleteGr"),content:t.t("networks.details.deleteGrContent"),onClose:Zs,onConfirm:Ks}),e.jsx(gs,{open:tt,title:t.t("networks.details.deleteMember"),content:t.t("networks.details.deleteMemberContent"),onClose:nt,onConfirm:it}),e.jsx(Cs,{open:me.open,autoHideDuration:2e3,onClose:()=>S({...me,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(xe,{onClose:()=>S({...me,open:!1}),severity:me.severity,sx:{width:"100%"},children:me.message})}),e.jsx(Ft,{open:Ms,onClose:Qs,onSave:Bs,networkData:j,isLoading:Es}),e.jsx(St,{open:Ws,onClose:Hs,onSave:$s,networkData:j,isLoading:Ds}),e.jsx(It,{open:Rs,onClose:()=>Be(!1),networkData:j})]})}):e.jsx(c,{sx:{minHeight:"100vh",bgcolor:"background.default",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(l,{variant:"h6",color:"error",children:t.t("auth.loginRequired")})})};export{$t as default};
