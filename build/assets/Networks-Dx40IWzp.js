import{r as u,j as e,B as m,g as W,T as t,F as L,s as P,t as M,M as T,G as C,O as k,n as G,h as U}from"./mui-mRVmBbre.js";import{c as $,b as D,L as O,i as a,N as F,a as x,h as z,m as H}from"./index-tM-Ac5N7.js";import{S as X}from"./SecureErrorMessage-C13siMY2.js";import{u as Y}from"./redux-DbjaNwcH.js";import{A as q}from"./AccessControl-DiRRByFc.js";import{u as J}from"./router-BwhLjOj0.js";import"./vendor-Bzgz95E1.js";import"./utils-DP_tgNw_.js";const K=k(U)(({theme:d})=>({padding:d.spacing(3),height:"100%",display:"flex",flexDirection:"column",gap:d.spacing(2),transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out","&:hover":{transform:"translateY(-5px)",boxShadow:d.shadows[4]}})),c=k(m)(({theme:d})=>({display:"flex",justifyContent:"space-between",alignItems:"center",padding:d.spacing(1),borderBottom:`1px solid ${d.palette.divider}`,"&:last-child":{borderBottom:"none"}})),j=d=>{if(!d)return"";const n=H.map(p=>p.value),h=d.split(" "),o=h[0];return n.includes(o)&&h.length>=2?`${o} ${h[1]}`:o},le=()=>{const d=J(),{user:n}=Y(s=>s.auth),h=$(),{selectedChurch:o,changeSelectedChurch:_,churches:p}=D(),[w,v]=u.useState([]),[I,b]=u.useState(!0),[S,E]=u.useState(null),[y,N]=u.useState(null);u.useEffect(()=>{(async()=>{if(n&&(n.current_role||n.role)==="collecteur_reseaux")try{const l=n.id||n._id;if(!l)return;const A=await x.users.getNetwork(l);N(A.data.networkId)}catch{N(null)}})()},[n]),u.useEffect(()=>{(async()=>{try{let l;if(h.isAdmin||h.isSuperAdmin||h.isManager)if(o){const r=o.id||o._id;l=await x.networks.getAll({churchId:r})}else{v([]),b(!1);return}else if(n?.eglise_locale){const r=typeof n.eglise_locale=="object"?n.eglise_locale.id||n.eglise_locale._id:n.eglise_locale;l=await x.networks.getAll({churchId:r})}else l=await x.networks.getAll();const B=(l.data?.data||l.data||[]).map(async r=>{try{const i=await x.networks.getStatsById(r.id||r._id);return{...r,stats:i.data}}catch(i){const g=z(i,`erreur lors de la récupération des stats pour ${r.nom}:`);return{...r,stats:null}}}),R=(await Promise.all(B)).map(r=>{const i=r.stats?.data??{};return{id:r.id||r._id,nom:r.nom,responsables:r.responsable2?.username?`${j(r.responsable1?.username)} & ${j(r.responsable2?.username)}`:j(r.responsable1?.username),nb_gr:i.totalGroups??0,nb_12:i[12]??0,nb_144:i[144]??0,nb_1728:i[1728]??0,nb_respo_gr:i["Responsables de GR"]??0,nb_leader:i.Leader??0,nb_leader_tous:i["Leader (Tous)"]??0,nb_membre:i["Membre simple"]??0}}).sort((r,i)=>{const g=f(r);return f(i)-g});v(R),b(!1)}catch(l){E(l.message),b(!1)}})()},[n,o]);const f=s=>(s.nb_12||0)+(s.nb_144||0)+(s.nb_1728||0)+(s.nb_leader||0)+(s.nb_membre||0)+(s.responsables?s.responsables.split("&").length:0);return I?e.jsx(O,{titre:a.t("networks.loading")}):S?e.jsx(X,{error:S,title:a.t("errors.loading")}):e.jsx(q,{allowedRoles:["SUPER_ADMIN","ADMIN","MANAGER","COLLECTEUR_RESEAUX"],children:e.jsxs(m,{sx:{minHeight:"100vh",bgcolor:"background.default"},children:[e.jsx(F,{}),e.jsxs(W,{maxWidth:"lg",sx:{mt:0,mb:4},children:[e.jsxs(m,{sx:{mb:4,display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"stretch",sm:"center"},gap:{xs:2,sm:0}},children:[e.jsx(t,{variant:"h4",sx:{color:"primary.main",fontWeight:"bold"},children:a.t("networks.list.title")}),(h.isAdmin||h.isSuperAdmin)&&e.jsxs(L,{sx:{minWidth:{xs:"100%",sm:250},maxWidth:{xs:"100%",sm:300}},children:[e.jsx(P,{id:"church-select-label",children:a.t("networks.list.filterByChurch")}),e.jsx(M,{id:"networks-church-select",name:"church",labelId:"church-select-label",value:o?.id||o?._id||"",label:a.t("networks.list.filterByChurch"),onChange:s=>{const l=s.target.value;_(l)},sx:{backgroundColor:"#fdfdfd"},autoComplete:"off",children:p.map(s=>e.jsx(T,{value:s.id||s._id,children:s.nom},s.id||s._id))})]})]}),w.length===0?e.jsxs(m,{sx:{textAlign:"center",py:8,px:2,backgroundColor:"background.paper",borderRadius:2,border:"2px dashed",borderColor:"divider",mx:2},children:[e.jsx(t,{variant:"h5",color:"text.secondary",gutterBottom:!0,children:"Aucun réseau trouvé"}),e.jsx(t,{variant:"body1",color:"text.secondary",sx:{mb:3},children:o?a.t("networks.noNetworksForChurch",{churchName:o.nom}):a.t("networks.noNetworksAvailable")}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Les réseaux apparaîtront ici une fois créés"})]}):e.jsx(C,{container:!0,children:w.map(s=>e.jsx(C,{"data-aos":"fade-up",sx:{width:"100%",padding:"10px 10px 10px 10px","@media (min-width:700px) and (max-width:1099px)":{width:"50%"},"@media (min-width:1100px) and (max-width:1599px)":{width:"33.33%"},"@media (min-width:1600px)":{width:"25%"},flexBasis:"unset",maxWidth:"unset",flexGrow:0,flexShrink:0,height:"100%"},children:e.jsxs(K,{elevation:2,children:[e.jsx(t,{variant:"h5",gutterBottom:!0,children:s.nom}),e.jsxs(c,{children:[e.jsx(t,{variant:"subtitle2",children:a.t("networks.list.responsables")}),e.jsx(t,{children:s.responsables||"-"})]}),e.jsxs(c,{children:[e.jsx(t,{variant:"subtitle2",children:a.t("networks.list.gr")}),e.jsx(t,{children:s.nb_gr})]}),e.jsxs(c,{children:[e.jsx(t,{variant:"subtitle2",children:a.t("networks.list.group12")}),e.jsx(t,{children:s.nb_12})]}),e.jsxs(c,{children:[e.jsx(t,{variant:"subtitle2",children:a.t("networks.list.group144")}),e.jsx(t,{children:s.nb_144})]}),e.jsxs(c,{children:[e.jsx(t,{variant:"subtitle2",children:a.t("networks.list.group1728")}),e.jsx(t,{children:s.nb_1728})]}),e.jsxs(c,{children:[e.jsx(t,{variant:"subtitle2",children:a.t("networks.list.responsableGR")}),e.jsx(t,{children:s.nb_respo_gr})]}),e.jsxs(c,{children:[e.jsx(t,{variant:"subtitle2",children:a.t("networks.list.leader")}),e.jsx(t,{children:s.nb_leader})]}),e.jsxs(c,{children:[e.jsx(t,{variant:"subtitle2",children:a.t("networks.list.leaderAll")}),e.jsx(t,{children:s.nb_leader_tous})]}),e.jsxs(c,{children:[e.jsx(t,{variant:"subtitle2",children:a.t("networks.list.member")}),e.jsx(t,{children:s.nb_membre})]}),e.jsxs(c,{children:[e.jsx(t,{variant:"h6",sx:{fontWeight:"bold",fontSize:"1.1rem",color:"primary.main"},children:a.t("networks.list.total")}),e.jsx(t,{sx:{fontWeight:"bold",fontSize:"1.1rem",color:"primary.main"},children:f(s)})]}),e.jsx(m,{sx:{mt:"auto",pt:2},children:e.jsx(G,{variant:"contained",color:"primary",fullWidth:!0,onClick:()=>d(`/networks/${s.id}`),disabled:(n?.current_role||n?.role)==="collecteur_reseaux"&&(y===null||String(y)!==String(s.id)),children:a.t("common.actions.view")})})]})},s.id))})]})]})})};export{le as default};
