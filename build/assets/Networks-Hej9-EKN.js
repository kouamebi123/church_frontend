import{r as h,j as e,B as u,g as E,T as t,F as B,s as T,t as M,M as L,G as N,O as A,n as P,h as D}from"./mui-mRVmBbre.js";import{c as G,b as U,L as $,i as a,N as z,a as p,h as O,m as X}from"./index-tq1YSY20.js";import{S as Y}from"./SecureErrorMessage-CIL0bUY2.js";import{u as H}from"./redux-DbjaNwcH.js";import{A as q}from"./AccessControl-kK8-PbhW.js";import{u as J}from"./router-BwhLjOj0.js";import"./vendor-Bzgz95E1.js";import"./utils-DP_tgNw_.js";const K=A(D)(({theme:d})=>({padding:d.spacing(3),height:"100%",display:"flex",flexDirection:"column",gap:d.spacing(2),background:"linear-gradient(145deg, #FFFFFF 0%, #F5F3FF 100%)",borderRadius:"20px",border:"1px solid rgba(102, 45, 145, 0.1)",boxShadow:"0 4px 20px rgba(102, 45, 145, 0.08)",transition:"all 0.4s cubic-bezier(0.4, 0, 0.2, 1)",position:"relative",overflow:"hidden","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,height:"4px",background:"linear-gradient(90deg, rgb(59, 20, 100), #662d91, #9e005d)",opacity:0,transition:"opacity 0.4s ease"},"&:hover":{transform:"translateY(-10px) scale(1.02)",boxShadow:"0 15px 50px rgba(102, 45, 145, 0.18)","&::before":{opacity:1}}})),c=A(u)(({theme:d})=>({display:"flex",justifyContent:"space-between",alignItems:"center",padding:d.spacing(1.5),borderRadius:"8px",background:"rgba(102, 45, 145, 0.02)",marginBottom:d.spacing(1),transition:"all 0.2s ease","&:hover":{background:"rgba(102, 45, 145, 0.05)",transform:"translateX(4px)"},"& .MuiTypography-subtitle2":{fontWeight:600,color:d.palette.text.secondary},"& .MuiTypography-root:not(.MuiTypography-subtitle2)":{fontWeight:700,color:d.palette.primary.main}})),j=d=>{if(!d)return"";const i=X.map(b=>b.value),x=d.split(" "),o=x[0];return i.includes(o)&&x.length>=2?`${o} ${x[1]}`:o},le=()=>{const d=J(),{user:i}=H(s=>s.auth),x=G(),{selectedChurch:o,changeSelectedChurch:_,churches:b}=U(),[w,y]=h.useState([]),[F,g]=h.useState(!0),[v,W]=h.useState(null),[S,k]=h.useState(null);h.useEffect(()=>{(async()=>{if(i&&(i.current_role||i.role)==="collecteur_reseaux")try{const l=i.id||i._id;if(!l)return;const C=await p.users.getNetwork(l);k(C.data.networkId)}catch{k(null)}})()},[i]),h.useEffect(()=>{(async()=>{try{let l;if(x.isAdmin||x.isSuperAdmin||x.isManager)if(o){const r=o.id||o._id;l=await p.networks.getAll({churchId:r})}else{y([]),g(!1);return}else if(i?.eglise_locale){const r=typeof i.eglise_locale=="object"?i.eglise_locale.id||i.eglise_locale._id:i.eglise_locale;l=await p.networks.getAll({churchId:r})}else l=await p.networks.getAll();const I=(l.data?.data||l.data||[]).map(async r=>{try{const n=await p.networks.getStatsById(r.id||r._id);return{...r,stats:n.data}}catch(n){const f=O(n,`erreur lors de la récupération des stats pour ${r.nom}:`);return{...r,stats:null}}}),R=(await Promise.all(I)).map(r=>{const n=r.stats?.data??{};return{id:r.id||r._id,nom:r.nom,responsables:r.responsable2?.username?`${j(r.responsable1?.username)} & ${j(r.responsable2?.username)}`:j(r.responsable1?.username),nb_gr:n.totalGroups??0,nb_12:n[12]??0,nb_144:n[144]??0,nb_1728:n[1728]??0,nb_respo_gr:n["Responsables de GR"]??0,nb_leader:n.Leader??0,nb_leader_tous:n["Leader (Tous)"]??0,nb_membre:n["Membre simple"]??0}}).sort((r,n)=>{const f=m(r);return m(n)-f});y(R),g(!1)}catch(l){W(l.message),g(!1)}})()},[i,o]);const m=s=>(s.nb_12||0)+(s.nb_144||0)+(s.nb_1728||0)+(s.nb_leader||0)+(s.nb_membre||0)+(s.responsables?s.responsables.split("&").length:0);return F?e.jsx($,{titre:a.t("networks.loading")}):v?e.jsx(Y,{error:v,title:a.t("errors.loading")}):e.jsx(q,{allowedRoles:["SUPER_ADMIN","ADMIN","MANAGER","COLLECTEUR_RESEAUX"],children:e.jsxs(u,{sx:{minHeight:"100vh"},children:[e.jsx(z,{}),e.jsxs(E,{maxWidth:"lg",sx:{mt:0,mb:4,py:4},children:[e.jsxs(u,{sx:{mb:5,display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:{xs:"stretch",sm:"center"},gap:{xs:2,sm:0}},children:[e.jsxs(u,{children:[e.jsx(t,{variant:"h3",sx:{fontWeight:800,background:"linear-gradient(135deg, #662d91, #9e005d, #9e005d)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",letterSpacing:"-0.5px",mb:1},children:a.t("networks.list.title")}),e.jsx(u,{sx:{width:"80px",height:"4px",background:"linear-gradient(90deg, #662d91, #9e005d, #9e005d)",borderRadius:"2px"}})]}),(x.isAdmin||x.isSuperAdmin)&&e.jsxs(B,{sx:{minWidth:{xs:"100%",sm:250},maxWidth:{xs:"100%",sm:300}},children:[e.jsx(T,{id:"church-select-label",children:a.t("networks.list.filterByChurch")}),e.jsx(M,{id:"networks-church-select",name:"church",labelId:"church-select-label",value:o?.id||o?._id||"",label:a.t("networks.list.filterByChurch"),onChange:s=>{const l=s.target.value;_(l)},sx:{backgroundColor:"#fdfdfd"},autoComplete:"off",children:b.map(s=>e.jsx(L,{value:s.id||s._id,children:s.nom},s.id||s._id))})]})]}),w.length===0?e.jsxs(u,{sx:{textAlign:"center",py:8,px:2,backgroundColor:"background.paper",borderRadius:2,border:"2px dashed",borderColor:"divider",mx:2},children:[e.jsx(t,{variant:"h5",color:"text.secondary",gutterBottom:!0,children:"Aucun réseau trouvé"}),e.jsx(t,{variant:"body1",color:"text.secondary",sx:{mb:3},children:o?a.t("networks.noNetworksForChurch",{churchName:o.nom}):a.t("networks.noNetworksAvailable")}),e.jsx(t,{variant:"body2",color:"text.secondary",children:"Les réseaux apparaîtront ici une fois créés"})]}):e.jsx(N,{container:!0,children:w.map(s=>e.jsx(N,{"data-aos":"fade-up",sx:{width:"100%",padding:"10px 10px 10px 10px","@media (min-width:700px) and (max-width:1099px)":{width:"50%"},"@media (min-width:1100px) and (max-width:1599px)":{width:"33.33%"},"@media (min-width:1600px)":{width:"25%"},flexBasis:"unset",maxWidth:"unset",flexGrow:0,flexShrink:0,height:"100%"},children:e.jsxs(K,{elevation:2,children:[e.jsx(t,{variant:"h5",gutterBottom:!0,sx:{fontWeight:700,color:"primary.main",mb:3,pb:2,borderBottom:"2px solid rgba(102, 45, 145, 0.1)"},children:s.nom}),e.jsxs(c,{children:[e.jsx(t,{variant:"subtitle2",children:a.t("networks.list.responsables")}),e.jsx(t,{children:s.responsables||"-"})]}),e.jsxs(c,{children:[e.jsx(t,{variant:"subtitle2",children:a.t("networks.list.gr")}),e.jsx(t,{children:s.nb_gr})]}),e.jsxs(c,{children:[e.jsx(t,{variant:"subtitle2",children:a.t("networks.list.group12")}),e.jsx(t,{children:s.nb_12})]}),e.jsxs(c,{children:[e.jsx(t,{variant:"subtitle2",children:a.t("networks.list.group144")}),e.jsx(t,{children:s.nb_144})]}),e.jsxs(c,{children:[e.jsx(t,{variant:"subtitle2",children:a.t("networks.list.group1728")}),e.jsx(t,{children:s.nb_1728})]}),e.jsxs(c,{children:[e.jsx(t,{variant:"subtitle2",children:a.t("networks.list.responsableGR")}),e.jsx(t,{children:s.nb_respo_gr})]}),e.jsxs(c,{children:[e.jsx(t,{variant:"subtitle2",children:a.t("networks.list.leader")}),e.jsx(t,{children:s.nb_leader})]}),e.jsxs(c,{children:[e.jsx(t,{variant:"subtitle2",children:a.t("networks.list.leaderAll")}),e.jsx(t,{children:s.nb_leader_tous})]}),e.jsxs(c,{children:[e.jsx(t,{variant:"subtitle2",children:a.t("networks.list.member")}),e.jsx(t,{children:s.nb_membre})]}),e.jsxs(c,{sx:{background:"linear-gradient(145deg, #F5F3FF 0%, #EDE9FE 100%)",border:"2px solid rgba(102, 45, 145, 0.2)",borderRadius:"12px",p:2,mt:2,boxShadow:"0 2px 8px rgba(102, 45, 145, 0.1)"},children:[e.jsx(t,{variant:"h6",sx:{fontWeight:700,fontSize:"1.1rem",color:"primary.main"},children:a.t("networks.list.total")}),e.jsx(t,{sx:{fontWeight:800,fontSize:"1.4rem",background:"linear-gradient(135deg, rgb(59, 20, 100) 0%, #662d91 50%, #9e005d 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:m(s)})]}),e.jsx(u,{sx:{mt:"auto",pt:3},children:e.jsx(P,{variant:"contained",fullWidth:!0,onClick:()=>d(`/networks/${s.id}`),disabled:(i?.current_role||i?.role)==="collecteur_reseaux"&&(S===null||String(S)!==String(s.id)),sx:{background:"linear-gradient(135deg, rgb(59, 20, 100) 0%, #662d91 50%, #9e005d 100%)",py:1.5,fontWeight:700,fontSize:"1rem",borderRadius:"12px",boxShadow:"0 4px 12px rgba(102, 45, 145, 0.25)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)","&:hover":{background:"linear-gradient(135deg, #1b1464, #662d91)",boxShadow:"0 8px 20px rgba(102, 45, 145, 0.35)",transform:"translateY(-2px)"},"&:disabled":{background:"rgba(102, 45, 145, 0.3)",color:"white"}},children:a.t("common.actions.view")})})]})},s.id))})]})]})})};export{le as default};
